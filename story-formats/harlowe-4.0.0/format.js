window.storyFormat({"name":"Harlowe","version":"4.0.0","author":"Leon Arnott","description":"The default story format for Twine 2, with numerous programming features and a rich passage editor. No HTML, JS or CSS experience required. Consult its <a href='https://www.cnbbx.com/twine/docs.html' target='_blank' rel='noopener noreferrer'>documentation</a>.","image":"icon.svg","url":"http://twinery.org/","license":"Zlib","proofing":false,"source":"<!DOCTYPE html>\n<html>\n\n<head>\n    <meta charset=\"utf-8\">\n    <meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n    <title>{{STORY_NAME}}</title>\n    <script>\n        var docEl = document.documentElement,\n            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',\n            recalc = function () {\n                let maxWidth = 750;\n                let cw = docEl.clientWidth > maxWidth ? maxWidth : docEl.clientWidth;\n                docEl.style.fontSize = 12 * (cw / 236) + 'px';\n            };\n        window.addEventListener(resizeEvt, recalc, false);\n        document.addEventListener('DOMContentLoaded', recalc, false);\n    </script>\n    <style title=\"Twine CSS\">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags=\"' attr(tags) '\">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags=\"' attr(tags) '\">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:\"<tw-sidebar>\"}.dom-debug-mode tw-hook::before{content:'<tw-hook name=\"' attr(name) '\">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name=\"' attr(name) '\">'}.dom-debug-mode tw-link::before{content:'<tw-link name=\"' attr(name) '\">'}.dom-debug-mode tw-dialog::before{content:\"<tw-dialog>\"}.dom-debug-mode tw-columns::before{content:\"<tw-columns>\"}.dom-debug-mode tw-column::before{content:\"<tw-column>\"}.dom-debug-mode tw-align::before{content:\"<tw-align>\"}.dom-debug-mode tw-include::before{content:'<tw-include type=\"' attr(type) '\" name=\"' attr(name) '\">'}tw-open-button[goto]{display:none}.debug-mode tw-open-button[replay],.debug-mode tw-open-button[goto]{display:inline}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"$\" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"_\" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2) !important}.debug-mode tw-expression[type=macro]::before{content:\"(\" attr(name) \":)\";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=\"\"]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1) !important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"[\"}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"]\"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"]<\" attr(name) \"|\"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1) !important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"{\"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"}\"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"`\"}.debug-mode tw-align[style*=\"text-align: center\"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 50%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*=\"text-align: left\"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0.25) 0%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*=\"text-align: right\"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type) ' \"' attr(name) '\"'}.debug-dialogs tw-backdrop:not(.eval-replay):not(.harlowe-crash){pointer-events:none;opacity:.1}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:\"...\"}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap !important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:flex;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:14em;min-height:1em;padding:0em .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 rgba(0,0,0,0) rgba(0,0,0,0) #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:flex;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger .panel-tools .panel-rows>*,tw-debugger .panel-options .panel-rows>*{margin-top:.4rem;display:block}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:\"~ No variables ~\";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:\"~ No enchantments ~\";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:\"~ No errors... for now. ~\";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:\"↓\"}tw-debugger th[data-col][data-order=desc]::after{content:\"↑\"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:\" in \"}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#575757;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=\"\"]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0px 0px .5em .5em;border-top:none;top:-2px}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:rgba(0,0,0,0) #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 rgba(0,0,0,0)}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3) !important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%;border:solid #fff !important}tw-dialog-links{text-align:right;display:flex;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:bold;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=\" color\"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=\" color\"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=\" color\"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=\" color\"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=\" color\"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=\" color\"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=\" color\"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=\" color\"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6) 1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:flex;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:.9em;line-height:130%;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden;overflow:hidden}tw-story select{background-color:rgba(0,0,0,0);font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{position:absolute;text-align:center;display:flex;justify-content:space-between;left:80px;right:80px;bottom:0em;flex-direction:row;width:auto;z-index:1;color:#fff}tw-icon{display:inline-block;margin:.5em 0;font-size:39px;font-family:\"Verdana\",sans-serif}tw-icon[alt]{opacity:.4;cursor:pointer}tw-icon[alt]:hover{opacity:.8}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .2rem;padding:3px;white-space:pre}tw-folddown::after{content:\"▶\"}tw-folddown.open::after{content:\"▼\"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline !important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment{color:#fff}tw-enchantment :empty{display:none}tw-enchantment tw-passage{position:absolute;left:0em;right:0em;bottom:0em;background:rgba(66,66,66,.5);padding:40px 15% 80px 15%}tw-enchantment tw-story{position:static}tw-enchantment tw-link{display:inline-block;padding:5px 10px;border-radius:5px;color:#fff;background-color:#fc0;margin:0 5px}tw-enchantment tw-link :hover{background-color:orange}tw-enchantment tw-link :active{background-color:#ff8c00}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0em 0em .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:flex;flex-direction:row;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}\n</style>\n</head>\n\n<body>\n    <tw-story>\n        <noscript>\n            <tw-noscript>JavaScript needs to be enabled to play {{STORY_NAME}}.</tw-noscript>\n        </noscript>\n        <tw-sidebar></tw-sidebar>\n    </tw-story>\n    {{STORY_DATA}}\n    <script title=\"Twine engine code\" data-main=\"harlowe\">!function(){\"use strict\";var e=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,\"default\")?e.default:e}var n,r={exports:{}};\n/*!\n * jQuery JavaScript Library v3.7.1\n * https://jquery.com/\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license\n * https://jquery.org/license\n *\n * Date: 2023-08-28T13:37Z\n */n=r,function(e,t){n.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\"jQuery requires a window with a document\");return t(e)}}(\"undefined\"!=typeof window?window:e,(function(e,t){var n=[],r=Object.getPrototypeOf,a=n.slice,o=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},i=n.push,s=n.indexOf,c={},l=c.toString,p=c.hasOwnProperty,u=p.toString,d=u.call(Object),h={},f=function(e){return\"function\"==typeof e&&\"number\"!=typeof e.nodeType&&\"function\"!=typeof e.item},m=function(e){return null!=e&&e===e.window},g=e.document,y={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,a,o=(n=n||g).createElement(\"script\");if(o.text=e,t)for(r in y)(a=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,a);n.head.appendChild(o).parentNode.removeChild(o)}function v(e){return null==e?e+\"\":\"object\"==typeof e||\"function\"==typeof e?c[l.call(e)]||\"object\":typeof e}var w=\"3.7.1\",k=/HTML$/i,x=function(e,t){return new x.fn.init(e,t)};function $(e){var t=!!e&&\"length\"in e&&e.length,n=v(e);return!f(e)&&!m(e)&&(\"array\"===n||0===t||\"number\"==typeof t&&t>0&&t-1 in e)}function T(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}x.fn=x.prototype={jquery:w,constructor:x,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return x.each(this,e)},map:function(e){return this.pushStack(x.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(x.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(x.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:i,sort:n.sort,splice:n.splice},x.extend=x.fn.extend=function(){var e,t,n,r,a,o,i=arguments[0]||{},s=1,c=arguments.length,l=!1;for(\"boolean\"==typeof i&&(l=i,i=arguments[s]||{},s++),\"object\"==typeof i||f(i)||(i={}),s===c&&(i=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],\"__proto__\"!==t&&i!==r&&(l&&r&&(x.isPlainObject(r)||(a=Array.isArray(r)))?(n=i[t],o=a&&!Array.isArray(n)?[]:a||x.isPlainObject(n)?n:{},a=!1,i[t]=x.extend(l,o,r)):void 0!==r&&(i[t]=r));return i},x.extend({expando:\"jQuery\"+(w+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\"[object Object]\"!==l.call(e)||(t=r(e))&&(\"function\"!=typeof(n=p.call(t,\"constructor\")&&t.constructor)||u.call(n)!==d))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if($(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n=\"\",r=0,a=e.nodeType;if(!a)for(;t=e[r++];)n+=x.text(t);return 1===a||11===a?e.textContent:9===a?e.documentElement.textContent:3===a||4===a?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&($(Object(e))?x.merge(n,\"string\"==typeof e?[e]:e):i.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!k.test(t||n&&n.nodeName||\"HTML\")},merge:function(e,t){for(var n=+t.length,r=0,a=e.length;r<n;r++)e[a++]=t[r];return e.length=a,e},grep:function(e,t,n){for(var r=[],a=0,o=e.length,i=!n;a<o;a++)!t(e[a],a)!==i&&r.push(e[a]);return r},map:function(e,t,n){var r,a,i=0,s=[];if($(e))for(r=e.length;i<r;i++)null!=(a=t(e[i],i,n))&&s.push(a);else for(i in e)null!=(a=t(e[i],i,n))&&s.push(a);return o(s)},guid:1,support:h}),\"function\"==typeof Symbol&&(x.fn[Symbol.iterator]=n[Symbol.iterator]),x.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),(function(e,t){c[\"[object \"+t+\"]\"]=t.toLowerCase()}));var S=n.pop,E=n.sort,C=n.splice,N=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",O=new RegExp(\"^\"+N+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+N+\"+$\",\"g\");x.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var j=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\x80-\\uFFFF\\w-]/g;function A(e,t){return t?\"\\0\"===e?\"�\":e.slice(0,-1)+\"\\\\\"+e.charCodeAt(e.length-1).toString(16)+\" \":\"\\\\\"+e}x.escapeSelector=function(e){return(e+\"\").replace(j,A)};var _=g,D=i;!function(){var t,r,o,i,c,l,u,d,f,m,g=D,y=x.expando,b=0,v=0,w=ee(),k=ee(),$=ee(),j=ee(),A=function(e,t){return e===t&&(c=!0),0},I=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",P=\"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\"+N+\"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",R=\"\\\\[\"+N+\"*(\"+P+\")(?:\"+N+\"*([*^$|!~]?=)\"+N+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+P+\"))|)\"+N+\"*\\\\]\",M=\":(\"+P+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+R+\")*)|.*)\\\\)|)\",V=new RegExp(N+\"+\",\"g\"),L=new RegExp(\"^\"+N+\"*,\"+N+\"*\"),F=new RegExp(\"^\"+N+\"*([>+~]|\"+N+\")\"+N+\"*\"),H=new RegExp(N+\"|>\"),q=new RegExp(M),z=new RegExp(\"^\"+P+\"$\"),W={ID:new RegExp(\"^#(\"+P+\")\"),CLASS:new RegExp(\"^\\\\.(\"+P+\")\"),TAG:new RegExp(\"^(\"+P+\"|[*])\"),ATTR:new RegExp(\"^\"+R),PSEUDO:new RegExp(\"^\"+M),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+N+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+N+\"*(?:([+-]|)\"+N+\"*(\\\\d+)|))\"+N+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+I+\")$\",\"i\"),needsContext:new RegExp(\"^\"+N+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+N+\"*((?:-\\\\d)?\\\\d*)\"+N+\"*\\\\)|)(?=[^-]|$)\",\"i\")},B=/^(?:input|select|textarea|button)$/i,U=/^h\\d$/i,G=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,X=/[+~]/,Y=new RegExp(\"\\\\\\\\[\\\\da-fA-F]{1,6}\"+N+\"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\",\"g\"),J=function(e,t){var n=\"0x\"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},K=function(){ce()},Q=de((function(e){return!0===e.disabled&&T(e,\"fieldset\")}),{dir:\"parentNode\",next:\"legend\"});try{g.apply(n=a.call(_.childNodes),_.childNodes),n[_.childNodes.length].nodeType}catch(e){g={apply:function(e,t){D.apply(e,a.call(t))},call:function(e){D.apply(e,a.call(arguments,1))}}}function Z(e,t,n,r){var a,o,i,s,c,p,u,m=t&&t.ownerDocument,b=t?t.nodeType:9;if(n=n||[],\"string\"!=typeof e||!e||1!==b&&9!==b&&11!==b)return n;if(!r&&(ce(t),t=t||l,d)){if(11!==b&&(c=G.exec(e)))if(a=c[1]){if(9===b){if(!(i=t.getElementById(a)))return n;if(i.id===a)return g.call(n,i),n}else if(m&&(i=m.getElementById(a))&&Z.contains(t,i)&&i.id===a)return g.call(n,i),n}else{if(c[2])return g.apply(n,t.getElementsByTagName(e)),n;if((a=c[3])&&t.getElementsByClassName)return g.apply(n,t.getElementsByClassName(a)),n}if(!(j[e+\" \"]||f&&f.test(e))){if(u=e,m=t,1===b&&(H.test(e)||F.test(e))){for((m=X.test(e)&&se(t.parentNode)||t)==t&&h.scope||((s=t.getAttribute(\"id\"))?s=x.escapeSelector(s):t.setAttribute(\"id\",s=y)),o=(p=pe(e)).length;o--;)p[o]=(s?\"#\"+s:\":scope\")+\" \"+ue(p[o]);u=p.join(\",\")}try{return g.apply(n,m.querySelectorAll(u)),n}catch(t){j(e,!0)}finally{s===y&&t.removeAttribute(\"id\")}}}return be(e.replace(O,\"$1\"),t,n,r)}function ee(){var e=[];return function t(n,a){return e.push(n+\" \")>r.cacheLength&&delete t[e.shift()],t[n+\" \"]=a}}function te(e){return e[y]=!0,e}function ne(e){var t=l.createElement(\"fieldset\");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function re(e){return function(t){return T(t,\"input\")&&t.type===e}}function ae(e){return function(t){return(T(t,\"input\")||T(t,\"button\"))&&t.type===e}}function oe(e){return function(t){return\"form\"in t?t.parentNode&&!1===t.disabled?\"label\"in t?\"label\"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Q(t)===e:t.disabled===e:\"label\"in t&&t.disabled===e}}function ie(e){return te((function(t){return t=+t,te((function(n,r){for(var a,o=e([],n.length,t),i=o.length;i--;)n[a=o[i]]&&(n[a]=!(r[a]=n[a]))}))}))}function se(e){return e&&void 0!==e.getElementsByTagName&&e}function ce(e){var t,n=e?e.ownerDocument||e:_;return n!=l&&9===n.nodeType&&n.documentElement?(u=(l=n).documentElement,d=!x.isXMLDoc(l),m=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,u.msMatchesSelector&&_!=l&&(t=l.defaultView)&&t.top!==t&&t.addEventListener(\"unload\",K),h.getById=ne((function(e){return u.appendChild(e).id=x.expando,!l.getElementsByName||!l.getElementsByName(x.expando).length})),h.disconnectedMatch=ne((function(e){return m.call(e,\"*\")})),h.scope=ne((function(){return l.querySelectorAll(\":scope\")})),h.cssHas=ne((function(){try{return l.querySelector(\":has(*,:jqfake)\"),!1}catch(e){return!0}})),h.getById?(r.filter.ID=function(e){var t=e.replace(Y,J);return function(e){return e.getAttribute(\"id\")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&d){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(Y,J);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode(\"id\");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&d){var n,r,a,o=t.getElementById(e);if(o){if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o];for(a=t.getElementsByName(e),r=0;o=a[r++];)if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o]}return[]}}),r.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},r.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&d)return t.getElementsByClassName(e)},f=[],ne((function(e){var t;u.appendChild(e).innerHTML=\"<a id='\"+y+\"' href='' disabled='disabled'></a><select id='\"+y+\"-\\r\\\\' disabled='disabled'><option selected=''></option></select>\",e.querySelectorAll(\"[selected]\").length||f.push(\"\\\\[\"+N+\"*(?:value|\"+I+\")\"),e.querySelectorAll(\"[id~=\"+y+\"-]\").length||f.push(\"~=\"),e.querySelectorAll(\"a#\"+y+\"+*\").length||f.push(\".#.+[+~]\"),e.querySelectorAll(\":checked\").length||f.push(\":checked\"),(t=l.createElement(\"input\")).setAttribute(\"type\",\"hidden\"),e.appendChild(t).setAttribute(\"name\",\"D\"),u.appendChild(e).disabled=!0,2!==e.querySelectorAll(\":disabled\").length&&f.push(\":enabled\",\":disabled\"),(t=l.createElement(\"input\")).setAttribute(\"name\",\"\"),e.appendChild(t),e.querySelectorAll(\"[name='']\").length||f.push(\"\\\\[\"+N+\"*name\"+N+\"*=\"+N+\"*(?:''|\\\"\\\")\")})),h.cssHas||f.push(\":has\"),f=f.length&&new RegExp(f.join(\"|\")),A=function(e,t){if(e===t)return c=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!h.sortDetached&&t.compareDocumentPosition(e)===n?e===l||e.ownerDocument==_&&Z.contains(_,e)?-1:t===l||t.ownerDocument==_&&Z.contains(_,t)?1:i?s.call(i,e)-s.call(i,t):0:4&n?-1:1)},l):l}for(t in Z.matches=function(e,t){return Z(e,null,null,t)},Z.matchesSelector=function(e,t){if(ce(e),d&&!j[t+\" \"]&&(!f||!f.test(t)))try{var n=m.call(e,t);if(n||h.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){j(t,!0)}return Z(t,l,null,[e]).length>0},Z.contains=function(e,t){return(e.ownerDocument||e)!=l&&ce(e),x.contains(e,t)},Z.attr=function(e,t){(e.ownerDocument||e)!=l&&ce(e);var n=r.attrHandle[t.toLowerCase()],a=n&&p.call(r.attrHandle,t.toLowerCase())?n(e,t,!d):void 0;return void 0!==a?a:e.getAttribute(t)},Z.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},x.uniqueSort=function(e){var t,n=[],r=0,o=0;if(c=!h.sortStable,i=!h.sortStable&&a.call(e,0),E.call(e,A),c){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)C.call(e,n[r],1)}return i=null,e},x.fn.uniqueSort=function(){return this.pushStack(x.uniqueSort(a.apply(this)))},r=x.expr={cacheLength:50,createPseudo:te,match:W,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Y,J),e[3]=(e[3]||e[4]||e[5]||\"\").replace(Y,J),\"~=\"===e[2]&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),\"nth\"===e[1].slice(0,3)?(e[3]||Z.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(\"even\"===e[3]||\"odd\"===e[3])),e[5]=+(e[7]+e[8]||\"odd\"===e[3])):e[3]&&Z.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return W.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||\"\":n&&q.test(n)&&(t=pe(n,!0))&&(t=n.indexOf(\")\",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Y,J).toLowerCase();return\"*\"===e?function(){return!0}:function(e){return T(e,t)}},CLASS:function(e){var t=w[e+\" \"];return t||(t=new RegExp(\"(^|\"+N+\")\"+e+\"(\"+N+\"|$)\"))&&w(e,(function(e){return t.test(\"string\"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute(\"class\")||\"\")}))},ATTR:function(e,t,n){return function(r){var a=Z.attr(r,e);return null==a?\"!=\"===t:!t||(a+=\"\",\"=\"===t?a===n:\"!=\"===t?a!==n:\"^=\"===t?n&&0===a.indexOf(n):\"*=\"===t?n&&a.indexOf(n)>-1:\"$=\"===t?n&&a.slice(-n.length)===n:\"~=\"===t?(\" \"+a.replace(V,\" \")+\" \").indexOf(n)>-1:\"|=\"===t&&(a===n||a.slice(0,n.length+1)===n+\"-\"))}},CHILD:function(e,t,n,r,a){var o=\"nth\"!==e.slice(0,3),i=\"last\"!==e.slice(-4),s=\"of-type\"===t;return 1===r&&0===a?function(e){return!!e.parentNode}:function(t,n,c){var l,p,u,d,h,f=o!==i?\"nextSibling\":\"previousSibling\",m=t.parentNode,g=s&&t.nodeName.toLowerCase(),v=!c&&!s,w=!1;if(m){if(o){for(;f;){for(u=t;u=u[f];)if(s?T(u,g):1===u.nodeType)return!1;h=f=\"only\"===e&&!h&&\"nextSibling\"}return!0}if(h=[i?m.firstChild:m.lastChild],i&&v){for(w=(d=(l=(p=m[y]||(m[y]={}))[e]||[])[0]===b&&l[1])&&l[2],u=d&&m.childNodes[d];u=++d&&u&&u[f]||(w=d=0)||h.pop();)if(1===u.nodeType&&++w&&u===t){p[e]=[b,d,w];break}}else if(v&&(w=d=(l=(p=t[y]||(t[y]={}))[e]||[])[0]===b&&l[1]),!1===w)for(;(u=++d&&u&&u[f]||(w=d=0)||h.pop())&&(!(s?T(u,g):1===u.nodeType)||!++w||(v&&((p=u[y]||(u[y]={}))[e]=[b,w]),u!==t)););return(w-=a)===r||w%r==0&&w/r>=0}}},PSEUDO:function(e,t){var n,a=r.pseudos[e]||r.setFilters[e.toLowerCase()]||Z.error(\"unsupported pseudo: \"+e);return a[y]?a(t):a.length>1?(n=[e,e,\"\",t],r.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,n){for(var r,o=a(e,t),i=o.length;i--;)e[r=s.call(e,o[i])]=!(n[r]=o[i])})):function(e){return a(e,0,n)}):a}},pseudos:{not:te((function(e){var t=[],n=[],r=ye(e.replace(O,\"$1\"));return r[y]?te((function(e,t,n,a){for(var o,i=r(e,null,a,[]),s=e.length;s--;)(o=i[s])&&(e[s]=!(t[s]=o))})):function(e,a,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}})),has:te((function(e){return function(t){return Z(e,t).length>0}})),contains:te((function(e){return e=e.replace(Y,J),function(t){return(t.textContent||x.text(t)).indexOf(e)>-1}})),lang:te((function(e){return z.test(e||\"\")||Z.error(\"unsupported lang: \"+e),e=e.replace(Y,J).toLowerCase(),function(t){var n;do{if(n=d?t.lang:t.getAttribute(\"xml:lang\")||t.getAttribute(\"lang\"))return(n=n.toLowerCase())===e||0===n.indexOf(e+\"-\")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===u},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:oe(!1),disabled:oe(!0),checked:function(e){return T(e,\"input\")&&!!e.checked||T(e,\"option\")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return U.test(e.nodeName)},input:function(e){return B.test(e.nodeName)},button:function(e){return T(e,\"input\")&&\"button\"===e.type||T(e,\"button\")},text:function(e){var t;return T(e,\"input\")&&\"text\"===e.type&&(null==(t=e.getAttribute(\"type\"))||\"text\"===t.toLowerCase())},first:ie((function(){return[0]})),last:ie((function(e,t){return[t-1]})),eq:ie((function(e,t,n){return[n<0?n+t:n]})),even:ie((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:ie((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:ie((function(e,t,n){var r;for(r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:ie((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}},r.pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=re(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ae(t);function le(){}function pe(e,t){var n,a,o,i,s,c,l,p=k[e+\" \"];if(p)return t?0:p.slice(0);for(s=e,c=[],l=r.preFilter;s;){for(i in n&&!(a=L.exec(s))||(a&&(s=s.slice(a[0].length)||s),c.push(o=[])),n=!1,(a=F.exec(s))&&(n=a.shift(),o.push({value:n,type:a[0].replace(O,\" \")}),s=s.slice(n.length)),r.filter)!(a=W[i].exec(s))||l[i]&&!(a=l[i](a))||(n=a.shift(),o.push({value:n,type:i,matches:a}),s=s.slice(n.length));if(!n)break}return t?s.length:s?Z.error(e):k(e,c).slice(0)}function ue(e){for(var t=0,n=e.length,r=\"\";t<n;t++)r+=e[t].value;return r}function de(e,t,n){var r=t.dir,a=t.next,o=a||r,i=n&&\"parentNode\"===o,s=v++;return t.first?function(t,n,a){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,a);return!1}:function(t,n,c){var l,p,u=[b,s];if(c){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||i)if(p=t[y]||(t[y]={}),a&&T(t,a))t=t[r]||t;else{if((l=p[o])&&l[0]===b&&l[1]===s)return u[2]=l[2];if(p[o]=u,u[2]=e(t,n,c))return!0}return!1}}function he(e){return e.length>1?function(t,n,r){for(var a=e.length;a--;)if(!e[a](t,n,r))return!1;return!0}:e[0]}function fe(e,t,n,r,a){for(var o,i=[],s=0,c=e.length,l=null!=t;s<c;s++)(o=e[s])&&(n&&!n(o,r,a)||(i.push(o),l&&t.push(s)));return i}function me(e,t,n,r,a,o){return r&&!r[y]&&(r=me(r)),a&&!a[y]&&(a=me(a,o)),te((function(o,i,c,l){var p,u,d,h,f=[],m=[],y=i.length,b=o||function(e,t,n){for(var r=0,a=t.length;r<a;r++)Z(e,t[r],n);return n}(t||\"*\",c.nodeType?[c]:c,[]),v=!e||!o&&t?b:fe(b,f,e,c,l);if(n?n(v,h=a||(o?e:y||r)?[]:i,c,l):h=v,r)for(p=fe(h,m),r(p,[],c,l),u=p.length;u--;)(d=p[u])&&(h[m[u]]=!(v[m[u]]=d));if(o){if(a||e){if(a){for(p=[],u=h.length;u--;)(d=h[u])&&p.push(v[u]=d);a(null,h=[],p,l)}for(u=h.length;u--;)(d=h[u])&&(p=a?s.call(o,d):f[u])>-1&&(o[p]=!(i[p]=d))}}else h=fe(h===i?h.splice(y,h.length):h),a?a(null,i,h,l):g.apply(i,h)}))}function ge(e){for(var t,n,a,i=e.length,c=r.relative[e[0].type],l=c||r.relative[\" \"],p=c?1:0,u=de((function(e){return e===t}),l,!0),d=de((function(e){return s.call(t,e)>-1}),l,!0),h=[function(e,n,r){var a=!c&&(r||n!=o)||((t=n).nodeType?u(e,n,r):d(e,n,r));return t=null,a}];p<i;p++)if(n=r.relative[e[p].type])h=[de(he(h),n)];else{if((n=r.filter[e[p].type].apply(null,e[p].matches))[y]){for(a=++p;a<i&&!r.relative[e[a].type];a++);return me(p>1&&he(h),p>1&&ue(e.slice(0,p-1).concat({value:\" \"===e[p-2].type?\"*\":\"\"})).replace(O,\"$1\"),n,p<a&&ge(e.slice(p,a)),a<i&&ge(e=e.slice(a)),a<i&&ue(e))}h.push(n)}return he(h)}function ye(e,t){var n,a=[],i=[],s=$[e+\" \"];if(!s){for(t||(t=pe(e)),n=t.length;n--;)(s=ge(t[n]))[y]?a.push(s):i.push(s);s=$(e,function(e,t){var n=t.length>0,a=e.length>0,i=function(i,s,c,p,u){var h,f,m,y=0,v=\"0\",w=i&&[],k=[],$=o,T=i||a&&r.find.TAG(\"*\",u),E=b+=null==$?1:Math.random()||.1,C=T.length;for(u&&(o=s==l||s||u);v!==C&&null!=(h=T[v]);v++){if(a&&h){for(f=0,s||h.ownerDocument==l||(ce(h),c=!d);m=e[f++];)if(m(h,s||l,c)){g.call(p,h);break}u&&(b=E)}n&&((h=!m&&h)&&y--,i&&w.push(h))}if(y+=v,n&&v!==y){for(f=0;m=t[f++];)m(w,k,s,c);if(i){if(y>0)for(;v--;)w[v]||k[v]||(k[v]=S.call(p));k=fe(k)}g.apply(p,k),u&&!i&&k.length>0&&y+t.length>1&&x.uniqueSort(p)}return u&&(b=E,o=$),w};return n?te(i):i}(i,a)),s.selector=e}return s}function be(e,t,n,a){var o,i,s,c,l,p=\"function\"==typeof e&&e,u=!a&&pe(e=p.selector||e);if(n=n||[],1===u.length){if((i=u[0]=u[0].slice(0)).length>2&&\"ID\"===(s=i[0]).type&&9===t.nodeType&&d&&r.relative[i[1].type]){if(!(t=(r.find.ID(s.matches[0].replace(Y,J),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=W.needsContext.test(e)?0:i.length;o--&&(s=i[o],!r.relative[c=s.type]);)if((l=r.find[c])&&(a=l(s.matches[0].replace(Y,J),X.test(i[0].type)&&se(t.parentNode)||t))){if(i.splice(o,1),!(e=a.length&&ue(i)))return g.apply(n,a),n;break}}return(p||ye(e,u))(a,t,!d,n,!t||X.test(e)&&se(t.parentNode)||t),n}le.prototype=r.filters=r.pseudos,r.setFilters=new le,h.sortStable=y.split(\"\").sort(A).join(\"\")===y,ce(),h.sortDetached=ne((function(e){return 1&e.compareDocumentPosition(l.createElement(\"fieldset\"))})),x.find=Z,x.expr[\":\"]=x.expr.pseudos,x.unique=x.uniqueSort,Z.compile=ye,Z.select=be,Z.setDocument=ce,Z.tokenize=pe,Z.escape=x.escapeSelector,Z.getText=x.text,Z.isXML=x.isXMLDoc,Z.selectors=x.expr,Z.support=x.support,Z.uniqueSort=x.uniqueSort}();var I=function(e,t,n){for(var r=[],a=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&x(e).is(n))break;r.push(e)}return r},P=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},R=x.expr.match.needsContext,M=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i;function V(e,t,n){return f(t)?x.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?x.grep(e,(function(e){return e===t!==n})):\"string\"!=typeof t?x.grep(e,(function(e){return s.call(t,e)>-1!==n})):x.filter(t,e,n)}x.filter=function(e,t,n){var r=t[0];return n&&(e=\":not(\"+e+\")\"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,(function(e){return 1===e.nodeType})))},x.fn.extend({find:function(e){var t,n,r=this.length,a=this;if(\"string\"!=typeof e)return this.pushStack(x(e).filter((function(){for(t=0;t<r;t++)if(x.contains(a[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)x.find(e,a[t],n);return r>1?x.uniqueSort(n):n},filter:function(e){return this.pushStack(V(this,e||[],!1))},not:function(e){return this.pushStack(V(this,e||[],!0))},is:function(e){return!!V(this,\"string\"==typeof e&&R.test(e)?x(e):e||[],!1).length}});var L,F=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(x.fn.init=function(e,t,n){var r,a;if(!e)return this;if(n=n||L,\"string\"==typeof e){if(!(r=\"<\"===e[0]&&\">\"===e[e.length-1]&&e.length>=3?[null,e,null]:F.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof x?t[0]:t,x.merge(this,x.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:g,!0)),M.test(r[1])&&x.isPlainObject(t))for(r in t)f(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(a=g.getElementById(r[2]))&&(this[0]=a,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):f(e)?void 0!==n.ready?n.ready(e):e(x):x.makeArray(e,this)}).prototype=x.fn,L=x(g);var H=/^(?:parents|prev(?:Until|All))/,q={children:!0,contents:!0,next:!0,prev:!0};function z(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}x.fn.extend({has:function(e){var t=x(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(x.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,a=this.length,o=[],i=\"string\"!=typeof e&&x(e);if(!R.test(e))for(;r<a;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(i?i.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?x.uniqueSort(o):o)},index:function(e){return e?\"string\"==typeof e?s.call(x(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(x.uniqueSort(x.merge(this.get(),x(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return I(e,\"parentNode\")},parentsUntil:function(e,t,n){return I(e,\"parentNode\",n)},next:function(e){return z(e,\"nextSibling\")},prev:function(e){return z(e,\"previousSibling\")},nextAll:function(e){return I(e,\"nextSibling\")},prevAll:function(e){return I(e,\"previousSibling\")},nextUntil:function(e,t,n){return I(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return I(e,\"previousSibling\",n)},siblings:function(e){return P((e.parentNode||{}).firstChild,e)},children:function(e){return P(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(T(e,\"template\")&&(e=e.content||e),x.merge([],e.childNodes))}},(function(e,t){x.fn[e]=function(n,r){var a=x.map(this,t,n);return\"Until\"!==e.slice(-5)&&(r=n),r&&\"string\"==typeof r&&(a=x.filter(r,a)),this.length>1&&(q[e]||x.uniqueSort(a),H.test(e)&&a.reverse()),this.pushStack(a)}}));var W=/[^\\x20\\t\\r\\n\\f]+/g;function B(e){return e}function U(e){throw e}function G(e,t,n,r){var a;try{e&&f(a=e.promise)?a.call(e).done(t).fail(n):e&&f(a=e.then)?a.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}x.Callbacks=function(e){e=\"string\"==typeof e?function(e){var t={};return x.each(e.match(W)||[],(function(e,n){t[n]=!0})),t}(e):x.extend({},e);var t,n,r,a,o=[],i=[],s=-1,c=function(){for(a=a||e.once,r=t=!0;i.length;s=-1)for(n=i.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,a&&(o=n?[]:\"\")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,i.push(n)),function t(n){x.each(n,(function(n,r){f(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&\"string\"!==v(r)&&t(r)}))}(arguments),n&&!t&&c()),this},remove:function(){return x.each(arguments,(function(e,t){for(var n;(n=x.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--})),this},has:function(e){return e?x.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return a=i=[],o=n=\"\",this},disabled:function(){return!o},lock:function(){return a=i=[],n||t||(o=n=\"\"),this},locked:function(){return!!a},fireWith:function(e,n){return a||(n=[e,(n=n||[]).slice?n.slice():n],i.push(n),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},x.extend({Deferred:function(t){var n=[[\"notify\",\"progress\",x.Callbacks(\"memory\"),x.Callbacks(\"memory\"),2],[\"resolve\",\"done\",x.Callbacks(\"once memory\"),x.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",x.Callbacks(\"once memory\"),x.Callbacks(\"once memory\"),1,\"rejected\"]],r=\"pending\",a={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var e=arguments;return x.Deferred((function(t){x.each(n,(function(n,r){var a=f(e[r[4]])&&e[r[4]];o[r[1]]((function(){var e=a&&a.apply(this,arguments);e&&f(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+\"With\"](this,a?[e]:arguments)}))})),e=null})).promise()},then:function(t,r,a){var o=0;function i(t,n,r,a){return function(){var s=this,c=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,c))===n.promise())throw new TypeError(\"Thenable self-resolution\");l=e&&(\"object\"==typeof e||\"function\"==typeof e)&&e.then,f(l)?a?l.call(e,i(o,n,B,a),i(o,n,U,a)):(o++,l.call(e,i(o,n,B,a),i(o,n,U,a),i(o,n,B,n.notifyWith))):(r!==B&&(s=void 0,c=[e]),(a||n.resolveWith)(s,c))}},p=a?l:function(){try{l()}catch(e){x.Deferred.exceptionHook&&x.Deferred.exceptionHook(e,p.error),t+1>=o&&(r!==U&&(s=void 0,c=[e]),n.rejectWith(s,c))}};t?p():(x.Deferred.getErrorHook?p.error=x.Deferred.getErrorHook():x.Deferred.getStackHook&&(p.error=x.Deferred.getStackHook()),e.setTimeout(p))}}return x.Deferred((function(e){n[0][3].add(i(0,e,f(a)?a:B,e.notifyWith)),n[1][3].add(i(0,e,f(t)?t:B)),n[2][3].add(i(0,e,f(r)?r:U))})).promise()},promise:function(e){return null!=e?x.extend(e,a):a}},o={};return x.each(n,(function(e,t){var i=t[2],s=t[5];a[t[1]]=i.add,s&&i.add((function(){r=s}),n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),i.add(t[3].fire),o[t[0]]=function(){return o[t[0]+\"With\"](this===o?void 0:this,arguments),this},o[t[0]+\"With\"]=i.fireWith})),a.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),o=a.call(arguments),i=x.Deferred(),s=function(e){return function(n){r[e]=this,o[e]=arguments.length>1?a.call(arguments):n,--t||i.resolveWith(r,o)}};if(t<=1&&(G(e,i.done(s(n)).resolve,i.reject,!t),\"pending\"===i.state()||f(o[n]&&o[n].then)))return i.then();for(;n--;)G(o[n],s(n),i.reject);return i.promise()}});var X=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;x.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&X.test(t.name)&&e.console.warn(\"jQuery.Deferred exception: \"+t.message,t.stack,n)},x.readyException=function(t){e.setTimeout((function(){throw t}))};var Y=x.Deferred();function J(){g.removeEventListener(\"DOMContentLoaded\",J),e.removeEventListener(\"load\",J),x.ready()}x.fn.ready=function(e){return Y.then(e).catch((function(e){x.readyException(e)})),this},x.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--x.readyWait:x.isReady)||(x.isReady=!0,!0!==e&&--x.readyWait>0||Y.resolveWith(g,[x]))}}),x.ready.then=Y.then,\"complete\"===g.readyState||\"loading\"!==g.readyState&&!g.documentElement.doScroll?e.setTimeout(x.ready):(g.addEventListener(\"DOMContentLoaded\",J),e.addEventListener(\"load\",J));var K=function(e,t,n,r,a,o,i){var s=0,c=e.length,l=null==n;if(\"object\"===v(n))for(s in a=!0,n)K(e,t,s,n[s],!0,o,i);else if(void 0!==r&&(a=!0,f(r)||(i=!0),l&&(i?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(x(e),n)})),t))for(;s<c;s++)t(e[s],n,i?r:r.call(e[s],s,t(e[s],n)));return a?e:l?t.call(e):c?t(e[0],n):o},Q=/^-ms-/,Z=/-([a-z])/g;function ee(e,t){return t.toUpperCase()}function te(e){return e.replace(Q,\"ms-\").replace(Z,ee)}var ne=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function re(){this.expando=x.expando+re.uid++}re.uid=1,re.prototype={cache:function(e){var t=e[this.expando];return t||(t={},ne(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,a=this.cache(e);if(\"string\"==typeof t)a[te(t)]=n;else for(r in t)a[te(r)]=t[r];return a},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][te(t)]},access:function(e,t,n){return void 0===t||t&&\"string\"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(te):(t=te(t))in r?[t]:t.match(W)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||x.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!x.isEmptyObject(t)}};var ae=new re,oe=new re,ie=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,se=/[A-Z]/g;function ce(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r=\"data-\"+t.replace(se,\"-$&\").toLowerCase(),\"string\"==typeof(n=e.getAttribute(r))){try{n=function(e){return\"true\"===e||\"false\"!==e&&(\"null\"===e?null:e===+e+\"\"?+e:ie.test(e)?JSON.parse(e):e)}(n)}catch(e){}oe.set(e,t,n)}else n=void 0;return n}x.extend({hasData:function(e){return oe.hasData(e)||ae.hasData(e)},data:function(e,t,n){return oe.access(e,t,n)},removeData:function(e,t){oe.remove(e,t)},_data:function(e,t,n){return ae.access(e,t,n)},_removeData:function(e,t){ae.remove(e,t)}}),x.fn.extend({data:function(e,t){var n,r,a,o=this[0],i=o&&o.attributes;if(void 0===e){if(this.length&&(a=oe.get(o),1===o.nodeType&&!ae.get(o,\"hasDataAttrs\"))){for(n=i.length;n--;)i[n]&&0===(r=i[n].name).indexOf(\"data-\")&&(r=te(r.slice(5)),ce(o,r,a[r]));ae.set(o,\"hasDataAttrs\",!0)}return a}return\"object\"==typeof e?this.each((function(){oe.set(this,e)})):K(this,(function(t){var n;if(o&&void 0===t)return void 0!==(n=oe.get(o,e))||void 0!==(n=ce(o,e))?n:void 0;this.each((function(){oe.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){oe.remove(this,e)}))}}),x.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=ae.get(e,t),n&&(!r||Array.isArray(n)?r=ae.access(e,t,x.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=x.queue(e,t),r=n.length,a=n.shift(),o=x._queueHooks(e,t);\"inprogress\"===a&&(a=n.shift(),r--),a&&(\"fx\"===t&&n.unshift(\"inprogress\"),delete o.stop,a.call(e,(function(){x.dequeue(e,t)}),o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return ae.get(e,n)||ae.access(e,n,{empty:x.Callbacks(\"once memory\").add((function(){ae.remove(e,[t+\"queue\",n])}))})}}),x.fn.extend({queue:function(e,t){var n=2;return\"string\"!=typeof e&&(t=e,e=\"fx\",n--),arguments.length<n?x.queue(this[0],e):void 0===t?this:this.each((function(){var n=x.queue(this,e,t);x._queueHooks(this,e),\"fx\"===e&&\"inprogress\"!==n[0]&&x.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){x.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,t){var n,r=1,a=x.Deferred(),o=this,i=this.length,s=function(){--r||a.resolveWith(o,[o])};for(\"string\"!=typeof e&&(t=e,e=void 0),e=e||\"fx\";i--;)(n=ae.get(o[i],e+\"queueHooks\"))&&n.empty&&(r++,n.empty.add(s));return s(),a.promise(t)}});var le=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,pe=new RegExp(\"^(?:([+-])=|)(\"+le+\")([a-z%]*)$\",\"i\"),ue=[\"Top\",\"Right\",\"Bottom\",\"Left\"],de=g.documentElement,he=function(e){return x.contains(e.ownerDocument,e)},fe={composed:!0};de.getRootNode&&(he=function(e){return x.contains(e.ownerDocument,e)||e.getRootNode(fe)===e.ownerDocument});var me=function(e,t){return\"none\"===(e=t||e).style.display||\"\"===e.style.display&&he(e)&&\"none\"===x.css(e,\"display\")};function ge(e,t,n,r){var a,o,i=20,s=r?function(){return r.cur()}:function(){return x.css(e,t,\"\")},c=s(),l=n&&n[3]||(x.cssNumber[t]?\"\":\"px\"),p=e.nodeType&&(x.cssNumber[t]||\"px\"!==l&&+c)&&pe.exec(x.css(e,t));if(p&&p[3]!==l){for(c/=2,l=l||p[3],p=+c||1;i--;)x.style(e,t,p+l),(1-o)*(1-(o=s()/c||.5))<=0&&(i=0),p/=o;p*=2,x.style(e,t,p+l),n=n||[]}return n&&(p=+p||+c||0,a=n[1]?p+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=p,r.end=a)),a}var ye={};function be(e){var t,n=e.ownerDocument,r=e.nodeName,a=ye[r];return a||(t=n.body.appendChild(n.createElement(r)),a=x.css(t,\"display\"),t.parentNode.removeChild(t),\"none\"===a&&(a=\"block\"),ye[r]=a,a)}function ve(e,t){for(var n,r,a=[],o=0,i=e.length;o<i;o++)(r=e[o]).style&&(n=r.style.display,t?(\"none\"===n&&(a[o]=ae.get(r,\"display\")||null,a[o]||(r.style.display=\"\")),\"\"===r.style.display&&me(r)&&(a[o]=be(r))):\"none\"!==n&&(a[o]=\"none\",ae.set(r,\"display\",n)));for(o=0;o<i;o++)null!=a[o]&&(e[o].style.display=a[o]);return e}x.fn.extend({show:function(){return ve(this,!0)},hide:function(){return ve(this)},toggle:function(e){return\"boolean\"==typeof e?e?this.show():this.hide():this.each((function(){me(this)?x(this).show():x(this).hide()}))}});var we,ke,xe=/^(?:checkbox|radio)$/i,$e=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i,Te=/^$|^module$|\\/(?:java|ecma)script/i;we=g.createDocumentFragment().appendChild(g.createElement(\"div\")),(ke=g.createElement(\"input\")).setAttribute(\"type\",\"radio\"),ke.setAttribute(\"checked\",\"checked\"),ke.setAttribute(\"name\",\"t\"),we.appendChild(ke),h.checkClone=we.cloneNode(!0).cloneNode(!0).lastChild.checked,we.innerHTML=\"<textarea>x</textarea>\",h.noCloneChecked=!!we.cloneNode(!0).lastChild.defaultValue,we.innerHTML=\"<option></option>\",h.option=!!we.lastChild;var Se={thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function Ee(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||\"*\"):void 0!==e.querySelectorAll?e.querySelectorAll(t||\"*\"):[],void 0===t||t&&T(e,t)?x.merge([e],n):n}function Ce(e,t){for(var n=0,r=e.length;n<r;n++)ae.set(e[n],\"globalEval\",!t||ae.get(t[n],\"globalEval\"))}Se.tbody=Se.tfoot=Se.colgroup=Se.caption=Se.thead,Se.th=Se.td,h.option||(Se.optgroup=Se.option=[1,\"<select multiple='multiple'>\",\"</select>\"]);var Ne=/<|&#?\\w+;/;function Oe(e,t,n,r,a){for(var o,i,s,c,l,p,u=t.createDocumentFragment(),d=[],h=0,f=e.length;h<f;h++)if((o=e[h])||0===o)if(\"object\"===v(o))x.merge(d,o.nodeType?[o]:o);else if(Ne.test(o)){for(i=i||u.appendChild(t.createElement(\"div\")),s=($e.exec(o)||[\"\",\"\"])[1].toLowerCase(),c=Se[s]||Se._default,i.innerHTML=c[1]+x.htmlPrefilter(o)+c[2],p=c[0];p--;)i=i.lastChild;x.merge(d,i.childNodes),(i=u.firstChild).textContent=\"\"}else d.push(t.createTextNode(o));for(u.textContent=\"\",h=0;o=d[h++];)if(r&&x.inArray(o,r)>-1)a&&a.push(o);else if(l=he(o),i=Ee(u.appendChild(o),\"script\"),l&&Ce(i),n)for(p=0;o=i[p++];)Te.test(o.type||\"\")&&n.push(o);return u}var je=/^([^.]*)(?:\\.(.+)|)/;function Ae(){return!0}function _e(){return!1}function De(e,t,n,r,a,o){var i,s;if(\"object\"==typeof t){for(s in\"string\"!=typeof n&&(r=r||n,n=void 0),t)De(e,s,n,r,t[s],o);return e}if(null==r&&null==a?(a=n,r=n=void 0):null==a&&(\"string\"==typeof n?(a=r,r=void 0):(a=r,r=n,n=void 0)),!1===a)a=_e;else if(!a)return e;return 1===o&&(i=a,a=function(e){return x().off(e),i.apply(this,arguments)},a.guid=i.guid||(i.guid=x.guid++)),e.each((function(){x.event.add(this,t,a,r,n)}))}function Ie(e,t,n){n?(ae.set(e,t,!1),x.event.add(e,t,{namespace:!1,handler:function(e){var n,r=ae.get(this,t);if(1&e.isTrigger&&this[t]){if(r)(x.event.special[t]||{}).delegateType&&e.stopPropagation();else if(r=a.call(arguments),ae.set(this,t,r),this[t](),n=ae.get(this,t),ae.set(this,t,!1),r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else r&&(ae.set(this,t,x.event.trigger(r[0],r.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ae)}})):void 0===ae.get(e,t)&&x.event.add(e,t,Ae)}x.event={global:{},add:function(e,t,n,r,a){var o,i,s,c,l,p,u,d,h,f,m,g=ae.get(e);if(ne(e))for(n.handler&&(n=(o=n).handler,a=o.selector),a&&x.find.matchesSelector(de,a),n.guid||(n.guid=x.guid++),(c=g.events)||(c=g.events=Object.create(null)),(i=g.handle)||(i=g.handle=function(t){return void 0!==x&&x.event.triggered!==t.type?x.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||\"\").match(W)||[\"\"]).length;l--;)h=m=(s=je.exec(t[l])||[])[1],f=(s[2]||\"\").split(\".\").sort(),h&&(u=x.event.special[h]||{},h=(a?u.delegateType:u.bindType)||h,u=x.event.special[h]||{},p=x.extend({type:h,origType:m,data:r,handler:n,guid:n.guid,selector:a,needsContext:a&&x.expr.match.needsContext.test(a),namespace:f.join(\".\")},o),(d=c[h])||((d=c[h]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,r,f,i)||e.addEventListener&&e.addEventListener(h,i)),u.add&&(u.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),a?d.splice(d.delegateCount++,0,p):d.push(p),x.event.global[h]=!0)},remove:function(e,t,n,r,a){var o,i,s,c,l,p,u,d,h,f,m,g=ae.hasData(e)&&ae.get(e);if(g&&(c=g.events)){for(l=(t=(t||\"\").match(W)||[\"\"]).length;l--;)if(h=m=(s=je.exec(t[l])||[])[1],f=(s[2]||\"\").split(\".\").sort(),h){for(u=x.event.special[h]||{},d=c[h=(r?u.delegateType:u.bindType)||h]||[],s=s[2]&&new RegExp(\"(^|\\\\.)\"+f.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),i=o=d.length;o--;)p=d[o],!a&&m!==p.origType||n&&n.guid!==p.guid||s&&!s.test(p.namespace)||r&&r!==p.selector&&(\"**\"!==r||!p.selector)||(d.splice(o,1),p.selector&&d.delegateCount--,u.remove&&u.remove.call(e,p));i&&!d.length&&(u.teardown&&!1!==u.teardown.call(e,f,g.handle)||x.removeEvent(e,h,g.handle),delete c[h])}else for(h in c)x.event.remove(e,h+t[l],n,r,!0);x.isEmptyObject(c)&&ae.remove(e,\"handle events\")}},dispatch:function(e){var t,n,r,a,o,i,s=new Array(arguments.length),c=x.event.fix(e),l=(ae.get(this,\"events\")||Object.create(null))[c.type]||[],p=x.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!p.preDispatch||!1!==p.preDispatch.call(this,c)){for(i=x.event.handlers.call(this,c,l),t=0;(a=i[t++])&&!c.isPropagationStopped();)for(c.currentTarget=a.elem,n=0;(o=a.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==o.namespace&&!c.rnamespace.test(o.namespace)||(c.handleObj=o,c.data=o.data,void 0!==(r=((x.event.special[o.origType]||{}).handle||o.handler).apply(a.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return p.postDispatch&&p.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,a,o,i,s=[],c=t.delegateCount,l=e.target;if(c&&l.nodeType&&!(\"click\"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(\"click\"!==e.type||!0!==l.disabled)){for(o=[],i={},n=0;n<c;n++)void 0===i[a=(r=t[n]).selector+\" \"]&&(i[a]=r.needsContext?x(a,this).index(l)>-1:x.find(a,this,null,[l]).length),i[a]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,c<t.length&&s.push({elem:l,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(x.Event.prototype,e,{enumerable:!0,configurable:!0,get:f(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[x.expando]?e:new x.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return xe.test(t.type)&&t.click&&T(t,\"input\")&&Ie(t,\"click\",!0),!1},trigger:function(e){var t=this||e;return xe.test(t.type)&&t.click&&T(t,\"input\")&&Ie(t,\"click\"),!0},_default:function(e){var t=e.target;return xe.test(t.type)&&t.click&&T(t,\"input\")&&ae.get(t,\"click\")||T(t,\"a\")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},x.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},x.Event=function(e,t){if(!(this instanceof x.Event))return new x.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ae:_e,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&x.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[x.expando]=!0},x.Event.prototype={constructor:x.Event,isDefaultPrevented:_e,isPropagationStopped:_e,isImmediatePropagationStopped:_e,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ae,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ae,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ae,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},x.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},x.event.addProp),x.each({focus:\"focusin\",blur:\"focusout\"},(function(e,t){function n(e){if(g.documentMode){var n=ae.get(this,\"handle\"),r=x.event.fix(e);r.type=\"focusin\"===e.type?\"focus\":\"blur\",r.isSimulated=!0,n(e),r.target===r.currentTarget&&n(r)}else x.event.simulate(t,e.target,x.event.fix(e))}x.event.special[e]={setup:function(){var r;if(Ie(this,e,!0),!g.documentMode)return!1;(r=ae.get(this,t))||this.addEventListener(t,n),ae.set(this,t,(r||0)+1)},trigger:function(){return Ie(this,e),!0},teardown:function(){var e;if(!g.documentMode)return!1;(e=ae.get(this,t)-1)?ae.set(this,t,e):(this.removeEventListener(t,n),ae.remove(this,t))},_default:function(t){return ae.get(t.target,e)},delegateType:t},x.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,a=g.documentMode?this:r,o=ae.get(a,t);o||(g.documentMode?this.addEventListener(t,n):r.addEventListener(e,n,!0)),ae.set(a,t,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,a=g.documentMode?this:r,o=ae.get(a,t)-1;o?ae.set(a,t,o):(g.documentMode?this.removeEventListener(t,n):r.removeEventListener(e,n,!0),ae.remove(a,t))}}})),x.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},(function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,a=e.handleObj;return r&&(r===this||x.contains(this,r))||(e.type=a.origType,n=a.handler.apply(this,arguments),e.type=t),n}}})),x.fn.extend({on:function(e,t,n,r){return De(this,e,t,n,r)},one:function(e,t,n,r){return De(this,e,t,n,r,1)},off:function(e,t,n){var r,a;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,x(e.delegateTarget).off(r.namespace?r.origType+\".\"+r.namespace:r.origType,r.selector,r.handler),this;if(\"object\"==typeof e){for(a in e)this.off(a,t,e[a]);return this}return!1!==t&&\"function\"!=typeof t||(n=t,t=void 0),!1===n&&(n=_e),this.each((function(){x.event.remove(this,e,n,t)}))}});var Pe=/<script|<style|<link/i,Re=/checked\\s*(?:[^=]|=\\s*.checked.)/i,Me=/^\\s*<!\\[CDATA\\[|\\]\\]>\\s*$/g;function Ve(e,t){return T(e,\"table\")&&T(11!==t.nodeType?t:t.firstChild,\"tr\")&&x(e).children(\"tbody\")[0]||e}function Le(e){return e.type=(null!==e.getAttribute(\"type\"))+\"/\"+e.type,e}function Fe(e){return\"true/\"===(e.type||\"\").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute(\"type\"),e}function He(e,t){var n,r,a,o,i,s;if(1===t.nodeType){if(ae.hasData(e)&&(s=ae.get(e).events))for(a in ae.remove(t,\"handle events\"),s)for(n=0,r=s[a].length;n<r;n++)x.event.add(t,a,s[a][n]);oe.hasData(e)&&(o=oe.access(e),i=x.extend({},o),oe.set(t,i))}}function qe(e,t){var n=t.nodeName.toLowerCase();\"input\"===n&&xe.test(e.type)?t.checked=e.checked:\"input\"!==n&&\"textarea\"!==n||(t.defaultValue=e.defaultValue)}function ze(e,t,n,r){t=o(t);var a,i,s,c,l,p,u=0,d=e.length,m=d-1,g=t[0],y=f(g);if(y||d>1&&\"string\"==typeof g&&!h.checkClone&&Re.test(g))return e.each((function(a){var o=e.eq(a);y&&(t[0]=g.call(this,a,o.html())),ze(o,t,n,r)}));if(d&&(i=(a=Oe(t,e[0].ownerDocument,!1,e,r)).firstChild,1===a.childNodes.length&&(a=i),i||r)){for(c=(s=x.map(Ee(a,\"script\"),Le)).length;u<d;u++)l=a,u!==m&&(l=x.clone(l,!0,!0),c&&x.merge(s,Ee(l,\"script\"))),n.call(e[u],l,u);if(c)for(p=s[s.length-1].ownerDocument,x.map(s,Fe),u=0;u<c;u++)l=s[u],Te.test(l.type||\"\")&&!ae.access(l,\"globalEval\")&&x.contains(p,l)&&(l.src&&\"module\"!==(l.type||\"\").toLowerCase()?x._evalUrl&&!l.noModule&&x._evalUrl(l.src,{nonce:l.nonce||l.getAttribute(\"nonce\")},p):b(l.textContent.replace(Me,\"\"),l,p))}return e}function We(e,t,n){for(var r,a=t?x.filter(t,e):e,o=0;null!=(r=a[o]);o++)n||1!==r.nodeType||x.cleanData(Ee(r)),r.parentNode&&(n&&he(r)&&Ce(Ee(r,\"script\")),r.parentNode.removeChild(r));return e}x.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,a,o,i,s=e.cloneNode(!0),c=he(e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(i=Ee(s),r=0,a=(o=Ee(e)).length;r<a;r++)qe(o[r],i[r]);if(t)if(n)for(o=o||Ee(e),i=i||Ee(s),r=0,a=o.length;r<a;r++)He(o[r],i[r]);else He(e,s);return(i=Ee(s,\"script\")).length>0&&Ce(i,!c&&Ee(e,\"script\")),s},cleanData:function(e){for(var t,n,r,a=x.event.special,o=0;void 0!==(n=e[o]);o++)if(ne(n)){if(t=n[ae.expando]){if(t.events)for(r in t.events)a[r]?x.event.remove(n,r):x.removeEvent(n,r,t.handle);n[ae.expando]=void 0}n[oe.expando]&&(n[oe.expando]=void 0)}}}),x.fn.extend({detach:function(e){return We(this,e,!0)},remove:function(e){return We(this,e)},text:function(e){return K(this,(function(e){return void 0===e?x.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return ze(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ve(this,e).appendChild(e)}))},prepend:function(){return ze(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ve(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return ze(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return ze(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(x.cleanData(Ee(e,!1)),e.textContent=\"\");return this},clone:function(e,t){return e=e??!1,t=t??e,this.map((function(){return x.clone(this,e,t)}))},html:function(e){return K(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if(\"string\"==typeof e&&!Pe.test(e)&&!Se[($e.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=x.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(x.cleanData(Ee(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return ze(this,arguments,(function(t){var n=this.parentNode;x.inArray(this,e)<0&&(x.cleanData(Ee(this)),n&&n.replaceChild(t,this))}),e)}}),x.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},(function(e,t){x.fn[e]=function(e){for(var n,r=[],a=x(e),o=a.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),x(a[s])[t](n),i.apply(r,n.get());return this.pushStack(r)}}));var Be=new RegExp(\"^(\"+le+\")(?!px)[a-z%]+$\",\"i\"),Ue=/^--/,Ge=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Xe=function(e,t,n){var r,a,o={};for(a in t)o[a]=e.style[a],e.style[a]=t[a];for(a in r=n.call(e),t)e.style[a]=o[a];return r},Ye=new RegExp(ue.join(\"|\"),\"i\");function Je(e,t,n){var r,a,o,i,s=Ue.test(t),c=e.style;return(n=n||Ge(e))&&(i=n.getPropertyValue(t)||n[t],s&&i&&(i=i.replace(O,\"$1\")||void 0),\"\"!==i||he(e)||(i=x.style(e,t)),!h.pixelBoxStyles()&&Be.test(i)&&Ye.test(t)&&(r=c.width,a=c.minWidth,o=c.maxWidth,c.minWidth=c.maxWidth=c.width=i,i=n.width,c.width=r,c.minWidth=a,c.maxWidth=o)),void 0!==i?i+\"\":i}function Ke(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(p){l.style.cssText=\"position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0\",p.style.cssText=\"position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%\",de.appendChild(l).appendChild(p);var t=e.getComputedStyle(p);r=\"1%\"!==t.top,c=12===n(t.marginLeft),p.style.right=\"60%\",i=36===n(t.right),a=36===n(t.width),p.style.position=\"absolute\",o=12===n(p.offsetWidth/3),de.removeChild(l),p=null}}function n(e){return Math.round(parseFloat(e))}var r,a,o,i,s,c,l=g.createElement(\"div\"),p=g.createElement(\"div\");p.style&&(p.style.backgroundClip=\"content-box\",p.cloneNode(!0).style.backgroundClip=\"\",h.clearCloneStyle=\"content-box\"===p.style.backgroundClip,x.extend(h,{boxSizingReliable:function(){return t(),a},pixelBoxStyles:function(){return t(),i},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),o},reliableTrDimensions:function(){var t,n,r,a;return null==s&&(t=g.createElement(\"table\"),n=g.createElement(\"tr\"),r=g.createElement(\"div\"),t.style.cssText=\"position:absolute;left:-11111px;border-collapse:separate\",n.style.cssText=\"box-sizing:content-box;border:1px solid\",n.style.height=\"1px\",r.style.height=\"9px\",r.style.display=\"block\",de.appendChild(t).appendChild(n).appendChild(r),a=e.getComputedStyle(n),s=parseInt(a.height,10)+parseInt(a.borderTopWidth,10)+parseInt(a.borderBottomWidth,10)===n.offsetHeight,de.removeChild(t)),s}}))}();var Qe=[\"Webkit\",\"Moz\",\"ms\"],Ze=g.createElement(\"div\").style,et={};function tt(e){var t=x.cssProps[e]||et[e];return t||(e in Ze?e:et[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;n--;)if((e=Qe[n]+t)in Ze)return e}(e)||e)}var nt=/^(none|table(?!-c[ea]).+)/,rt={position:\"absolute\",visibility:\"hidden\",display:\"block\"},at={letterSpacing:\"0\",fontWeight:\"400\"};function ot(e,t,n){var r=pe.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||\"px\"):t}function it(e,t,n,r,a,o){var i=\"width\"===t?1:0,s=0,c=0,l=0;if(n===(r?\"border\":\"content\"))return 0;for(;i<4;i+=2)\"margin\"===n&&(l+=x.css(e,n+ue[i],!0,a)),r?(\"content\"===n&&(c-=x.css(e,\"padding\"+ue[i],!0,a)),\"margin\"!==n&&(c-=x.css(e,\"border\"+ue[i]+\"Width\",!0,a))):(c+=x.css(e,\"padding\"+ue[i],!0,a),\"padding\"!==n?c+=x.css(e,\"border\"+ue[i]+\"Width\",!0,a):s+=x.css(e,\"border\"+ue[i]+\"Width\",!0,a));return!r&&o>=0&&(c+=Math.max(0,Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-o-c-s-.5))||0),c+l}function st(e,t,n){var r=Ge(e),a=(!h.boxSizingReliable()||n)&&\"border-box\"===x.css(e,\"boxSizing\",!1,r),o=a,i=Je(e,t,r),s=\"offset\"+t[0].toUpperCase()+t.slice(1);if(Be.test(i)){if(!n)return i;i=\"auto\"}return(!h.boxSizingReliable()&&a||!h.reliableTrDimensions()&&T(e,\"tr\")||\"auto\"===i||!parseFloat(i)&&\"inline\"===x.css(e,\"display\",!1,r))&&e.getClientRects().length&&(a=\"border-box\"===x.css(e,\"boxSizing\",!1,r),(o=s in e)&&(i=e[s])),(i=parseFloat(i)||0)+it(e,t,n||(a?\"border\":\"content\"),o,r,i)+\"px\"}function ct(e,t,n,r,a){return new ct.prototype.init(e,t,n,r,a)}x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Je(e,\"opacity\");return\"\"===n?\"1\":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,o,i,s=te(t),c=Ue.test(t),l=e.style;if(c||(t=tt(s)),i=x.cssHooks[t]||x.cssHooks[s],void 0===n)return i&&\"get\"in i&&void 0!==(a=i.get(e,!1,r))?a:l[t];\"string\"==(o=typeof n)&&(a=pe.exec(n))&&a[1]&&(n=ge(e,t,a),o=\"number\"),null!=n&&n==n&&(\"number\"!==o||c||(n+=a&&a[3]||(x.cssNumber[s]?\"\":\"px\")),h.clearCloneStyle||\"\"!==n||0!==t.indexOf(\"background\")||(l[t]=\"inherit\"),i&&\"set\"in i&&void 0===(n=i.set(e,n,r))||(c?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var a,o,i,s=te(t);return Ue.test(t)||(t=tt(s)),(i=x.cssHooks[t]||x.cssHooks[s])&&\"get\"in i&&(a=i.get(e,!0,n)),void 0===a&&(a=Je(e,t,r)),\"normal\"===a&&t in at&&(a=at[t]),\"\"===n||n?(o=parseFloat(a),!0===n||isFinite(o)?o||0:a):a}}),x.each([\"height\",\"width\"],(function(e,t){x.cssHooks[t]={get:function(e,n,r){if(n)return!nt.test(x.css(e,\"display\"))||e.getClientRects().length&&e.getBoundingClientRect().width?st(e,t,r):Xe(e,rt,(function(){return st(e,t,r)}))},set:function(e,n,r){var a,o=Ge(e),i=!h.scrollboxSize()&&\"absolute\"===o.position,s=(i||r)&&\"border-box\"===x.css(e,\"boxSizing\",!1,o),c=r?it(e,t,r,s,o):0;return s&&i&&(c-=Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-it(e,t,\"border\",!1,o)-.5)),c&&(a=pe.exec(n))&&\"px\"!==(a[3]||\"px\")&&(e.style[t]=n,n=x.css(e,t)),ot(0,n,c)}}})),x.cssHooks.marginLeft=Ke(h.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Je(e,\"marginLeft\"))||e.getBoundingClientRect().left-Xe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+\"px\"})),x.each({margin:\"\",padding:\"\",border:\"Width\"},(function(e,t){x.cssHooks[e+t]={expand:function(n){for(var r=0,a={},o=\"string\"==typeof n?n.split(\" \"):[n];r<4;r++)a[e+ue[r]+t]=o[r]||o[r-2]||o[0];return a}},\"margin\"!==e&&(x.cssHooks[e+t].set=ot)})),x.fn.extend({css:function(e,t){return K(this,(function(e,t,n){var r,a,o={},i=0;if(Array.isArray(t)){for(r=Ge(e),a=t.length;i<a;i++)o[t[i]]=x.css(e,t[i],!1,r);return o}return void 0!==n?x.style(e,t,n):x.css(e,t)}),e,t,arguments.length>1)}}),x.Tween=ct,ct.prototype={constructor:ct,init:function(e,t,n,r,a,o){this.elem=e,this.prop=n,this.easing=a||x.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?\"\":\"px\")},cur:function(){var e=ct.propHooks[this.prop];return e&&e.get?e.get(this):ct.propHooks._default.get(this)},run:function(e){var t,n=ct.propHooks[this.prop];return this.options.duration?this.pos=t=x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ct.propHooks._default.set(this),this}},ct.prototype.init.prototype=ct.prototype,ct.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=x.css(e.elem,e.prop,\"\"))&&\"auto\"!==t?t:0},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):1!==e.elem.nodeType||!x.cssHooks[e.prop]&&null==e.elem.style[tt(e.prop)]?e.elem[e.prop]=e.now:x.style(e.elem,e.prop,e.now+e.unit)}}},ct.propHooks.scrollTop=ct.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:\"swing\"},x.fx=ct.prototype.init,x.fx.step={};var lt,pt,ut=/^(?:toggle|show|hide)$/,dt=/queueHooks$/;function ht(){pt&&(!1===g.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(ht):e.setTimeout(ht,x.fx.interval),x.fx.tick())}function ft(){return e.setTimeout((function(){lt=void 0})),lt=Date.now()}function mt(e,t){var n,r=0,a={height:e};for(t=t?1:0;r<4;r+=2-t)a[\"margin\"+(n=ue[r])]=a[\"padding\"+n]=e;return t&&(a.opacity=a.width=e),a}function gt(e,t,n){for(var r,a=(yt.tweeners[t]||[]).concat(yt.tweeners[\"*\"]),o=0,i=a.length;o<i;o++)if(r=a[o].call(n,t,e))return r}function yt(e,t,n){var r,a,o=0,i=yt.prefilters.length,s=x.Deferred().always((function(){delete c.elem})),c=function(){if(a)return!1;for(var t=lt||ft(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,i=l.tweens.length;o<i;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&i?n:(i||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{},easing:x.easing._default},n),originalProperties:t,originalOptions:n,startTime:lt||ft(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(a)return this;for(a=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),p=l.props;for(function(e,t){var n,r,a,o,i;for(n in e)if(a=t[r=te(n)],o=e[n],Array.isArray(o)&&(a=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(i=x.cssHooks[r])&&\"expand\"in i)for(n in o=i.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=a);else t[r]=a}(p,l.opts.specialEasing);o<i;o++)if(r=yt.prefilters[o].call(l,e,p,l.opts))return f(r.stop)&&(x._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return x.map(p,gt,l),f(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),x.fx.timer(x.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l}x.Animation=x.extend(yt,{tweeners:{\"*\":[function(e,t){var n=this.createTween(e,t);return ge(n.elem,e,pe.exec(t),n),n}]},tweener:function(e,t){f(e)?(t=e,e=[\"*\"]):e=e.match(W);for(var n,r=0,a=e.length;r<a;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,a,o,i,s,c,l,p,u=\"width\"in t||\"height\"in t,d=this,h={},f=e.style,m=e.nodeType&&me(e),g=ae.get(e,\"fxshow\");for(r in n.queue||(null==(i=x._queueHooks(e,\"fx\")).unqueued&&(i.unqueued=0,s=i.empty.fire,i.empty.fire=function(){i.unqueued||s()}),i.unqueued++,d.always((function(){d.always((function(){i.unqueued--,x.queue(e,\"fx\").length||i.empty.fire()}))}))),t)if(a=t[r],ut.test(a)){if(delete t[r],o=o||\"toggle\"===a,a===(m?\"hide\":\"show\")){if(\"show\"!==a||!g||void 0===g[r])continue;m=!0}h[r]=g&&g[r]||x.style(e,r)}if((c=!x.isEmptyObject(t))||!x.isEmptyObject(h))for(r in u&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(l=g&&g.display)&&(l=ae.get(e,\"display\")),\"none\"===(p=x.css(e,\"display\"))&&(l?p=l:(ve([e],!0),l=e.style.display||l,p=x.css(e,\"display\"),ve([e]))),(\"inline\"===p||\"inline-block\"===p&&null!=l)&&\"none\"===x.css(e,\"float\")&&(c||(d.done((function(){f.display=l})),null==l&&(p=f.display,l=\"none\"===p?\"\":p)),f.display=\"inline-block\")),n.overflow&&(f.overflow=\"hidden\",d.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),c=!1,h)c||(g?\"hidden\"in g&&(m=g.hidden):g=ae.access(e,\"fxshow\",{display:l}),o&&(g.hidden=!m),m&&ve([e],!0),d.done((function(){for(r in m||ve([e]),ae.remove(e,\"fxshow\"),h)x.style(e,r,h[r])}))),c=gt(m?g[r]:0,r,d),r in g||(g[r]=c.start,m&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),x.speed=function(e,t,n){var r=e&&\"object\"==typeof e?x.extend({},e):{complete:n||!n&&t||f(e)&&e,duration:e,easing:n&&t||t&&!f(t)&&t};return x.fx.off?r.duration=0:\"number\"!=typeof r.duration&&(r.duration in x.fx.speeds?r.duration=x.fx.speeds[r.duration]:r.duration=x.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue=\"fx\"),r.old=r.complete,r.complete=function(){f(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(me).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var a=x.isEmptyObject(e),o=x.speed(t,n,r),i=function(){var t=yt(this,x.extend({},e),o);(a||ae.get(this,\"finish\"))&&t.stop(!0)};return i.finish=i,a||!1===o.queue?this.each(i):this.queue(o.queue,i)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return\"string\"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||\"fx\",[]),this.each((function(){var t=!0,a=null!=e&&e+\"queueHooks\",o=x.timers,i=ae.get(this);if(a)i[a]&&i[a].stop&&r(i[a]);else for(a in i)i[a]&&i[a].stop&&dt.test(a)&&r(i[a]);for(a=o.length;a--;)o[a].elem!==this||null!=e&&o[a].queue!==e||(o[a].anim.stop(n),t=!1,o.splice(a,1));!t&&n||x.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||\"fx\"),this.each((function(){var t,n=ae.get(this),r=n[e+\"queue\"],a=n[e+\"queueHooks\"],o=x.timers,i=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<i;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),x.each([\"toggle\",\"show\",\"hide\"],(function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,a){return null==e||\"boolean\"==typeof e?n.apply(this,arguments):this.animate(mt(t,!0),e,r,a)}})),x.each({slideDown:mt(\"show\"),slideUp:mt(\"hide\"),slideToggle:mt(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},(function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),x.timers=[],x.fx.tick=function(){var e,t=0,n=x.timers;for(lt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||x.fx.stop(),lt=void 0},x.fx.timer=function(e){x.timers.push(e),x.fx.start()},x.fx.interval=13,x.fx.start=function(){pt||(pt=!0,ht())},x.fx.stop=function(){pt=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fn.delay=function(t,n){return t=x.fx&&x.fx.speeds[t]||t,n=n||\"fx\",this.queue(n,(function(n,r){var a=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(a)}}))},function(){var e=g.createElement(\"input\"),t=g.createElement(\"select\").appendChild(g.createElement(\"option\"));e.type=\"checkbox\",h.checkOn=\"\"!==e.value,h.optSelected=t.selected,(e=g.createElement(\"input\")).value=\"t\",e.type=\"radio\",h.radioValue=\"t\"===e.value}();var bt,vt=x.expr.attrHandle;x.fn.extend({attr:function(e,t){return K(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){x.removeAttr(this,e)}))}}),x.extend({attr:function(e,t,n){var r,a,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?x.prop(e,t,n):(1===o&&x.isXMLDoc(e)||(a=x.attrHooks[t.toLowerCase()]||(x.expr.match.bool.test(t)?bt:void 0)),void 0!==n?null===n?void x.removeAttr(e,t):a&&\"set\"in a&&void 0!==(r=a.set(e,n,t))?r:(e.setAttribute(t,n+\"\"),n):a&&\"get\"in a&&null!==(r=a.get(e,t))?r:(r=x.find.attr(e,t))??void 0)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&\"radio\"===t&&T(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,a=t&&t.match(W);if(a&&1===e.nodeType)for(;n=a[r++];)e.removeAttribute(n)}}),bt={set:function(e,t,n){return!1===t?x.removeAttr(e,n):e.setAttribute(n,n),n}},x.each(x.expr.match.bool.source.match(/\\w+/g),(function(e,t){var n=vt[t]||x.find.attr;vt[t]=function(e,t,r){var a,o,i=t.toLowerCase();return r||(o=vt[i],vt[i]=a,a=null!=n(e,t,r)?i:null,vt[i]=o),a}}));var wt=/^(?:input|select|textarea|button)$/i,kt=/^(?:a|area)$/i;function xt(e){return(e.match(W)||[]).join(\" \")}function $t(e){return e.getAttribute&&e.getAttribute(\"class\")||\"\"}function Tt(e){return Array.isArray(e)?e:\"string\"==typeof e&&e.match(W)||[]}x.fn.extend({prop:function(e,t){return K(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[x.propFix[e]||e]}))}}),x.extend({prop:function(e,t,n){var r,a,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&x.isXMLDoc(e)||(t=x.propFix[t]||t,a=x.propHooks[t]),void 0!==n?a&&\"set\"in a&&void 0!==(r=a.set(e,n,t))?r:e[t]=n:a&&\"get\"in a&&null!==(r=a.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,\"tabindex\");return t?parseInt(t,10):wt.test(e.nodeName)||kt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:\"htmlFor\",class:\"className\"}}),h.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),x.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],(function(){x.propFix[this.toLowerCase()]=this})),x.fn.extend({addClass:function(e){var t,n,r,a,o,i;return f(e)?this.each((function(t){x(this).addClass(e.call(this,t,$t(this)))})):(t=Tt(e)).length?this.each((function(){if(r=$t(this),n=1===this.nodeType&&\" \"+xt(r)+\" \"){for(o=0;o<t.length;o++)a=t[o],n.indexOf(\" \"+a+\" \")<0&&(n+=a+\" \");i=xt(n),r!==i&&this.setAttribute(\"class\",i)}})):this},removeClass:function(e){var t,n,r,a,o,i;return f(e)?this.each((function(t){x(this).removeClass(e.call(this,t,$t(this)))})):arguments.length?(t=Tt(e)).length?this.each((function(){if(r=$t(this),n=1===this.nodeType&&\" \"+xt(r)+\" \"){for(o=0;o<t.length;o++)for(a=t[o];n.indexOf(\" \"+a+\" \")>-1;)n=n.replace(\" \"+a+\" \",\" \");i=xt(n),r!==i&&this.setAttribute(\"class\",i)}})):this:this.attr(\"class\",\"\")},toggleClass:function(e,t){var n,r,a,o,i=typeof e,s=\"string\"===i||Array.isArray(e);return f(e)?this.each((function(n){x(this).toggleClass(e.call(this,n,$t(this),t),t)})):\"boolean\"==typeof t&&s?t?this.addClass(e):this.removeClass(e):(n=Tt(e),this.each((function(){if(s)for(o=x(this),a=0;a<n.length;a++)r=n[a],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==e&&\"boolean\"!==i||((r=$t(this))&&ae.set(this,\"__className__\",r),this.setAttribute&&this.setAttribute(\"class\",r||!1===e?\"\":ae.get(this,\"__className__\")||\"\"))})))},hasClass:function(e){var t,n,r=0;for(t=\" \"+e+\" \";n=this[r++];)if(1===n.nodeType&&(\" \"+xt($t(n))+\" \").indexOf(t)>-1)return!0;return!1}});var St=/\\r/g;x.fn.extend({val:function(e){var t,n,r,a=this[0];return arguments.length?(r=f(e),this.each((function(n){var a;1===this.nodeType&&(null==(a=r?e.call(this,n,x(this).val()):e)?a=\"\":\"number\"==typeof a?a+=\"\":Array.isArray(a)&&(a=x.map(a,(function(e){return null==e?\"\":e+\"\"}))),(t=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()])&&\"set\"in t&&void 0!==t.set(this,a,\"value\")||(this.value=a))}))):a?(t=x.valHooks[a.type]||x.valHooks[a.nodeName.toLowerCase()])&&\"get\"in t&&void 0!==(n=t.get(a,\"value\"))?n:\"string\"==typeof(n=a.value)?n.replace(St,\"\"):n??\"\":void 0}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,\"value\");return null!=t?t:xt(x.text(e))}},select:{get:function(e){var t,n,r,a=e.options,o=e.selectedIndex,i=\"select-one\"===e.type,s=i?null:[],c=i?o+1:a.length;for(r=o<0?c:i?o:0;r<c;r++)if(((n=a[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!T(n.parentNode,\"optgroup\"))){if(t=x(n).val(),i)return t;s.push(t)}return s},set:function(e,t){for(var n,r,a=e.options,o=x.makeArray(t),i=a.length;i--;)((r=a[i]).selected=x.inArray(x.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),x.each([\"radio\",\"checkbox\"],(function(){x.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=x.inArray(x(e).val(),t)>-1}},h.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute(\"value\")?\"on\":e.value})}));var Et=e.location,Ct={guid:Date.now()},Nt=/\\?/;x.parseXML=function(t){var n,r;if(!t||\"string\"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,\"text/xml\")}catch(e){}return r=n&&n.getElementsByTagName(\"parsererror\")[0],n&&!r||x.error(\"Invalid XML: \"+(r?x.map(r.childNodes,(function(e){return e.textContent})).join(\"\\n\"):t)),n};var Ot=/^(?:focusinfocus|focusoutblur)$/,jt=function(e){e.stopPropagation()};x.extend(x.event,{trigger:function(t,n,r,a){var o,i,s,c,l,u,d,h,y=[r||g],b=p.call(t,\"type\")?t.type:t,v=p.call(t,\"namespace\")?t.namespace.split(\".\"):[];if(i=h=s=r=r||g,3!==r.nodeType&&8!==r.nodeType&&!Ot.test(b+x.event.triggered)&&(b.indexOf(\".\")>-1&&(v=b.split(\".\"),b=v.shift(),v.sort()),l=b.indexOf(\":\")<0&&\"on\"+b,(t=t[x.expando]?t:new x.Event(b,\"object\"==typeof t&&t)).isTrigger=a?2:3,t.namespace=v.join(\".\"),t.rnamespace=t.namespace?new RegExp(\"(^|\\\\.)\"+v.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:x.makeArray(n,[t]),d=x.event.special[b]||{},a||!d.trigger||!1!==d.trigger.apply(r,n))){if(!a&&!d.noBubble&&!m(r)){for(c=d.delegateType||b,Ot.test(c+b)||(i=i.parentNode);i;i=i.parentNode)y.push(i),s=i;s===(r.ownerDocument||g)&&y.push(s.defaultView||s.parentWindow||e)}for(o=0;(i=y[o++])&&!t.isPropagationStopped();)h=i,t.type=o>1?c:d.bindType||b,(u=(ae.get(i,\"events\")||Object.create(null))[t.type]&&ae.get(i,\"handle\"))&&u.apply(i,n),(u=l&&i[l])&&u.apply&&ne(i)&&(t.result=u.apply(i,n),!1===t.result&&t.preventDefault());return t.type=b,a||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(y.pop(),n)||!ne(r)||l&&f(r[b])&&!m(r)&&((s=r[l])&&(r[l]=null),x.event.triggered=b,t.isPropagationStopped()&&h.addEventListener(b,jt),r[b](),t.isPropagationStopped()&&h.removeEventListener(b,jt),x.event.triggered=void 0,s&&(r[l]=s)),t.result}},simulate:function(e,t,n){var r=x.extend(new x.Event,n,{type:e,isSimulated:!0});x.event.trigger(r,null,t)}}),x.fn.extend({trigger:function(e,t){return this.each((function(){x.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return x.event.trigger(e,t,n,!0)}});var At=/\\[\\]$/,_t=/\\r?\\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,It=/^(?:input|select|textarea|keygen)/i;function Pt(e,t,n,r){var a;if(Array.isArray(t))x.each(t,(function(t,a){n||At.test(e)?r(e,a):Pt(e+\"[\"+(\"object\"==typeof a&&null!=a?t:\"\")+\"]\",a,n,r)}));else if(n||\"object\"!==v(t))r(e,t);else for(a in t)Pt(e+\"[\"+a+\"]\",t[a],n,r)}x.param=function(e,t){var n,r=[],a=function(e,t){var n=f(t)?t():t;r[r.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(n??\"\")};if(null==e)return\"\";if(Array.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,(function(){a(this.name,this.value)}));else for(n in e)Pt(n,e[n],t,a);return r.join(\"&\")},x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=x.prop(this,\"elements\");return e?x.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!x(this).is(\":disabled\")&&It.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!xe.test(e))})).map((function(e,t){var n=x(this).val();return null==n?null:Array.isArray(n)?x.map(n,(function(e){return{name:t.name,value:e.replace(_t,\"\\r\\n\")}})):{name:t.name,value:n.replace(_t,\"\\r\\n\")}})).get()}});var Rt=/%20/g,Mt=/#.*$/,Vt=/([?&])_=[^&]*/,Lt=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,Ht=/^\\/\\//,qt={},zt={},Wt=\"*/\".concat(\"*\"),Bt=g.createElement(\"a\");function Ut(e){return function(t,n){\"string\"!=typeof t&&(n=t,t=\"*\");var r,a=0,o=t.toLowerCase().match(W)||[];if(f(n))for(;r=o[a++];)\"+\"===r[0]?(r=r.slice(1)||\"*\",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Gt(e,t,n,r){var a={},o=e===zt;function i(s){var c;return a[s]=!0,x.each(e[s]||[],(function(e,s){var l=s(t,n,r);return\"string\"!=typeof l||o||a[l]?o?!(c=l):void 0:(t.dataTypes.unshift(l),i(l),!1)})),c}return i(t.dataTypes[0])||!a[\"*\"]&&i(\"*\")}function Xt(e,t){var n,r,a=x.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((a[n]?e:r||(r={}))[n]=t[n]);return r&&x.extend(!0,e,r),e}Bt.href=Et.href,x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":Wt,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Xt(Xt(e,x.ajaxSettings),t):Xt(x.ajaxSettings,e)},ajaxPrefilter:Ut(qt),ajaxTransport:Ut(zt),ajax:function(t,n){\"object\"==typeof t&&(n=t,t=void 0),n=n||{};var r,a,o,i,s,c,l,p,u,d,h=x.ajaxSetup({},n),f=h.context||h,m=h.context&&(f.nodeType||f.jquery)?x(f):x.event,y=x.Deferred(),b=x.Callbacks(\"once memory\"),v=h.statusCode||{},w={},k={},$=\"canceled\",T={readyState:0,getResponseHeader:function(e){var t;if(l){if(!i)for(i={};t=Lt.exec(o);)i[t[1].toLowerCase()+\" \"]=(i[t[1].toLowerCase()+\" \"]||[]).concat(t[2]);t=i[e.toLowerCase()+\" \"]}return null==t?null:t.join(\", \")},getAllResponseHeaders:function(){return l?o:null},setRequestHeader:function(e,t){return null==l&&(e=k[e.toLowerCase()]=k[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==l&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)T.always(e[T.status]);else for(t in e)v[t]=[v[t],e[t]];return this},abort:function(e){var t=e||$;return r&&r.abort(t),S(0,t),this}};if(y.promise(T),h.url=((t||h.url||Et.href)+\"\").replace(Ht,Et.protocol+\"//\"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||\"*\").toLowerCase().match(W)||[\"\"],null==h.crossDomain){c=g.createElement(\"a\");try{c.href=h.url,c.href=c.href,h.crossDomain=Bt.protocol+\"//\"+Bt.host!=c.protocol+\"//\"+c.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&\"string\"!=typeof h.data&&(h.data=x.param(h.data,h.traditional)),Gt(qt,h,n,T),l)return T;for(u in(p=x.event&&h.global)&&0==x.active++&&x.event.trigger(\"ajaxStart\"),h.type=h.type.toUpperCase(),h.hasContent=!Ft.test(h.type),a=h.url.replace(Mt,\"\"),h.hasContent?h.data&&h.processData&&0===(h.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(h.data=h.data.replace(Rt,\"+\")):(d=h.url.slice(a.length),h.data&&(h.processData||\"string\"==typeof h.data)&&(a+=(Nt.test(a)?\"&\":\"?\")+h.data,delete h.data),!1===h.cache&&(a=a.replace(Vt,\"$1\"),d=(Nt.test(a)?\"&\":\"?\")+\"_=\"+Ct.guid+++d),h.url=a+d),h.ifModified&&(x.lastModified[a]&&T.setRequestHeader(\"If-Modified-Since\",x.lastModified[a]),x.etag[a]&&T.setRequestHeader(\"If-None-Match\",x.etag[a])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&T.setRequestHeader(\"Content-Type\",h.contentType),T.setRequestHeader(\"Accept\",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+(\"*\"!==h.dataTypes[0]?\", \"+Wt+\"; q=0.01\":\"\"):h.accepts[\"*\"]),h.headers)T.setRequestHeader(u,h.headers[u]);if(h.beforeSend&&(!1===h.beforeSend.call(f,T,h)||l))return T.abort();if($=\"abort\",b.add(h.complete),T.done(h.success),T.fail(h.error),r=Gt(zt,h,n,T)){if(T.readyState=1,p&&m.trigger(\"ajaxSend\",[T,h]),l)return T;h.async&&h.timeout>0&&(s=e.setTimeout((function(){T.abort(\"timeout\")}),h.timeout));try{l=!1,r.send(w,S)}catch(e){if(l)throw e;S(-1,e)}}else S(-1,\"No Transport\");function S(t,n,i,c){var u,d,g,w,k,$=n;l||(l=!0,s&&e.clearTimeout(s),r=void 0,o=c||\"\",T.readyState=t>0?4:0,u=t>=200&&t<300||304===t,i&&(w=function(e,t,n){for(var r,a,o,i,s=e.contents,c=e.dataTypes;\"*\"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader(\"Content-Type\"));if(r)for(a in s)if(s[a]&&s[a].test(r)){c.unshift(a);break}if(c[0]in n)o=c[0];else{for(a in n){if(!c[0]||e.converters[a+\" \"+c[0]]){o=a;break}i||(i=a)}o=o||i}if(o)return o!==c[0]&&c.unshift(o),n[o]}(h,T,i)),!u&&x.inArray(\"script\",h.dataTypes)>-1&&x.inArray(\"json\",h.dataTypes)<0&&(h.converters[\"text script\"]=function(){}),w=function(e,t,n,r){var a,o,i,s,c,l={},p=e.dataTypes.slice();if(p[1])for(i in e.converters)l[i.toLowerCase()]=e.converters[i];for(o=p.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=o,o=p.shift())if(\"*\"===o)o=c;else if(\"*\"!==c&&c!==o){if(!(i=l[c+\" \"+o]||l[\"* \"+o]))for(a in l)if((s=a.split(\" \"))[1]===o&&(i=l[c+\" \"+s[0]]||l[\"* \"+s[0]])){!0===i?i=l[a]:!0!==l[a]&&(o=s[0],p.unshift(s[1]));break}if(!0!==i)if(i&&e.throws)t=i(t);else try{t=i(t)}catch(e){return{state:\"parsererror\",error:i?e:\"No conversion from \"+c+\" to \"+o}}}return{state:\"success\",data:t}}(h,w,T,u),u?(h.ifModified&&((k=T.getResponseHeader(\"Last-Modified\"))&&(x.lastModified[a]=k),(k=T.getResponseHeader(\"etag\"))&&(x.etag[a]=k)),204===t||\"HEAD\"===h.type?$=\"nocontent\":304===t?$=\"notmodified\":($=w.state,d=w.data,u=!(g=w.error))):(g=$,!t&&$||($=\"error\",t<0&&(t=0))),T.status=t,T.statusText=(n||$)+\"\",u?y.resolveWith(f,[d,$,T]):y.rejectWith(f,[T,$,g]),T.statusCode(v),v=void 0,p&&m.trigger(u?\"ajaxSuccess\":\"ajaxError\",[T,h,u?d:g]),b.fireWith(f,[T,$]),p&&(m.trigger(\"ajaxComplete\",[T,h]),--x.active||x.event.trigger(\"ajaxStop\")))}return T},getJSON:function(e,t,n){return x.get(e,t,n,\"json\")},getScript:function(e,t){return x.get(e,void 0,t,\"script\")}}),x.each([\"get\",\"post\"],(function(e,t){x[t]=function(e,n,r,a){return f(n)&&(a=a||r,r=n,n=void 0),x.ajax(x.extend({url:e,type:t,dataType:a,data:n,success:r},x.isPlainObject(e)&&e))}})),x.ajaxPrefilter((function(e){var t;for(t in e.headers)\"content-type\"===t.toLowerCase()&&(e.contentType=e.headers[t]||\"\")})),x._evalUrl=function(e,t,n){return x.ajax({url:e,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,converters:{\"text script\":function(){}},dataFilter:function(e){x.globalEval(e,t,n)}})},x.fn.extend({wrapAll:function(e){var t;return this[0]&&(f(e)&&(e=e.call(this[0])),t=x(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return f(e)?this.each((function(t){x(this).wrapInner(e.call(this,t))})):this.each((function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=f(e);return this.each((function(n){x(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not(\"body\").each((function(){x(this).replaceWith(this.childNodes)})),this}}),x.expr.pseudos.hidden=function(e){return!x.expr.pseudos.visible(e)},x.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},x.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Jt=x.ajaxSettings.xhr();h.cors=!!Jt&&\"withCredentials\"in Jt,h.ajax=Jt=!!Jt,x.ajaxTransport((function(t){var n,r;if(h.cors||Jt&&!t.crossDomain)return{send:function(a,o){var i,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(i in t.xhrFields)s[i]=t.xhrFields[i];for(i in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||a[\"X-Requested-With\"]||(a[\"X-Requested-With\"]=\"XMLHttpRequest\"),a)s.setRequestHeader(i,a[i]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,\"abort\"===e?s.abort():\"error\"===e?\"number\"!=typeof s.status?o(0,\"error\"):o(s.status,s.statusText):o(Yt[s.status]||s.status,s.statusText,\"text\"!==(s.responseType||\"text\")||\"string\"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n(\"error\"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout((function(){n&&r()}))},n=n(\"abort\");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}})),x.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),x.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter(\"script\",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\")})),x.ajaxTransport(\"script\",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,a){t=x(\"<script>\").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on(\"load error\",n=function(e){t.remove(),n=null,e&&a(\"error\"===e.type?404:200,e.type)}),g.head.appendChild(t[0])},abort:function(){n&&n()}}}));var Kt,Qt=[],Zt=/(=)\\?(?=&|$)|\\?\\?/;x.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=Qt.pop()||x.expando+\"_\"+Ct.guid++;return this[e]=!0,e}}),x.ajaxPrefilter(\"json jsonp\",(function(t,n,r){var a,o,i,s=!1!==t.jsonp&&(Zt.test(t.url)?\"url\":\"string\"==typeof t.data&&0===(t.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Zt.test(t.data)&&\"data\");if(s||\"jsonp\"===t.dataTypes[0])return a=t.jsonpCallback=f(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Zt,\"$1\"+a):!1!==t.jsonp&&(t.url+=(Nt.test(t.url)?\"&\":\"?\")+t.jsonp+\"=\"+a),t.converters[\"script json\"]=function(){return i||x.error(a+\" was not called\"),i[0]},t.dataTypes[0]=\"json\",o=e[a],e[a]=function(){i=arguments},r.always((function(){void 0===o?x(e).removeProp(a):e[a]=o,t[a]&&(t.jsonpCallback=n.jsonpCallback,Qt.push(a)),i&&f(o)&&o(i[0]),i=o=void 0})),\"script\"})),h.createHTMLDocument=((Kt=g.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===Kt.childNodes.length),x.parseHTML=function(e,t,n){return\"string\"!=typeof e?[]:(\"boolean\"==typeof t&&(n=t,t=!1),t||(h.createHTMLDocument?((r=(t=g.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=g.location.href,t.head.appendChild(r)):t=g),o=!n&&[],(a=M.exec(e))?[t.createElement(a[1])]:(a=Oe([e],t,o),o&&o.length&&x(o).remove(),x.merge([],a.childNodes)));var r,a,o},x.fn.load=function(e,t,n){var r,a,o,i=this,s=e.indexOf(\" \");return s>-1&&(r=xt(e.slice(s)),e=e.slice(0,s)),f(t)?(n=t,t=void 0):t&&\"object\"==typeof t&&(a=\"POST\"),i.length>0&&x.ajax({url:e,type:a||\"GET\",dataType:\"html\",data:t}).done((function(e){o=arguments,i.html(r?x(\"<div>\").append(x.parseHTML(e)).find(r):e)})).always(n&&function(e,t){i.each((function(){n.apply(this,o||[e.responseText,t,e])}))}),this},x.expr.pseudos.animated=function(e){return x.grep(x.timers,(function(t){return e===t.elem})).length},x.offset={setOffset:function(e,t,n){var r,a,o,i,s,c,l=x.css(e,\"position\"),p=x(e),u={};\"static\"===l&&(e.style.position=\"relative\"),s=p.offset(),o=x.css(e,\"top\"),c=x.css(e,\"left\"),(\"absolute\"===l||\"fixed\"===l)&&(o+c).indexOf(\"auto\")>-1?(i=(r=p.position()).top,a=r.left):(i=parseFloat(o)||0,a=parseFloat(c)||0),f(t)&&(t=t.call(e,n,x.extend({},s))),null!=t.top&&(u.top=t.top-s.top+i),null!=t.left&&(u.left=t.left-s.left+a),\"using\"in t?t.using.call(e,u):p.css(u)}},x.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){x.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],a={top:0,left:0};if(\"fixed\"===x.css(r,\"position\"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&\"static\"===x.css(e,\"position\");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((a=x(e).offset()).top+=x.css(e,\"borderTopWidth\",!0),a.left+=x.css(e,\"borderLeftWidth\",!0))}return{top:t.top-a.top-x.css(r,\"marginTop\",!0),left:t.left-a.left-x.css(r,\"marginLeft\",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&\"static\"===x.css(e,\"position\");)e=e.offsetParent;return e||de}))}}),x.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},(function(e,t){var n=\"pageYOffset\"===t;x.fn[e]=function(r){return K(this,(function(e,r,a){var o;if(m(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===a)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:a,n?a:o.pageYOffset):e[r]=a}),e,r,arguments.length)}})),x.each([\"top\",\"left\"],(function(e,t){x.cssHooks[t]=Ke(h.pixelPosition,(function(e,n){if(n)return n=Je(e,t),Be.test(n)?x(e).position()[t]+\"px\":n}))})),x.each({Height:\"height\",Width:\"width\"},(function(e,t){x.each({padding:\"inner\"+e,content:t,\"\":\"outer\"+e},(function(n,r){x.fn[r]=function(a,o){var i=arguments.length&&(n||\"boolean\"!=typeof a),s=n||(!0===a||!0===o?\"margin\":\"border\");return K(this,(function(t,n,a){var o;return m(t)?0===r.indexOf(\"outer\")?t[\"inner\"+e]:t.document.documentElement[\"client\"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body[\"scroll\"+e],o[\"scroll\"+e],t.body[\"offset\"+e],o[\"offset\"+e],o[\"client\"+e])):void 0===a?x.css(t,n,s):x.style(t,n,a,s)}),t,i?a:void 0,i)}}))})),x.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],(function(e,t){x.fn[t]=function(e){return this.on(t,e)}})),x.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\"**\"):this.off(t,e||\"**\",n)},hover:function(e,t){return this.on(\"mouseenter\",e).on(\"mouseleave\",t||e)}}),x.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),(function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var en=/^[\\s\\uFEFF\\xA0]+|([^\\s\\uFEFF\\xA0])[\\s\\uFEFF\\xA0]+$/g;x.proxy=function(e,t){var n,r,o;if(\"string\"==typeof t&&(n=e[t],t=e,e=n),f(e))return r=a.call(arguments,2),o=function(){return e.apply(t||this,r.concat(a.call(arguments)))},o.guid=e.guid=e.guid||x.guid++,o},x.holdReady=function(e){e?x.readyWait++:x.ready(!0)},x.isArray=Array.isArray,x.parseJSON=JSON.parse,x.nodeName=T,x.isFunction=f,x.isWindow=m,x.camelCase=te,x.type=v,x.now=Date.now,x.isNumeric=function(e){var t=x.type(e);return(\"number\"===t||\"string\"===t)&&!isNaN(e-parseFloat(e))},x.trim=function(e){return null==e?\"\":(e+\"\").replace(en,\"$1\")};var tn=e.jQuery,nn=e.$;return x.noConflict=function(t){return e.$===x&&(e.$=nn),t&&e.jQuery===x&&(e.jQuery=tn),x},void 0===t&&(e.jQuery=e.$=x),x}));var a=t(r.exports);const{fromCharCode:o}=String,i=\"audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter\".split(\",\"),s=\"a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon\".split(\",\"),c=[\"audio\"],[l,p,u]=[e=>o(e)!==o(e).toLowerCase(),e=>o(e)!==o(e).toUpperCase(),e=>o(e).toLowerCase()!==o(e).toUpperCase()].map((e=>`[${Array.from(Array(57343)).map(((e,t)=>t)).filter(e).map(((e,t,n)=>e===n[t-1]+1&&e===n[t+1]-1?\"-\":o(e))).join(\"\").replace(/-+/g,\"-\")}]`));function d(e){return\"instant\"===e?0:800}let h,f,m=[],g={},y=0,b={},v=0,w={x:0,y:0};function k(e,t,n,r,a){let o=0,i=0,s=t+n;function c(n=0){let l;1&e[0].compareDocumentPosition(document)&&(s=0),o&&(l=n-o,s-=l),o=n,r>0&&y+v>0&&e.data(\"expediteAnim\")(r),s<=t&&(i+=l||0,\"paused\"===e.css(\"animation-play-state\")&&e.css({visibility:\"\",\"animation-play-state\":\"running\"})),s<=0?(e.removeData(\"expediteAnim\"),a()):requestAnimationFrame(c)}e.data(\"expediteAnim\",(t=>{var n;void 0===t&&(t=i),s-=t,\"running\"===e.css(\"animation-play-state\")&&e.css(\"animation-delay\",((\"ms\"===(n=(n=e.css(\"animation-delay\")).toLowerCase()).slice(-2)?+n.slice(0,-2)||0:\"s\"===n.slice(-1)&&1e3*+n.slice(0,-1)||0)||0)-t+\"ms\")})),s?requestAnimationFrame(c):c()}const x=/-|_/g,$={hash(e){let t=9;for(let n=e.length;n>0;)n-=1,t=Math.imul(t^e.charCodeAt(n),9**9);return(t^t>>>9)>>>0},permutations(...e){const{length:t}=e,n=[[...e]],r=Array(t).fill(0);let a,o,i=1;for(;i<t;)r[i]<i?(a=i%2&&r[i],o=e[i],e[i]=e[a],e[a]=o,++r[i],i=1,n.push([...e])):(r[i]=0,++i);return n},nth(e){const t=\"\"+ +e;return e+(\"1\"!==t[t.length-1]||1!==t.length&&\"1\"===t[t.length-2]?\"2\"!==t[t.length-1]||1!==t.length&&\"1\"===t[t.length-2]?\"3\"!==t[t.length-1]||1!==t.length&&\"1\"===t[t.length-2]?\"th\":\"rd\":\"nd\":\"st\")},plural:(e,t,n)=>`${e} ${1!==Math.abs(e)?n||`${t}s`:t}`,andList:e=>e.length<=1?e[0]:`${e.slice(0,-1).join(\", \")} and ${e[e.length-1]}`,realWhitespace:\"[ \\\\n\\\\r\\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]\",anyRealLetter:\"[\\\\dA-Za-z\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",anyUppercase:l,anyLowercase:p,anyCasedLetter:u,anyNewline:\"(?:\\\\n|\\\\r|\\\\r\\\\n)\",unescape:e=>e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,(e=>({\"&amp;\":\"&\",\"&gt;\":\">\",\"&lt;\":\"<\",\"&quot;\":'\"',\"&#39;\":\"'\",\"&nbsp;\":String.fromCharCode(160),\"&zwnj;\":String.fromCharCode(8204)}[e]))),escape:e=>e.replace(/[&><\"']/g,(e=>({\"&\":\"&amp;\",\">\":\"&gt;\",\"<\":\"&lt;\",'\"':\"&quot;\",\"'\":\"&#39;\"}[e]))),insensitiveName:e=>`${e}`.toLowerCase().replace(x,\"\"),allKeysDown:(...e)=>e.every((e=>g[e])),someKeysDown:(...e)=>e.some((e=>g[e])),buttonsDown:(...e)=>e.every((e=>b[e])),anyInputDown:()=>y+v>0,mouseCoords:w,parentColours(e){const t={colour:null,backgroundColour:null},n=/^\\w+a\\(.+?,\\s*0\\s*\\)$|^transparent$/;for(;e.length&&e[0]!==document;e=e.parent()){if(!t.backgroundColour){const r=e.css(\"background-color\");r.match(n)||(t.backgroundColour=r)}if(!t.colour){const r=e.css(\"color\");r.match(n)||(t.colour=r)}if(t.colour&&t.backgroundColour)return t}return{colour:\"#fff\",backgroundColour:\"#000\"}},childrenProbablyInline(e){const t=[];return[].every.call(e.findAndFilter(\"*\"),(e=>!!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute(\"style\")))||!i.includes(e.tagName.toLowerCase())&&!/display: (?!none|inline|inherit|unset)/.test(e.getAttribute(\"style\"))&&(s.includes(e.tagName.toLowerCase())||t.push(e),!0)))&&t.every((e=>/inline|none/.test(window.getComputedStyle(e).display)))},transitionOut(e,t,n,r=0,a=0,o=0,i=void 0){if(0===e.length)return;n||=d(t);(e.length>1||!$.childrenProbablyInline(e)||![\"tw-hook\",\"tw-passage\",\"tw-sidebar\",\"tw-expression\"].includes(e.tag()))&&(e=e.wrapAll(\"<tw-transition-container>\").parent()),i&&e.css(\"transform-origin\",i),e.attr(\"data-t8n\",t).addClass(\"transition-out\").css({\"animation-duration\":`${n}ms`,\"animation-delay\":-o+\"ms\",\"animation-play-state\":\"paused\"}),requestAnimationFrame((()=>{$.childrenProbablyInline(e)?e.css(\"display\",\"inline\"):e.parent().is(\"tw-backdrop,tw-story\")||e[0].setAttribute(\"style\",`${e[0].getAttribute(\"style\")}display:block !important;width:100%`)})),k(e,n,r-o,a,(()=>{e.remove()}))},transitionIn(e,t,n,r=0,o=0,i=0,s=void 0){if(0===e.length)return;n||=d(t);const l=e.length>1||!$.childrenProbablyInline(e)||![\"tw-hook\",\"tw-passage\",\"tw-sidebar\",\"tw-expression\"].includes(e.tag());l&&(e=e.wrapAll(\"<tw-transition-container>\").parent()),s&&e.css(\"transform-origin\",s),e.attr(\"data-t8n\",t).addClass(\"transition-in\").css({\"animation-duration\":`${n}ms`,\"animation-delay\":-i+\"ms\",...r-i?{visibility:\"hidden\",\"animation-play-state\":\"paused\"}:{}}),requestAnimationFrame((()=>{$.childrenProbablyInline(e)?e.css(\"display\",\"inline\"):e.parent().is(\"tw-backdrop,tw-story\")||e[0].setAttribute(\"style\",`${e[0].getAttribute(\"style\")}display:block !important;width:100%`)})),k(e,n,r-i,o,(()=>{const t=0===e.filter(c.join(\",\")).length;if(l&&t){e.find(\"tw-transition-container, .transition-in, .transition-out\").each(((e,t)=>{((t=a(t)).data(\"expediteAnim\")||Object)()}));const t=[],n=e.find(\"*\");for(let e=0;e<n.length;e+=1){const r=n[e];0===r.scrollTop&&0===r.scrollLeft||t.push([r,r.scrollLeft,r.scrollTop])}const r=e.find(document.activeElement);e.contents().unwrap();for(let[e,n,r]of t)e.scrollLeft=n,e.scrollTop=r;r.length&&r[0].focus()}else e.removeClass(\"transition-in\").removeAttr(\"data-t8n\")}))},debounce(e,{batch:t=!1,recur:n=!1,maxWait:r=1/0}={}){let a,o=[],i=0,s=0,c=!1;const l=()=>{Date.now()-i>300||s>=r?(a=0,s=0,c=!n,t?(e(o),o=[]):e(...o),c=!1):a=requestAnimationFrame(l)};return(...e)=>{if(c)return;const n=Date.now();s+=n-i,i=n,t?o.push(e):o=e,a&&cancelAnimationFrame(a),a=requestAnimationFrame(l)}},impossible(e,t){window.console?.error(`${e}(): ${t}`)},onStartup(e){m?m.push(e):e()},get storyElement(){return h},detachStoryElement(){document.documentElement.contains(h[0])&&(f=h.parent(),h.detach())},reattachStoryElement(){document.documentElement.contains(h[0])||(f||a(document.body)).append(h.parents().length?h.parents().last():h)},options:{speedMultiplier:1}};a(document.documentElement).on(\"keydown keyup mousedown mouseup\",(({key:e,button:t,type:n})=>{const r=n.includes(\"down\"),a=e?g:b,o=e&&$.insensitiveName(e)||t;a[o]&&!r?e?y=Math.max(y-1,0):v=Math.max(v-1,0):!a[o]&&r&&(e?y+=1:v+=1),a[o]=r})).on(\"mousemove\",(({pageX:e,pageY:t})=>{w.x=e,w.y=t})),a((()=>{h=a(\"tw-story\"),m.forEach((e=>e())),m=null})),Object.freeze($);\n/*!\n* Natural Sort algorithm for Javascript - Version 0.7 - Released under MIT license\n* Author: Jim Palmer (based on chunking idea from Dave Koelle)\n* http://www.overset.com/2008/09/01/javascript-natural-sort-algorithm-with-unicode-support/\n* Expanded by Leon Arnott to use Intl.Collator, 2015.\n* Expanded by Leon Arnott to take a string-obtaining helper function, 2019.\n*/\nvar T=(e,t=String)=>function(n,r){let a,o,i,s,c=/(^-?[0-9]+(\\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,l=/(^([\\w ]+,?[\\w ]+)?[\\w ]+,?[\\w ]+\\d+:\\d+(:\\d+)?[\\w ]?|^\\d{1,4}[/-]\\d{1,4}[/-]\\d{1,4}|^\\w+, \\w+ \\d+, \\d{4})/,p=/^0x[0-9a-f]+$/i,u=/^0/,d=t(n).trim(),h=t(r).trim(),f=d.replace(c,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),m=h.replace(c,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),g=parseInt(d.match(p))||1!==f.length&&d.match(l)&&Date.parse(d),y=parseInt(h.match(p))||g&&h.match(l)&&Date.parse(h)||null;if(e&&window.Intl&&window.Intl.Collator&&(i=window.Intl.Collator(e)),y){if(g<y)return-1;if(g>y)return 1}for(let e=0,t=Math.max(f.length,m.length);e<t;e++){if(a=!(f[e]||\"\").match(u)&&parseFloat(f[e])||f[e]||0,o=!(m[e]||\"\").match(u)&&parseFloat(m[e])||m[e]||0,isNaN(a)!==isNaN(o))return isNaN(a)?1:-1;if(typeof a!=typeof o)a+=\"\",o+=\"\";else if(\"string\"==typeof a&&i&&(s=i.compare(a,o),0!==s))return s;if(a<o)return-1;if(a>o)return 1}return 0};function S(e){return e&&\"object\"==typeof e?(Object.keys(e).forEach((t=>{e[t]=S(e[t])})),e):`${e}`.replace(/[-[\\]/{}()*+?.\\\\^$|]/g,\"\\\\$&\")}function E(e){return(...t)=>`(${e}${t.join(\"|\")})`}const C=E(\"?:\"),N=E(\"?!\"),O=E(\"?=\"),j=\"[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*\",A=j.replace(\"*\",\"+\"),_=\"\\\\b\",D=\"[\\\\w\\\\-\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",I=D.replace(\"\\\\-\",\"\"),P=C(\"\\\\n\",\"$\"),R=`${j}(\\\\*+)${A}`,M=`${j}((?:0\\\\.)+)${A}`,V=`${j}-{3,}${j}${P}`,L=`${j}(#{1,6})${j}`,F=`${j}(==+>|<=+|=+><=+|<==+>)${j}${P}`,H=`${j}(=+\\\\|+|\\\\|+=+|=+\\\\|+=+|\\\\|=+\\\\|)${j}${P}`,q={opener:\"\\\\[\\\\[(?!\\\\[)\",main:void 0,text:`(${function(...e){return`[^${e.map(S).join(\"\")}]*`}(\"]\")})`,rightSeparator:C(\"\\\\->\",\"\\\\|\"),leftSeparator:\"<\\\\-\",closer:\"\\\\]\\\\]\",legacySeparator:\"\\\\|\",legacyText:`(${C(\"[^\\\\|\\\\]]\",`\\\\]${N(\"\\\\]\")}`)}+)`},z=`${I}*${I.replace(\"\\\\w\",\"a-zA-Z\")}${I}*`,W=`\\\\$(${z})`,B=`_(${z})`,U=`'s${A}${N(\"_\")}(${z})`,G=`(${z})${A}of${_}${N(`it${_}`)}`,X=`'s${A}`,Y=`of${_}`,J=C(\"it\",\"time\",\"turns?\",\"visits?\",\"exits?\",\"pos\")+_,K=`its${A}(${z})`,Q=`its${_}`,Z=`(${z})${A}of${A}it${_}`,ee=`of${A}it${_}`,te={opener:\"\\\\(\",name:`(${C(\"\\\\$\",\"_\")}?${D}+):${N(\"\\\\/\")}`,closer:\"\\\\)\"},ne=C(\"=<\",\"=>\",`[gl]te?${_}`,`n?eq${_}`,`isnot${_}`,`are${_}`,`x${_}`,`isa${_}`,`or${A}a${_}`),re=\"[a-zA-Z][\\\\w\\\\-]*\",ae=\"(?:\\\"[^\\\"]*\\\"|'[^']*'|[^'\\\">])*?\",oe=`\\\\|(${D}+)(>|\\\\))`,ie=`(<|\\\\()(${D}+)\\\\|`,se=`((?:\\\\b\\\\d+(?:\\\\.\\\\d+)?|\\\\.\\\\d+)(?:[eE][+\\\\-]?\\\\d+)?)${N(\"m?s\")}${_}`;q.main=q.opener+C(q.text+q.rightSeparator,q.text.replace(\"*\",\"*?\")+q.leftSeparator)+q.text;const ce={upperLetter:\"[A-Z\\\\u00c0-\\\\u00de\\\\u0150\\\\u0170]\",lowerLetter:\"[a-z0-9_\\\\-\\\\u00df-\\\\u00ff\\\\u0151\\\\u0171]\",anyLetter:D,anyLetterStrict:I,whitespace:A.replace(\"[\",\"[\\\\n\\\\r\"),escapedLine:\"\\\\\\\\\\\\n\\\\\\\\?|\\\\n\\\\\\\\\",br:\"\\\\n(?!\\\\\\\\)\",tag:`<\\\\/?${re}${ae}>`,scriptStyleTag:`<(${C(\"script\",\"style\",\"textarea\")})${ae}>[^]*?<\\\\/\\\\1>`,scriptStyleTagOpener:\"<\",url:`(${C(\"https?\",\"mailto\",\"javascript\",\"ftp\",\"data\")}:\\\\/\\\\/[^\\\\s<]+[^<.,:;\"')\\\\]\\\\s])`,bullet:\"\\\\*\",hr:V,heading:L,align:F,column:H,bulleted:R,numbered:M,verbatimOpener:\"`+\",hookAppendedFront:`\\\\[${N(\"=+\")}`,hookPrependedFront:`${oe}\\\\[${N(\"=+\")}`,hookFront:`\\\\[${N(\"=+\")}`,hookBack:`\\\\]${N(ie)}`,hookAppendedBack:`\\\\]${ie}`,unclosedHook:\"\\\\[=+\",unclosedHookPrepended:`${oe}\\\\[=+`,unclosedCollapsed:\"\\\\{=+\",passageLink:q.main+q.closer,legacyLink:q.opener+q.legacyText+q.legacySeparator+q.legacyText+q.closer,simpleLink:q.opener+q.legacyText+q.closer,macroFront:te.opener+O(te.name),macroName:te.name,groupingFront:`\\\\(${N(te.name)}`,twine1Macro:\"<<[^>\\\\s]+\\\\s*(?:\\\\\\\\.|'(?:[^'\\\\\\\\]*\\\\\\\\.)*[^'\\\\\\\\]*'|\\\"(?:[^\\\"\\\\\\\\]*\\\\\\\\.)*[^\\\"\\\\\\\\]*\\\"|[^'\\\"\\\\\\\\>]|>(?!>))*>>\",validPropertyName:z,property:U,belongingProperty:G,possessiveOperator:X,belongingOperator:Y,itsOperator:Q,belongingItOperator:ee,variable:W,tempVariable:B,hookName:`\\\\?(${D}+)\\\\b`,cssTime:`(\\\\d+\\\\.?\\\\d*|\\\\d*\\\\.?\\\\d+)(m?s)${_}`,colour:C(C(\"Red\",\"Orange\",\"Yellow\",\"Lime\",\"Green\",\"Cyan\",\"Aqua\",\"Blue\",\"Navy\",\"Purple\",\"Fuchsia\",\"Magenta\",\"White\",\"Gray\",\"Grey\",\"Black\",\"Transparent\"),\"#[\\\\dA-Fa-f]{3}(?:[\\\\dA-Fa-f]{3})?\"),datatype:C(\"alnum\",\"alphanumeric\",\"any(?:case)?\",\"array\",\"bool(?:ean)?\",\"changer\",\"codehook\",\"colou?r\",\"const\",\"command\",\"dm\",`data${C(\"map\",\"type\",\"set\")}`,\"ds\",\"digit\",\"gradient\",\"empty\",\"even\",`int${N(\"o\")}(?:eger)?`,\"lambda\",\"lowercase\",\"macro\",\"linebreak\",\"newline\",\"num(?:ber)?\",\"odd\",\"str(?:ing)?\",\"uppercase\",\"whitespace\")+_,number:se,boolean:C(\"true\",\"false\")+_,identifier:J,itsProperty:K,belongingItProperty:Z,escapedStringChar:\"\\\\\\\\[^\\\\n]\",singleStringOpener:\"'\",doubleStringOpener:'\"',singleStringCloser:\"'\",doubleStringCloser:'\"',is:`is${N(`${A}not${_}`,`${A}an?${_}`,`${A}in${_}`,`${A}<`,`${A}>`)}${_}`,isNot:`is${A}not${N(A+C(\"an?\",\"in\")+_)}${_}`,isA:`is${A}an?${_}`,isNotA:`is${A}not${A}an?${_}`,matches:`matches${_}`,doesNotMatch:`does${A}not${A}match${_}`,and:`and${_}`,or:`or${_}`,not:`not${_}`,inequality:`((?:is(?:${A}not)?${j})*)(${C(\"<(?!=)\",\"<=\",\">(?!=)\",\">=\")})`,isIn:`is${A}in${_}`,contains:`contains${_}`,doesNotContain:`does${A}not${A}contain${_}`,isNotIn:`is${A}not${A}in${_}`,addition:S(\"+\")+N(\"=\"),subtraction:S(\"-\")+N(\"=\",\"type\"),multiplication:S(\"*\")+N(\"=\"),division:C(\"/\",\"%\")+N(\"=\"),spread:`\\\\.\\\\.\\\\.${N(\"\\\\.\")}`,to:C(`to${_}`,\"=\"),into:`into${_}`,making:`making${_}`,where:`where${_}`,when:`when${_}`,via:`via${_}`,each:`each${_}`,bind:`2?bind${_}`,typeSignature:S(\"-type\")+_,incorrectOperator:ne,PlainCompare:{comma:\",\",commentFront:\"\\x3c!--\",commentBack:\"--\\x3e\",strikeOpener:\"~~\",italicOpener:\"//\",boldOpener:\"''\",supOpener:\"^^\",strongFront:\"**\",strongBack:\"**\",emFront:\"*\",emBack:\"*\",collapsedFront:\"{\",collapsedBack:\"}\",groupingBack:\")\"}};let le;const{hasOwn:pe}=Object,ue={};class de{constructor(e){for(let t in e)this[t]=e[t]}addChild(e){const t=this.lastChildEnd(),n=new de(e);return n.start=t,n.end=e.text&&t+e.text.length,n.place=this.place,n.children=[],n.innerText&&he(n),this.children.push(n),n}lastChildEnd(){const e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))}tokenAt(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(let t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){const n=this.children[t].tokenAt(e);if(n)return n}return this}pathAt(e){if(e<this.start||e>=this.end)return[];let t=[];if(this.children.length)for(let n=0;n<this.children.length;n+=1)if(e>=this.children[n].start&&e<this.children[n].end){const r=this.children[n].pathAt(e);if(r.length){t=t.concat(r);break}}return t.concat(this)}nearestTokenAt(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(((t,n)=>t||(e>=n.start&&e<n.end?n:null)),null):this}everyLeaf(e){return this.children&&0!==this.children.length?this.children.reduce(((t,n)=>t&&n.everyLeaf(e)),!0):!!e(this)}demote(){this.type=\"text\"}error(e){this.type=\"error\",this.message=e}toString(){let e=`${this.type}(${this.start}→${this.end})`;return this.children&&this.children.length>0&&(e+=`[${this.children}]`),e}copy(){const e=new de(this);return e.children=e.children.slice(),e}foldChildren(){let e=[];const t=this.children.slice();for(let n=0;n<t.length;n+=1){const r=t[n];let a=!1;if(r.matches)for(let t=0;t<e.length;t+=1){let{type:n}=e[t];n in r.matches&&(fe(this,r,e[t]),e=e.slice(t+1),a=!0)}!a&&r.isFront&&e.unshift(r)}}}function he(e,t){const n=e.innerText;let r=null,a=0,o=a,i=n.length,s=null;for(;a<i;){const i=n.slice(a);let c=(r&&r.length?r[0]:e).innerMode,l=0,p=c.length;for(;l<p;l+=1){const p=ue[c[l]];if(p.constraint&&!p.constraint(s)||p.cannotFollowText&&(\"text\"===s?.type||o<a)||(p.plainCompare?!i.startsWith(p.pattern):!p.pattern.test(i)))continue;const u=p.fn(p.plainCompare?p.pattern:p.pattern.exec(i));let d=!1,h=0;if(u.matches){for(;r&&h<r.length;h+=1){let{type:e,aka:t}=r[h];if(e in u.matches){d=!0;break}t&&(e=t),u.cannotCross?.indexOf(e)>-1&&(h=r.length-1)}if((!r||h>=r.length)&&!u.isFront)continue}o<a&&e.addChild({type:\"text\",text:n.slice(o,a),innerMode:c}),s=e.addChild(u),a+=s.text.length,o=a;let f=!1;d&&(t&&fe(e,s,r[h]),r=r.slice(h+1),f=!0),!f&&s.isFront&&(r?r.unshift(s):r=[s]);break}l===p&&(a+=1,null===s&&(s={type:\"text\"}))}for(o<a&&e.addChild({type:\"text\",text:n.slice(o,a),innerMode:(r?.length?r[0]:e).innerMode});r?.length>0;)r.shift().demote();return e}function fe(e,t,n){const r=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,r-(a+1)),t.type=t.matches[n.type],t.innerText=\"\";for(let e=0,n=t.children.length;e<n;e++)t.innerText+=t.children[e].text;t.start=n.start,t.text=n.text+t.innerText+t.text;for(let e in n)pe(n,e)&&!pe(t,e)&&(t[e]=n[e]);t.isFront&&(t.isFront=!1),e.children.splice(a,1)}le={lex:(e,t=\"\",n=\"start\",r=!1)=>he(new de({type:\"root\",place:t,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:le.modes[n]}),!r),rules:ue,modes:{}};var me=le;const{keys:ge,assign:ye,hasOwn:be}=Object;let ve=Object.freeze({lex:function(e){function t(e){return e||=\"innerText\",function(t){const n=t.reduceRight(((e,t,n)=>e||(n?t:\"\")),\"\"),r={};return r[e]=n,r}}function n(e,t){const n={};return n[e]=t,()=>({isFront:!0,matches:n,cannotCross:[\"verbatimOpener\"]})}const r=Object.bind(0,null);function a(e,t){return Object.keys(t).forEach((n=>{const r=t[n].fn;t[n].fn=t=>{const a=r(t);return a.text||(a.text=\"string\"==typeof t?t:t[0]),a.type||(a.type=n),a.innerMode||(a.innerMode=e),a}})),t}const o=[],i=[],s=[],c=a(o,{hr:{fn:r},bulleted:{fn:e=>({depth:e[1].length})},numbered:{fn:e=>({depth:e[1].length/2})},heading:{fn:e=>({depth:e[1].length})},align:{fn(e){let t;const n=e[1],r=n.indexOf(\"><\");return~r?(t=Math.round(r/(n.length-2)*50),25===t&&(t=\"center\")):\"<\"===n[0]&&\">\"===n.slice(-1)?t=\"justify\":n.indexOf(\">\")>-1?t=\"right\":n.indexOf(\"<\")>-1&&(t=\"left\"),{align:t}}},column:{fn(e){let t;const n=e[1],r=n.indexOf(\"|\");return r&&r<n.length-1?t=\"center\":\"|\"===n[0]&&\"|\"===n.slice(-1)?t=\"none\":r===n.length-1?t=\"right\":r||(t=\"left\"),{column:t,width:/\\|+/.exec(n)[0].length,marginLeft:/^=*/.exec(n)[0].length,marginRight:/=*$/.exec(n)[0].length}}}}),l=e=>{switch(e&&e.type){case null:case\"br\":case\"hr\":case\"bulleted\":case\"numbered\":case\"heading\":case\"align\":case\"column\":case\"escapedLine\":return!0}return!1};ge(c).forEach((e=>{c[e].constraint=l,c[e].cannotFollowText=!0}));const p=a(o,{twine1Macro:{fn:()=>({type:\"error\",message:\"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros.\"})},emBack:{fn:()=>({matches:{emFront:\"em\"},cannotCross:[\"verbatimOpener\"]})},strongBack:{fn:()=>({matches:{strongFront:\"strong\"},cannotCross:[\"verbatimOpener\"]})},strongFront:{fn:()=>({isFront:!0})},emFront:{fn:()=>({isFront:!0})},boldOpener:{fn:n(\"boldOpener\",\"bold\")},italicOpener:{fn:n(\"italicOpener\",\"italic\")},strikeOpener:{fn:n(\"strikeOpener\",\"strike\")},supOpener:{fn:n(\"supOpener\",\"sup\")},commentFront:{fn:()=>({isFront:!0})},commentBack:{fn:()=>({matches:{commentFront:\"comment\"}})},scriptStyleTag:{fn:r},tag:{fn:r},url:{fn:r},hookPrependedFront:{fn:e=>({name:e[1],hidden:\")\"===e[2],isFront:!0,tagPosition:\"prepended\"})},hookFront:{fn:()=>({isFront:!0})},hookBack:{fn:()=>({matches:{hookPrependedFront:\"hook\",hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},hookAppendedBack:{fn:e=>({name:e[2],hidden:\"(\"===e[1],tagPosition:\"appended\",matches:{hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},unclosedHook:{fn:r},unclosedHookPrepended:{fn:e=>({type:\"unclosedHook\",name:e[1],hidden:\")\"===e[2]})},verbatimOpener:{fn(e){let t=e[0].length,n={};return n[`verbatim${t}`]=\"verbatim\",{type:`verbatim${t}`,isFront:!0,matches:n,aka:\"verbatimOpener\"}}},unclosedCollapsed:{fn:r},collapsedFront:{fn:()=>({isFront:!0})},collapsedBack:{fn:()=>({matches:{collapsedFront:\"collapsed\"},cannotCross:[\"verbatimOpener\"]})},escapedLine:{fn:r},legacyLink:{fn:e=>({type:\"twineLink\",innerText:e[1],passage:e[2],innerMode:o})},br:{fn:r}}),u=ye(a(i,{macroFront:{fn:e=>({isFront:!0,name:e[1]})},groupingBack:{fn:()=>({matches:{groupingFront:\"grouping\",macroFront:\"macro\"},cannotCross:[\"singleStringOpener\",\"doubleStringOpener\",\"hookFront\"]})},passageLink:{fn(e){const t=e[1]||\"\",n=e[2]||\"\",r=e[3]||\"\";return{type:\"twineLink\",innerText:n?r:t,passage:t?r:n,innerMode:o}}},simpleLink:{fn:e=>({type:\"twineLink\",innerText:e[1]||\"\",passage:e[1]||\"\",innerMode:o})},variable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:t(\"name\")},tempVariable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:t(\"name\")}}),{hookFront:p.hookFront,hookBack:p.hookBack}),d=a(i,{commentBack:{fn:()=>({matches:{commentFront:\"comment\"}})},macroName:{constraint:e=>e&&\"macroFront\"===e.type,fn:t(\"name\")},groupingFront:{fn:()=>({isFront:!0})},property:{fn:t(\"name\"),constraint(e){if(e)switch(e.type){case\"variable\":case\"hookName\":case\"property\":case\"tempVariable\":case\"colour\":case\"itsProperty\":case\"belongingItProperty\":case\"macro\":case\"grouping\":case\"string\":case\"datatype\":case\"hook\":case\"boolean\":case\"number\":return!0}}},possessiveOperator:{fn:r},itsProperty:{cannotFollowText:!0,fn:t(\"name\")},itsOperator:{cannotFollowText:!0,fn:r},belongingItProperty:{cannotFollowText:!0,fn:t(\"name\")},belongingItOperator:{cannotFollowText:!0,fn:r},belongingProperty:{cannotFollowText:!0,fn:t(\"name\")},belongingOperator:{cannotFollowText:!0,fn:r},escapedStringChar:{fn:()=>({type:\"text\"})},singleStringOpener:{fn:()=>({isFront:!0,matches:{singleStringOpener:\"string\"},innerMode:s})},doubleStringOpener:{fn:()=>({isFront:!0,matches:{doubleStringOpener:\"string\"},innerMode:s})},hookName:{fn:t(\"name\")},cssTime:{fn:e=>({value:+e[1]*(\"s\"===e[2].toLowerCase()?1e3:1)})},datatype:{cannotFollowText:!0,fn:e=>({name:e[0].toLowerCase()})},colour:{cannotFollowText:!0,fn(e){let t,n=e[0].toLowerCase(),r={red:\"e61919\",orange:\"e68019\",yellow:\"e5e619\",lime:\"80e619\",green:\"19e619\",cyan:\"19e5e6\",aqua:\"19e5e6\",blue:\"197fe6\",navy:\"1919e6\",purple:\"7f19e6\",fuchsia:\"e619e5\",magenta:\"e619e5\",white:\"fff\",black:\"000\",gray:\"888\",grey:\"888\"};return t=be(r,n)?`#${r[n]}`:n,{colour:t}}},number:{fn:e=>({value:parseFloat(e[0])})},inequality:{fn:e=>({operator:e[2],negate:e[1].indexOf(\"not\")>-1})},identifier:{fn:t(\"name\"),cannotFollowText:!0},whitespace:{fn:r,cannotFollowText:!0},incorrectOperator:{fn:e=>{const t={\"=>\":\">=\",\"=<\":\"<=\",gte:\">=\",lte:\"<=\",gt:\">\",lt:\"<\",eq:\"is\",isnot:\"is not\",neq:\"is not\",isa:\"is a\",are:\"is\",x:\"*\",\"or a\":\"or\"}[e[0].toLowerCase().replace(/\\s+/g,\" \")];return{type:\"error\",message:`Please say ${t?`'${t}'`:\"something else\"} instead of '${e[0]}'.`,explanation:\"In the interests of readability, I want certain operators to be in a specific form.\"}},cannotFollowText:!0},...[\"boolean\",\"is\",\"to\",\"into\",\"where\",\"when\",\"via\",\"making\",\"each\",\"and\",\"or\",\"not\",\"isNot\",\"contains\",\"doesNotContain\",\"isIn\",\"isA\",\"isNotA\",\"isNotIn\",\"matches\",\"doesNotMatch\",\"bind\"].reduce(((e,t)=>(e[t]={fn:r,cannotFollowText:!0},e)),{}),...[\"comma\",\"spread\",\"typeSignature\",\"addition\",\"subtraction\",\"multiplication\",\"division\"].reduce(((e,t)=>(e[t]={fn:r},e)),{})}),h=a(s,{singleStringCloser:d.singleStringOpener,doubleStringCloser:d.doubleStringOpener,escapedStringChar:d.escapedStringChar});o.push(...ge(c),...ge(u),...ge(p)),i.push(...ge(u),...ge(d)),s.push(...ge(h));const f={...c,...p,...u,...d,...h};ge(f).forEach((e=>{ce.PlainCompare[e]?(f[e].pattern=ce.PlainCompare[e],f[e].plainCompare=!0):f[e].pattern=RegExp(`^(?:${ce[e]})`,\"i\")})),ye(e.rules,f);const{modes:m}=e;return m.start=m.markup=o,m.macro=i,m.string=s,e}(me).lex,Patterns:ce});const{impossible:we,escape:ke}=$;a(document.documentElement).on(\"click\",\"tw-folddown\",(({target:e})=>{(e=a(e)).toggleClass(\"open\");const t=e.popData(\"folddown\");for(\"function\"==typeof t&&t(e);e&&!e.next().length;)e=e.parent();e?.next().toggle()}));const xe={syntax:\"The markup seems to contain a mistake.\",saving:\"I tried to save or load the game, but I couldn't do it.\",operation:\"I tried to perform an operation on some data, but the data's type was incorrect.\",macrocall:\"I tried to use a macro, but its call wasn't written correctly.\",datatype:\"I tried to use a macro, but was given the wrong type of data to it.\",custommacro:\"I tried to use a custom macro, but its code hook had a mistake in it.\",infinite:\"I almost ended up doing the same thing over and over, forever.\",property:\"I tried to access a value in a string/array/datamap, but I couldn't find it.\",unimplemented:\"I currently don't have this particular feature. I'm sorry.\",propagated:\"Click the 'Open' button to see the code hook as it was executed.\",user:\"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.\",assertion:\"This command exists to provide a helpful error if a certain important condition wasn't true.\",debugonly:\"This macro is not meant to be used outside of debugging your story.\"},$e=[],Te={TwineError:!0,create(e,t,n,r){return t&&\"string\"==typeof t||we(\"TwineError.create\",\"has a bad message string\"),n||e in xe||we(\"TwineError.create\",\"no error explanation given\"),\"user\"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:n,source:void 0,innerDOM:r,appendTitleText:!1})},containsError(...e){for(let t=0;t<e.length;t+=1){const n=e[t];if(Te.isPrototypeOf(n))return n;if(Array.isArray(n)){const e=Te.containsError(...n);if(e)return e}}return!1},createWarning(e,t){return Object.assign(this.create(e,t),{warning:!0})},render(e,t=!1){e=\"string\"==typeof e?e:this.source||\"\";const n=a(`<tw-error class='${this.warning?\"warning\":\"error\"}' title='${ke(e)}'>${ke(this.message+(this.appendTitleText?` ${e}`:\"\"))}</tw-error>`),r=a(\"<tw-error-explanation>\").text(this.explanation||xe[this.type]).hide(),o=a(\"<tw-folddown tabindex=0>\");return this.innerDOM&&a(\"<tw-open-button label='Open'>\").on(\"click\",(()=>{const e=a(\"<tw-backdrop><tw-dialog></tw-backdrop>\");e.find(\"tw-dialog\").prepend(this.innerDOM,a(\"<tw-link tabindex=0>OK</tw-link>\").on(\"click\",(()=>{this.innerDOM.detach(),e.remove()})).wrap(\"<tw-dialog-links>\").parent()),$.storyElement.prepend(e)})).appendTo(n),n.append(o).append(r),n.data(\"TwineError\",this),t||$e.forEach((t=>t(this,e))),n},on:e=>(\"function\"!=typeof e||$e.includes(e)||$e.push(e),Te)};var Se=Object.preventExtensions(Te);const{insensitiveName:Ee,unescape:Ce,onStartup:Ne,impossible:Oe}=$,{assign:je}=Object,Ae=RegExp(ve.Patterns.macroFront+ve.Patterns.macroName,\"ig\");function _e(e){const t=e.attr(\"name\"),n=Ce(e.html()),r=function(e,t){const n=[\"metadata\",\"storylet\",\"exclusivity\",\"urgency\"];if(!(e.match(Ae)||[]).some((e=>n.some((t=>Ee(e.slice(1,-1))===t)))))return{};let r=!1;const a={};return ve.lex(e,t).children.forEach((function e(t){if(\"macro\"===t.type){const e=Ee(t.name);if(n.some((t=>e===t))){if(Se.isPrototypeOf(a[e]))return;if(r)return void(a[e]=Se.create(\"syntax\",`The (${t.name}:) macro can't appear after non-metadata macros.`));if(a[e])return void(a[e]=Se.create(\"syntax\",`There is more than one (${t.name}:) macro.`));a[e]=t}else r=!0;t.children.forEach((function e(t){const r=Ee(t.name);\"macro\"===t.type&&n.some((e=>r===e))?a[r]=Se.create(\"syntax\",`The (${t.name}:) macro can't be inside another macro.`):t.children.forEach(e)}))}else t.children.forEach(e)})),a}(n,t);return je(new Map([[\"source\",n],[\"tags\",(e.attr(\"tags\")||\"\").split(/\\s/)||[]],[\"name\",t]]),{TwineScript_TypeName:\"a passage datamap\",TwineScript_ObjectName:\"a passage datamap\",metadata:r,tree:null})}let De=Object.create(null),Ie=[],Pe=null;const Re=je(new Map,{TwineScript_ObjectName:\"the Passages datamap\",getTagged(e){if(De[e])return De[e];const t=T(\"en\",(e=>e.get(\"name\"))),n=[];return this.forEach((t=>{const r=t instanceof Map&&t.get(\"tags\");Array.isArray(r)&&r.includes(e)&&n.push(t)})),n.sort(t),De[e]=n,n},clearTagCache(){De=Object.create(null)},clear(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete(){Map.prototype.delete.call(this,...arguments),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree(e){if(!this.has(e))return Oe(\"Passages.getTree\",\"No passage name?\"),[];const t=this.get(e),n=t.get(\"tags\");if(n.includes(\"header\")||n.includes(\"footer\")||n.includes(\"debug-header\")||n.includes(\"debug-footer\"))return t.tree||(t.tree=ve.lex(t.get(\"source\"),e)),t.tree;for(let t=0;t<Ie.length;t+=1)if(Ie[t]&&Ie[t].place===e){const e=Ie.splice(t,1)[0];return Ie.unshift(e),e}const r=ve.lex(t.get(\"source\"),e);return Ie.unshift(r),Ie.length>16&&Ie.pop(),r},clearTreeCache(){Ie=[]},getStorylets(e,t){const n=t?t.filter(e,[...Re.values()]):[...Re.values()];if(Se.containsError(n))return n;const r=[];let a=-1/0;const o=n.reduce(((t,n)=>{if(t)return t;const o=n.get(\"storylet\");if(o){const t=e.speculate(o,n.get(\"name\"),\"a (storylet:) macro\");if(Se.containsError(t))return t.message=`There's an error in the storylet passage \"${n.get(\"name\")}\":\\n${t.message}`,t.source=o.TwineScript_ToSource(),t;if(t){const e=n.get(\"exclusivity\");a=Math.max(a,\"number\"==typeof e?e:0),r.push(n)}}}),void 0);if(o)return o;const i=T(\"en\");return r.filter((e=>{let t=e.get(\"exclusivity\");return t=\"number\"==typeof t?t:0,t===a})).sort(((e,t)=>{let n=e.get(\"urgency\"),r=t.get(\"urgency\");return n=\"number\"==typeof n?n:0,r=\"number\"==typeof r?r:0,n!==r?r-n:i(e.get(\"name\"),t.get(\"name\"))}))},allStorylets:()=>(Pe||(Pe=[...Re.values()].filter((e=>e.get(\"storylet\")))),Pe),clearStoryletCache(){Pe=null},loadMetadata(e){const t=[];return Re.forEach((n=>{n.metadata&&Object.keys(n.metadata).forEach((r=>{if(Se.containsError(n.metadata[r]))return void t.push(n.metadata[r]);const a=n.metadata[r],o=e.speculate(a,n.get(\"name\"),`a (${r}:) macro`),i=`In \"${n.get(\"name\")}\":\\n`;if(Se.containsError(o))return o.message=i+o.message,o.source=a.text,void t.push(o);function s(e,r){n.has(e)?t.push(Se.create(\"syntax\",`This passage's datamap already has a '${JSON.stringify(e)}' data name.`)):n.set(e,r)}o instanceof Map?o.forEach(((e,t)=>s(t,e))):s(r,o)})),n.metadata=void 0})),t},hasValid(e){const t=this.get(e);return t&&t instanceof Map&&t.has(\"source\")},create:_e});Ne((()=>{a(\"tw-storydata > tw-passagedata\").get().forEach((e=>{let t=a(e);Re.set(t.attr(\"name\"),_e(t))}))}));const{escape:Me,insensitiveName:Ve,options:Le}=$;let Fe;function He(e,t,n=\"\"){return`<${t}${n?` ${n}`:\"\"}>${e}</${t}>`}const qe=\"text-align: center; max-width:50%; \";function ze(e,t){function n(e,n,r){const a=ze(e.children,t);return a&&He(a,n,r)}let r=\"\",a=[];if(!e)return r;Array.isArray(e)||(e=[e]);const o=e.length;for(let i=0;i<o;i+=1){let s=e[i];switch(s.type){case\"include\":r+=n(s,`tw-${s.type}`,`type=\"${s.tag}\" name=\"${s.name}\"`);break;case\"error\":r+=Se.create(\"syntax\",s.message,s.explanation).render(Me(s.text))[0].outerHTML;break;case\"numbered\":case\"bulleted\":{let n=\"numbered\"===s.type?\"ol\":\"ul\";r+=`<${n}>`;let a=1;for(;i<o&&e[i];){if(\"br\"===e[i].type){if(r+=\"</li>\",!e[i+1]||e[i+1].type!==s.type)break}else e[i].type===s.type?(r+=`<${n}>`.repeat(Math.max(0,e[i].depth-a)),r+=`</${n}>`.repeat(Math.max(0,a-e[i].depth)),r+=\"<li>\",a=e[i].depth):r+=ze([e[i]],t);i+=1}r+=`</${n}>`.repeat(a+1);break}case\"align\":for(;s&&\"align\"===s.type;){const{align:n}=s,a=i+=1;if(\"left\"===n){i-=1;break}for(;i<o&&e[i]&&\"align\"!==e[i].type;)i+=1;const c=ze(e.slice(a,i),t);let l=\"\";switch(n){case\"center\":l+=`${qe}margin-left: auto; margin-right: auto;`;break;case\"justify\":case\"right\":l+=`text-align: ${n};`;break;default:+n&&(l+=`${qe}margin-left: ${n}%;`)}r+=`<tw-align ${l?`style=\"${l}\"`:\"\"}>${c}</tw-align>\\n`,s=e[i]}break;case\"column\":{const n=[];for(;s&&\"column\"===s.type;){const{column:r}=s,a=i+=1;if(\"none\"===r){i-=1;break}for(;i<o&&e[i]&&\"column\"!==e[i].type;)i+=1;n.push({text:s.text,type:r,body:ze(e.slice(a,i),t),width:s.width,marginLeft:s.marginLeft,marginRight:s.marginRight}),s=e[i]}if(n.length){const e=n.reduce(((e,t)=>e+t.width),0);r+=`<tw-columns>${n.map((t=>`<tw-column type=${t.type}  style=\"width:${t.width/e*100}%; margin-left: ${t.marginLeft}em; margin-right: ${t.marginRight}em;\">${t.body}</tw-column>\\n`)).join(\"\")}</tw-columns>`}break}case\"heading\":for(r+=`<h${s.depth}>`;++i<o&&e[i];){if(\"br\"===e[i].type){r+=`</h${s.depth}>`;break}r+=ze([e[i]],t)}break;case\"br\":if(!a.length||/td|th/.test(a[0])){r+=\"<br>\";let t=e[i+1];for(;t&&(\"br\"===t.type||\"tag\"===t.type&&/^<br\\b/i.test(t.text));)r+=`<tw-consecutive-br${\"tag\"===t.type?\" data-raw\":\"\"}>&nbsp;</tw-consecutive-br>`,i+=1,t=e[i+1]}break;case\"hr\":r+=\"<hr>\";break;case\"escapedLine\":case\"comment\":break;case\"inlineUrl\":r+=`<a class=\"link\" href=\"${Me(s.text)}\">${s.text}</a>`;break;case\"scriptStyleTag\":case\"tag\":{const e=s.text.toLowerCase();/^<\\/?(?:table|thead|tbody|tr|tfoot|td|th|svg)\\b/.test(e)&&!s.text.endsWith(\"/>\")&&a[s.text.startsWith(\"</\")?\"shift\":\"unshift\"](e),r+=s.text.startsWith(\"</\")?s.text:s.text.replace(/(\\/)?>$/,((e,t)=>` data-raw${t?`></${s.text.match(/[\\w-]+/)}`:\"\"}>`));break}case\"sub\":case\"sup\":case\"strong\":case\"em\":r+=n(s,s.type);break;case\"strike\":r+=n(s,\"s\");break;case\"bold\":r+=n(s,\"b\");break;case\"italic\":r+=n(s,\"i\");break;case\"twineLink\":{const[e]=ve.lex(`(link-goto:${JSON.stringify(s.innerText)},${JSON.stringify(s.passage)})`).children;r+=`<tw-expression type=\"macro\" name=\"link-goto\"${Le.debug?` title=\"${Me(s.text)}\"`:\"\"} code=\"${t.code.length}\"></tw-expression>`,t.code.push(e);break}case\"hook\":r+=`<tw-hook ${s.hidden?\"hidden \":\"\"}${s.name?`name=\"${Ve(s.name)}\"`:\"\"}${Le.debug&&s.name?` title=\"Hook: ?${s.name}\"`:\"\"} source=\"${t.source.length}\"></tw-hook>`,t.source.push(s.children);break;case\"unclosedHook\":return r+=`<tw-hook ${s.hidden?\"hidden \":\"\"}${s.name?`name=\"${Ve(s.name)}\"`:\"\"}source=\"${t.source.length}\"></tw-hook>`,t.source.push(e.slice(i+1,o)),r;case\"verbatim\":r+=He(Me(s.innerText).replace(/\\n/g,\"<br>\"),\"tw-verbatim\");break;case\"collapsed\":r+=n(s,\"tw-collapsed\");break;case\"unclosedCollapsed\":return r+=`<tw-collapsed>${ze(e.slice(i+1,o),t)}</tw-collapsed>`,r;case\"variable\":case\"tempVariable\":case\"macro\":{const e=[],n=[];if(\"macro\"===s.type&&function t(r){\"string\"!==r.type&&\"hook\"!==r.type&&r.children.every(t);const a=Ve(r.name);if(\"macro\"!==r.type||\"prompt\"!==a&&\"confirm\"!==a){if(\"hook\"===r.type&&!r.everyLeaf((e=>\"error\"!==e.type||(n.push(e),!1))))return!1}else e.push(r);return!0}(s),n.length)return Se.create(\"syntax\",`This code hook's markup contained ${n.length} error${n.length?\"s\":\"\"}:<br>—${n.map((e=>e.message)).join(\"<br>—\")}`).render(Me(s.text))[0].outerHTML;const a=e.map((e=>(e.blockerTree=t.blockers.length,t.blockers.push(e),e.blockerTree)));r+=`<tw-expression type=\"${s.type}\" name=\"${Me(s.name||s.text)}\"${Le.debug?` title=\"${Me(s.text)}\"`:\"\"}${a.length?` blockers=\"${a}\"`:\"\"} code=\"${t.code.length}\"></tw-expression>`,t.code.push(s)}break;default:r+=s.children&&s.children.length?ze(s.children,t):s.text}}return r}Fe={exec(e){const t={code:[],blockers:[],source:[]},n=ze(e=\"string\"==typeof e?ve.lex(e).children:e,t),r=a(a.parseHTML(n,document,!0));return r.findAndFilter(\"script:not([src])\").each(((e,t)=>{const n=t.getAttribute(\"type\");n&&\"text/javascript\"!==n.toLowerCase()||t.setAttribute(\"type\",\"application/x-harlowe\")})),t.blockers=t.blockers.map((e=>{e.blockedValue=!0;const t=Object.create(e);return t.blockedValue=!1,t})),r.findAndFilter(\"tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])\").each(((e,n)=>{let r=a(n);if(r.attr(\"blockers\")){const e=r.popAttr(\"blockers\").split(\",\").map((e=>t.blockers[e]));r.data(\"blockers\",e)}r.attr(\"source\")&&r.data(\"source\",t.source[r.popAttr(\"source\")]),r.attr(\"code\")&&r.data(\"code\",t.code[r.popAttr(\"code\")])})),r}};var We=Object.freeze(Fe);const{impossible:Be,transitionIn:Ue}=$,{exec:Ge}=We,{assign:Xe,keys:Ye,seal:Je,hasOwn:Ke}=Object,{isArray:Qe}=Array,Ze=e=>(\"string\"==typeof e?e:e.map((e=>e.text)).join(\"\")).split(/\\n/g).reduce(((e,t,n,{length:r})=>e.concat(document.createTextNode(t),n!==r-1&&document.createElement(t.length?\"br\":\"tw-consecutive-br\"))),[]);class et{loopVars={};styles=[];attr=[];data={};summary(){return[\"source\",\"appendSource\",\"enabled\",\"verbatim\",\"target\",\"append\",\"newTargets\",\"transition\",\"transitionTime\",\"transitionDeferred\",\"transitionDelay\",\"transitionSkip\",\"transitionOrigin\",\"innerEnchantments\",\"enablers\",\"output\"].filter((e=>Ke(this,e))).concat([this.attr.length&&\"attr\",this.styles.length&&\"styles\",Ye(this.loopVars).length&&\"loopVars\",Ye(this.data).length&&\"data\"].filter(Boolean))}constructor(e){e&&Xe(this,e)}update(){const{newTargets:e,transition:t,transitionDeferred:n,append:r}=this;let{target:a}=this;\"function\"==typeof a&&(a=a());const o=e=>{if(Qe(this.styles)&&this.styles.length>0){const[t,n]=this.styles.reduce(((e,t)=>(Ye(t).forEach((n=>{const r=t[n];e[+(\"function\"==typeof r)].push({[n]:r})})),e)),[[],[]]);t.forEach((t=>e.css(t))),setTimeout((()=>{n.forEach((t=>e.css(t)))}))}this.attr&&this.attr.forEach((t=>e.attr(t))),this.data&&e.data(this.data)};let i=a;if(Qe(e)&&e.length&&(i=e.map((e=>e.target))),Qe(i))for(let e=0;e<i.length;e+=1)o(i[e]);else o(i);if(t&&!n&&!r){let e,n=a;do{e=n.data(\"timestamp\"),!e&&(n=n.parent())}while(!e&&n.length);Ue(a,t,this.transitionTime,this.transitionDelay,this.transitionSkip,e?Date.now()-e:0,this.transitionOrigin)}}render(){const{source:e,transition:t,transitionTime:n,transitionDeferred:r,enabled:o,enablers:i,data:s,section:c,newTargets:l,innerEnchantments:p,appendSource:u,output:d}=this;let{target:h,target:f,append:m}=this;if(\"function\"==typeof h&&(h=h()),!m)return Be(\"ChangeDescriptor.render\",\"This doesn't have an 'append' method chosen.\"),a();if(d)return a();if(i?.length){const{descriptor:e,changer:t}=i[0],n=e.render();if(t){const e=new et({section:c,target:n});t.run(e),e.update()}return n}if(!o||void 0!==h.attr(\"hidden\"))return new et({target:h,attr:this.attr.filter((e=>!(\"style\"in e))),data:{...s,originalSource:e,hidden:!0}}).update(),a();let g=h;if(Qe(l)&&l.length&&(g=l),!g)return Be(\"ChangeDescriptor.render\",\"ChangeDescriptor has source but not a target!\"),a();let y=a();if([].concat(g).filter((e=>!e.jquery)).map((e=>{let t,n=m;return e.target&&e.append&&(({append:n,before:t}=e),e=e.target),{elements:e.hooks(c,f).filter((function(){return!(t&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(f[0]))})),append:n}}),[]).forEach((({elements:e,append:t})=>{e.each(((e,n)=>{n=a(n),y=y.add(Xe(Object.create(this),{target:n,append:t,newTargets:null}).render()),n.filter(\"tw-pseudo-hook\").contents().unwrap()}))})),y.length||Qe(g))return y;let b=m;if(!(b in g)){if(\"replace\"!==b)return Be(\"ChangeDescriptor.render\",`The target doesn't have a '${b}' method.`),a();g[0]instanceof Text?b=\"replaceWith\":(g.empty(),b=\"append\")}return g[0]instanceof Text&&(\"append\"===b&&(b=\"after\"),\"prepend\"===b&&(b=\"before\")),y=a(e&&(this.verbatim?Ze(e):Ge(e))),Qe(u)&&u.forEach((({source:e,append:t})=>{const n=a(this.verbatim?Ze(e):Ge(e));y=\"append\"===t?y.add(n):\"prepend\"===t?n.add(y):n})),g[b](y.length?y:void 0),g.data(\"timestamp\",Date.now()),this.update(),t&&!r&&Ue(\"replace\"===m?h:y,t,n,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),p&&p.map((e=>e(g))).forEach((e=>c.addEnchantment(e))),y}}Xe(et.prototype,{source:\"\",enabled:!0,verbatim:!1,append:\"replace\",transition:\"\",output:!1,timestamp:0}),Je(et);const{impossible:tt,nth:nt,permutations:rt,plural:at}=$,{validPropertyName:ot}=ce,it=\"object\",st=\"boolean\",ct=\"string\",lt=\"number\";function pt(e){return!!e&&(typeof e===it||\"function\"==typeof e)}const{isArray:ut}=Array;function dt(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function ht(e){return ut(e)?\"array\":e instanceof Map?\"datamap\":e instanceof Set?\"dataset\":typeof e===ct?ct:e&&typeof e===it?it:\"\"}function ft(e){if(!pt(e))return e;if(\"TwineScript_Clone\"in e&&\"function\"==typeof e.TwineScript_Clone)return e.TwineScript_Clone();if(ut(e))return[...e];if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(\"function\"==typeof e)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return{...e};case null:return Object.assign(Object.create(null),e)}return tt(\"OperationUtils.clone\",`The value ${e} cannot be cloned!`),e}function mt(e,t,n,r){let a=\"\",o=0;for(;a.length<=t&&o<e.length;){const i=r(e[o]);if(!(i.length+a.length<=t)){a+=(o>0?\" and \":\"\")+at(e.length-o,(o>0?\"other \":\"\")+n);break}a+=(o>0&&o===e.length-1?\" and \":\"\")+i+(o<e.length-1?\", \":\"\"),o+=1}return a}function gt(e){if(pt(e)&&\"TwineScript_ObjectName\"in e)return e.TwineScript_ObjectName;if(ut(e))return 0===e.length?\"an empty array\":`an array (with ${mt(e,48,\"item\",gt)})`;if(e instanceof Map)return 0===e.size?\"an empty datamap\":`a datamap (with ${mt([...e.keys()],48,\"dataname\",bt)})`;if(e instanceof Set)return 0===e.size?\"an empty dataset\":`a dataset (with ${mt([...e.values()],48,\"item\",gt)})`;if(typeof e===ct){if(0===e.length)return\"an empty string\";let t=[...e];return t.length>48?`a ${t.length}-character string starting with ${JSON.stringify(t.slice(0,48).join(\"\"))}`:`the string ${JSON.stringify(e)}`}return typeof e===st?`the boolean value '${e}'`:typeof e===lt?`the number ${JSON.stringify(e)}`:void 0===e?\"an empty variable\":\"...whatever this is\"}const yt=(e,t)=>[e[0],t[0]].sort(T(\"en\"))[0]===e[0]?-1:1;function bt(e,t){let n=Se.containsError(e);if(n&&tt(\"toSource\",`received a TwineError: ${n.message}`),\"function\"==typeof e.TwineScript_ToSource)return e.TwineScript_ToSource();if(dt(e)&&\"first\"in e&&\"last\"in e)return`${e.first<0?`${-1!==e.first?nt(-e.first):\"\"}last`:nt(e.first+1)}to${e.last<0?`${-1!==e.last?nt(-e.last):\"\"}last`:nt(e.last+1)}`;if(ut(e)){let n=\"\";for(let r of e)n+=n?\",\":\"(a:\",n+=\"property\"===t?r+(r>0):bt(r);return n+(n?\")\":\"(a:)\")}if(e instanceof Map){const t=Array.from(e.entries()).sort(yt);let n=\"\";for(let[e,r]of t)n+=`${(n?\",\":\"(dm:\")+bt(e)},${bt(r)}`;return n+(n?\")\":\"(dm:)\")}return e instanceof Set?`(ds:${Array.from(e).sort(T(\"en\")).map(bt)})`:typeof e===lt&&\"property\"===t?e<0?-1===e?\"last\":`${nt(-e)}last`:nt(e+1):typeof e===ct&&\"property\"===t?RegExp(ot).test(e)?e:`(${JSON.stringify(e)})`:JSON.stringify(e)}function vt(e,t){return typeof e!==it&&typeof t!==it?e===t:ut(e)&&ut(t)?e.length===t.length&&e.every(((e,n)=>vt(t[n],e))):e instanceof Map&&t instanceof Map?vt(Array.from(e.entries()).sort(),Array.from(t.entries()).sort()):e instanceof Set&&t instanceof Set?vt([...e],[...t]):e&&\"function\"==typeof e.TwineScript_is?e.TwineScript_is(t):e&&typeof e===it&&t&&typeof t===it&&dt(e)&&dt(t)?vt(Object.getOwnPropertyNames(e).map((t=>[t,e[t]])),Object.getOwnPropertyNames(t).map((e=>[e,t[e]]))):Object.is(e,t)}const wt=Object.freeze({isObject:pt,isValidDatamapName:function(e,t){if(e instanceof Map||tt(\"isValidDatamapName\",\"called with non-Map\"),Se.containsError(t))return t;if(typeof t!==ct&&typeof t!==lt)return Se.create(\"property\",`Only strings and numbers can be used as data names for ${gt(e)}, not ${gt(t)}.`);const n=typeof t===ct?+t:`${t}`;return!(!Number.isNaN(n)&&e.has(n))||Se.create(\"property\",`You mustn't use both ${gt(t)} and ${gt(n)} as data names in the same datamap.`)},collectionType:ht,isSequential:function(e){return typeof e===ct||ut(e)||\"function\"==typeof e.hooks},unstorableValue:function e(t){return pt(t)&&\"TwineScript_Unstorable\"in t&&t||ut(t)&&t.find(e)||t instanceof Map&&[...t.values()].find(e)||t instanceof Set&&[...t].find(e)},isHarloweJSValue:function e(t){return typeof t===ct||typeof t===st||typeof t===lt&&!Number.isNaN(t)&&Math.abs(t)!==1/0||Array.isArray(t)&&t.every(e)||t instanceof Set&&[...t].every(e)||t instanceof Map&&[...t.values()].every(e)&&[...t.keys()].every((e=>typeof e===ct))},clone:ft,objectName:gt,typeName:function e(t){const n=dt(t);if(n&&t.innerType)return t.typeName?t.typeName:\"insensitive set\"===t.pattern?\"a case-insensitive string name\":\"either\"===t.pattern?(ut(t.innerType)||tt(\"typeName\",'\"either\" pattern had non-array inner type'),t.innerType.map(e).join(\" or \")):\"optional\"===t.pattern?`(optional) ${e(t.innerType)}`:e(t.innerType);if(n&&\"range\"===t.pattern){if(t.name)return t.name;const{min:e,max:n}=t;return`a${e>0?\" positive\":\"\"}${t.integer?\" whole\":\"\"} number${0===e?` between 0 and ${n}`:n<1/0?` up to ${n}`:\"\"}`}return t===String||t===Number||t===Boolean?\"a \"+typeof t():t===parseInt?\"a whole number\":t===Map?\"a datamap\":t===Set?\"a dataset\":t===Array?\"an array\":pt(t)&&\"TwineScript_TypeName\"in t?t.TwineScript_TypeName:gt(t)},typeID:function(e){const t=typeof e;return[st,ct,lt].includes(t)?t:ut(e)?\"array\":e instanceof Map?\"datamap\":e instanceof Set?\"dataset\":e.constructor.TwineScript_TypeID||\"\"},toSource:bt,is:vt,contains:function(e,t){if(e||\"\"===e){if(typeof e===ct)return typeof t!==ct?Se.create(\"operation\",`${gt(e)} can only contain strings, not ${gt(t)}.`):e.includes(t);if(ut(e))return e.some((e=>vt(e,t)));if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some((e=>vt(e,t)))}return Se.create(\"operation\",`${gt(e)} cannot contain any values, let alone ${gt(t)}`)},isA:function(e,t){return\"function\"==typeof t.TwineScript_IsTypeOf?t.TwineScript_IsTypeOf(e):Se.create(\"operation\",`\"is a\" should only be used to compare type names, not ${gt(t)}.`)},matches:function e(t,n){let r=!1;if(t&&\"function\"==typeof t.TwineScript_IsTypeOf){const e=t.TwineScript_IsTypeOf(n);if(Se.containsError(e))return e;r||=e}if(n&&\"function\"==typeof n.TwineScript_IsTypeOf){const e=n.TwineScript_IsTypeOf(t);if(Se.containsError(e))return e;r||=e}if(r)return!0;if(ut(t)&&ut(n)){let r=0,a=0,o=!0;for(;o&&r<t.length&&a<n.length;){let i=t[r],s=n[a];if(i.rest){for(;a<n.length&&e(i,s);)a+=1,s=n[a];r+=1}else if(s.rest){for(;r<t.length&&e(i,s);)r+=1,i=t[r];a+=1}else e(i,s)?(r+=1,a+=1):o=!1}return o&&r>=t.length&&a>=n.length}return t instanceof Map&&n instanceof Map?e(Array.from(t.entries()).sort(),Array.from(n.entries()).sort()):t instanceof Set&&n instanceof Set?(t=[...t],rt(...n).some((n=>e(t,n)))):vt(t,n)},subset:function e(t,n,r){if(!n||!r)return Se.create(\"macrocall\",`The sub${ht(t)} index value must not be ${n&&r}.`);const a=typeof t===ct;if(a&&(t=Array.from(t)),n<0&&(n=Math.max(0,t.length+n+1)),r<0&&(r=Math.max(0,t.length+r+1)),n>r)return e(arguments[0],r,n);const o=t.slice(n>0?n-1:n,r).map(ft);return a?o.join(\"\"):o},range:function e(t,n){if(t>n)return e(n,t);const r=[t];for(n-=t;n-- >0;)r.push(++t);return r},printBuiltinValue:function e(t){return Se.containsError(t)?t:t&&\"function\"==typeof t.TwineScript_Print?t.TwineScript_Print():t instanceof Map?(t=Array.from(t.entries()),Se.containsError(t)?t:`${t.reduce(((t,[n,r])=>`${t}<tr><td>\\`${e(n)}\\`</td><td>\\`${e(r)}\\`</td></tr>`),\"<table class=datamap>\")}</table>`):t instanceof Set?`${Array.from(t.values()).map(e)}`:ut(t)?`${t.map(e)}`:t&&typeof t.jquery===ct?t:pt(t)?Se.create(\"unimplemented\",\"I don't know how to print this value yet.\"):`${t}`},unique:(e,t,n)=>n.findIndex((t=>vt(e,t)))===t}),{toSource:kt}=wt;class xt{#e=\"\";#t=\"\";attachable;cd;#n;static TwineScript_TypeID;get TwineScript_ObjectName(){return`a (${this.#e}:) command`}get TwineScript_TypeName(){return`a (${this.#e}:) command`}TwineScript_Print(){return`\\`[A (${this.#e}:) command]\\``}TwineScript_ToSource(){return this.#t}TwineScript_is(e){return kt(this)===kt(e)}TwineScript_Clone(){return new xt({attachable:this.attachable,cd:new et(this.cd),runFn:this.#n,name:this.#e,source:this.#t})}TwineScript_Attach(e,t){this.cd.section=e;const n=t.run(this.cd);return Se.containsError(n)?n:this}TwineScript_Run(e){const t=this.#n(this.cd,e);return this.attachable&&(this.cd=new et),t}constructor({attachable:e,cd:t=new et,runFn:n,name:r,source:a}){this.attachable=e,this.cd=t,void 0!==r&&(this.#e=r),void 0!==a&&(this.#t=a),void 0!==n&&(this.#n=n)}name(e,t){return this.#e=e,this.#t=t,this}}function $t({variables:e,hook:t,changer:n}){const r={};for(let t in e)r[t]=[e[t]];const a=new et({source:t,loopVars:r});if(n){const e=n.run(a);if(Se.containsError(e))return e}return a}Object.freeze(xt),Object.freeze(xt.prototype);class Tt extends xt{get TwineScript_ObjectName(){return\"a custom command\"}get TwineScript_TypeName(){return\"a custom command\"}TwineScript_Print(){return\"`[A custom command]`\"}TwineScript_Clone(){return new Tt(this.#r)}TwineScript_Run(e){this.cd.section=e;const t=this.cd;return this.cd=$t(this.#r),t}constructor(e){super({attachable:!0,cd:$t(e),source:e.toSource}),this.#r=e}#r;TwineScript_CustomCommand(){return this.#r}}Object.freeze(Tt),Object.freeze(Tt.prototype);const{toSource:St,is:Et}=wt,{lex:Ct}=ve,{assign:Nt,create:Ot,defineProperty:jt,hasOwn:At}=Object,{isArray:_t}=Array,{imul:Dt}=Math;jt(Map.prototype,\"toJSON\",{value:void 0}),jt(Set.prototype,\"toJSON\",{value:void 0});const It=[\"localStorage\",\"sessionStorage\"].map((e=>{try{return!!window[e]&&(window[e].setItem(\"test\",\"1\"),window[e].removeItem(\"test\"),!0)}catch(e){return!1}}));let Pt,Rt;function Mt(e=String.fromCodePoint(Date.now()%1114112),t=0){Pt.seedIter=t,Pt.seed=e;let n,r=0,a=2166136261;for(;r<e.length;r+=1)n=Dt(e.charCodeAt(r),3432918353),n=n<<15|n>>>17,a^=Dt(n,461845907),a=a<<13|a>>>19,a=Dt(a,5)+3864292196|0;return a^=e.length,a^=a>>>16,a=Dt(a,2246822507),a^=a>>>13,a=Dt(a,3266489909),a^=a>>>16,a=(a>>>0)+1831565813*t,()=>{Pt.seedIter+=1;let e=a+=1831565813;return e=Dt(e^e>>>15,1|e),e^=e+Dt(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}function Vt(e,t,n){const r=\"it\"===n?\"its\":`${n}'s`;let a=\"\";if(_t(t)&&_t(e)&&t.length){let o=t.length===e.length;a=\"(a:\";for(let n=0;n<t.length;n+=1){const i=t[n];if(Et(i,e[n])){const e=St(i),t=`${r} ${n+1}th`;a+=`${e.length<t.length?e:t},`;continue}o=!1;const s=e.indexOf(i);if(s>-1){const e=St(i),t=`${r} ${s+1}th`;a+=`${e.length<t.length?e:t},`}else a+=`${Vt(e[n],i,`${r} ${n+1}th`)},`}a=o?n:`${a.slice(0,-1)})`}else if(t instanceof Map&&e instanceof Map&&t.size){let o=t.size===e.size;a=\"(dm:\";for(let[n,i]of t.entries())if(a+=`${St(n)},`,Et(i,e.get(n))){const e=St(i),t=`${r} (${St(n)})`;a+=`${e.length<t.length?e:t},`}else o=!1,a+=`${Vt(e.get(n),i,`${r} (${St(n)})`)},`;a=o?n:`${a.slice(0,-1)})`}else if(t instanceof Set&&e instanceof Set&&t.size){const r=new Set,o=new Set;for(let n of e)t.has(n)||r.add(n);for(let n of t)e.has(n)||o.add(n);r.size||o.size||(a=n),a=r.size+o.size>t.size?St(t):n+(o.size?`+${St(o)}`:\"\")+(r.size?`-${St(r)}`:\"\")}else\"string\"==typeof t&&\"string\"==typeof e&&t&&(t.startsWith(e)?a=`${n}+${St(t.slice(e.length))}`:t.endsWith(e)&&(a=`${St(t.slice(0,t.length-e.length))}+${n}`));return a?\"it\"===n?{via:a}:a:\"it\"===n?void 0:St(t)}const Lt={passage:\"\",variables:Ot(null),visits:void 0,turns:void 0,seed:void 0,seedIter:void 0,mockVisits:void 0,mockTurns:void 0,forgetVisits:void 0,create(e=\"\"){const t=Ot(Lt);return t.passage=e,t.variables=Ot(null),t.valueRefs=Ot(null),t}},Ft={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]};let Ht=[],qt=-1,zt=Lt.create(),Wt=\"\";const Bt=(e,t)=>{const n=t.variables,r=Ot(null);for(let a=e.length-1;a>=0;a-=1){const o=e[a];for(let e of[\"mockVisits\",\"mockTurns\",\"seed\",\"seedIter\"])At(o,e)&&!At(t,e)&&(t[e]=o[e]);o.forgetVisits&&(t.forgetVisits=Math.max(t.forgetVisits||0,o.forgetVisits)),void 0!==o.turns&&(t.turns=(t.turns||0)+o.turns),t.pastVisits||=[],a!==e.length-1&&(void 0!==e[a+1].visits&&Array.isArray(t.pastVisits[0])?t.pastVisits[0].unshift(o.passage):t.pastVisits.unshift(o.passage)),void 0!==o.pastVisits&&t.pastVisits.unshift(o.pastVisits),void 0!==o.visits&&t.pastVisits.unshift(o.visits);for(let e in o.variables)if(\"TwineScript_TypeDefs\"===e){n[e]||=Ot(null);for(let t in o.variables[e])n[e][t]||=o.variables[e][t]}else if(!e.startsWith(\"TwineScript_\")&&!(e in n)&&(null===o.variables[e]&&(r[e]=!0),!r[e])){n[e]=o.variables[e];const r=o.valueRefs[e];r&&!(\"via\"in r)&&(t.valueRefs[e]||=r)}}for(let e in t.valueRefs){const n=t.valueRefs[e];n&&\"via\"in n&&delete t.valueRefs[e]}};function Ut(){Pt.history=Pt.pastVisits.slice(Pt.forgetVisits).reduce(((e,t)=>e.concat(t)),[]),Pt.mockVisits&&(Pt.history=Pt.mockVisits.concat(Pt.history))}function Gt(){const e=Lt.create();e.pastVisits=[],Nt(e.variables,{TwineScript_ObjectName:\"this story's variables\",TwineScript_TypeDefs:Ot(null),TwineScript_VariableStore:{type:\"global\",name:\"this story's variables\"},TwineScript_Delete(e){delete this[e],zt.variables[e]=null,delete zt.valueRefs[e]},TwineScript_Set(e,t,n){if(this[e]=t,zt.variables[e]=t,n)zt.valueRefs[e]=n;else if((_t(t)||t instanceof Map||t instanceof Set||\"string\"==typeof t)&&!$.options.uncompressedStructures)for(let n=qt;n>=0;n-=1){const r=Ht[n].variables[e];if(void 0!==r){const n=Vt(r,t,\"it\");n&&(\"it\"===n.via?delete zt.variables[e]:zt.valueRefs[e]=n);break}}},TwineScript_GetProperty(e){return this[e]},TwineScript_DefineType(e,t){this.TwineScript_TypeDefs[e]=t,At(zt.variables,\"TwineScript_TypeDefs\")||(zt.variables.TwineScript_TypeDefs=Ot(null)),zt.variables.TwineScript_TypeDefs[e]=t}}),Bt(Ht.slice(0,qt+1),e),Pt=e,Ut(),Rt=Mt(e.seed,e.seedIter)}let Xt;function Yt(e){let t;zt=Lt.create(e),({past:Wt,pastAndPresent:t}=Xt.serialise(!0)),function(e){if(Xt.hasSessionStorage&&\"string\"==typeof e)try{sessionStorage.setItem(\"Saved Session\",e)}catch(e){return}}(t)}function Jt(e,t,n,r){for(let a in r)if(At(r,a)&&!a.startsWith(\"TwineScript_\"))if(\"object\"==typeof r[a])if(At(r[a],\"at\")){n.valueRefs[a]=r[a];const{at:t,from:o,to:i,hash:s,seed:c,seedIter:l,blockedValues:p}=r[a];if(!Re.has(t))throw Error(`The data refers to a passage named \\`\"${n.passage}\"\\`, but it isn't in this story.`);const u=Re.get(t).get(\"source\");let d=u.slice(o,i);if(void 0!==s){let e=0,n=i-o;for(;$.hash(d).toString(16)!==s;){if(e+n>=u.length)throw Error(`The value (or type) of the variable \\`$${a}\\` couldn't be found in the passage \\`\"${t}\"\\`.`);e+=1,e===o&&(e+=1),d=u.slice(e,e+n)}}const h=Ct(d,\"\",\"macro\");void 0!==c&&void 0!==l&&(Rt=Mt(c,l)),void 0!==p&&(e.stackTop.blockedValues=p,h.forEach((function e(t){if(\"string\"!==t.type&&\"hook\"!==t.type&&t.children.every(e),\"macro\"===t.type){const e=$.insensitiveName(t.name);\"prompt\"!==e&&\"confirm\"!==e||(t.blockedValue=!0)}}))),r[a]=e.eval(h)}else if(At(r[a],\"via\")){for(let n=t.length-1;n>=0;n-=1)if(At(t[n].variables,a)){e.Identifiers.it=t[n].variables[a];break}r[a]=e.eval(Ct(r[a].via,\"\",\"macro\")),e.Identifiers.it=0}else At(r[a],\"changer\")&&(r[a].changer=e.eval(Ct(r[a].changer,\"\",\"macro\")),r[a].hook=e.eval(Ct(r[a].hook,\"\",\"macro\")),Jt(e,t,n,r[a].variables),r[a]=new Tt(r[a]));else r[a]=e.eval(Ct(r[a],\"\",\"macro\"));else\"TwineScript_MockVisits\"===a&&(n.mockVisits=r[a])}Gt(),zt.seed=Pt.seed,zt.seedIter=0,Xt={get passage(){return zt.passage},get variables(){return Pt.variables},get pastLength(){return qt},get turns(){return qt+1+(Pt.turns||0)+(Pt.mockTurns||0)},get futureLength(){return Ht.length-1-qt},get mockVisits(){return Pt.mockVisits||[]},set mockVisits(e){Pt.mockVisits=e,zt.mockVisits=e,Ut()},get mockTurns(){return Pt.mockTurns||0},set mockTurns(e){Pt.mockTurns=e,zt.mockTurns=e},history:()=>Pt.history,forgetUndos(e){e<0&&(e=Ht.length+e);const t=Ht.splice(0,Math.min(Ht.length-1,e));if(!t.length)return;qt=Ht.length-1;const n=Ht[0];Bt(t,n),n.pastVisits.push(t[t.length-1].passage),n.turns=(n.turns||0)+t.length,Pt.turns=(Pt.turns||0)+t.length,n.forgetVisits&&(n.pastVisits=n.pastVisits.slice(n.forgetVisits-n.turns),n.forgetVisits-=n.turns),Wt=\"\",0===qt&&a(\"tw-link[undo], tw-icon[alt='Undo']\",$.storyElement).each(((e,t)=>{(a(t).closest(\"tw-expression, tw-hook\").data(\"forgetUndosEvent\")||Object)(t)})),Ft.forgetUndos.forEach((e=>e()))},forgetVisits(e){e<0&&(e=Ht.length+e),e>qt+Pt.turns&&(e=qt+Pt.turns),zt.forgetVisits=Pt.forgetVisits=Math.max(Pt.forgetVisits||0,e),Ut()},passageNameVisited(e){let t=0;if(!Re.get(e))return 0;for(let n=0;n<Pt.history.length;n++)t+=+(e===Pt.history[n]);return t},get timeline(){return Ht},play(e){zt||$.impossible(\"State.play\",\"present is undefined!\"),Ft.beforeForward.forEach((e=>e())),zt.passage&&(zt.visits?.length&&Array.isArray(Pt.pastVisits[Pt.pastVisits.length-1])?Pt.pastVisits[Pt.pastVisits.length-1].push(zt.passage):Pt.pastVisits.push(zt.passage),Pt.history.push(zt.passage)),zt.passage=e,Ht=Ht.slice(0,qt+1).concat(zt),qt+=1,Yt(e),Ft.forward.forEach((t=>t(e)))},redirect(e){zt||$.impossible(\"State.redirect\",\"present is undefined!\"),zt.passage&&(zt.visits?.length&&Array.isArray(Pt.pastVisits[Pt.pastVisits.length-1])?Pt.pastVisits[Pt.pastVisits.length-1].push(zt.passage):Pt.pastVisits.push([zt.passage]),Pt.history.push(zt.passage)),zt.visits=(zt.visits||[]).concat(e),zt.passage=e},rewind(e){let t=void 0!==e?e:1,n=!1;for(;t>0&&qt>0;t--)n=!0,qt-=1;return n&&(Ft.beforeBack.forEach((e=>e())),Wt=\"\",Yt(Ht[qt].passage),Gt(),Ft.back.forEach((e=>e()))),n},fastForward(e){let t=1,n=!1;for(\"number\"==typeof e&&(t=e);t>0&&Ht.length>0;t--)n=!0,qt+=1;return n&&(Ft.beforeForward.forEach((e=>e())),Yt(Ht[qt].passage),Gt(),Ft.forward.forEach((e=>e(Ht[qt].passage,\"fastForward\")))),n},on(e,t){if(e in Ft)return\"function\"!=typeof t||Ft[e].includes(t)||Ft[e].push(t),Xt;$.impossible(\"State.on\",\"invalid event name\")},reset(){Ft.beforeLoad.forEach((e=>e())),Ht=[],qt=-1,Gt(),zt=Lt.create(),zt.seed=Pt.seed,zt.seedIter=0,Wt=\"\",Rt=Mt(),Ft.load.forEach((e=>e(Ht)))},hasStorage:It[0],hasSessionStorage:It[1],setSeed(e){Rt=Mt(e),zt.seed=Pt.seed,zt.seedIter=0},get seed(){return Pt.seed},get seedIter(){return Pt.seedIter},random:()=>{const e=Rt();return zt.seedIter=Pt.seedIter,e},shuffled(...e){const t=e.reduce(((e,t,n)=>{const r=this.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e}),[]);return zt.seedIter=Pt.seedIter,t}},Xt.serialise=e=>{let t;t=Ht.slice(Wt?e?qt-1:qt:0,qt+1);const n=(e,t)=>{if(\"TwineScript_TypeDefs\"===t){const n={};for(let r in e[t])n[r]=St(e[t][r]);return n}if(null===e[t])return null;if(\"object\"==typeof e[t]&&\"TwineScript_CustomCommand\"in e[t]){const r=e[t].TwineScript_CustomCommand();return{changer:St(r.changer),toSource:r.toSource,hook:St(r.hook),variables:Object.keys(r.variables).reduce(((e,t)=>(e[t]=n(r.variables,t),e)),{})}}return St(e[t])};let r=function(e,t){if(Lt.isPrototypeOf(t)&&void 0===t.visits&&void 0===t.turns&&void 0===t.mockVisits&&void 0===t.forgetVisits&&void 0===t.pastVisits&&void 0===t.mockTurns&&void 0===t.seed&&void 0===t.seedIter&&Object.keys(t.variables).every((e=>e.startsWith(\"TwineScript_\"))))return t.passage;if(!Lt.isPrototypeOf(this)||\"valueRefs\"!==e){if(Lt.isPrototypeOf(this)&&\"variables\"===e){const e={};for(let t in this.variables)this.valueRefs[t]?e[t]=this.valueRefs[t]:e[t]=n(this.variables,t);return e}return t}},a=t.slice(0,-1),o=Wt;try{return a.length&&(o=(o?`${o.slice(0,-1)},`:\"[\")+JSON.stringify(a,r).slice(1)),{past:o,pastAndPresent:o.slice(0,-1)+(o?\",\":\"[\")+JSON.stringify(t.slice(-1),r).slice(1)}}catch(e){return{past:!1,pastAndPresent:!1}}},Xt.deserialise=(e,t)=>{let n;try{n=JSON.parse(t)}catch(e){return Error(\"The save data is unintelligible.\")}if(!_t(n))return Error(\"The save data isn't a sequence of past turns.\");for(let t=0;t<n.length;t+=1){let r=n[t];if(\"string\"==typeof r)r={passage:r,variables:{}};else if(\"object\"!=typeof r||!At(r,\"variables\")){n.splice(t--,1);continue}if(r.valueRefs=Ot(null),r.variables=Nt(Ot(null),r.variables),!Re.hasValid(r.passage))return Error(`The data refers to a passage named \\`\"${r.passage}\"\\`, but it isn't in this story.`);if(At(r.variables,\"TwineScript_TypeDefs\"))try{Jt(e,n.slice(0,t),r,r.variables.TwineScript_TypeDefs)}catch(e){return Error(`The variable types on turn ${t+1} couldn't be reconstructed.${e.message?` (${e.message})`:\"\"}`)}try{Jt(e,n.slice(0,t),r,r.variables)}catch(e){return Error(`The variables on turn ${t+1} couldn't be reconstructed.${e.message?` (${e.message})`:\"\"}`)}n[t]=Nt(Ot(Lt),r)}return Ht=n,qt=Ht.length-1,Ft.load.forEach((e=>e(Ht))),Wt=\"\",Gt(),Yt(Ht[qt].passage),!0},Object.seal(Lt);var Kt=Xt;const{typeName:Qt,matches:Zt,toSource:en,unstorableValue:tn}=wt,{freeze:nn,assign:rn}=Object;class an{TwineScript_TypeName=\"a TypedVar (typed variable name)\";get TwineScript_ObjectName(){const e=en(this.datatype);return`the ${e.length<24?`${e}-`:\"\"}typed variable name, ${this.varRef.TwineScript_ToSource()}`}TwineScript_Print(){return\"`[A typed variable name]`\"}TwineScript_Unstorable=!0;TwineScript_Clone(){return new an(this.datatype.TwineScript_Clone(),this.varRef)}TwineScript_ToSource(){return`${en(this.datatype)}-type ${this.varRef.TwineScript_ToSource()}`}TwineScript_GetProperty(e){return\"name\"===e?this.getName():this[e]}TwineScript_Properties=[\"datatype\",\"name\"];TwineScript_IsTypeOf(e){return Zt(this.datatype,e)}get(){return this.varRef.get(...arguments)}getName(){return this.varRef.getName()}defineType(){if(\"any\"!==this.datatype.name)return this.varRef.defineType(this.datatype)}static check(e,t){let n;if(n=Se.containsError(t)||Se.containsError(e)||t.error)return n;if(!pr.isPrototypeOf(t))return Se.create(\"syntax\",\"The -type syntax must have a variable to its right.\");const{object:r,compiledPropertyChain:a}=t;if(!r||!r.TwineScript_VariableStore||1!==a.length||!r.TwineScript_TypeDefs)return Se.create(\"unimplemented\",\"I can only restrict the datatypes of variables, not data names or anything else.\");const o=tn(e);return!o||o instanceof an?void 0:Se.create(\"syntax\",`The -type syntax can't have ${Qt(o)} to its left.`)}constructor(e,t){rn(this,{datatype:e,varRef:t})}}nn(an),nn(an.prototype);const{realWhitespace:on,anyRealLetter:sn,anyCasedLetter:cn,anyNewline:ln}=$,{floor:pn,abs:un}=Math;class dn{static TwineScript_TypeID=\"datatype\";TwineScript_TypeName=\"a datatype\";TwineScript_Print(){return`\\`[${this.TwineScript_ObjectName}]\\``}get TwineScript_ObjectName(){return`the ${this.rest?\"...\":\"\"}${this.name} datatype`}TwineScript_is(e){return e instanceof dn&&e.name===this.name}TwineScript_Clone(){return this.rest?this:Object.create(this)}TwineScript_ToSource(){return(this.rest?\"...\":\"\")+this.name}constructor(e,t=!1){this.name=\"datamap\"===e?\"dm\":\"dataset\"===e?\"ds\":\"number\"===e?\"num\":\"string\"===e?\"str\":\"color\"===e?\"colour\":\"boolean\"===e?\"bool\":\"alphanumeric\"===e?\"alnum\":\"integer\"===e?\"int\":\"newline\"===e?\"linebreak\":e,this.rest=t}}const hn={array:Array.isArray,dm:e=>e instanceof Map,ds:e=>e instanceof Set,datatype:e=>e instanceof dn,changer:e=>e instanceof wr,colour:e=>e instanceof Gr,gradient:e=>e instanceof ca,lambda:e=>e instanceof pa,macro:e=>e instanceof ia,codehook:e=>e instanceof kr,command:e=>e instanceof xt,str:e=>\"string\"==typeof e,num:e=>\"number\"==typeof e,bool:e=>\"boolean\"==typeof e},fn={...hn,even:e=>!isNaN(e)&&pn(un(e))%2==0,odd:e=>!isNaN(e)&&pn(un(e))%2==1,empty:e=>e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&\"string\"!=typeof e)&&!e.length,int:e=>\"number\"==typeof e&&e===(0|e),uppercase:e=>\"string\"==typeof e&&1===[...e].length&&[...e].every((e=>e!==e.toLowerCase())),lowercase:e=>\"string\"==typeof e&&1===[...e].length&&[...e].every((e=>e!==e.toUpperCase())),whitespace:e=>\"string\"==typeof e&&!!e.match(`^${on}$`),digit:e=>\"string\"==typeof e&&!!e.match(\"^\\\\d$\"),alnum:e=>\"string\"==typeof e&&!!e.match(`^${sn}$`),anycase:e=>\"string\"==typeof e&&!!e.match(`^${cn}$`),linebreak:e=>\"string\"==typeof e&&!!e.match(`^${ln}$`),any:()=>!0,const:()=>!0};dn.from=e=>{const t=Object.keys(hn).find((t=>hn[t](e)));return new dn(t)},dn.prototype.TwineScript_IsTypeOf=function(e){const{name:t,rest:n}=this;return!!fn[t]&&fn[t](e,n)},dn.prototype.toTypeSignatureObject=function(){const{name:e}=this,t={pattern:\"range\",range:fn[e],name:`a ${\"dm\"===e?\"datamap\":\"ds\"===e?\"dataset\":\"num\"===e?`${e}ber`:\"str\"===e?`${e}ing`:\"color\"===e?\"colour\":\"bool\"===e?`${e}ean`:\"alnum\"===e?\"alphanumeric character\":\"int\"===e?`${e}eger`:\"even\"===e||\"odd\"===e?`${e} number`:e.endsWith(\"case\")||\"whitespace\"===e?`${e} character`:\"empty\"===e?`${e} value`:e}`};return this.rest?{pattern:\"zero or more\",innerType:t}:t},Object.freeze(dn),Object.seal(dn.prototype);const mn=RegExp(`${$.realWhitespace}+`),gn=RegExp(`${$.realWhitespace}+`,\"g\");function yn(e,t,n){const r=e.textContent.length;if(t>=r)return[];let a;const o=[a=0===t?e:e.splitText(t)];return n&&(n<=0&&(n=r-n),n<r&&o.push(a.splitText(n-t))),o}const bn=(()=>{let e;return()=>{if(void 0!==e)return e;const t=a(\"<p>\");return t[0].normalize?(t.append(document.createTextNode(\"0-\"),document.createTextNode(\"2\"),document.createTextNode(\"\"))[0].normalize(),e=1===t.contents().length):e=!1}})();function vn(e){const t=e[0],n=e.parent();if(!n.length||e.findAndFilter(\"tw-story\").length)return null;let r=n.textNodes().filter((e=>{const n=e.compareDocumentPosition(t);return 4&n&&!(8&n)}));return r=r[r.length-1],r||vn(n)}function wn(e){const t=e[0],n=e.parent();if(!n.length||e.findAndFilter(\"tw-story\").length)return null;const r=n.textNodes().filter((e=>{const n=e.compareDocumentPosition(t);return 2&n&&!(8&n)}))[0];return r||wn(n)}const kn=\"tw-collapsed,[collapsing=true]\";const xn=/^(=*)([^=]+)=*$/;var $n=Object.freeze({dialog:function({section:e,parent:t=$.storyElement,cd:n,message:r=\"\",defaultValue:o,buttons:i=[{name:\"OK\",confirm:!0,callback:Object}]}={}){\"object\"==typeof r&&\"a code hook\"===r.TwineScript_TypeName&&(r=r.code);const s=a(`<tw-backdrop><tw-dialog>${o||\"\"===o?\"<input type=text style='display:block;margin:0 auto'></input>\\n\":\"\"}<tw-dialog-links>${i.length?i.reduce(((e,{name:t},n)=>`${e}<tw-link style='margin:0 ${n===i.length-1?\"0 0 0.5em\":0===n?\"0.5em 0 0\":\"0.5em\"}' tabindex=0>${t}</tw-link>`),\"\"):`<tw-link tabindex=0>${i[0].name}</tw-link>`}</tw-dialog-links></tw-dialog></tw-backdrop>`),c=s.find(\"tw-dialog\");if(t.append(s),e){e.renderInto(r,c,{...n,append:\"prepend\"});const t=n?.transition&&s.find(\"tw-dialog > tw-transition-container\");t?.length&&t.appendTo(s).append(c.prepend(t.contents().detach()))}else c.prepend(We.exec(r));if(o){const e=s.find(\"input\").last();e.val(o).on(\"keypress\",(({which:e})=>{13===e&&(s.remove(),i.filter((e=>e.confirm)).forEach((e=>e.callback())))})),setTimeout((()=>e.focus()),100)}return i.reverse().forEach(((e,t)=>{a(s.find(\"tw-link\").get(-t-1)).on(\"click\",(()=>{$.options.debug&&$.options.ignoreClickEvents&&!a(s).is(\".eval-replay, .harlowe-crash\")||(s.remove(),e.callback())}))})),s},realWhitespace:mn,textNodeToChars:function(e){const t=[...e.textContent];return 1===t.length?[e]:t.reduce(((e,t)=>(t.match(mn)&&e.length&&e[e.length-1].match(mn)?e[e.length-1]+=t:e.push(t),e)),[]).reduce(((t,n)=>{const r=e;return n.length<e.textContent.length&&(e=e.splitText(n.length)),t.concat(r)}),[])},findTextInNodes:function e(t,n){let r=[],a=\"\",o=[];if(!t.length||!n)return o;for(;t.length>0;){r.push(t[0]),a+=t[0].textContent,t.shift();let e=a.indexOf(n);if(e>-1){const i=a.length-(e+n.length);for(;e>=r[0].textContent.length;)e-=r[0].textContent.length,r.shift();if(1===r.length){const a=yn(r[0],e,e+n.length);o.push(a[0]),a[1]&&t.unshift(a[1]);break}o.push(yn(r[0],e,r[0].length)[0]),o.push(...r.slice(1,-1));const s=yn(r[r.length-1],0,r[r.length-1].textContent.length-i);o.push(s[0]),s[1]&&t.unshift(s[1]),o=o.filter(Boolean);break}}return[o,...e(t,n)]},collapse:function(e){function t(e){return 0===a(this||e).parentsUntil(kn).filter(\"tw-verbatim, tw-expression, [collapsing=false]\").length}let n=vn(e);a(n).parents(kn).length||(n=null);let r=wn(e);a(r).parents(kn).length||(r=null);const o=\"br:not([data-raw]),tw-consecutive-br:not([data-raw])\";e.find(o).filter(t).replaceWith(document.createTextNode(\" \"));const i=(e=a(e.get().map((e=>a(e).filter(t).is(o)?a(document.createTextNode(\" \")).replaceAll(e)[0]:e)))).textNodes();let s=0;i.reduce(((e,n)=>t(n)?(n.textContent=n.textContent.replace(gn,\" \"),\" \"!==n.textContent[0]||e&&e.textContent&&!(e.textContent.search(/\\s$/)>-1)||(n.textContent=n.textContent.slice(1)),n):document.createTextNode(\"A\")),n),[...i].reverse().every((e=>!!t(e)&&(e.textContent.match(/^\\s*$/)?(s+=e.textContent.length,e.textContent=\"\",!0):(e.textContent=e.textContent.replace(/\\s+$/,(e=>(s+=e.length,\"\"))),!1)))),s>0&&r&&(i[i.length-1].textContent+=\" \"),e[0]&&bn()&&e[0].normalize()},geomStringRegExp:xn,geomParse:function(e){if(!e)return{marginLeft:0,size:0};const t=e.length,[n,r,a]=xn.exec(e)||[];return!n||a===e&&a.length>1?{marginLeft:0,size:0}:{marginLeft:r.length/t*100,size:a.length/t*100}}});const{textNodeToChars:Tn,realWhitespace:Sn,findTextInNodes:En}=$n,{toSource:Cn}=wt;function Nn(e){const{dom:t}=e;let n=a();this.next&&(n=n.add(Nn.call(this.next,e)));const r=(e,t)=>{if(Array.isArray(t))return t.reduce(((t,n)=>t.add(e.get(n))),a());if(t&&\"object\"==typeof t&&\"first\"in t&&\"last\"in t){let{first:n,last:r}=t;const{length:o}=e;n<0&&(n+=o),r<0&&(r+=o);let i=[e.get(n)];for(;n!==r;)n+=Math.sign(r-n),i.push(e.get(n));return a(i)}if(\"string\"==typeof t){if(\"chars\"===t){let t=[];for(let n of e.textNodes(\":not(tw-error, tw-error *)\"))for(let e of Tn(n))e.textContent.match(Sn)||t.push(e);return a(t)}if(\"links\"===t)return e.findAndFilter(\"tw-link, .enchantment-link\");if(\"visited\"===t)return e.findAndFilter(\"tw-link.visited\");if(\"lines\"===t){const t=e.findAndFilter(\"br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)\").get();let n=[[]];e.contents().each((function e(r,o){const i=(o.tagName||\"\").toLowerCase();if(\"tw-sidebar\"!==i)if(\"tw-passage\"!==i&&\"tw-transition-container\"!==i){if(t.length){if(o===t[0])return t.shift(),void n.push([]);if(16&o.compareDocumentPosition(t[0]))return n.push([]),a(o).contents().each(e),void n.push([])}n[n.length-1].push(o)}else a(o).contents().each(e)}));return a(n.map((e=>!!e.length&&a(e).wrapAll(\"<tw-pseudo-hook>\").parent()[0])).filter(Boolean))}}return a(e.get(t))};if(this.selector){let o;if(\"string\"===this.selector.type)o=function(e,t){const n=En(t.textNodes(),e);let r=a();return n.forEach((e=>{r=r.add(a(e).wrapAll(\"<tw-pseudo-hook>\").parent())})),r}(this.selector.data,t);else{if(\"base\"===this.selector.type)return n.add(r(Nn.call(this.selector.data,e),this.property));{const e=function(e){let t=`tw-hook[name=\"${e=$.insensitiveName(e).replace(/\"/g,\"&quot;\")}\"],tw-enchantment[name=\"${e}\"]`;return t+={page:\", tw-story\",passage:\", tw-passage\",sidebar:\", tw-sidebar\",link:\", tw-link, .enchantment-link\"}[e]||\"\",t}(this.selector.data);o=t.findAndFilter(e).add(t.parentsUntil($.storyElement.parent())).filter(e)}}n=this.property?n.add(r(o,this.property)):n.add(o)}return n=n.get().reduce(((e,t)=>{let n=a(t);return e.add(n.is(\"tw-enchantment\")&&n.contents().length<=1?n.contents():n)}),a()),n}function On(e){if(!e)return[];const{selector:t,property:n,next:r}=e;return[JSON.stringify([\"base\"===t.type?On(t.data):$.insensitiveName(t.data),n]),...On(r)].sort()}class jn{forEach(e,t){const n=Nn.call(this,e).each(((e,n)=>t(a(n),e)));return e.dom.findAndFilter(\"tw-pseudo-hook\").contents().unwrap(),n}hooks(e){return Nn.call(this,e)}get TwineScript_ObjectName(){return`the hook name ${this.TwineScript_ToSource()}`}static TwineScript_TypeID=\"hookName\";TwineScript_TypeName=\"a hook name (like ?this)\";TwineScript_Unstorable=!0;TwineScript_ToSource(){let e=\"\";const{type:t,data:n}=this.selector;return\"name\"===t?n.match(RegExp(`^${$.anyRealLetter}+$`))?e+=`?${n}`:e+=`(hooks-named:${JSON.stringify(n)})`:\"string\"===t?e+=JSON.stringify(n):\"base\"===t&&(e+=`${n.TwineScript_ToSource()}'s ${Cn(this.property,\"property\")}`),this.next&&(e+=` + ${this.next.TwineScript_ToSource()}`),e}\"TwineScript_+\"(e){const t=this.TwineScript_Clone();let n=t;for(;n.next;)n=n.next;return n.next=e,t}TwineScript_is(e){return`${On(this)}`==`${On(e)}`}TwineScript_GetProperty(e){return new jn({type:\"base\",data:this},e,void 0)}static TwineScript_Properties=[\"chars\",\"links\",\"lines\",\"visited\"];TwineScript_Clone(){return new jn(this.selector,this.property,this.next)}constructor(e,t,n=void 0){Object.assign(this,{selector:Object.freeze(e),property:t,next:n})}static from(e){return e instanceof jn?e:new jn({type:\"string\",data:e})}}Object.freeze(jn),Object.freeze(jn.prototype);const{impossible:An,andList:_n,nth:Dn}=$,{is:In,isObject:Pn,toSource:Rn,isSequential:Mn,objectName:Vn,typeName:Ln,clone:Fn,isValidDatamapName:Hn,subset:qn,collectionType:zn,unstorableValue:Wn,matches:Bn}=wt,{isArray:Un}=Array,{hasOwn:Gn}=Object;let Xn;const Yn=0,Jn={set:[],delete:[]},Kn=\"You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), \",Qn=\"You can't access the '0th' or '0thlast' position of \";function Zn(e,t){let n;if(Se.containsError(t))return n;if(e instanceof Map&&(n=Se.containsError(Hn(e,t))))return n;if(Mn(e)){let n;if(\"number\"==typeof t){if(0===t)return Se.create(\"property\",`You can't access elements at position 0 of ${Vn(e)}.`,\"Only positive and negative position values exist.\");t>0&&(t-=1)}else if(\"string\"==typeof t&&(n=/^(\\d+)(?:st|[nr]d|th)last$/i.exec(t))){if(\"0\"===n[1])return Se.create(\"property\",`${Qn+Vn(e)}.`);t=-n[1]}else if(\"string\"==typeof t&&(n=/^(\\d+)(?:st|[nr]d|th)$/i.exec(t))){if(\"0\"===n[1])return Se.create(\"property\",`${Qn+Vn(e)}.`);t=n[1]-1}else if(\"string\"==typeof t&&(n=/^(?:(\\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(t))){let[,e=0,r,a=0,o]=n;e=r?-e:e-1,a=o?-a:a-1,t={last:a,first:e}}else if(\"last\"===t)t=-1;else if(\"random\"===t){if(!e.length)return Se.create(\"property\",`I can't get a random value from ${Vn(e)}, because it's empty.`);t=Kt.random()*Array.from(e).length|0}else{if(e instanceof jn&&!jn.TwineScript_Properties.includes(t))return Se.create(\"property\",`${Kn+_n(jn.TwineScript_Properties.map((e=>`'${e}'`)))} of ${Vn(e)}, not ${\"string\"==typeof t?Rn(t):Vn(t)}.`);if(!([\"length\",\"some\",\"any\",\"all\",\"start\",\"end\",\"random\"].includes(t)||e instanceof jn))return Se.create(\"property\",`${Kn}'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ${Vn(e)}, not ${\"string\"==typeof t?Rn(t):Vn(t)}.`)}}else if(e instanceof Set){if(![\"length\",\"some\",\"any\",\"all\"].includes(t))return Se.create(\"property\",`${Kn}'length', 'some', 'any', and 'all' of ${Vn(e)}.`,\"You can't access specific individual data values from datasets.\");\"length\"===t&&(t=\"size\")}else{if(Un(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(t))return Se.create(\"property\",`You can only get the ${_n(e.TwineScript_Properties.map((e=>`'${e}'`)))} of ${Vn(e)}, not ${\"string\"==typeof t?Rn(t):Vn(t)}.`);if(\"number\"==typeof e||\"boolean\"==typeof e)return Se.create(\"property\",`You can't get any data values, let alone ${Vn(t)}, from ${Vn(e)}`)}return t}function er(e,t){return t-0<0&&Math.abs(t)<=e.length?e.length+(t-0):t}const tr=/[^\\uD801-\\uDFFF]/,nr=new Map;function rr(e,t){if(void 0===e)return e;if(e instanceof Map)return e.get(t);if((\"some\"===t||\"any\"===t||\"all\"===t||\"start\"===t||\"end\"===t)&&!e.TwineScript_VariableStore)return function(e,t){const n=`\"${t} value${\"any\"===t?\"\":\"s\"}\" of `;return{determiner:t,determined:e,array:[...e],string:\"string\"==typeof e&&e,TwineScript_ObjectName:n+Vn(e),TwineScript_ToSource:()=>`${t} of ${Rn(e)}`,TwineScript_TypeName:`${n}a data structure`,TwineScript_Unstorable:!0,TwineScript_Print(){return`\\`[${this.TwineScript_TypeName}]\\``}}}(e,t);if(\"string\"==typeof e)if(nr.has(e))e=nr.get(e);else if(tr.test(e)){const t=[...e];nr.set(e,t),e=t}else nr.set(e,e);if(Mn(e)&&Number.isFinite(t)&&(t=er(e,t)),e.TwineScript_GetProperty)return e.TwineScript_GetProperty(t);const n=e[t];return\"function\"!=typeof n?n:void 0}function ar(e){if(e.computed){let{value:t}=e;return Xn.isPrototypeOf(t)&&(t=t.get()),\"string\"==typeof t?`('${t}')`:`(${t})`}return\"number\"==typeof e?Dn(e):`'${e}'`}function or(e,t,n){if(e.TwineScript_VariableStore){if(e.TwineScript_TypeDefs&&t in e.TwineScript_TypeDefs){const r=e.TwineScript_TypeDefs[t];if(\"const\"===r.name){if(void 0!==e[t])return Se.create(\"operation\",`I can't alter ${e===Kt.variables?\"$\":\"_\"}${t} because it's been restricted to a constant value.`,\"This variable can't be changed for the rest of the story.\")}else if(!Bn(r,n))return Se.create(\"operation\",`I can't set ${e===Kt.variables?\"$\":\"_\"}${t} to ${Ln(n)} because it's been restricted to ${Rn(r)}-type data.`,\"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).\")}return!0}return Un(t)?t.map((t=>or(e,t))):e instanceof Map?\"string\"==typeof t||Se.create(\"operation\",`${Vn(e)} can only have string data names, not ${Vn(t)}.`):Mn(e)?[\"length\",\"random\",\"some\",\"any\",\"all\",\"start\",\"end\"].includes(t)?Se.create(\"operation\",`I can't forcibly alter the '${t}' of ${Vn(e)}.`,\"start\"===t||\"end\"===t?`Alter the values at actual positions, like 1st or 2ndlast, rather than just the '${t}'.`:void 0):+t==(0|t)||Se.create(\"property\",`${Vn(e)} can only have position keys ('3rd', '1st', (5), etc.), not ${ar(t)}.`):e.TwineScript_Identifiers&&t in e?Se.create(\"keyword\",`I can't alter the value of the '${t}' identifier.`,\"You can only alter data in variables, not fixed identifiers.\"):Se.create(\"operation\",`I can't modify ${Vn(e)}`,e instanceof Set?\"You should use an (array:) if you need to modify the data inside this dataset.\":e instanceof jn?\"You should alter hooks indirectly using macros like (replace:) or (enchant:).\":void 0)}function ir(e,t,n,r){const a=t;e instanceof Map?e.set(t,n):(Mn(e)&&(t=er(e,t)),e.TwineScript_Set?e.TwineScript_Set(t,n,r):e[t]=n),Jn.set.forEach((t=>t(e,a,n)))}function sr(e,t){const n=t;Mn(e)&&(t=er(e,t)),Un(e)&&/^(?:[1-9]\\d*|0)$/.exec(t)?e.splice(t,1):e instanceof Map||e instanceof Set?e.delete(t):e.TwineScript_Delete?e.TwineScript_Delete(t):delete e[t],Jn.delete.forEach((t=>t(e,n)))}function cr(e,t,n=t,r=!1){if(t&&\"object\"==typeof t&&\"last\"in t&&\"first\"in t){if(e instanceof jn)return e.TwineScript_GetProperty(t);const{first:n,last:r}=t;return qn(e,n+(n>=0),r+(r>=0))}if(Un(t))return e instanceof jn?e.TwineScript_GetProperty(t):t.map((t=>cr(e,t,t)))[\"string\"==typeof e?\"join\":\"valueOf\"](\"\");const a=rr(e,t);if(void 0===a&&!r){if(e===Kt.variables)return Yn;if(\"temp\"===e.TwineScript_VariableStore?.type)return Se.create(\"property\",`There isn't a temp variable named _${n} in this place.`,\"Temp variables only exist inside the same passage, hook, or lambda in which they're created.\");if(Un(e)&&\"number\"==typeof t)return Se.create(\"property\",`This array of ${e.length} elements doesn't have a ${ar(n+(\"number\"==typeof n?1:\"\"))} element.`,e.length?`It contains: ${_n(e.map(Vn))}.`:\"The array is empty.\");const r=Array.from(\"function\"==typeof e.keys&&e.keys());return Se.create(\"property\",`I can't find a ${ar(n)} data name in ${Vn(e)}`,e instanceof Map&&r.length?`Its names include: ${_n(r)}.`:void 0)}return a}function lr(e,t){const n=this.compiledPropertyChain.reduce(((e,t)=>{let n;return n=0===e.length?this.object:cr(...e[e.length-1]),e.push([n,t])&&e}),[]).reduceRight(e,t);return Se.containsError(n)?n:void 0}Xn={get(){let e=this.object;for(let t=0;t<this.compiledPropertyChain.length-1;t+=1)if(e=cr(e,this.compiledPropertyChain[t]),Se.containsError(e))return e;return cr(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},has(){let e=this.object;for(let t=0;t<this.compiledPropertyChain.length-1;t+=1)if(e=cr(e,this.compiledPropertyChain[t],void 0,!0),void 0===e||Se.containsError(e))return!1;return void 0!==cr(e,this.compiledPropertyChain.slice(-1)[0],void 0,!0)},set(e,t){return!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?lr.call(this,((e,[n,r],a)=>{let o,i;if(o=Se.containsError(e,n,r)||Se.containsError(or(n,r,e)))return o;if(i=Wn(e))return Se.create(\"operation\",`${Vn(e)} can't be stored${e.TwineScript_Unstorable?\"\":zn(e)?` because it holds ${Vn(i)}`:\"\"}.`);if(a>0)n=Fn(n);else if(\"temp\"===n.TwineScript_VariableStore?.type&&n!==Kt.variables){let e=n;for(;\"temp\"===e.TwineScript_VariableStore?.type&&!Gn(e,r);)e=Object.getPrototypeOf(e);\"temp\"===e.TwineScript_VariableStore?.type&&(n=e)}if(\"string\"==typeof n){if(\"string\"!=typeof e)return Se.create(\"datatype\",`I can't put this non-string value, ${Vn(e)}, in a string.`);if(e.length!==(Un(r)?r.length:1))return Se.create(\"datatype\",`${Vn(e)}is not the right length to fit into this string location.`);n=[...n];const t=[...e];[].concat(r).forEach((e=>{0+e<0&&(e=n.length+(0+e)),n=[...n.slice(0,e),t.shift(),...n.slice(e+1)]})),n=n.join(\"\")}else Pn(n)&&(void 0!==e.TwineScript_KnownName&&(\"\"!==e.TwineScript_KnownName&&(e=Fn(e)),e.TwineScript_KnownName=Rn(this)),Un(r)&&Mn(e)?(\"string\"==typeof e&&(e=[...e]),r.map(((t,n)=>[t,e[n]])).forEach((([e,r])=>ir(n,e,r,t)))):ir(n,r,e,t));return n}),e):Se.create(\"macrocall\",`I can't (set:) ${Vn(this)}, if the ${(Vn(this.object).match(/ (.+$)/)||[\"\",\"value\"])[1]} isn't stored in a variable.`,\"Modifying data structures that aren't in variables won't change the game state at all.\")},delete(){return lr.call(this,((e,[t,n],r)=>{let a;if(a=Se.containsError(e,t,n)||Se.containsError(or(t,n)))return a;if(r>0&&(t=Fn(t)),null===e){const e=\"string\"==typeof t;e&&(t=[...t]),Un(n)?(Mn(t)&&(n=[...new Set(n)]).sort(((e,n)=>er(t,n)-er(t,e))),n.forEach((e=>sr(t,e)))):sr(t,n),e&&(t=t.join(\"\"))}else ir(t,n,e,!1);return t}),null)},defineType(e){const{object:t,compiledPropertyChain:n}=this,r=n[0];Gn(t,\"TwineScript_TypeDefs\")||(t.TwineScript_TypeDefs=Object.create(t.TwineScript_TypeDefs||null));const a=t.TwineScript_TypeDefs,o=a[r];if(o&&!In(o,e))return Se.create(\"operation\",`I can't redefine the type of ${Vn(this)} to ${e.TwineScript_ObjectName||Ln(e)}, as it is already ${o.TwineScript_ObjectName||Ln(o)}.`);t.TwineScript_DefineType?t.TwineScript_DefineType(r,e):a[r]=e,\"const\"===e.name&&(t[r]=void 0)},matches(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName(){return this.compiledPropertyChain[0]},create(e,t){let n;if(n=Se.containsError(e))return n;!Array.isArray(t)&&(t=[].concat(t)),Xn.isPrototypeOf(e)&&(t=e.propertyChain.concat(t),e=e.object);const r=function(e,t){let n=[];for(let r=0;r<t.length;r+=1){let a,o=t[r];if(o.computed&&(o=o.value),Xn.isPrototypeOf(o)&&(o=o.get()),Un(o)){let t=[];for(let n=0;n<o.length;n+=1)t[n]=Zn(e,o[n]);o=t}else o=Zn(e,o);if(a=Se.containsError(o))return a;r<t.length-1&&(e=cr(e,o)),n.push(o)}return n}(e,t);return(n=Se.containsError(r))?n:Object.assign(Object.create(Xn),{object:e,propertyChain:t,compiledPropertyChain:r})},TwineScript_ToSource(){const e=(e,t)=>!t&&this.object.TwineScript_VariableStore?e:ar(e);return(this.object===Kt.variables?\"$\":\"temp\"===this.object.TwineScript_VariableStore?.type?\"_\":`${Rn(this.object)}'s `)+(1===this.propertyChain.length?e(this.propertyChain[0]):this.propertyChain.reduce(((t,n,r)=>`${t}'s ${e(n,r)}`)))},get TwineScript_ObjectName(){return this.object.TwineScript_VariableStore?`the ${\"temp\"===this.object.TwineScript_VariableStore?.type?\"temp \":\"\"}variable ${this.TwineScript_ToSource()}`:`${Vn(this.object)}'s ${1===this.propertyChain.length?ar(this.propertyChain[0]):this.propertyChain.reduce(((e,t)=>`${e}'s ${ar(t)}`))}`},on(e,t){if(e in Jn)return\"function\"!=typeof t||Jn[e].includes(t)||Jn[e].push(t),Xn;An(\"VarRef.on\",\"invalid event name\")}};var pr=Object.freeze(Xn);const{objectName:ur,matches:dr,toSource:hr}=wt;function fr(e,t,n=!0){let r,a=[];if(r=t&&pr.isPrototypeOf(t)?t.get():t,Se.containsError(r))return r;if(Array.isArray(r)&&Array.isArray(e)){let o=0,i=0;for(;o<e.length&&i<r.length;){let n=e[o],s=r[i];if(n instanceof an&&n.datatype.rest||n instanceof dn&&n.rest){const e=i;for(;i<r.length&&dr(n,s);)i+=1,s=r[i];n instanceof an?n.datatype=[n.datatype]:n instanceof dn&&(n=new dn(\"array\")),a=a.concat(fr(n,pr.isPrototypeOf(t)?pr.create(t,{first:e+1,last:i+1}):r.slice(e,i)))}else a=a.concat(fr(n,pr.isPrototypeOf(t)?pr.create(t,i+1):s)),i+=1;o+=1}return o<e.length?n&&Se.create(\"operation\",`I can't unpack this array because it needs ${e.length-o} more value${e.length-o>0?\"s\":\"\"}.`):a}if(e instanceof Map&&r instanceof Map){for(const[o,i]of e.entries()){if(!r.has(o))return n&&Se.create(\"operation\",`I can't unpack this datamap because it needs a '${o}' data name.`);a=a.concat(fr(i,pr.isPrototypeOf(t)?pr.create(t,o):r.get(o)))}return a}if(e instanceof an){if(\"function\"==typeof e.datatype.destructure)return[{dest:e,value:r,src:t}].concat(e.datatype.destructure(r));if(!dr(r,e.datatype))return n&&Se.create(\"operation\",`I can't put ${ur(r)} into ${e.varRef.TwineScript_ToSource()} because it doesn't match ${e.varRef.TwineScript_ToSource()}'s datatype, ${ur(e.datatype)}.`);a=a.concat(fr(e.datatype,r))}return pr.isPrototypeOf(e)||e instanceof an?a.concat({dest:e,value:r,src:t}):\"function\"==typeof e.destructure?a.concat(e.destructure(r)):dr(r,e)?a:n&&Se.create(\"operation\",`I tried to unpack, but ${ur(e)} in the pattern didn't match ${ur(r)}.`)}class mr{TwineScript_TypeName=\"a VariableToValue (a 'to' or 'into' expression)\";TwineScript_ObjectName=\"a VariableToValue (a 'to' or 'into' expression)\";TwineScript_ToSource(){return\"into\"===this.operator?`${hr(this.src)} ${this.operator} ${hr(this.dest)}`:`${hr(this.dest)} ${this.operator} ${hr(this.src)}`}TwineScript_Unstorable=!0;set(e=!1){let t,n=[];const r=fr(this.dest,this.src);if(t=Se.containsError(r))return t;if(!r.length)return Se.create(\"operation\",`I can't store a new value inside ${ur(this.dest)} that isn't in a variable.`,\"You need a variable, or a data structure containing variables at certain positions, to store the value.\");for(let{dest:a,value:o,src:i}of r.reverse()){if(a instanceof an){if(t=Se.containsError(a.defineType()))return t;a=a.varRef}if(t=a.set(o,this.srcRef),Se.isPrototypeOf(t))return t;e&&i&&i.delete(),n.unshift(`${ur(a)} is now ${ur(o)}`)}return n.join(\"; \")}constructor(e,t,n,r){Object.assign(this,{dest:e,src:t,operator:n,srcRef:r})}}Object.freeze(mr),Object.freeze(mr.prototype);const{plural:gr}=$,{is:yr,toSource:br}=wt,vr={};class wr{static TwineScript_TypeID=\"changer\";TwineScript_TypeName=\"a changer\";TwineScript_Print(){return`\\`[A (${this.macroName}:) changer]\\``}TwineScript_ToSource(){return`(${this.macroName}:${\"else\"===this.macroName?\"\":this.params.map(br)})${this.next?`+${this.next.TwineScript_ToSource()}`:\"\"}`}get TwineScript_ObjectName(){let e;1===this.params.length&&(e=br(this.params[0]),e.length>36&&(e=void 0));let t=`a (${this.macroName}:${e||\"\"}) changer`,{next:n}=this;n&&(t+=\" combined with \");let r=0;for(;n&&t.length<48;){const e=`(${n.macroName}:)`;t+=(r>0&&!n.next?\" and \":\"\")+e+(n.next?\", \":\"\"),n=n.next,r+=1}let a=0;for(;n&&a<99;)n=n.next,a+=1;return a>0&&(t+=`${r>0?\" and \":\"\"}${gr(a,\"other changer\")}`),t}summary(){const e=new et;return this.run(e),e.summary()}constructor(e,t=[],n,r=!0){Object.assign(this,{macroName:e,params:t,next:n,canEnchant:r})}\"TwineScript_+\"(e){const t=this.TwineScript_Clone();let n=t;for(;n.next;)n=n.next;return n.next=e,t.canEnchant=this.canEnchant&&e.canEnchant,t}TwineScript_is(e){if(e instanceof wr)return this.macroName===e.macroName&&yr(this.params,e.params)&&yr(this.next,e.next)}TwineScript_Clone(){const e=new wr(this.macroName,this.params,this.next);let t=e;for(;t.next;)t=t.next=t.next.TwineScript_Clone();return e.canEnchant=this.canEnchant,e}run(e,t){const n=\"output\"===this.macroName?[t||this]:this.params,r=vr[this.macroName](e,...n);if(Se.containsError(r))return r;this.next&&this.next.run(e,t||this)}static register(e,t){vr[e]=t}}Object.freeze(wr),Object.freeze(wr.prototype);class kr{TwineScript_TypeName=\"a code hook\";TwineScript_ObjectName=\"a code hook\";TwineScript_ToSource(){return this.source}TwineScript_Print(){return this.code}TwineScript_toString(){return this.source}TwineScript_is(e){return e instanceof kr&&this.source===e.source}TwineScript_Clone(){return new kr(this.code,this.source)}constructor(e,t){Object.assign(this,{code:e,source:t})}}Object.freeze(kr),Object.freeze(kr.prototype);const{max:xr,min:$r,sin:Tr,cos:Sr,round:Er,floor:Cr,atan2:Nr,cbrt:Or,sqrt:jr,PI:Ar}=Math,{assign:_r,create:Dr}=Object,Ir=/^([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])$/,Pr=/^([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])$/,Rr=Dr(null);function Mr(e,t,...n){if(n.length>0)return Mr(Mr(e,t),...n);if(!t)return e;const r=[];for(let n=0;n<e.length;n++){r[n]=[];for(let a=0;a<t[0].length;a++){let o=0;for(let r=0;r<e[0].length;r++)o+=e[n][r]*t[r][a];r[n][a]=o}}return r}function Vr(e){if(e in Rr)return Rr[e];let t=a(\"<p>\").css(\"background-color\",e).css(\"background-color\");return t=\"transparent\"===t?{r:0,g:0,b:0,a:0}:t.startsWith(\"rgb\")?t.match(/\\d+/g).reduce(((e,t,n)=>(e[\"rgb\"[n]]=+t,e)),{}):{r:192,g:192,b:192},Rr[e]=t,t}function Lr(e){return\"string\"!=typeof e?e:(e=(e=e.replace(\"#\",\"\")).replace(Ir,\"$1$1$2$2$3$3\"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}function Fr({r:e,g:t,b:n,a:r}){const a=xr(e/=255,t/=255,n/=255),o=$r(e,t,n),i=(a+o)/2,s=a-o;if(a===o)return{h:0,s:0,l:i};let c;switch(a){case e:c=(t-n)/s+(t<n?6:0);break;case t:c=(n-e)/s+2;break;case n:c=(e-t)/s+4}c=Er(60*c);return{h:c,s:i>.5?s/(2-a-o):s/(a+o),l:i,a:r}}const Hr=[.9642956764295677,1,.8251046025104602],qr=24389/27,zr=216/24389,Wr=e=>e.map((e=>[e])),Br=e=>e.map((e=>e[0]));function Ur({l:e,c:t,h:n,a:r}){const a=[e*=100,t*Sr(n*Ar/180),t*Tr(n*Ar/180)],o=[];o[1]=(a[0]+16)/116,o[0]=a[1]/500+o[1],o[2]=o[1]-a[2]/200;const i=[o[0]**3>zr?o[0]**3:(116*o[0]-16)/qr,e>qr*zr?((e+16)/116)**3:e/qr,o[2]**3>zr?o[2]**3:(116*o[2]-16)/qr].map(((e,t)=>e*Hr[t])),[s,c,l]=Br(Mr([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],Mr([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],Wr(i)))).map((e=>{return $r(255,xr(0,255*((t=e)>.0031308?1.055*t**(1/2.4)-.055:12.92*t)));var t}));return{r:s,g:c,b:l,a:r}}class Gr{static TwineScript_TypeID=\"colour\";TwineScript_TypeName=\"a colour\";TwineScript_ObjectName=\"a colour\";TwineScript_DebugName(){return`a colour ${this.TwineScript_Print()}`}\"TwineScript_+\"(e){const t=this.toRGBA(),n=e.toRGBA();return new Gr({r:$r(Er(.6*(t.r+n.r)),255),g:$r(Er(.6*(t.g+n.g)),255),b:$r(Er(.6*(t.b+n.b)),255),a:(t.a+n.a)/2})}TwineScript_Print(){const{r:e,g:t,b:n,a:r}=this.toRGBA();return`<tw-colour style='background-color:rgba(${[e,t,n,r]});'></tw-colour>`}TwineScript_is(e){if(!(e instanceof Gr))return!1;if(e.lch&&this.lch)return e.lch.l===this.lch.l&&e.lch.c===this.lch.c&&e.lch.h===this.lch.h&&e.a===this.a;const t=this.toRGBA();return(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}TwineScript_Clone(){return new Gr(this)}toRGBAString(){const{r:e,g:t,b:n,a:r}=this.toRGBA();return`rgba(${e}, ${t}, ${n}, ${r})`}toHSLA(){return Fr(this.toRGBA())}toRGBA(){return this.lch?function(e){let t=Ur(e);const n=e=>t[e]>=1e-5&&t[e]<=254.99999;if(Object.keys(t).every(n))return t;let r=(e={...e}).c,a=0;for(e.c/=2;r-a>1e-5;)t=Ur(e),Object.keys(t).every(n)?a=e.c:r=e.c,e.c=(r+a)/2;return Ur(e)}({a:this.a,...this.lch}):this}toLCHA(){return this.lch?{a:this.a,...this.lch}:function({r:e,g:t,b:n,a:r}){const a=Br(Mr([[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],Mr([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Wr([e/255,t/255,n/255].map((e=>e<.04045?e/12.92:((e+.055)/1.055)**2.4)))))).map(((e,t)=>e/Hr[t])).map((e=>e>zr?Or(e):(qr*e+16)/116)),o=[116*a[1]-16,500*(a[0]-a[1]),200*(a[1]-a[2])],i=180*Nr(o[2],o[1])/Ar;return{l:o[0]/100,c:jr(o[1]**2+o[2]**2),h:i>=0?i:i+360,a:r}}(this)}LCHRotate(e){e<0&&(e=360+e);const t=this.toLCHA();return t.h=(t.h+e)%360,new Gr(t)}TwineScript_GetProperty(e){if(\"lch\"===e){const e=this.toLCHA();return new Map([[\"l\",e.l],[\"c\",e.c],[\"h\",e.h]])}const t=this.toRGBA();return\"h\"===e||\"s\"===e||\"l\"===e?Fr(t)[e]:\"r\"===e||\"g\"===e||\"b\"===e||\"a\"===e?t[e]:void 0}static TwineScript_Properties=[\"h\",\"s\",\"l\",\"r\",\"g\",\"b\",\"a\",\"lch\"];TwineScript_ToSource(){if(0===this.a)return\"transparent\";const e=!this.lch&&Fr(this);let t;if(e){if(1===e.l&&!e.h&&!e.s)return\"white\";if(0===e.l&&!e.h&&!e.s)return\"black\";if(e.l>=.5&&e.l<.5334&&0===e.s)return\"gray\";if(.5===e.l&&e.s>=.8&&e.s<.804){const t={0:\"red\",30:\"orange\",60:\"yellow\",90:\"lime\",120:\"green\",180:\"cyan\",210:\"blue\",240:\"navy\",270:\"purple\",300:\"magenta\"}[e.h];if(t)return t}t=[e.h,e.s,e.l]}else t=[this.lch.l,this.lch.c,this.lch.h];return`(${this.lch?\"lch\":\"hsl\"}:${t}${1!==this.a?`,${this.a}`:\"\"})`}constructor(e){\"string\"==typeof e&&(e=(Gr.isHexString(e)?Lr:Vr)(e)),\"h\"in e&&\"s\"in e&&\"l\"in e&&!(\"r\"in e)&&!(\"g\"in e)&&!(\"b\"in e)&&(e=function({h:e,s:t,l:n,a:r}){if(0===t){const e=Cr(255*n);return{r:e,g:e,b:e}}const a=n<.5?n*(1+t):n+t-n*t,o=2*n-a;function i(e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?o+6*(a-o)*e:e<.5?a:e<2/3?o+(a-o)*(2/3-e)*6:o}return{r:Cr(255*i((e/=360)+1/3)),g:Cr(255*i(e)),b:Cr(255*i(e-1/3)),a:r}}(e));let t=1;\"a\"in e&&\"number\"==typeof e.a&&(t=e.a),\"h\"in e&&\"c\"in e&&!(\"s\"in e)&&\"l\"in e&&_r(this,{lch:{l:e.l,c:e.c,h:e.h}}),_r(this,e),this.a=t}static isHexString(e){return\"string\"==typeof e&&\"#\"===e[0]&&(e.slice(1).match(Ir)||e.slice(1).match(Pr))}static isCSS3Function(e){return\"string\"==typeof e&&/^(?:rgb|hsl)a?\\(\\s*\\d+(?:\\.\\d+)?\\s*,\\s*\\d+(?:\\.\\d+)?%?\\s*,\\s*\\d+(?:\\.\\d+)?%?(?:,\\s*\\d+(?:\\.\\d+)?\\s*)?\\)$/.test(e)}}Object.freeze(Gr),Object.freeze(Gr.prototype);var Xr=Object.seal({TwineScript_ObjectName:\"the temporary variables\",TwineScript_VariableStore:{type:\"temp\",name:\"an unknown scope\"},TwineScript_TypeDefs:Object.create(null)});const{impossible:Yr}=$,Jr={create:e=>(e||Yr(\"TwineNotifier.create\",\"called with only 1 string.\"),Object.assign(Object.create(Jr),{message:e})),render(){return a(\"<tw-notifier>\").attr(\"message\",this.message)}};var Kr=Object.preventExtensions(Jr);const{andList:Qr}=$,{objectName:Zr,typeName:ea,matches:ta,toSource:na}=wt,{assign:ra,create:aa}=Object,oa=e=>(t,...n)=>{e.called+=1;const{varNames:r,params:o,body:i}=e,s=ra(aa(Xr),{TwineScript_VariableStore:{type:\"temp\",name:`${e.TwineScript_ObjectName} call #${e.called}`},TwineScript_TypeDefs:aa(null)}),c=[];let l=0,p=!1,u=\"\";for(let e=0;e<n.length;e+=1){const t=n[e];u=r[l],s.TwineScript_TypeDefs[u]=o[l].datatype.rest?new dn(\"array\"):o[l].datatype;const a=pr.create(s,u);if(Se.containsError(a))return a;if(o[l].datatype.rest){p=!0;const r=(s[u]||[]).concat([t]);if(e<n.length-1){s[u]=r;continue}a.set(r)}else a.set(t),l+=1;c.push(Kr.create(`${Zr(a)} is now ${Zr(s[u])}`))}if(!p&&o[l]?.datatype.rest){const e=pr.create(s,r[l]);if(Se.containsError(e))return e;e.set([]),s.TwineScript_TypeDefs[u]=new dn(\"array\")}let d,h=a(\"<p>\").append(We.exec(i.code)),f=t.stack.length;t.stack.unshift({tempVariables:s,dom:h,output(e){d=e}});const{evalReplay:m}=t;for(t.evalReplay=null,t.execute();t.stack.length>f;)t.stack.shift();t.evalReplay=m;const g=h.find(\"tw-error\");return g.length?(h.prepend(c.map((e=>e.render())),\"<br>\"),Se.create(\"propagated\",`${g.length} error${g.length>1?\"s\":\"\"} occurred when running ${e.TwineScript_ObjectName}.`,void 0,h)):void 0===d?Se.create(\"custommacro\",`${e.TwineScript_ObjectName} didn't output any data or hooks using (output:) or (output-data:).`):\"object\"==typeof d&&\"changer\"in d?(d.toSource=`(${e.TwineScript_KnownName||\"unnamed\"}:${n.map(na)})`,new Tt(d)):d};class ia{static TwineScript_TypeID=\"macro\";TwineScript_TypeName=\"a custom macro\";TwineScript_GetProperty(e){if(\"params\"===e)return[...this.params]}static TwineScript_Properties=[\"params\"];TwineScript_Print(){return`\\`[${this.TwineScript_ObjectName}]\\``}TwineScript_Clone(){const e=ra(aa(ia.prototype),this);return e.fn=oa(e),e}TwineScript_ToSource(){return`(macro:${this.params.map((e=>e.TwineScript_ToSource())).concat(\"\")}${this.body.TwineScript_ToSource()})`}static createFromFn(e,t,n,r){return ra(aa(ia.prototype),{params:[],fn:e,typeSignature:r,TwineScript_ObjectName:t,TwineScript_ToSource:n,TwineScript_KnownName:\"\"})}constructor(e,t){ra(this,{params:e,called:0,varNames:e.map((e=>e.varRef.propertyChain[0])),typeSignature:e.map((e=>{let t;return t=e.datatype.toTypeSignatureObject?e.datatype.toTypeSignatureObject({rest:e.rest}):{pattern:\"range\",range:t=>ta(e.datatype,t),name:ea(e.datatype)},e.rest?{pattern:\"zero or more\",innerType:t}:t})),body:t,TwineScript_KnownName:\"\",TwineScript_ObjectName:`a custom macro (with ${e.length?Qr(e.map(na)):\"no params\"})`}),this.fn=oa(this)}}Object.freeze(ia),Object.seal(ia.prototype);const{toSource:sa}=wt;class ca{static TwineScript_TypeID=\"gradient\";TwineScript_TypeName=\"a gradient\";TwineScript_ObjectName=\"a gradient\";TwineScript_DebugName(){return`a gradient ${this.TwineScript_Print()}`}TwineScript_GetProperty(e){return\"angle\"===e?this.angle:\"stops\"===e?this.stops.map((e=>new Map([[this.repeating?\"pixels\":\"percent\",e.stop],[\"colour\",e.colour.TwineScript_Clone()]]))):void 0}static TwineScript_Properties=[\"angle\",\"stops\"];TwineScript_ToSource(){return`(gradient:${this.angle},${this.stops.map((e=>`${sa(e.stop)},${sa(e.colour)}`))})`}TwineScript_is(e){return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every((({colour:e,stop:t},n)=>this.stops[n].stop===t&&this.stops[n].colour.TwineScript_is(e)))}TwineScript_Clone(){return new ca(this.angle,[...this.stops])}TwineScript_Print(){return`<tw-colour style='background:${this.toLinearGradientString()}'></tw-colour>`}constructor(e,t,n=!1){Object.assign(this,{angle:e,stops:t.sort(((e,t)=>e.stop-t.stop)),repeating:n})}multiply(e){return new ca(this.angle,this.stops.map((({colour:t,stop:n})=>({colour:t,stop:n*e}))))}toLinearGradientString(){return`${this.repeating?\"repeating-\":\"\"}linear-gradient(${this.angle}deg, ${this.stops.reduce(((e,{colour:t,stop:n})=>`${e+t.toRGBAString()} ${n*(this.repeating?1:100)}${this.repeating?\"px,\":\"%,\"}`),\"\").slice(0,-1)})`}}Object.freeze(ca),Object.freeze(ca.prototype);const{objectName:la}=wt;class pa{static TwineScript_TypeID=\"lambda\";TwineScript_TypeName=\"a lambda\";get TwineScript_ObjectName(){return`a \"${\"making\"in this?\"making ... \":\"\"}${\"each\"in this?\"each ... \":\"\"}${\"where\"in this?\"where ... \":\"\"}${\"when\"in this?\"when ... \":\"\"}${\"via\"in this?\"via ... \":\"\"}\" lambda`}TwineScript_Print(){return\"`[A lambda]`\"}TwineScript_is(e){return e===this}TwineScript_ToSource(){return this.source}static TypeSignature(...e){return{pattern:\"lambda\",innerType:pa,clauses:e,typeName:`a \"${e.concat(\"\").join(\" ...\")}\" lambda`}}TwineScript_Clone(){return Object.assign(Object.create(pa.prototype),this)}static#a(e){const t=e&&e.varRef?e.varRef:e;return void 0===t||t&&pr.isPrototypeOf(t)&&Xr.isPrototypeOf(t.object)&&1===t.propertyChain.length}static check(e,t,n){const r=\"temp variable, or typed temp variable\";if(Se.containsError(e))return e;if(Se.containsError(n))return n;if(\"making\"===t&&!pa.#a(n))return Se.create(\"syntax\",`I need a ${r}, to the right of '${t}', not ${la(n)}.`);if(e instanceof pa){if(\"when\"===t||\"when\"in e)return Se.create(\"syntax\",`A 'when' lambda cannot have any other clauses, such as '${t}'.`);if(t in e)return Se.create(\"syntax\",`This lambda has two '${t}' clauses.`)}else{if(\"when\"===t&&void 0!==e)return Se.create(\"syntax\",\"A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).\");if(!pa.#a(e))return Se.create(\"syntax\",`This lambda needs to start with a single ${r}, not ${la(e)}.`)}const a=e instanceof pa?e.loop?.getName?.():e?.getName();return\"making\"===t&&n.getName()===a||\"loop\"===t&&n.getName()===e?.making?.getName()?Se.create(\"syntax\",`This lambda has two variables named '${n.getName()}'.`,\"Lambdas should have all-unique parameter names.\"):void 0}constructor(e,t,n,r){e instanceof pa?Object.assign(this,e):this.loop=e||\"\",this.source=r.trim(),this[t]=n}static#o(e,t,n){if(t)if(t instanceof an){const r=t.varRef.create(e,t.varRef.propertyChain);if(Se.containsError(r))return r;let a=r.defineType(t.datatype);if(Se.containsError(a))return a;if(a=r.set(n),Se.containsError(a))return a}else e[t.getName()]=n}apply(e,{loop:t,pos:n,making:r,ignoreVia:a=!1,tempVariables:o}){o||=Object.create(e.stack.length?e.stackTop.tempVariables:Xr);const i=pa.#o(o,this.loop,t)||pa.#o(o,this.making,r);if(Se.containsError(i))return i;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:o,lambdaPos:this.when?void 0:n})),!t||this.making||this.when?e.Identifiers.it=Se.create(\"operation\",`I can't use 'it', or an implied 'it', in ${this.TwineScript_ObjectName}`):e.Identifiers.it=t;const s=!a&&this.via,c=\"where\"in this||\"when\"in this,{evalReplay:l}=e;let p,u,d,h;if(e.evalReplay=l?[]:null,c?(u=e.eval(this.where||this.when),d=e.evalReplay,e.evalReplay=d&&s?[]:null,!t||this.making||this.when||(e.Identifiers.it=t),p=function(e,t,n){let r;return(r=Se.containsError(e))?r:\"boolean\"!=typeof e?Se.create(\"operation\",`This lambda's 'where' clause must evaluate to true or false, not ${la(e)}.`):e?t:n}(u,!s||e.eval(s),null)):u=p=!s||e.eval(s),h=s?e.evalReplay:null,e.stack.shift(),e.evalReplay=l,l&&(c||s)){let e=l[l.length-1];(e||{}).lambda&&e.lambda.obj===this||(e={lambda:{obj:this,loops:[]},code:(l[l.length-1]||{}).code||\"\"},e.fromCode=e.code,l.push(e)),e.lambda.loops.push({it:t,pos:n,...void 0!==r&&{making:r},...s&&{viaReplay:h,viaResult:p},...c&&{whereReplay:d,whereResult:null!==u&&u}})}return p}filter(e,t,n=null){let r;return t.reduce(((t,a,o)=>{if(r)return r;const i=this.apply(e,{loop:a,pos:o+1,ignoreVia:!0,tempVariables:n});return(r=Se.containsError(i))?r:t.concat(i?[a]:[])}),[])}}Object.freeze(pa),Object.freeze(pa.prototype);const{objectName:ua}=wt;pr.on(\"set\",((e,t)=>{e.TwineScript_VariableStore&&$.storyElement.find(\"[data-2bind]\").each(((n,r)=>{const o=(r=a(r)).data(\"twoWayBindEvent\");\"function\"==typeof o&&o(r,e,t)}))}));const da={TwineScript_TypeName:\"a VarBind (bound variable name)\",get TwineScript_ObjectName(){return`a ${this.bind} bind to ${this.varRef.TwineScript_ToSource()}`},TwineScript_Print:()=>\"`[A bound variable name]`\",TwineScript_Unstorable:!0,TwineScript_ToSource(){return`${\"two way\"===this.bind?\"2\":\"\"}bind ${this.varRef.TwineScript_ToSource()}`},set(e){const t=this.varRef.set(e);let n;if(n=Se.containsError(t))return n},create(e,t=\"one way\"){return Se.containsError(e)?e:pr.isPrototypeOf(e)?e.error?e.error:Object.assign(Object.create(this),{varRef:e,bind:t}):Se.create(\"operation\",`I can only 'bind' a variable, not ${ua(e)}.`)}};var ha=Object.freeze(da);const{objectName:fa,toSource:ma}=wt,{collapse:ga}=$n,ya={create(e){return Object.assign(Object.create(this),{enchantments:a()},e)},enchantScope(){const{attr:e,data:t,functions:n,section:r}=this;let{scope:o,localHook:i,lambda:s}=this,c=[],l=0;o.forEach(r,((p,u)=>{if(i){i=i.jquery?i:i.hooks(r);const e=p.find(i);if(e.length)p=e;else if(!i.has(p[0]).length)return}if(p.is(\":empty\")&&(!p.data(\"source\")||!p.data(\"source\").length))return;let d;l+=1,s?(d=s.apply(r,{loop:o.TwineScript_GetProperty(u),pos:l}),Se.containsError(d)?(p.replaceWith(d.render()),s=d=null):d instanceof wr?d.canEnchant||(p.replaceWith(Se.create(\"macrocall\",`The lambda \"${ma(s)}\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).`).render()),s=d=null):(p.replaceWith(Se.create(\"macrocall\",`The lambda \"${ma(s)}\" must return a changer, not ${fa(d)}.`).render()),s=d=null)):d=this.changer;const h=!e&&!t&&(!d||d.summary().every((e=>e.startsWith(\"transition\")))),f=h?p:p.wrap(\"<tw-enchantment>\").parent();if(e&&f.attr(e),t&&f.data(t),n&&n.forEach((e=>e(f))),d){const e=new et({section:r,target:f});if(d.run(e),e.update(),p.is($.storyElement)){const t=Object.keys(Object.assign({},...e.styles));p.css(t.reduce(((e,n)=>(\"background-color\"===n||\"background-image\"===n?(e[\"background-color\"]=\"transparent\",e[\"background-image\"]=\"none\",t.push(\"background-\"+(\"background-color\"===n?\"image\":\"color\"))):e[n]=\"inherit\",e)),{})),f.data({enchantedProperties:t})}else if(p.is(\"tw-passage\")&&e.styles.some((e=>\"margin-left\"in e||\"margin\"in e||\"margin-right\"in e))){const e=\"padding-left\",t=\"padding-right\";$.storyElement.css(e,\"0px\").css(t,\"0px\"),f.data({enchantedProperties:[e,t]})}}p.is($.storyElement)&&f.css({\"min-width\":\"100%\",\"min-height\":\"100%\"}),\"true\"===f.attr(\"collapsing\")&&(f.find(\"[collapsing=false]\").each((function(){a(this).removeAttr(\"collapsing\")})),ga(f)),h||c.push(f)})),this.enchantments=a(c)},disenchant(){this.enchantments.each(((e,t)=>{(t=a(t)).contents().unwrap();const n=t.data(\"enchantedProperties\");n&&$.storyElement.css(n.reduce(((e,t)=>(e[t]=\"\",e)),{}))}))}};var ba=Object.freeze(ya);const{insensitiveName:va,nth:wa,andList:ka}=$,{objectName:xa,typeName:$a,toSource:Ta}=wt,{isArray:Sa}=Array,{hasOwn:Ea}=Object,Ca={},Na=(e=0,t=1/0)=>({pattern:\"range\",min:e,max:t,range:n=>\"number\"==typeof n&&!Number.isNaN(n)&&n>=e&&n<=t}),Oa={optional:e=>({pattern:\"optional\",innerType:e}),zeroOrMore:e=>({pattern:\"zero or more\",innerType:e}),either:(...e)=>({pattern:\"either\",innerType:e}),rest:e=>({pattern:\"rest\",innerType:e}),insensitiveSet:(...e)=>({pattern:\"insensitive set\",innerType:e}),numberRange:Na,nonNegativeInteger:{pattern:\"range\",integer:!0,min:0,max:1/0,range:e=>\"number\"==typeof e&&!Number.isNaN(e)&&e>=0&&!`${e}`.includes(\".\")},positiveInteger:{pattern:\"range\",integer:!0,min:1,max:1/0,range:e=>\"number\"==typeof e&&!Number.isNaN(e)&&e>=1&&!`${e}`.includes(\".\")},positiveNumber:Na(2**-52,1/0),nonNegativeNumber:Na(0,1/0),percent:Na(0,1),wrapped:(e,t)=>({pattern:\"wrapped\",innerType:e,message:t}),Any:{TwineScript_TypeName:\"anything\"},Everything:{TwineScript_TypeName:\"everything\"}};function ja(e,t){if(null===t)return void 0===e;const n=typeof e;if(\"function\"!=typeof t&&\"pattern\"in t){if(\"optional\"===t.pattern||\"zero or more\"===t.pattern)return void 0===e||ja(e,t.innerType);if(\"either\"===t.pattern){for(let n=0;n<t.innerType.length;n+=1)if(ja(e,t.innerType[n]))return!0;return!1}if(\"lambda\"===t.pattern&&\"object\"==typeof e&&ja(e,t.innerType))return t.clauses.includes(\"where\")===(\"where\"in e||\"each\"in e)&&t.clauses.includes(\"making\")===\"making\"in e&&t.clauses.includes(\"via\")===\"via\"in e&&t.clauses.includes(\"with\")===\"with\"in e;if(\"insensitive set\"===t.pattern)return t.innerType.includes(va(e));if(\"range\"===t.pattern)return t.range(e);if(\"wrapped\"===t.pattern)return ja(e,t.innerType)}if(void 0!==t&&void 0===e)return!1;if(\"TwineScript_TypeName\"in t){if(\"anything\"===t.TwineScript_TypeName&&void 0!==e&&!(e&&\"object\"==typeof e&&\"TwineScript_Unstorable\"in e&&e.TwineScript_Unstorable))return!0;if(\"everything\"===t.TwineScript_TypeName&&void 0!==e)return!0}return t===String?\"string\"===n:t===Boolean?\"boolean\"===n:t===parseInt?\"number\"===n&&!Number.isNaN(e)&&!`${e}`.includes(\".\"):t===Number?\"number\"===n&&!Number.isNaN(e):t===Array?Sa(e):\"function\"==typeof t&&Object.hasOwn(t,\"prototype\")?e instanceof t:Object.isPrototypeOf.call(t,e)}function Aa(e){return e===Oa.Any||\"object\"==typeof e&&\"innerType\"in e&&(Sa(e.innerType)?e.innerType.some(Aa):!!e.innerType&&Aa(e.innerType))}function _a(e,{fn:t,typeSignature:n,returnType:r},a,o){let i;o=function(e){const t=[];for(let n=0;n<e.length;n+=1){if(!(n in e))continue;let r=e[n];if(\"object\"==typeof r&&\"spreader\"in r&&!0===r.spreader){const e=\"value\"in r&&r.value,n=Se.containsError(e);n?t.push(n):Sa(e)||\"string\"==typeof e?t.push(...e):e instanceof Set?t.push(...Array.from(e).sort(T(\"en\"))):t.push(Se.create(\"operation\",`I can't spread out ${xa(e)}, because it is not a string, dataset, or array.`))}else t.push(r)}return t}(o),\"string\"!=typeof e&&(i=e,e=\"\");const s=i?\"\":`(${Sa(e)&&e.length>1?e[0]:e}:)`;let c,l;e=i?\"TwineScript_KnownName\"in i?`the custom macro, ${i.TwineScript_KnownName}`:\"an unnamed custom macro\":`the ${s} macro`,c=n.length>0?1===n.length&&Aa(n[0])?1===o.length?\"That value can't be given to macros as-is.\":\"Give only a single value to this macro.\":`${e} must only be given ${ka(n.map($a))}${n.length>1?\", in that order\":\".\"}`:`${e} must not be given any data.${i?\"\":` Just write ${s}`}`;for(let t=0,a=Math.max(o.length,n.length);t<a;t+=1){let a=n[t],p=o[t];if(Se.containsError(p))return p;if(t>=n.length&&!l)return Se.create(\"datatype\",`${o.length-n.length} too many values were given to ${e}.`,c);if(a||=l,!a.innerType||\"rest\"!==a.pattern&&\"zero or more\"!==a.pattern||(l=a.innerType,\"rest\"===a.pattern&&(a=a.innerType)),!ja(p,a)){if(void 0===p){let r=n.filter((e=>!(\"optional\"===e.pattern||\"zero or more\"===e.pattern))).length;return Se.create(\"datatype\",`${e} was given ${o.length?ka(o.map(xa)):\"nothing\"}, but needs ${r-t} more value${r-t>1?\"s\":\"\"}.`,c)}return\"object\"==typeof p&&\"TwineScript_Unstorable\"in p&&p.TwineScript_Unstorable&&Aa(a)?Se.create(\"datatype\",`${e}'s ${wa(t+1)} value, ${xa(p)}, is not valid data for this macro.`,c):p instanceof kr&&\"Changer\"===r?Se.create(\"syntax\",`Please put this hook outside the parentheses of ${e}, not inside it.`,\"Hooks should appear after a macro\"+(i?\".\":`: ${s}[Some text]`)):p&&p instanceof pa&&\"lambda\"===a.pattern?Se.create(\"datatype\",`${e}'s ${wa(t+1)} value (a lambda) should have ${ka([\"where\",\"when\",\"making\",\"via\",\"with\"].filter((e=>a.clauses.includes(e))).map((e=>`a '${e}' clause`)))}, not ${ka([\"where\",\"when\",\"making\",\"via\",\"with\"].filter((e=>\"object\"==typeof p&&e in p)).map((e=>`a '${e}' clause`)))}.`):\"insensitive set\"===a.pattern?Se.create(\"datatype\",`${xa(p)} is not a valid name string for ${e}.`,`Only the following names are recognised (capitalisation and hyphens ignored): ${ka(a.innerType)}.`):Se.create(\"datatype\",`${e}'s ${wa(t+1)} value is ${xa(p)}, but should be ${$a(a)}.`,a.message||c)}}return t(a,...o)}function Da(e,t,n,r){const a={fn:n,typeSignature:r=[].concat(r||[]),returnType:t};Object.freeze(a),[].concat(e).forEach((e=>Object.defineProperty(Ca,va(e),{value:a})))}const Ia={has:e=>(e=va(e),Ea(Ca,e)),get:e=>(e=va(e),Ea(Ca,e)&&Ca[e]),add:function e(t,n,r,a){return Da(t,n,r,a),e},addChanger:function e(t,n,r,a){return Da(t,\"Changer\",n,a),wr.register(Sa(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a,o=!0){const i=[].concat(t)[0];return Da(t,\"Command\",((e,...t)=>{const a=n(...t);return a||new xt({attachable:o,runFn:(e,n)=>o?r(e,n,...t):r(n,...t),name:i,source:`(${i}:${t.map(Ta)})`})}),a),e},TypeSignature:Oa,run:(e,t,n)=>Ia.has(e)?_a(e,Ia.get(e),t,n):Se.create(\"macrocall\",`I can't run the macro '${e}' because it doesn't exist.`,\"Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.\"),runCustom:(e,t,n)=>e instanceof ia?_a(e,e,t,n):Se.containsError(e)?e:Se.create(\"macrocall\",`I can't call ${xa(e)} because it isn't a custom macro.`)};var Pa=Object.freeze(Ia);const{isObject:Ra,collectionType:Ma,is:Va,isA:La,clone:Fa,unique:Ha,contains:qa,matches:za,objectName:Wa,toSource:Ba}=wt,{plural:Ua}=$;let Ga;function Xa(e,t,n,r){return n||=\"do this to\",(a,o)=>{let i;return 1===t.length&&(o=a),(i=Se.containsError(a,o))?i:typeof a!==e||typeof o!==e?Se.create(\"operation\",`I can only ${n} ${e}s, not ${Wa(typeof a!==e?a:o)}.`,r):t(a,o)}}function Ya(e){return(t,n)=>{let r;if(r=Se.containsError(t,n))return r;if(typeof t!=typeof n||Ra(t)&&\"TwineScript_TypeName\"in t&&Ra(n)&&\"TwineScript_TypeName\"in n&&t.TwineScript_TypeName!==n.TwineScript_TypeName||Ma(t)!==Ma(n)){const e=`${Wa(t)} isn't the same type of data as ${Wa(n)}`;let r;return typeof t+typeof n!=\"stringnumber\"&&typeof t+typeof n!=\"numberstring\"||(r=\"You might want to convert one side to a number using (num:), or to a string using (str:).\"),Se.create(\"operation\",e[0].toUpperCase()+e.slice(1),r)}return e(t,n)}}function Ja(e,t,n=!1){const r=(a,o)=>{let i;if(i=Se.containsError(a,o))return i;let[s,c]=a.determiner?[a,o]:o.determiner?[o,a]:[];if(s){const{determiner:e,determined:l}=s;if(\"start\"===e||\"end\"===e){if(t)return Se.create(\"operation\",`I can't use '${t}' with the 'start' or 'end' of ${Wa(l)}.`);if(c.determiner){if(\"start\"===c.determiner||\"end\"===c.determiner)return Se.create(\"operation\",\"I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.\",\"Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.\");[s,c]=[c,s]}const p=s.string||s.array;for(let t=0;t<p.length+1;t+=1){const c=t?\"end\"===e?p.slice(-t):p.slice(0,t):p.constructor(),l=s===a?r(c,o):r(a,c);if(i=Se.containsError(l))return i;if(l!==n)return l}return n}const p=\"all\"===e;return s.array.reduce(((e,t)=>{let n,i=s===a?r(t,o):r(a,t);return(n=Se.containsError(e,i))?n:p?e&&i:e||i}),p)}return e(a,o)};return r}function Ka(e,t){return Ja(((t,n)=>{const r=e(t,n);return Se.containsError(r)?r:!r}),t,!0)}const Qa=\"If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \\\"\\\" '.\";Ga={and:Xa(\"boolean\",Ya(((e,t)=>e&&t)),\"use 'and' to join\",Qa),or:Xa(\"boolean\",Ya(((e,t)=>e||t)),\"use 'or' to join\",Qa),not:Xa(\"boolean\",(e=>!e),\"use 'not' to invert\",Qa),\"+\":Ya(((e,t)=>{if(Array.isArray(e))return[...e,...t];let n;return e instanceof Map?(n=new Map(e),t.forEach(((e,t)=>n.set(t,e))),n):e instanceof Set?new Set([...e,...t].filter(Ha).map(Fa)):\"function\"==typeof e[\"TwineScript_+\"]?e[\"TwineScript_+\"](t):\"string|number|boolean\".includes(typeof e)?e+t:Se.create(\"operation\",`I can't use + on ${Wa(e)}.`)})),\"-\":Ya(((e,t)=>{if(Array.isArray(e))return e.filter((e=>!t.some((t=>Va(e,t)))));if(e instanceof Set){const n=[...t];return new Set([...e].filter((e=>!n.some((t=>Va(e,t))))))}return\"string\"==typeof e?e.split(t).join(\"\"):\"number\"==typeof e?e-t:Se.create(\"operation\",`I can't use - on ${Wa(e)}.`)})),\"*\":Xa(\"number\",Ya(((e,t)=>e*t)),\"multiply\"),\"/\":Xa(\"number\",Ya(((e,t)=>0===t?Se.create(\"operation\",`I can't divide ${Wa(e)} by zero.`):e/t)),\"divide\"),\"%\":Xa(\"number\",Ya(((e,t)=>0===t?Se.create(\"operation\",`I can't modulo ${Wa(e)} by zero.`):e%t)),\"modulus\"),\"<\":Ja(Xa(\"number\",Ya(((e,t)=>e<t)),\"do < to\"),\"<\"),\">\":Ja(Xa(\"number\",Ya(((e,t)=>e>t)),\"do > to\"),\">\"),\"<=\":Ja(Xa(\"number\",Ya(((e,t)=>e<=t)),\"do <= to\"),\"<=\"),\">=\":Ja(Xa(\"number\",Ya(((e,t)=>e>=t)),\"do >= to\"),\">=\"),is:Ja(Va),isNot:Ka(Va),contains:Ja(qa,\"contains\"),doesNotContain:Ka(qa,\"does not contain\"),isIn:Ja(((e,t)=>qa(t,e)),\"is in\"),isNotIn:Ka(((e,t)=>qa(t,e)),\"is not in\"),isA:Ja(La,\"is a\"),isNotA:Ka(La,\"is not a\"),typifies:Ja(((e,t)=>La(t,e))),untypifies:Ka(((e,t)=>La(t,e))),matches:Ja(za),doesNotMatch:Ka(za),makeSpreader(e){if(Se.containsError(e))return e;if(e instanceof an||e instanceof dn){const t=Fa(e);return(e instanceof an?t.datatype:t).rest=!0,t}return{value:e,spreader:!0,TwineScript_TypeName:\"a spreaded '...' value\",TwineScript_ObjectName:Ua(\"string\"==typeof e||Array.isArray(e)?[...e].length:1,\"spreaded '...' value\"),TwineScript_Unstorable:!0,TwineScript_ToSource:()=>`${[...e].map(Ba)}`}}};var Za=Object.freeze(Ga);const{insensitiveName:eo,impossible:to,hash:no}=$,{toSource:ro,typeName:ao,objectName:oo}=wt,{hasOwn:io}=Object;const so=[[\"error\",\"text\"],[\"comma\"],[\"to\",\"into\"],[\"where\",\"when\",\"via\",\"making\",\"each\"],[\"typeSignature\"],[\"and\",\"or\"],[\"is\",\"isNot\"],[\"contains\",\"doesNotContain\",\"isIn\",\"isNotIn\"],[\"isA\",\"isNotA\",\"matches\",\"doesNotMatch\"],[\"inequality\"],[\"addition\",\"subtraction\"],[\"multiplication\",\"division\"],{rightAssociative:[\"spread\",\"bind\"]},{rightAssociative:[\"not\",\"positive\",\"negative\"]},{rightAssociative:[\"belongingProperty\",\"belongingItProperty\",\"belongingOperator\",\"belongingItOperator\"]},[\"property\",\"itsProperty\",\"possessiveOperator\",\"itsOperator\"],[\"twineLink\",\"macro\",\"identifier\",\"variable\",\"tempVariable\",\"hookName\",\"number\",\"cssTime\",\"boolean\",\"string\",\"hook\",\"colour\",\"datatype\",\"root\"],[\"grouping\"]];function co(e,t){let n,r,a,o=[];if(!e.length)return o;for(\"most\"===t?(n=so.length-1,r=a=-1):(n=0,r=so.length,a=1);n!==r;n+=a){let t=so[n],r=NaN;if(Array.isArray(t)){for(let n=e.length-1;n>=0;n-=1)if(t.includes(e[n].type)){r=n;break}}else for(let n=0;n<e.length;n+=1)if(t.rightAssociative.includes(e[n].type)){r=n;break}if(!Number.isNaN(r)&&r>-1){o=[e[r],r];break}}return o}const lo=[\"inequality\",\"is\",\"isNot\",\"isIn\",\"contains\",\"doesNotContain\",\"isNotIn\",\"isA\",\"typifies\",\"isNotA\",\"untypifies\",\"matches\",\"doesNotMatch\"],po={\">\":\"<=\",\"<\":\">=\",\">=\":\"<\",\"<=\":\">\"};function uo(e){return\"inequality\"===e.type?e.negate?po[e.operator]:e.operator:e.type}const ho={\">\":\"<\",\"<\":\">\",\">=\":\"<=\",\"<=\":\">=\",contains:\"isIn\",doesNotContain:\"isNotIn\",isIn:\"contains\",isA:\"typifies\",typifies:\"isA\",isNotA:\"untypifies\",untypifies:\"isNotA\"};function fo(e){const t=uo(e);return ho[t]||t}const mo={error:\"neither\",identifier:\"neither\",variable:\"neither\",tempVariable:\"neither\",hookName:\"neither\",number:\"neither\",boolean:\"neither\",string:\"neither\",hook:\"neither\",colour:\"neither\",datatype:\"neither\",root:\"neither\",twineLink:\"neither\",macro:\"neither\",grouping:\"neither\",itsProperty:\"neither\",belongingItProperty:\"neither\",to:\"both\",into:\"both\",typeSignature:\"both\",and:\"both\",or:\"both\",belongingOperator:\"both\",possessiveOperator:\"both\",multiplication:\"both\",division:\"both\",spread:\"after\",bind:\"after\",not:\"after\",belongingProperty:\"after\",each:\"after\",itsOperator:\"after\",positive:\"after\",negative:\"after\",belongingItOperator:\"before\",property:\"before\"};function go(e,t,n){return Se.create(\"syntax\",`I need usable code to be ${e?\"left \":\"\"}${e&&t?\"and \":\"\"}${t?\"right \":\"\"}of ${n.text}.`)}function yo(e,t,n){return Se.create(\"syntax\",`There can't be a ${e&&t?`${e.map((e=>e.text)).join(\"\")} or ${t.map((e=>e.text)).join(\"\")}`:(e||t).map((e=>e.text)).join(\"\")} to the ${e?\"left \":\"\"}${e&&t?\"or \":\"\"}${t?\"right \":\"\"}of ${n.text}.`,\"There could be a comma missing between them.\")}function bo(e,{val:t,fromCode:n,toCode:r,toDesc:a,reason:o,it:i,tokens:s,i:c}){if(e.length>=200)return;let l=s[c],p=s.slice(0,c),u=s.slice(c+1);if(1===s.length&&(p=u=!1,l=s[0]),e[e.length-1].error)return;const d=Se.containsError(t),h=e[e.length-1].code,f=e[0].basis;let m;p?.length&&u?.length&&p[0].start>u[0].start&&([p,u]=[u,p]),m=r||`${p?.length&&\"whitespace\"===p[p.length-1].type?\" \":\"\"}${d?\" 🐞 \":t&&!t.TwineScript_ToSource&&t.TwineScript_Unstorable?oo(t):ro(t)}${!u?.length||\"whitespace\"!==u[0].type&&\"addition\"!==l.type&&\"subtraction\"!==l.type?\"\":\" \"}`;let g=(p.length?p[0]:l).start-f,y=(u.length?u[u.length-1]:l).end-f;for(let t of e)t.start<g?(g+=t.diff,y+=t.diff):t.start<y&&(y+=t.diff);if(!n&&(n=h.slice(g,y),r&&r.trim()===n.trim()))return;const b=m.length-(y-g);e.push({code:h.slice(0,g)+m+h.slice(y),fromCode:n,toCode:!d&&r,toDesc:!d&&!r&&(a||oo(t)),start:g,end:y,diff:b,reason:o,itIdentifier:void 0!==i&&oo(i),error:d&&d.render(h.slice(g,y),!0)})}function vo(e,t){return pr.isPrototypeOf(t)||t instanceof an?(e.Identifiers.it=t.get(),t):t}function wo(e,t,n=!1,r=!1){const{evalReplay:a}=e,o=a?.length;let i,s,c=!1;const l=Za;let p,u,d,h,f;if(Array.isArray(t)||(t=[t]),!t.length||!t[0])return to(\"Runner.run\",\"No tokens to run!\"),0;1===t.length?p=t[0]:([p,d]=co(t,\"least\"),h=t.slice(0,d),f=t.slice(d+1),(!h.length||1===h.length&&\"whitespace\"===h[0].type)&&(h=!1),(!f.length||1===f.length&&\"whitespace\"===f[0].type)&&(f=!1));const m=p.type;if(!m)return to(\"Runner.run\",\"Token has no type!\"),0;const g=mo[m]||\"\";\"both\"!==g||h&&f?\"neither\"===g&&(h||f)?u=yo(h,f,p):\"before\"===g?h?f&&(u=yo(null,f,p)):u=go(!0,!1,p):\"after\"===g&&(f?h&&(u=yo(h,null,p)):u=go(!1,!0,p)):u=go(!h,!f,p),e.freeVariables&&\"object\"==typeof e.freeVariables&&function(e,t){const n=e.freeVariables;if(\"macro\"===t.type){const r=eo(t.name);\"current-time\"===r||\"current-date\"===r||\"monthday\"===r||\"weekday\"===r||\"history\"===r||\"visited\"===r||\"passage\"===r?e.freeVariables=!0:t.blockedValue&&!n.blockedValues?n.blockedValues=e.stackTop.blockedValues.concat():\"random\"!==r&&\"either\"!==r&&\"shuffled\"!==r||n.seed||(n.seed=Kt.seed,n.seedIter=Kt.seedIter)}else if(\"identifier\"===t.type){const n=eo(t.text);\"time\"!==n&&\"exits\"!==n&&\"it\"!==n&&\"visits\"!==n&&\"turns\"!==n||(e.freeVariables=!0)}else\"property\"===t.type||\"belongingProperty\"===t.type?\"random\"!==eo(t.name)||n.seed||(n.seed=Kt.seed,n.seedIter=Kt.seedIter):\"variable\"!==t.type&&\"tempVariable\"!==t.type||(e.freeVariables=!0)}(e,p);const y=!0;if(u);else{if(\"comma\"===m)return to(\"Section.run\",\"a comma token was run() somehow.\"),0;if(\"root\"===m)u=wo(e,p.children);else if(\"identifier\"===m)u=n?pr.create(e.Identifiers,p.text.toLowerCase()):e.Identifiers[p.text.toLowerCase()];else if(\"variable\"===m||\"tempVariable\"===m)if(u=pr.create(\"tempVariable\"===m?e.stackTop.tempVariables:Kt.variables,p.name),r){let e=new dn(\"any\");u=an.check(e,u)??new an(e,u),i=o&&\"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value.\"}else if(n||Se.containsError(u))c=!0;else{const e=u.get();i=o&&(u?.object!==Kt.variables||io(u.object,u.compiledPropertyChain[0])?\"\":\"This variable didn't exist; for story-wide $ variables, a default value of 0 is used if they don't exist.\"),u=e}else if(\"hookName\"===m)u=new jn({type:\"name\",data:p.name}),c=!0;else if(\"number\"===m||\"cssTime\"===m)u=p.value,i=o&&\"cssTime\"===m&&(p.text.endsWith(\"ms\")?\"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.\":\"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000).\"),c=!i;else if(\"boolean\"===m)u=\"true\"===p.text.toLowerCase(),c=!0;else if(\"string\"===m){const e=p.text.replace(/(.?)\\n/g,((e,t)=>`${\"\\\\\"===t?\"\\\\\\\\\":\"\\n\"===t?\"\\\\n\":t}\\\\n`)).replace(/(\\\\*)\\\\0/g,((e,t)=>`${t?\"\\\\\".repeat(2*t.length):\"\"}0`));u=window.eval(e),c=!0}else if(\"hook\"===m)u=new kr(p.children,p.text),c=!0;else if(\"colour\"===m)u=new Gr(p.colour),c=!0;else if(\"datatype\"===m)u=new dn(p.name),c=!0;else if(\"spread\"===m)u=l.makeSpreader(wo(e,f,!1,r));else if(\"bind\"===m)u=ha.create(wo(e,f,y),p.text.startsWith(\"2\")?\"two way\":\"\"),c=!0;else if(\"to\"===m||\"into\"===m){const t=\"to\"===m?vo(e,wo(e,h,y,true)):wo(e,f,y,true);if(Se.containsError(t))u=t;else{(pr.isPrototypeOf(t)&&t.propertyChain.length<=1||t instanceof an&&t.varRef.propertyChain.length<=1)&&(e.freeVariables=Object.create(null));const n=\"to\"===m?wo(e,f,y):vo(e,wo(e,h,y));if(Se.containsError(n))return n;const r=e.freeVariables;let a;e.freeVariables=null,p.place&&r&&\"object\"==typeof r&&\"boolean\"!=typeof n&&\"number\"!=typeof n&&!$.options.uncompressedPureValues&&(a=r,a.at=p.place,a.from=f[0].start,a.to=f[f.length-1].end,a.hash=no(f.reduce(((e,t)=>e+t.text),\"\")).toString(16),JSON.stringify(a).length>=ro(n).length&&(a=void 0)),u=new mr(t,n,m,a),c=!0,s=e.Identifiers.it}}else if(\"typeSignature\"===m){const t=wo(e,h),n=e.freeVariables;e.freeVariables=null;const r=wo(e,f,y);e.freeVariables=n,u=an.check(t,r)??new an(t,r),c=!0}else if(\"where\"===m||\"when\"===m||\"via\"===m)if(f){const n=h?wo(e,h,y):void 0,r=t.map((e=>e.text)).join(\"\");u=pa.check(n,p.type,f)??new pa(n,p.type,f,r),c=!0}else u=go(!1,!0,p);else if(\"making\"===m||\"each\"===m)if(f){const n=[].concat(t).map((e=>e.text)).join(\"\");if(\"each\"===m){const t=wo(e,f,y);u=pa.check(t,\"each\",null)??new pa(t,\"each\",null,n)}else{const t=h?wo(e,h,y):void 0,r=wo(e,f,y);u=pa.check(t,m,r)??new pa(t,m,r,n)}c=!0}else u=go(!1,!0,p);else if(\"and\"===m||\"or\"===m){const n=e=>{const[t,r]=co(e,\"least\");if(t&&\"whitespace\"!==t.type)return lo.includes(t.type)?t:t.type===m?n(e.slice(0,r))||n(e.slice(r+1)):void 0},r=n(h),i=n(f),s=Se.create(\"operation\",`This use of \"is not\" and \"${m}\" is grammatically ambiguous.`,`Maybe try rewriting this as \"__ is not __ ${m} __ is not __\"`);let c;const g=t=>{const[n,r]=co(t,\"least\");if(!n||\"whitespace\"===n.type)return[];if(n.type===m)return[...g(t.slice(0,r)),...g(t.slice(r+1))];const i=wo(e,t);if(o&&\"boolean\"!=typeof i){const n=c.replace(/[A-Z]/g,(e=>` ${e.toLowerCase()}`));bo(a,{toCode:` it ${n} ${ro(i)} `,reason:`A missing 'it ${n}' was inferred to correct the '${m}' operation.`,tokens:t,i:r}),bo(a,{toCode:` ${ro(e.Identifiers.it)} ${n} ${ro(i)} `,tokens:t,i:r})}return[{val:i,tokens:t,i:r}]},y=(...t)=>t.reduce(((t,{val:n,tokens:r,i})=>{if(\"boolean\"==typeof n)return n;const s=Za[p.type](t,Za[c](e.Identifiers.it,n));return o&&bo(a,{val:s,tokens:r,i}),s}),\"and\"===p.type);if(r&&!i){const t=r;if(c=uo(t),\"isNot\"===t.type||\"isNotA\"===t.type||\"untypifies\"===t.type)u=s;else{const t=wo(e,h);u=l[m](t,y(...g(f)))}}else if(!r&&i){const n=i,r=t.indexOf(n);if(c=fo(n),\"isNot\"===n.type||\"isNotA\"===n.type||\"untypifies\"===n.type)u=s;else{const a=[...t.slice(r+1),Object.assign(Object.create(n),{[\"inequality\"===n.type?\"operator\":\"type\"]:fo(n)}),...t.slice(d+1,r)],o=wo(e,a);u=l[m](o,y(...g(h)))}}else u=l[m](wo(e,h),wo(e,f))}else if(lo.includes(m)){f||go(!1,!0,p);const t=h?wo(e,h):e.Identifiers.it;u=l[uo(p)](t,wo(e,f)),e.Identifiers.it=t,s=t,i=o&&!h&&\"A missing 'it' was inferred to complete the operation.\"}else if(\"addition\"===m||\"subtraction\"===m){f||go(!1,!0,p);let n=!h;if(h){const[e,t]=co(h,\"least\"),r=mo[e.type],a=e.type;n=(\"both\"===r||\"after\"===r||\"addition\"===a||\"subtraction\"===a)&&(t===h.length-1||t===h.length-2&&\"whitespace\"===h[h.length-1].type)}n?(p.type=\"addition\"===m?\"positive\":\"negative\",u=wo(e,t),p.type=m,c=!0):u=l[p.text](wo(e,h),wo(e,f))}else if(\"multiplication\"===m||\"division\"===m)u=l[p.text](wo(e,h),wo(e,f));else if(\"positive\"===m||\"negative\"===m)u=l[\"*\"](\"negative\"===m?-1:1,wo(e,f)),c=!0;else if(\"not\"===m)u=l.not(wo(e,f));else if(\"belongingProperty\"===m){const r=wo(e,f,n);u=pr.create(r,p.name);let s=n||Se.containsError(u);u=s?u:u.get(),s=n||Se.containsError(u),o&&!s?bo(a,{toCode:` ${p.name} of ${ro(pr.isPrototypeOf(r)?r.get():r)} `,tokens:t,i:d}):s||(i=`The value to the right of 'of', ${ao(r)}, had a \"${p.name}\" data name corresponding to that data value.`)}else if(\"belongingOperator\"===m||\"belongingItOperator\"===m){const r=wo(e,h);\"random\"===r&&e.freeVariables&&\"object\"==typeof e.freeVariables&&!e.freeVariables.seed&&(e.freeVariables.seed=Kt.seed,e.freeVariables.seedIter=Kt.seedIter),u=pr.create(\"belongingItOperator\"===m?e.Identifiers.it:wo(e,f,n),{computed:!0,value:r}),u=n||Se.containsError(u)?u:u.get(),\"belongingItOperator\"===m&&o&&bo(a,{toCode:` ${ro(r)} of ${ro(e.Identifiers.it)} `,tokens:t,i:d})}else if(\"property\"===m){const r=wo(e,h,y);u=pr.create(r,p.name);let s=n||Se.containsError(u);u=s?u:u.get(),s=n||Se.containsError(u),o&&pr.isPrototypeOf(r)&&!s?bo(a,{toCode:` ${ro(r.get())}'s ${p.name} `,tokens:t,i:d}):s||(i=`The value to the left of 's, ${ao(r)}, had a \"${p.name}\" data name corresponding to that data value.`)}else if(\"itsProperty\"===m||\"belongingItProperty\"===m)u=pr.create(e.Identifiers.it,p.name),u=n||Se.containsError(u)?u:u.get(),o&&bo(a,{toCode:\"itsProperty\"===m?` ${ro(e.Identifiers.it)}'s ${p.name} `:` ${p.name} of ${ro(e.Identifiers.it)} `,tokens:t,i:d});else if(\"possessiveOperator\"===m||\"itsOperator\"===m)if(!f||!h&&\"itsOperator\"!==p.type)u=go(!h,!f,p);else{const r=wo(e,f);\"random\"===r&&e.freeVariables&&\"object\"==typeof e.freeVariables&&!e.freeVariables.seed&&(e.freeVariables.seed=Kt.seed,e.freeVariables.seedIter=Kt.seedIter),u=pr.create(\"itsOperator\"===p.type?e.Identifiers.it:wo(e,h,n),{computed:!0,value:r}),u=n||Se.containsError(u)?u:u.get(),\"itsOperator\"===m&&o&&bo(a,{toCode:` ${ro(e.Identifiers.it)}'s ${ro(r)} `,tokens:t,i:d})}else if(\"twineLink\"===m)u=Pa.run(\"link-goto\",e,[p.innerText,p.passage]),i=o&&\"Passage links are the same as (link-goto:) macro calls.\";else if(\"macro\"===m)if(p.blockedValue&&!e.blocked){if(u=e.blockedValue(),void 0===u)return to(\"Runner.run\",\"section.blockedValue() returned undefined\"),0}else{const t=p.children[0],n=\"$\"===t.text[0]||\"_\"===t.text[0];if(\"macroName\"!==t.type&&!n)return to(\"Runner.run\",\"macro token had no macroName child token\"),0;let a;n?(a=pr.create(\"_\"===t.text[0]?e.stackTop.tempVariables:Kt.variables,t.text.trim().slice(1,-1)),Se.containsError(a)||(a=a.get())):a=p.name,u=Pa[n?\"runCustom\":\"run\"](a,e,p.children.slice(1).reduce(((e,t)=>(\"comma\"===t.type?e.push([]):e[e.length-1].push(t),e)),[[]]).filter((e=>e.length&&(e.length>1||\"whitespace\"!==e[0].type))).map((t=>wo(e,t,!1,r)))),i=o&&n&&`I called ${oo(a)}.`}else if(\"grouping\"===m)u=wo(e,p.children,n),c=!0;else if(\"error\"===m)u=Se.create(\"syntax\",p.message,p.explanation||\"\");else{if(\"text\"!==m)return to(\"Section.run\",`unknown syntax token type: ${m}!!`),0;{let e;p.text.trim().match(/^\\d+(?:th|nd|st|rd)(?:last)?(?:to\\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(e=`Position data names like \"${p.text}\" need to be either left of \"of\" or right of \"'s\".`),u=Se.create(\"syntax\",e||`\"${p.text}\" isn't valid Harlowe syntax for the inside of a macro call.`,\"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.\")}}}return void 0===u?(to(\"Section.run\",`token ${m}${p.name?` (${p.name}:)`:\"\"} produced undefined`),0):u===e?(to(\"Section.run\",`token ${m}${p.name?` (${p.name}:)`:\"\"} produced the section`),0):(o&&!c&&bo(a,{val:u,reason:i,it:s,tokens:t,i:d}),u)}const{printBuiltinValue:ko,objectName:xo,typeID:$o,isObject:To}=wt,{collapse:So}=$n,{assign:Eo,create:Co,keys:No,hasOwn:Oo}=Object;let jo;function Ao(e,t,n){if(t&&\"object\"==typeof t&&t instanceof wr){const r=n.popData(\"source\")||n[0].cachedData?.source;n[0]?.cachedData&&(n[0].cachedData.source=void 0),n.data(\"originalSource\",r);const a=new et({target:n,source:r,section:this,append:\"append\"}),o=t.run(a);Se.containsError(o)&&e.replaceWith(o.render(e.attr(\"title\")));if(!this.renderInto(r,null,a)){const t=$.insensitiveName(e.attr(\"name\"));return[\"if\",\"elseif\",\"unless\",\"else\",\"testfalse\"].includes(t)&&(e.addClass(\"false\"),\"elseif\"!==t&&(this.stackTop.lastHookShown=!1)),n.data(\"live\")&&Po.call(this,e,a,n),!0}}else{if(!1===t){const t=n.popData(\"source\")||n[0].cachedData?.source;return n[0]?.cachedData&&(n[0].cachedData.source=void 0),t&&(n.cachedData&&(n.cachedData.source=void 0),n.data(\"originalSource\",t),n.data(\"hidden\",!0)),e.addClass(\"false\"),this.stackTop.lastHookShown=!1,!0}if(!0!==t)return!1}return this.stackTop.lastHookShown=!0,!0}function _o(e){const{nextSibling:t}=e instanceof a?e[0]:e;if(t&&(t instanceof Text&&!t.textContent.trim()||[\"br\",\"tw-consecutive-br\"].includes((t.tagName||\"\").toLowerCase()))){const{whitespace:e,nextElem:n}=_o(t);return{whitespace:a(t).add(e),nextElem:n}}return{whitespace:a(),nextElem:a(t)}}const Do=e=>{if(e?.length)return a(\"<tw-open-button replay label='🔍'>\").data(\"evalReplay\",e)};function Io(e,t){let n=this.eval(t);e.append(Do(this.evalReplay)),e.append(((e,t)=>{if(/a \\((go-to|undo|redirect|restart):\\) command/.exec(t?.TwineScript_TypeName))return a(\"<tw-open-button goto label='GO'>\").data(\"goto\",{section:e,command:t})})(this,n)),this.stackTop.evaluateOnly&&n&&(n instanceof wr||\"function\"==typeof n.TwineScript_Run)&&(n=Se.create(\"syntax\",`I can't work out what ${this.stackTop.evaluateOnly} should evaluate to, because it contains a ${n instanceof wr?\"changer.\":\"command.\"}`,\"Please rewrite this without putting changers or commands here.\"));let r,o,i,s=a();for(o=e;n instanceof wr;){if(({whitespace:r,nextElem:o}=_o(o)),o[0]&&o[0].nodeType===Node.TEXT_NODE&&\"+\"===o[0].textContent.trim()){let e,t=o;if(({whitespace:e,nextElem:o}=_o(t)),o.is(\"tw-expression\")){const i=o.popData(\"code\")||o[0]?.cachedData?.code;o[0]?.cachedData&&(o[0].cachedData.code=void 0);const s=this.eval(i);if(Se.containsError(s)){n=s;break}const c=Za[\"+\"](n,s);a(r).add(t).add(e).remove(),n=Se.containsError(c)?Se.create(\"operation\",`I can't combine ${xo(n)} with ${xo(s)}.`,\"function\"==typeof s.TwineScript_Run?`If you want to attach this changer to ${xo(s)}, remove the + between them.`:\"Changers can only be added to other changers.\"):c;continue}}if(o.is(\"tw-expression\")){const t=o.popData(\"code\")||o[0]?.cachedData?.code;o[0]?.cachedData&&(o[0].cachedData.code=void 0);const r=this.eval(t);if(o.append(Do(this.evalReplay)),Se.containsError(r)){n=r;break}if(r&&\"object\"==typeof r&&r.attachable){n=r.TwineScript_Attach(this,n);break}return r instanceof wr?void e.replaceWith(Se.create(\"operation\",`Changers like (${n.macroName}:) need to be combined using + between them.`,\"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.\").render(e.attr(\"title\"))):void e.replaceWith(Se.create(\"operation\",`${xo(r)} can't have changers like (${n.macroName}:) attached.`,\"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.\").render(e.attr(\"title\")))}if(o.is(\"tw-hook\")){r.remove(),s=o;break}n.macroName||$.impossible(\"Section.runExpression\",\"changer has no macroName\");const t=e.attr(\"title\")||`(${n.macroName}: ...)`;return void e.replaceWith(Se.create(\"syntax\",`The (${n.macroName}:) changer should be stored in a variable or attached to a hook.`,`Macros like this should appear before a hook: ${t}[Some text]`).render(e.attr(\"title\")))}if(e.attr(\"return\",$o(n)),s=s.length?s:_o(e).nextElem.filter(\"tw-hook\"),i=Se.containsError(n))e.replaceWith(i.render(e.attr(\"title\")).append(Do(this.evalReplay)));else if(Kr.isPrototypeOf(n))e.append(n.render());else if(n&&\"function\"==typeof n.TwineScript_Run)if(n=n.TwineScript_Run(this),Se.containsError(n))e.replaceWith(n.render(e.attr(\"title\")));else if(n instanceof et){if(n.data?.live)return void e.replaceWith(Se.create(\"unimplemented\",\"I currently can't attach (live:) or (event:) macros to commands - only hooks.\").render(e.attr(\"title\")));n.section=this,n.target=o,this.renderInto(\"\",o,n)}else{if(To(n)&&\"blocked\"in n&&n.blocked)return this.stackTop.blocked=n.blocked,void e.data(\"code\",{type:\"macro\",blockedValue:!0,text:e.attr(\"title\")||\"\",start:0,end:(e.attr(\"title\")||\"\").length});n&&$.impossible(\"Section.runExpression\",`TwineScript_Run() returned a non-ChangeDescriptor ${typeof n}: \"${n}\"`)}else{if(s.length&&Ao.call(this,e,n,s))return;\"string\"==typeof n||\"number\"==typeof n||n instanceof Map||n instanceof Set||Array.isArray(n)||n instanceof Gr||n instanceof kr||n&&\"function\"==typeof n.TwineScript_Print&&!(n instanceof wr)?(n=ko(n),Se.containsError(n)?e.replaceWith(n.render(e.attr(\"title\"))):\"string\"==typeof n||Array.isArray(n)?this.renderInto(n,e):$.impossible(\"Section.runExpression\",\"printBuiltinValue() produced a non-string non-array \"+typeof n)):n instanceof wr||\"boolean\"==typeof n||$.impossible(\"Section.runExpression\",`The expression evaluated to an unknown value: ${n}`)}}function Po(e,t,n){const{delay:r,event:a}=n.data(\"live\");(t={...t,append:\"replace\",transitionDeferred:!1,enabled:!0}).data={...t.data,live:void 0};const o=n.data(\"originalSource\")||\"\",{tempVariables:i}=this.stackTop;let s,c=null,l=r;const p=e=>{c&&(l-=(e-c)*($.options.debug&&void 0!==$.options.speedMultiplier?$.options.speedMultiplier:1)),c=e,l>0?requestAnimationFrame(p):(l=r,s())};s=this.whenUnblocked.bind(this,(()=>{if(!this.inDOM())return;const r=a?.filter(this,[!0],i);Se.containsError(r)?r.render(this,e.attr(\"title\")).replaceAll(e):!a||r[0]?(this.renderInto(o,n,t,i),r||n.find(\"tw-expression[name='stop']\").length||this.inDOM()&&requestAnimationFrame(p)):requestAnimationFrame(p)})),requestAnimationFrame(p)}const Ro={add:[],remove:[]};jo={create(e=$.storyElement){let t=Eo(Co(this),{timestamp:Date.now(),dom:e,stack:[],enchantments:[],unblockCallbacks:[],freeVariables:null,evalReplay:null,loadedGame:!1,Identifiers:{TwineScript_Identifiers:!0,it:0,get time(){return t.stackTop?.evaluateOnly?Se.create(\"operation\",`'time' can't be used in ${t.stackTop.evaluateOnly}.`):(Date.now()-t.timestamp)*($.options.debug&&void 0!==$.options.speedMultiplier?$.options.speedMultiplier:1)},get turns(){return Kt.turns},get turn(){return Kt.turns},get visits(){const{stackTop:{speculativePassage:e}}=t;return Kt.history().filter((t=>t===(e||Kt.passage))).length+(!e||e===Kt.passage)},get visit(){return t.Identifiers.visits},get exits(){return t.stackTop?.evaluateOnly?Se.create(\"operation\",`'exit' and 'exits' can't be used in ${t.stackTop.evaluateOnly}.`):t.dom.find(\"tw-enchantment, tw-link\").filter(((e,t)=>(t=a(t)).data(\"enchantmentEvent\")||t.parent().data(\"linkPassageName\")||t.parent().data(\"clickEvent\"))).length},get exit(){return t.Identifiers.exits},get pos(){return t.stackTop&&!t.stackTop.evaluateOnly&&t.stackTop.lambdaPos?+t.stackTop.lambdaPos||1:Se.create(\"operation\",\"'pos' can only be used in lambdas that aren't 'when' lambdas.\")}}});return t},eval(e){if($.options.debug&&$.options.evalReplay){const t=Array.isArray(e)?e.reduce(((e,t)=>e+t.text),\"\"):e.text||\"\";this.evalReplay=[{code:t,fromCode:t,basis:(Array.isArray(e)?e[0]:e).start,start:0,end:t.length,diff:0}]}let t;try{t=wo(this,e)}catch(t){return window.console?.error(t),this.evalReplay=null,Se.create(\"\",`An internal error occurred while trying to run ${[].concat(e).map((e=>e.text)).join(\"\")}.`,`The error was \"${t.message}\".\\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).`)}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),t},get stackTop(){return this.stack[0]},inDOM(){return $.storyElement.find(this.dom).length>0},evaluateTwineMarkup(e,t){const n=a(\"<p>\");let r;return this.stack.unshift({desc:new et({target:n,source:e,section:this,append:\"append\"}),tempVariables:this.stackTop.tempVariables||void 0,evaluateOnly:t,finalIter:!0}),this.execute(),(r=n.find(\"tw-error\")).length>0?r:n},speculate(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:Eo(Co(Xr),{TwineScript_VariableStore:{type:\"temp\",name:n}}),speculativePassage:t});const{evalReplay:r}=this;let a;return this.evalReplay=null,e instanceof pa?a=e.apply(this,{loop:void 0,pos:void 0}):e&&(a=wo(this,e)),this.stack.shift(),this.evalReplay=r,a},renderInto(e,t,n,r=null){const o=new et({target:t,source:e,section:this,append:\"append\"});if(n)if(n instanceof wr){const e=n.run(o);if(Se.containsError(e))return e.render(t.attr(\"title\")).replaceAll(t),!1}else Eo(o,n);if(t=\"function\"==typeof o.target?o.target():o.target,this.stack.length>=50){if(this.stack.reduce(((e,{finalIter:t})=>e+!!t),0)>=50)return Se.create(\"infinite\",\"Printing this expression may have trapped me in an infinite loop.\").render(t.attr(\"title\")).replaceAll(t),!1}const i=(e,n,r)=>{let o=t instanceof a&&t.is(\"tw-hook\")&&t.parents(\"tw-collapsed,[collapsing=true]\").length>0;this.stack.unshift({desc:e,finalIter:r,tempVariables:n,collapses:o,evaluateOnly:this.stackTop&&this.stackTop.evaluateOnly})};if(r||(r=Co(this.stack.length?this.stackTop.tempVariables:Xr)),!Oo(r,\"TwineScript_VariableStore\")){const e=t?.tag();r.TwineScript_VariableStore={type:\"temp\",name:\"tw-hook\"===e?t.attr(\"name\")?`?${t.attr(\"name\")}`:\"an unnamed hook\":\"tw-expression\"===e?`a ${t.attr(\"type\")} expression`:\"tw-passage\"===e?\"this passage\":\"an unknown scope\"}}const s=this.stackTop?.blocked;if(No(o.loopVars).length){const e={...o.loopVars};let n=Math.min(...No(e).map((t=>e[t].length)));if(Kr.create(`${n} loop${1!==n?\"s\":\"\"}`).render().prependTo(t),n){for(let t=n-1;t>=0;t-=1)i(o,No(e).reduce(((n,r)=>(n[r]=e[r][t],n)),Co(r)),t===n-1);for(let e=n-1;e>=0&&!this.stackTop.blocked;e-=1)this.execute()}}else i(o,r,!0),this.execute();return(0===this.stack.length||!s&&this.stackTop?.blocked)&&this.updateEnchantments(),o.enabled},execute(){let{desc:e,dom:t,collapses:n,evaluateOnly:r}=this.stackTop;e&&!t&&(t=e.render(),this.stackTop.dom=t,this.stackTop.desc=void 0),t.findAndFilter('tw-hook,tw-expression,script[type=\"application/x-harlowe\"]').each(((e,t)=>{let n=a(t).data();t.cachedData={blockers:n.blockers,code:n.code,source:n.source}})).each(((e,t)=>{if(this.stackTop.blocked)return!1;let{cachedData:n}=t;switch(n&&(t.cachedData=void 0),(t=a(t)).tag()){case\"tw-hook\":{let e=t.popData(\"source\")||n?.source;if(e&&t.data(\"originalSource\",e),t.data(\"tempVariables\",this.stackTop.tempVariables),t.popAttr(\"hidden\")){t.data(\"hidden\",!0);break}e&&this.renderInto(e,t);break}case\"tw-expression\":{const e=t.data(\"blockers\")||n?.blockers;if(e){if(r)return void t.removeData(\"blockers\").removeData(\"code\").replaceWith(Se.create(\"syntax\",`I can't use a macro like (prompt:) or (confirm:) in ${r}.`,\"Please rewrite this without putting such macros here.\").render(t.attr(\"title\"),t));if(e.length){this.stackTop.blocked=!0;let n=this.eval(e.shift());return Se.containsError(n)&&(this.stackTop.blocked=!1,t.removeData(\"blockers\").replaceWith(n.render(t.attr(\"title\"),t))),!1}t.removeData(\"blockers\")}const a=t.popData(\"code\")||n?.code;a&&Io.call(this,t,a);break}case\"script\":if($.reattachStoryElement(),!t.text())break;try{o=t.text(),i=this.stackTop.tempVariables,Function(\"script\",\"$\",\"scope\",\"with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}\")(o,a,Object.create(null,Object.keys(Kt.variables).map((e=>!e.startsWith(\"TwineScript_\")&&`$${e}`)).concat(Object.keys(i).map((e=>!e.startsWith(\"TwineScript_\")&&`_${e}`))).reduce(((e,t)=>(t&&(e[t]={get(){const e=(\"$\"===t[0]?Kt.variables:i)[t.slice(1)];if(!wt.isHarloweJSValue(e))throw Se.create(\"\",`The contents of the variable ${t}, ${wt.objectName(e)}, couldn't be converted to a Javascript value.`,\"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.\");return wt.clone(e)},set(e){const n=\"$\"===t[0]?Kt.variables:i;if(!wt.isHarloweJSValue(e))throw Se.create(\"\",`The Javascript value, ${e}, couldn't be converted to a Harlowe value and assigned to the variable ${t}.`,\"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.\");e=wt.clone(e);const r=pr.create(n,t.slice(1)).set(e);if(Se.containsError(r))throw r}}),e)),{})))}catch(e){Se.isPrototypeOf(e)?t.replaceWith(e.render(t.text(),t)):(window.console?.error(e),t.replaceWith(Se.create(\"\",\"A Javascript error occurred while running this <script> element.\",`The error was \"${e}\". Check the browser console for more details.`).render(t.text(),t)))}}var o,i})),this.stackTop.blocked||(t.length&&n&&So(t),t.findAndFilter(\"tw-collapsed,[collapsing=true]\").each((function(){So(a(this))})),setTimeout((()=>t.find(\"input, textarea\").first().focus()),100),this.stack.shift())},updateEnchantments(){this.enchantments.forEach((e=>{e.disenchant(),e.enchantScope()}))},on(e,t){return Ro[e].push(t),this},addEnchantment(e){this.enchantments.push(e),Ro.add.forEach((t=>t(this,e)))},removeEnchantment(e){const t=this.enchantments.indexOf(e);this.enchantments.splice(t,1),e.disenchant(),Ro.remove.forEach((t=>t(this,e)))},unblock(e){for(this.stack.length||$.impossible(\"Section.unblock\",\"stack is empty\"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;this.unblockCallbacks.length>0;){if(this.unblockCallbacks.shift()(),this.stackTop?.blocked)return}},whenUnblocked(e,t){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):(t||e)()},blockedValue(){const{stackTop:e}=this;return e?e.blockedValues&&e.blockedValues.length?e.blockedValues.shift():($.impossible(\"Section.blockedValue\",\"blockedValues is missing or empty\"),0):($.impossible(\"Section.blockedValue\",\"stack is empty\"),0)}};var Mo=Object.preventExtensions(jo);const{impossible:Vo,transitionOut:Lo,options:Fo}=$;let Ho,qo;function zo(e,t,n){let r,a;if(n){const e=n.get(\"name\"),a=Re.getTree(e);a.children.length&&(r={type:\"include\",tag:t,name:e,children:a.children,text:a.text})}else r=Re.getTree(t);if(r){for(;(a=e[e.length-1])&&(\"root\"===a.type||\"include\"===a.type)&&a.children.some((e=>e.type.startsWith(\"unclosed\")));)e[e.length-1]=Object.create(a),e=e[e.length-1].children=a.children.slice();e.push(r)}}function Wo(e,t={}){const{loadedGame:n}=t,r=Re.get(e),o=$.storyElement;let i=o.parent(),{stretch:s,transition:{depart:c=\"instant\",arrive:l=\"dissolve\",departOrigin:p,arriveOrigin:u,time:d}={}}=t;i.findAndFilter(\"tw-enchantment\").each(((e,t)=>{const n=(t=a(t)).data(\"enchantedProperties\");n&&o.css(n.reduce(((e,t)=>(e[t]=\"\",e)),{})),t[0]===i[0]&&(i=o.unwrap().parent())})),Re.hasValid(e)||Vo(\"Engine.showPassage\",`There's no passage with the name \"${e}\"!`);const h=o.children(\"tw-passage\").not(\".transition-out, .transition-out *\"),f=(r.get(\"tags\")||[]).join(\" \"),m=function(){const e=a(\"<tw-passage>\"),t=$.storyElement.children(\"tw-sidebar\"),n=a('<tw-icon tabindex=0 alt=\"Undo\" title=\"Undo\">&#8630;</tw-icon>'),r=a('<tw-icon tabindex=0 alt=\"Redo\" title=\"Redo\">&#8631;</tw-icon>'),o=a('<tw-icon tabindex=0 alt=\"Fullscreen\" title=\"Fullscreen\">&#9974;</tw-icon>'),i=a('<tw-icon tabindex=0 alt=\"Restart\" title=\"Restart\">&#10226;</tw-icon>');return Kt.pastLength<=0&&n.css(\"visibility\",\"hidden\"),Kt.futureLength<=0&&r.css(\"visibility\",\"hidden\"),t.html(\"\"),t.append(n,r,o,i),e}();\"function\"==typeof p&&(p=p.call(h)),\"function\"==typeof u&&(u=u.call(m));const g=!s&&c,y=g&&h.css(\"width\");$.detachStoryElement(),m.appendTo(o).attr({tags:f}),g&&(Lo(h,c,d,0,0,0,p),h.css({position:\"absolute\",width:()=>\"0px\"!==y?y:\"100%\"})),o.attr({tags:f});const b=Mo.create(m);n&&(b.loadedGame=!0);const v=[];if(Kt.pastLength<=0&&1===Kt.turns){for(let e of Re.getTagged(\"startup\"))zo(v,\"startup\",e);if(Fo.debug)for(let e of Re.getTagged(\"debug-startup\"))zo(v,\"debug-startup\",e)}for(let e of Re.getTagged(\"header\"))zo(v,\"header\",e);if(Fo.debug)for(let e of Re.getTagged(\"debug-header\"))zo(v,\"debug-header\",e);zo(v,e);for(let e of Re.getTagged(\"footer\"))zo(v,\"footer\",e);if(Fo.debug)for(let e of Re.getTagged(\"debug-footer\"))zo(v,\"debug-footer\",e);b.renderInto(v,m,{transition:l,transitionTime:d,transitionOrigin:u}),b.loadedGame=!1,$.reattachStoryElement(),scroll(0,s?m.offset().top-.05*a(window).height():o[0].getBoundingClientRect().top+document.body.scrollTop)}Ho={goBack(e){Kt.rewind()&&Wo(Kt.passage,e)},goForward(e){Kt.fastForward()&&Wo(Kt.passage,e)},goToPassage(e,t){Kt.play(e),Wo(e,t)},redirect(e,t){Kt.redirect(e),Wo(e,t)},toggleFullscreen(){const e=document.documentElement;document.fullscreenElement?document.exitFullscreen():e.requestFullscreen.call(e)},showPassage:Wo,enableDebugMode(){qo&&qo()},registerDebugMode(e){!qo&&(qo=e)}};var Bo=Object.freeze(Ho);const Uo=T(),Go=Object.seal({create({className:e,rowWrite:t,rowCheck:n,rowSort:r,columnHead:o,tabName:i,tabNameCounter:s=!0,tabUpdate:c}){const l=a(`<div class='panel panel-${e}' style='${this.defaultMaxHeight?`max-height:${this.defaultMaxHeight}px`:\"\"}' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>`),p=a(`<button class='tab tab-${e}'>${s?`0 ${i}s`:i}</button>`);let u;return p.click((()=>{p.toggleClass(\"enabled\"),p.parent().siblings(\".panel\").attr(\"hidden\",\"\"),p.is(\".enabled\")&&(p.siblings(`.tab:not(.tab-${e})`).removeClass(\"enabled\"),l.removeAttr(\"hidden\"))})),l.on(\"click\",\"th\",(({target:e})=>{let t=(e=a(e)).attr(\"data-order\");t=\"desc\"===t?\"asc\":\"desc\",u.sort(e.attr(\"data-col\"),t),l.find(\"th[data-order]\").removeAttr(\"data-order\"),e.attr(\"data-order\",t)})),c||(c=e=>p.text(s?`${e} ${i}${1!==e?\"s\":\"\"}`:i)),u=Object.assign(Object.create(this),{tabName:i,tab:p,panel:l,panelRows:l.find(\".panel-rows\"),rowWrite:t,rowSort:r,rowCheck:n,columnHead:o,tabUpdate:c}),u},sort(e,t){this.panelRows.children(\":not(.panel-head, .panel-row-source)\").get().sort(((n,r)=>(\"desc\"===t&&([n,r]=[r,n]),n=n.querySelector(`.${e}`),r=r.querySelector(`.${e}`),this.rowSort&&this.rowSort(e,a(n),a(r))||Uo(n.textContent,r.textContent)))).forEach((e=>{const t=a(e).next(\".panel-row-source\").get();this.panelRows.append(e,t)}))},update(e,t){const{rowCheck:n,rowWrite:r,panelRows:o,columnHead:i,panel:s}=this,c=[],l=o.children();e.forEach((e=>{const t=l.get().filter((t=>n(e,a(t)))),i=r(e,t.length&&a(t));t.length||o.append(i),c.push(...i.get())})),l.filter(((e,t)=>!c.includes(t)&&!t.className.includes(\"panel-head\"))).remove(),this.tabUpdate(t),t>0&&!o.find(\".panel-head\").length?o.prepend(i()):0===t&&o.find(\".panel-head\").remove();const p=s.find(\"th[data-order]\");p.length&&this.sort(p.attr(\"data-col\"),p.attr(\"data-order\"))},defaultMaxHeight:300}),Xo={boolean:\"color:hsla(0,0%,30%,1.0)\",array:\"color:hsla(0,100%,30%,1.0)\",dataset:\"color:hsla(30,100%,40%,1.0)\",number:\"color:hsla(30,100%,30%,1.0)\",datamap:\"color:hsla(60,100%,30%,1.0)\",changer:\"color:hsla(90,100%,30%,1.0)\",lambda:\"color:hsla(120,100%,40%,1.0)\",hookName:\"color:hsla(160,100%,30%,1.0)\",string:\"color:hsla(180,100%,30%,1.0)\",identifier:\"color:hsla(200,80%,40%,1.0)\",variable:\"color:hsla(200,100%,30%,1.0)\",tempVariable:\"color:hsla(200,70%,20%,1.0)\",datatype:\"color:hsla(220,100%,30%,1.0)\",colour:\"color:hsla(280,100%,30%,1.0)\",macro:\"color:hsla(320,80%,30%,1.0)\",twineLink:\"color:hsla(240,100%,20%,1.0)\"};Xo.gradient=Xo.colour,Xo.command=Xo.twineLink,Xo.instant=Xo.metadata=Xo.any=Xo.customMacro=Xo.macro;const{min:Yo}=Math,Jo=(e,t,n)=>r=>`background-color: hsla(${e},${t}%,${n}%,${r});`,Ko=Jo(40,100,50),Qo=Jo(220,100,50),Zo=/hsla\\((\\d+),\\s*(\\d+)%,\\s*(\\d+)%,\\s*(\\d+\\.\\d+)\\)/g,ei=\"cm-harlowe-4-\",ti=`${{root:\"box-sizing:border-box;\",hook:Ko(.05),\"hook-2\":Ko(.1),\"hook-3\":Ko(.15),\"hook-4\":Ko(.2),\"hook-5\":Ko(.25),\"hook-6\":Ko(.3),\"hook-7\":Ko(.35),\"hook-8\":Ko(.4),\"^=hook , ^=hook-\":\"font-weight:bold;\",unclosedHook:`${Ko(.05)}font-weight:bold;`,[`error:not([class*='${ei}string'])`]:\"background-color: hsla(17,100%,50%,0.5) !important;\",\"^=macroName\":\"font-style:italic;\",\"macroName-boolean\":Xo.boolean,\"macroName-array\":Xo.array,\"macroName-dataset\":Xo.dataset,\"macroName-datatype\":Xo.datatype,\"macroName-number\":Xo.number,\"macroName-datamap\":Xo.datamap,\"macroName-changer\":Xo.changer,\"macroName-string\":Xo.string,\"macroName-colour, macroName-gradient\":Xo.colour,\"macroName-command, macroName-instant, macroName-metadata\":Xo.command,\"macroName-custommacro, macroName-macro, macroName-any\":Xo.macro,\"^=macro \":`font-weight:bold;${Xo.macro}`,\"comma, spread\":Xo.macro,addition:Xo.any,\"subtraction, multiplication, division\":Xo.number,\"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch\":Xo.boolean,\"bold, strong\":\"font-weight:bold;\",\"italic, em\":\"font-style:italic;\",sup:\"vertical-align: super;font-size:0.8em;\",strike:\"text-decoration: line-through;\",verbatim:\"background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)\",\"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike\":\"font-weight:100; color: hsla(0,0%,0%,0.5)\",\"^=collapsed\":\"font-weight:bold; color: hsla(201,100%,30%,1.0);\",unclosedCollapsed:`${Qo(.025)}font-weight:bold; color: hsla(201,100%,30%,1.0);`,collapsed:Qo(.025),\"collapsed.hook\":Qo(.05),\"collapsed.hook-2\":Qo(.1),\"collapsed.hook-3\":Qo(.15),\"collapsed.hook-4\":Qo(.2),\"collapsed.hook-5\":Qo(.25),\"collapsed.hook-6\":Qo(.3),\"collapsed.hook-7\":Qo(.35),\"collapsed.hook-8\":Qo(.4),\"twineLink:not(.text)\":Xo.twineLink,\"tag, scriptStyleTag, comment\":\"color: hsla(240,34%,25%,1.0);\",boolean:Xo.boolean,string:Xo.string,number:Xo.number,variable:Xo.variable,tempVariable:Xo.tempVariable,hookName:Xo.hookName,datatype:Xo.datatype,colour:Xo.colour,cssTime:Xo.number,passageString:`${Xo.variable};text-decoration:underline 1px;`,tagString:`${Xo.variable};text-decoration:underline 1px dotted;`,\"variableOccurrence, hookOccurrence\":\"background: hsla(159,50%,75%,1.0) !important;\",\"^=where, ^=via, ^=with, ^=making, ^=each, ^=when\":`${Xo.lambda}; font-style:italic;`,heading:\"font-weight:bold;\",hr:\"background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);\",align:\"color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);\",column:\"color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);\",escapedLine:\"font-weight:bold; color: hsla(51,100%,30%,1.0);\",\"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator\":Xo.identifier,toString(){return Object.keys(this).reduce(((e,t)=>{if(\"toString\"===t)return e;const n=t.split(\", \").map((function e(t){return t.indexOf(\".\")>-1?t.split(/\\./g).map(e).join(\"\"):0===t.indexOf(\"^=\")?`[class^='${ei}${t.slice(2)}']`:`.${ei}${t}`}));return e+=`${n.join(\", \")}{${this[t]}}`,this[t].match(Zo)&&[\".theme-dark\",\"[data-app-theme=dark]\"].forEach((r=>{e+=`${n.map((e=>`${r} ${e}`)).join(\", \")}{${this[t].replace(Zo,((e,t,n,r,a)=>`hsla(${t},${Yo(100,1.5*+n)}%,${100-r}%,${a})`))}}`})),e}),\"\")}}}`,{insensitiveName:ni}=$,{lex:ri}=me;function ai(e){let t={},n=\"\";for(let r=0;r<e.length;r+=1){const{type:a,text:o}=e[r];\"verbatim\"!==a&&\"comment\"!==a||(n=\"\");let i=ei+a;switch(t[i]=(t[i]||0)+1,t[i]>1&&(i+=`-${t[i]}`),a){case\"text\":if(o.trim()){e.slice(r+1).reduce(((e,t)=>void 0===e?\"macro\"===t.type||\"hook\"!==t.type&&e:e),void 0)&&(i+=` ${ei}error`)}break;case\"macroName\":{const t=e[r].text[0];if(\"_\"===t||\"$\"===t){i+=` ${ei}customMacro ${ei+(\"_\"===t?\"tempV\":\"v\")}ariable`;break}const n=ni(e[r].text.slice(0,-1));Pa.has(n)?i+=`-${Pa.get(n).returnType.toLowerCase()}`:i+=` ${ei}error`;break}}n+=`${i} `}return n}function oi(e,t,n,r){if(e.length>9999)return[a(\"<span>\").text(e)[0]];const o=ri(e,\"\",t||\"macro\"),i=[];let s=\"\",c=o;for(let e=o.start;e<o.end;e+=1){const t=o.pathAt(e);t[0]!==c[0]&&(i.length&&(i[i.length-1].textContent=s),s=\"\",c=t,i.push(a(`<${r&&e>=n&&e<r?\"mark\":\"span\"} class=\"${ai(c)}\">`)[0])),s+=o.text[e-o.start]}return i.length&&(i[i.length-1].textContent=s),i}const{objectName:ii,isObject:si,toSource:ci,typeID:li}=wt,{dialog:pi}=$n;let ui=(e,t)=>{const{escape:n,nth:r,debounce:o}=$,i=a(document.documentElement),s=T();let c={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400};if(Kt.hasStorage)try{const e=localStorage.getItem(`(Debug Options ${$.options.ifid})`);e&&(c=JSON.parse(e))}catch(e){}function l(){if(Kt.hasStorage)try{localStorage.setItem(`(Debug Options ${$.options.ifid})`,JSON.stringify(c))}catch(e){}}Go.defaultMaxHeight=c.maxHeight;let p=a(`<tw-debugger class=\"${[c.darkMode?\"theme-dark\":\"\",c.fadePanel?\"fade-panel\":\"\"].join(\" \")}\" style=\"${c.width?`width:${c.width}px`:\"\"}\">\\n<div class='panel panel-errors' hidden><table></table></div>\\n<div class='tabs'></div>\\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\\n<button class='show-invisibles'>🔍 Debug View</button>\\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\\n<button class='close'>✖</button>\\n<div class='resizer-h'>\\n</tw-debugger>`);const u=p.find(\".tabs\"),d=p.find(\".show-dom\"),h=p.find(\".show-invisibles\"),f=p.find(\".close\"),m=p.find(\".turns\"),g=e=>o(((...t)=>{if($.options.debug)return e(...t)}),{maxWait:2e3});a(document.documentElement).on(\"click\",\"tw-expression, tw-error, tw-eval-explanation\",o((e=>{const t=a(e.target).data(\"evalReplay\");t&&function(e){let t=0;const r=pi({buttons:[{name:\"Understood\",confirm:!0,callback:()=>!p.find(\"tw-backdrop\").length&&p.removeClass(\"show-dialog\")}]}).addClass(\"eval-replay\"),o=a(`<tw-eval-replay>${1===e.length?\"\":\"<tw-eval-code></tw-eval-code>\"}<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>${1===e.length?\"\":\"<tw-dialog-links><tw-link style='visibility:hidden'>← 10</tw-link><tw-link style='visibility:hidden'>← ←</tw-link><b></b><tw-link>→ →</tw-link><tw-link>10 →</tw-link></tw-dialog-links>\"}</tw-eval-replay>`);r.find(\"tw-dialog\").css({width:\"75vw\",\"max-width\":\"75vw\"}).prepend(o);const i=o.find(\"tw-link:first-of-type\"),s=i.next(),c=s.next(),l=c.next(),u=l.next();function d(){const r=e[t],p=o.find(\"tw-eval-explanation\").empty(),d=o.find(\"tw-eval-code\");if(r.toCode||r.toDesc||r.error||r.lambda){if(o.find(\"tw-eval-code\").empty().append(oi(r.code,\"macro\",t>0&&r.start,t>0&&r.end+r.diff)),p.append(r.lambda?\"\":`<code class='${r.fromCode.length>56?\"from-block\":\"from-inline\"}'></code>`,r.error?\"<span> caused an error: </span>\":r.lambda?\"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>\":`<span> became${r.ToDesc?\"…\":\"\"} </span>${r.toDesc?`<span class='to-desc'>${n(r.toDesc)}.</span>`:\"<code class='to-code'></code>\"}`),r.error)p.append(r.error);else if(r.lambda){const e=(e,t)=>a(`<${e}><code></${e}>`).find(\"code\").append(oi(t,\"macro\")).end();p.find(\".to-lambda\").append(oi(r.lambda.obj.source,\"macro\")).end().append(a(\"<table>\").append(a(\"<tr>\").append(e(\"th\",\"pos\"),r.lambda.obj.loop?e(\"th\",`_${r.lambda.obj.loop.getName()}`).append(\" / \",a(\"<code>\").append(oi(\"it\",\"macro\"))):e(\"th\",\"it\"),r.lambda.obj.making&&e(\"th\",`_${r.lambda.obj.making.getName()}`),r.lambda.obj.where&&e(\"th\",\"where\").append(\" result\"),r.lambda.obj.via&&e(\"th\",\"via\").append(\" result\")),...r.lambda.loops.map((({it:t,pos:n,making:o,whereResult:i,whereReplay:s,viaResult:c,viaReplay:l})=>a(\"<tr>\").append(e(\"td\",ci(n)),e(\"td\",ci(t)),void 0!==o&&e(\"td\",ci(o)),null!=i&&(Se.containsError(i)?a(\"<td>\").append(i.render(r.lambda.obj.source,!0)):e(\"td\",ci(i))).append(s&&a(\"<tw-open-button replay label='🔍'>\").data(\"evalReplay\",s)),null!=c&&(Se.containsError(c)?a(\"<td>\").append(c.render(r.lambda.obj.source,!0)):e(\"td\",ci(c))).append(l&&a(\"<tw-open-button replay label='🔍'>\").data(\"evalReplay\",l)))))))}else r.toDesc||p.find(\".to-code\").append(oi(r.toCode,\"macro\"));p.next().html(r.itIdentifier?`(The <code class=\"cm-harlowe-4-identifier\">it</code> identifier now refers to ${n(r.itIdentifier)}.)`:\"\").next().text(r.reason||\"\")}else d.empty().append(oi(r.code,\"macro\")),p.html(\"<center>First, there was <code></code>.</center>\").next().empty().next().empty();!r.lambda&&p.find(\"code\").first().append(oi(r.fromCode,\"macro\")),o.find(\"mark\").each(((e,t)=>{t.scrollIntoView()})),i.css(\"visibility\",t<=9?\"hidden\":\"visible\"),s.css(\"visibility\",t<=0?\"hidden\":\"visible\"),l.css(\"visibility\",t>=e.length-1?\"hidden\":\"visible\"),u.css(\"visibility\",t>=e.length-10?\"hidden\":\"visible\"),c.html(`( ${t+1}/${e.length} )`)}d(),i.on(\"click\",(()=>{t=Math.max(0,t-10),d()})),s.on(\"click\",(()=>{t=Math.max(0,t-1),d()})),l.on(\"click\",(()=>{t=Math.min(e.length-1,t+1),d()})),u.on(\"click\",(()=>{t=Math.min(e.length-1,t+10),d()})),p.find(\"tw-backdrop\").length?p.find(\"tw-backdrop\").before(r):p.addClass(\"show-dialog\").append(r)}(t);const r=a(e.target).data(\"goto\");if(r){let e=$.options.ignoreGotos;$.options.ignoreGotos=!1,r.command.TwineScript_Run(r.section),$.options.ignoreGotos=e}e.stopPropagation()}))),p.find(\".resizer-h\").mousedown((e=>{if(1!==e.which)return!0;e.stopPropagation();const{pageX:t}=e,n=p.width();i.on(\"mousemove.debugger-resizer-h\",(({pageX:e})=>{p.width((n+t-e|0)+\"px\")})).on(\"mouseup.debugger-resizer-h\",(()=>{i.off(\".debugger-resizer-h\"),c.width=p.width(),l()}))})),p.on(\"mousedown\",\".resizer-v\",(e=>{if(1!==e.which)return!0;e.stopPropagation();const{pageY:t}=e,n=a(e.target.parentNode).height();i.on(\"mousemove.debugger-resizer-v\",(({pageY:e})=>{p.find(\".panel\").css(\"maxHeight\",n+t-(0|e)+\"px\")})).on(\"mouseup.debugger-resizer-v\",(()=>{i.off(\".debugger-resizer-v\"),c.maxHeight=+p.find(\".panel\").css(\"maxHeight\"),l()}))})),h.click((()=>{i.toggleClass(\"debug-mode\").removeClass(\"dom-debug-mode\"),h.toggleClass(\"enabled\"),d.removeClass(\"enabled\")})),d.click((()=>{i.toggleClass(\"dom-debug-mode\").removeClass(\"debug-mode\"),d.toggleClass(\"enabled\"),h.removeClass(\"enabled\")})),f.click((()=>{i.removeClass(\"debug-mode dom-debug-mode\"),p.detach(),Object.assign($.options,{debug:!1,speedMultiplier:1,ignoreClickEvents:!1,ignoreGotos:!1})}));const y=g((()=>{const e=m.children().get(),{timeline:t}=Kt;let n=0;t.forEach((({turns:t=0,passage:r},a)=>{n+=1+t;const o=`${n}: ${r}`;e[a]?e[a].textContent=o:m.append(`<option value='${a}'>${o}</option>`)})),t.length<e.length&&a(e.slice(t.length)).remove(),m[t.length>=1?\"removeAttr\":\"attr\"](\"disabled\"),m.val(Kt.pastLength)}));m.change((({target:e})=>{let{value:t}=e;const n=+t-Kt.pastLength;0!==n&&(Kt[n<0?\"rewind\":\"fastForward\"](Math.abs(n)),Bo.showPassage(Kt.passage))})),y(),Kt.on(\"forward\",y).on(\"load\",y).on(\"forgetUndos\",(()=>y)).on(\"back\",(()=>{Kt.pastLength<=1&&m.attr(\"disabled\"),m.find(\"[selected]\").removeAttr(\"selected\"),m.val(Kt.pastLength)}));const b=e=>{const t=e.parents(\".variable-row, .enchantment-row, .source-row\");t.next(\".panel-row-source\").find(\"td\").empty().append(oi(t.data(\"value\")||ci(t.data(\"enchantment\").changer),t.is(\"source-row\")?\"markup\":\"macro\"))};let v=new Set;const w=Go.create({className:\"variables\",tabName:\"Variable\",rowWrite({name:e,dataset:t,path:r,value:o,tempScope:i,type:s},c){const l=o&&o.length>48&&!o.TwineScript_DebugName,p=si(o)&&\"TwineScript_DebugName\"in o&&\"function\"==typeof o.TwineScript_DebugName?o.TwineScript_DebugName():n(ii(o));let u=\"\";r.length&&(u=r.reduce(((e,t)=>`${e+t}'s `),\"\")),t&&(e=\"???\");const d=s?ci(s):\"\",h=\"object\"==typeof o||l;if(c){c[0].firstChild.innerHTML=d||\"\",u&&a(c[0].firstChild).children(\".variable-path\").html((i?\"_\":\"$\")+n(u)),c[0].childNodes[1].lastChild.textContent=(u?\"\":i?\"_\":\"$\")+n(`${e}`),c[0].childNodes[2].textContent=i||\"\",c[0].childNodes[3].innerHTML=p;const t=a(c[0].lastChild.firstChild),r=t.is(\".open\");t[h?\"show\":\"hide\"]();const s=c.next(\".panel-row-source\");return r&&s.find(\"td\").empty().append(oi(ci(o))),c.data(\"value\",ci(o)),c.add(s)}return c=a('<div class=\"variable-row\">').attr(\"data-name\",e).attr(\"data-path\",`${r}`).attr(\"data-scope\",i||\"\").css(\"padding-left\",`${Math.min(5,r.length)}em`).append(`<td class='variable-type'>${d||\"\"}</td>`,`<td class='variable-name cm-harlowe-4-${i?\"tempV\":\"v\"}ariable'><span class='variable-path'>${u?(i?\"_\":\"$\")+n(u):\"\"}</span> ${u?\"\":i?\"_\":\"$\"}${n(`${e}`)}</td>`,`<td class='temporary-variable-scope'>${i||\"\"}</td>`,`<td class='variable-value cm-harlowe-4-macroName-${li(o)}'>${p}</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:${h?\"visible\":\"none\"}'>(source:) </tw-folddown></td>`).data(\"value\",ci(o)).find(\"tw-folddown\").data(\"folddown\",b).end().add(\"<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>\")},rowCheck:({name:e,path:t,tempScope:n},r)=>r[0]&&r[0].getAttribute(\"data-name\")===e&&r[0].getAttribute(\"data-path\")===`${t}`&&r[0].getAttribute(\"data-scope\")===n,columnHead:()=>'<tr class=\"panel-head\"><th data-col=\"variable-type\">Type</th><th data-col=\"variable-name\">Name</th><th data-col=\"temporary-variable-scope\">Scope</th><th data-col=\"variable-value\">Value</th></tr>',rowSort(e,t,n){if(\"variable-value\"===e)return s(t.attr(\"class\"),n.attr(\"class\"))||s(t.parent().data(\"value\"),n.parent().data(\"value\"))}}),k=g((()=>{const e=[],t=Kt.variables;let n=e.length;function a(t){if(e.length>500)return;e.push(t);const n=t.path.concat(t.name),{value:o,tempScope:i}=t;n.length<=4&&(Array.isArray(o)?o.forEach(((e,t)=>a({name:r(t+1),path:n,value:e,tempScope:i}))):o instanceof Map?[...o].forEach((([e,t])=>a({name:e,path:n,value:t,tempScope:i}))):o instanceof Set&&[...o].forEach(((e,t)=>a({name:t,dataset:!0,path:n,value:e,tempScope:i}))))}for(let e in t)e.startsWith(\"TwineScript\")||(n+=1,a({name:e,path:[],value:t[e],tempScope:\"\",type:t.TwineScript_TypeDefs?.[e]}));e.push(...v),n+=v.size,w.update(e,n),0===n!==w.panel[0].classList.contains(\"panel-variables-empty\")&&w.panel.toggleClass(\"panel-variables-empty\")}));let x;pr.on(\"set\",((e,t,n)=>{if(e!==Kt.variables&&\"temp\"===e.TwineScript_VariableStore?.type&&!e.TwineScript_VariableStore?.name.match(/#\\d+$/)){const r=e.TwineScript_VariableStore?.name,a=e.TwineScript_TypeDefs?.[t],o=[...v].find((e=>e.name===t&&e.tempScope===r));o?o.value=n:v.add({name:t,path:[],value:n,tempScope:r,type:a})}k(),x()})).on(\"delete\",(()=>{k(),x()})),w.panel.append(\"<div class='panel-variables-bottom'>\\n\\t\\t\\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\\n\\t\\t\\t<input class='clipboard' type=\\\"text\\\" style='opacity:0;pointer-events:none;position:absolute;'></input>\\n\\t\\t</div>\").removeAttr(\"hidden\"),w.tab.addClass(\"enabled\");const S=w.panel.find(\".clipboard\");i.on(\"click\",\".panel-variables-copy\",(()=>{let e=[];for(let t in Kt.variables)t.startsWith(\"TwineScript\")||e.push(`$${t} to ${ci(Kt.variables[t])}`);S.val(`(set:${e})`)[0].select(),document.execCommand(\"copy\")}));const E=Go.create({className:\"enchantments\",tabName:\"Enchantment\",rowWrite(e,t){const{scope:r,changer:o,lambda:i,name:s,localHook:c}=e;let l;return l=o?n(ii(o)):i?n(ci(i)):`<em>enchanted with (${s}:)</em>`,t||a('<div class=\"enchantment-row\">').data(\"enchantment\",e).append(`<td><span class='enchantment-name'>${ci(r)}${c?`</span><span class='enchantment-local cm-harlowe-4-hookName'>${\"function\"==typeof c.TwineScript_ToSource?c.TwineScript_ToSource():c.attr(\"name\")?`?${c.attr(\"name\")}`:\"an unnamed hook\"}`:\"\"}</span></td><td class='enchantment-value cm-harlowe-4-macroName-${o?\"changer\":\"command\"} '>${l}</td>${o?\"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>\":\"\"}`).find(\"tw-folddown\").data(\"folddown\",b).end().add(o?a(\"<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>\"):\"\")},rowCheck:(e,t)=>t.data(\"enchantment\")===e,columnHead:()=>'<tr class=\"panel-head\"><th data-col=\"enchantment-name\">Scope</th><th data-col=\"enchantment-value\">Value</th></div>'}),C=g((e=>{E.update(e.enchantments,e.enchantments.length)}));Mo.on(\"add\",C).on(\"remove\",C);const N=Mo.create(),O=Go.create({className:\"storylets\",tabName:\"Storylet\",rowWrite({name:e,active:t,storyletSource:n,exclusive:r,urgent:o},i){if(i)return i.toggleClass(\"storylet-closed\",!t),i[0].firstChild.textContent=t?\"✓\":\"\",i;const s=a(`<tr class=\"storylet-row ${t?\"\":\"storylet-closed\"}\">`).attr(\"data-name\",e).append(`<td class='storylet-open'>${t?\"✓\":\"\"}</td><td class='storylet-name'>${e}</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>${r}</td><td class='storylet-urgent'>${o}</td>`);return s.find(\".storylet-lambda\").append(oi(n.replace(/^when\\s+/i,\"\"))),s},rowCheck:({name:e},t)=>t[0].getAttribute(\"data-name\")===n(`${e}`),columnHead:()=>'<tr class=\"panel-head\"><th data-col=\"storylet-open\" data-order=\"desc\">Open</th><th data-col=\"storylet-name\">Name</th><th data-col=\"storylet-lambda\">Condition</th><th data-col=\"storylet-exclusive\" class=\\'storylet-exclusive\\'>Exclusivity</th><th data-col=\"storylet-urgent\" class=\\'storylet-urgent\\'>Urgency</th></tr>'});O.tab.hide(),x=g((()=>{const e=Re.getStorylets(N),t=Se.containsError(e),n=Re.allStorylets();let r,a;O.update(n.map((n=>{const o=\"number\"==typeof n.get(\"exclusivity\")?n.get(\"exclusivity\"):0,i=\"number\"==typeof n.get(\"urgency\")?n.get(\"urgency\"):0;return r||=o,a||=o,{name:n.get(\"name\"),storyletSource:n.get(\"storylet\").TwineScript_ToSource(),active:!t&&e.some((e=>e.get(\"name\")===n.get(\"name\"))),exclusive:o,urgent:i}})),t?0:e.length),O.panel.toggleClass(\"storylet-error\",t),O.panel.toggleClass(\"panel-exclusive\",r),O.panel.toggleClass(\"panel-urgent\",a),n.length&&O.tab.show()}));const j=Go.create({className:\"source\",tabName:\"Source\",tabNameCounter:!1,rowWrite({name:e,tag:t},n){if(n)return n.add(n.next(\".panel-row-source\"));const r=Re.get(e).get(\"source\");return a(`<div class=\"source-row\" data-tag=\"${t}\">`).data(\"value\",r).append(`<td class=\"source-name\">${e}</td><td class=\"source-tags\">${t}</td><td class='panel-row-buttons'><tw-folddown class='${t?\"\":\"open\"}' tabindex=0></tw-folddown></td>`).find(\"tw-folddown\").data(\"folddown\",b).end().add(a(`<tr class='panel-row-source' style='${t?\"display:none\":\"\"}'><td colspan='3'></td></tr>`).find(\"td\").append(!t&&oi(r,\"markup\")).end())},rowCheck:({name:e},t)=>t[0].firstChild.textContent===n(`${e}`),tabUpdate:a.noop,columnHead:a.noop}),A=[\"debug-startup\",\"startup\",\"header\",\"debug-header\",\"footer\",\"debug-footer\"].reduce(((e,t)=>e.concat(Re.getTagged(t).map((e=>({name:e.get(\"name\"),tag:t}))))),[]),_=Go.create({className:\"errors\",tabName:\"Error\",rowWrite:a.noop,rowCheck:a.noop,columnHead:a.noop,tabUpdate:e=>_.tab.css({background:e?\"rgba(230,101,204,0.3)\":\"\"}).text(`${e} Error${1!==e?\"s\":\"\"}`)}),D=o((e=>{if(!$.options.debug)return;_.panelRows.append(e.reduce(((e,[t,r])=>\"propagated\"===t.type?e:`${e}<tr class=\"error-row\"><td class=\"error-passage\">${Kt.passage}</td><td class=\"error-message\" title=\"${n(r)}\">${t.message}</td></tr>`),\"\"));const t=_.panelRows.children(),r=t.length;r>500&&a(Array.prototype.slice.call(_.panelRows[0].childNodes,0,r-500)).remove(),_.tabUpdate(Math.min(500,t.length))}),{batch:!0});Se.on(D),_.panel.append(\"<div class='panel-errors-bottom'>\\n\\t\\t\\t<button class='panel-errors-clean'>🧹 Clear this panel</button>\\n\\t\\t</div>\"),i.on(\"click\",\".panel-errors-clean\",(()=>{_.panelRows.empty(),_.tabUpdate(0)}));const I=Go.create({className:\"tools\",tabName:\"Tools\",tabNameCounter:!1,rowWrite:({id:e,type:t,label:n,dropdownItems:r,dropdownValue:o},i)=>\"checkbox\"===t?i?i.find(\"input\").prop(\"checked\",!1):a(`<span><input id=\"debug-${e}\" type=\"checkbox\"></input><label for=\"debug-${e}\">${n}</label></span>`):\"dropdown\"===t?i?i.find(\"input\").prop(\"checked\",!1):a(`<span>${n}<select style=\"width:3em\" data-default=\"${o}\" id=\"debug-${e}\"></span>`).find(\"select\").append(r.map((e=>`<option value='${e}' ${e===o?\"selected\":\"\"}>${e}x</option>`))).end():void 0,rowCheck:a.noop,columnHead:a.noop,tabUpdate:e=>I.tab.css({background:e?\"hsla(210, 72%, 65%, .3)\":\"\"})});i.on(\"click, change\",'.panel-tools [type=\"checkbox\"], .panel-tools select',(({target:e})=>{const t=(e=a(e)).attr(\"id\"),n=e.is(\":checked\")||e.is(\"select\")&&e.val()!==+e.attr(\"data-default\");\"debug-peekBehindDialogs\"===t&&i.toggleClass(\"debug-dialogs\",n),\"debug-ignoreClickEvents\"===t&&($.options.ignoreClickEvents=n),\"debug-ignoreGotos\"===t&&($.options.ignoreGotos=n),\"debug-speedMultiplier\"===t&&($.options.speedMultiplier=+e.val()),I.tabUpdate(n)})),I.update([{id:\"peekBehindDialogs\",type:\"checkbox\",label:\"See through and click through <code>(dialog:)</code> boxes\"},{id:\"ignoreClickEvents\",type:\"checkbox\",label:\"Stop links, <code>(click:)</code> and <code>(hover-style:)</code> from activating\"},{id:\"ignoreGotos\",type:\"checkbox\",label:\"Stop <code>(go-to:)</code>, <code>(undo:)</code>, <code>(redirect:)</code> and <code>(restart:)</code> from activating<br><small>(Click 'GO' buttons in Debug View to activate later)</small>\"},{id:\"speedMultiplier\",label:\"Speed of timed events (<code>time</code>, <code>(live:)</code>, <code>(after:)</code>): \",type:\"dropdown\",dropdownValue:1,dropdownItems:[.25,.5,.75,1,1.25,1.5,1.75,2,3,5,10]}]);const P=Go.create({className:\"options\",tabName:\"⚙️\",tabNameCounter:!1,rowWrite:({name:e,label:t},n)=>{const r={darkMode:c.darkMode,fadePanel:c.fadePanel,evalReplay:c.evalReplay}[e];return n?n.find(\"input\").prop(\"checked\",r):a(`<span><input id=\"debug-${e}\" type=\"checkbox\" ${r?\"checked\":\"\"}></input><label for=\"debug-${e}\">${t}</label></span>`)},rowCheck:a.noop,tabUpdate:a.noop,columnHead:a.noop});i.on(\"click\",'.panel-options [type=\"checkbox\"]',(({target:e})=>{const t=(e=a(e)).attr(\"id\"),n=e.is(\":checked\");\"debug-darkMode\"===t&&(c.darkMode=n,p.toggleClass(\"theme-dark\",n)),\"debug-fadePanel\"===t&&(c.fadePanel=n,p.toggleClass(\"fade-panel\",n)),\"debug-evalReplay\"===t&&($.options.evalReplay=c.evalReplay=n),l()})),P.update([{name:\"darkMode\",label:\"Debug panel is dark\"},{name:\"fadePanel\",label:\"Debug panel is transparent unless the cursor is over it\"},{name:\"evalReplay\",label:\"Record expression replays (viewable via 🔍 buttons in Debug View; slower)\"}]),p.prepend(w.panel,E.panel,_.panel,O.panel,j.panel,I.panel,P.panel),u.prepend(w.tab,E.tab,_.tab,O.tab,j.tab,I.tab,P.tab);const R=()=>v=new Set;Kt.on(\"beforeForward\",R).on(\"beforeBack\",R).on(\"beforeLoad\",R);const M=g((()=>{k(),x(),E.panelRows.empty(),E.tabUpdate(0),Kt.passage&&Re.get(Kt.passage)&&(j.update(A.concat({name:Kt.passage,tag:\"\"})),j.panel.find('[data-tag=\"\"], [data-tag=\"\"] + .panel-row-source').insertBefore(j.panel.find('[data-tag=\"footer\"]').first()))}));Kt.on(\"forward\",M).on(\"back\",M).on(\"load\",M);const V=()=>{a(document.body).append(p),$.options.debug=!0,$.options.evalReplay=c.evalReplay,$.options.speedMultiplier=1,$.options.ignoreClickEvents=!1,$.options.ignoreGotos=!1,M()};ui=V,a(document.head).append(a(\"<style>\").html(ti)),V(),e&&D(e,t)};Bo.registerDebugMode(((e,t)=>!$.options.debug&&ui(e,t)));var di=ui;const{realWhitespace:hi,nth:fi,anyRealLetter:mi,plural:gi}=$,{subset:yi,objectName:bi,clone:vi,toSource:wi}=wt,{hasOwn:ki}=Object,{rest:xi,zeroOrMore:$i,either:Ti,optional:Si,insensitiveSet:Ei,numberRange:Ci,percent:Ni,nonNegativeInteger:Oi,positiveInteger:ji,Any:Ai}=Pa.TypeSignature,{max:_i,min:Di,round:Ii,floor:Pi,ceil:Ri}=Math;function Mi(e){return(...t)=>{const n=e(...t);return\"number\"!=typeof n||isNaN(n)?Se.create(\"macrocall\",\"This mathematical expression doesn't compute!\"):n}}Pa.add([\"str\",\"string\",\"text\"],\"String\",((e,...t)=>t.map((e=>e instanceof kr?e.source:e)).join(\"\")),[$i(Pa.TypeSignature.either(String,Number,Boolean,Array,kr))])(\"source\",\"String\",((e,t)=>wi(t)),[Ai])(\"substring\",\"String\",((e,t,n,r)=>yi(t,n,r)),[String,parseInt,parseInt])(\"lowercase\",\"String\",((e,t)=>t.toLowerCase()),[String])(\"uppercase\",\"String\",((e,t)=>t.toUpperCase()),[String])(\"lowerfirst\",\"String\",((e,t)=>t.replace(RegExp(`${mi}+`),(e=>(e=Array.from(e))[0].toLowerCase()+e.slice(1).join(\"\").toLowerCase()))),[String])(\"upperfirst\",\"String\",((e,t)=>t.replace(RegExp(`${mi}+`),(e=>(e=Array.from(e))[0].toUpperCase()+e.slice(1).join(\"\").toLowerCase()))),[String])(\"words\",\"Array\",((e,t)=>t.split(RegExp(`${hi}+`)).filter(Boolean)),[String])([\"str-repeated\",\"string-repeated\"],\"String\",((e,t,n)=>0===n.length?Se.create(\"macrocall\",\"I can't repeat an empty string.\"):n.repeat(t)),[Oi,String])([\"str-reversed\",\"string-reversed\"],\"String\",((e,t)=>[...t].reverse().join(\"\")),[String])(\"joined\",\"String\",((e,t,...n)=>n.join(t)),[xi(String)])(\"plural\",\"String\",((e,t,n,r)=>n&&\"\"!==r?gi(t,n,r):Se.create(\"macrocall\",\"The (plural:) macro can't be given empty strings.\")),[parseInt,String,Si(String)])([\"str-nth\",\"string-nth\"],\"String\",((e,t)=>fi(t)),[parseInt])(\"digit-format\",\"String\",((e,t,n)=>{if(Math.abs(n)>=1e21)return Se.create(\"macrocall\",\"The number given to (digit-format:) is too big.\");const r=/([^#0])(?=[#0]*$)/g,a=(r.exec(t)||[])[1],o=(/^[#0]*([^#0])/g.exec(t)||[])[1];let i=(t=[...t]).length;a&&(\",\"!==a||o&&\",\"!==o)&&(i=r.lastIndex-1);let s=Math.abs(n).toFixed(16).replace(/(\\.\\d*?)0+$/,((e,t)=>t)).replace(/^0+/,\"\"),c=s.includes(\".\")?s.indexOf(\".\"):s.length,l=0,p=\"\";for(let e=t.length-1;e>=0;e-=1){const n=t[e];if(\"0\"===n||\"#\"===n){const t=s[c-i+e+l];p=(t||(\"0\"===n?\"0\":\"\"))+p}else e<t.length-1&&e>0&&(p=n+p,l+=e===i?0:1)}return(n<0?\"-\":\"\")+p}),[String,Number])([\"num\",\"number\"],\"Number\",((e,t)=>Number.isNaN(+t)?Se.create(\"macrocall\",`I couldn't convert ${bi(t)} to a number.`):+t),[String])(\"datatype\",\"Datatype\",((e,t)=>dn.from(t)),[Ai])(\"datapattern\",\"Any\",((e,t)=>function e(t){let n,r;return Array.isArray(t)?n=t.map(e):t instanceof Map?(n=new Map,[...t].forEach((([t,r])=>n.set(t,e(r))))):n=dn.from(t),(r=Se.containsError(n))?r:n}(t)),[Ai])([\"rgb\",\"rgba\"],\"Colour\",((e,...t)=>new Gr({r:t[0],g:t[1],b:t[2],a:t[3]})),[Ci(0,255),Ci(0,255),Ci(0,255),Si(Ni)])([\"hsl\",\"hsla\"],\"Colour\",((e,t,n,r,a)=>((t=Ii(t)%360)<0&&(t+=360),new Gr({h:t,s:n,l:r,a}))),[Number,Ni,Ni,Si(Ni)])([\"lch\",\"lcha\"],\"Colour\",((e,t,n,r,a)=>((r=Ii(r)%360)<0&&(r+=360),new Gr({l:t,c:n,h:r,a}))),[Ni,Ci(0,132),Number,Si(Ni)])(\"complement\",\"Colour\",((e,t)=>t.LCHRotate(180)),[Gr])(\"mix\",\"Colour\",((e,t,n,r,a)=>{n=n.toLCHA(),a=a.toLCHA();let o=1;t+r!==1&&(t+r<1&&(o=t+r),[t,r]=[t/(t+r),r/(t+r)]),n.c<2||n.l<.01||n.l>.99?n.h=a.h:(a.c<2||a.l<.01||a.l>.99)&&(a.h=n.h),n.l*=n.a,n.c*=n.a,a.l*=a.a,a.c*=a.a,a.h-n.h>180?n.h+=360:a.h-n.h<-180&&(a.h+=360);let i=n.a*t+a.a*r,s=(n.l*t+a.l*r)/i,c=(n.c*t+a.c*r)/i,l=(n.h*t+a.h*r)/i;return new Gr({l:s,c,h:l,a:i*o})}),[Ni,Gr,Ni,Gr])(\"palette\",\"Array\",((e,t,n)=>{const{l:r,h:a}=n.toLCHA(),o={l:r<=.75?.75+r/3:.75-3*(1-r),c:80,h:a,a:1};let i,s,c;return i=new Gr(o),o.l+=r<=.75?-.1:.1,o.l<.5&&(o.l*=.5/o.l),s=new Gr(o),o.l+=r<=.85?.15:-.15,c=new Gr(o),\"adjacent\"===t?(i=i.LCHRotate(-30),s=i.LCHRotate(30),c=i.LCHRotate(60)):\"triad\"===t&&(c=i.LCHRotate(180),s=i.LCHRotate(140),i=i.LCHRotate(-140)),[n,i,s,c]}),[Ei(\"mono\",\"adjacent\",\"triad\"),Gr])(\"gradient\",\"Gradient\",((e,t,...n)=>{if((t=Ii(t)%360)<0&&(t+=360),n.length<4)return Se.create(\"datatype\",\"(gradient:) must be given at least 2 colour-stop pairs of numbers and colours.\");let r;const a=[],o=n.reduce(((e,t)=>{if(Se.containsError(e))return e;if(void 0===r)r=t;else{if(!(\"number\"==typeof r&&t instanceof Gr))return Se.create(\"datatype\",\"(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.\");a.push({stop:r,colour:vi(t)}),r=void 0}return e}),!0);return Se.containsError(o)?o:void 0!==r?Se.create(\"macrocall\",\"This gradient has a colour-stop percent without a colour.\"):new ca(t,a)}),[Number,xi(Ti(Ni,Gr))])(\"stripes\",\"Gradient\",((e,t,n,...r)=>{(t=Ii(t)%360)<0&&(t+=360);let a=0;const o=[];return r.forEach((e=>{o.push({stop:a,colour:vi(e)}),a+=n,o.push({stop:a,colour:vi(e)})})),new ca(t,o,!0)}),[Number,ji,Gr,xi(Gr)])(\"hooks-named\",\"HookName\",((e,t)=>t?new jn({type:\"name\",data:t}):Se.create(\"datatype\",\"(hooks-named:) can't be given an empty string.\")),[String])(\"cond\",\"Any\",((e,...t)=>{for(let e=0;e<t.length;e+=2){const n=t[e];if(e===t.length-1||Se.containsError(n))return n;if(\"boolean\"!=typeof n)return Se.create(\"datatype\",`(cond:)'s ${fi(e+1)} value is ${bi(n)}, but should be a boolean.`);if(n)return t[e+1]}return Se.create(\"macrocall\",`An odd number of values must be given to (cond:), not ${t.length}`,\"(cond:) must be given one or more pairs of booleans and values, as well as one final value.\")}),[Boolean,Ai,xi(Ai)]);const Vi=e=>(t,...n)=>e(...n);({weekday:[()=>`${[\"Sun\",\"Mon\",\"Tues\",\"Wednes\",\"Thurs\",\"Fri\",\"Satur\"][(new Date).getDay()]}day`,null],monthday:[()=>(new Date).getDate(),null],currenttime:[()=>{const e=new Date,t=e.getHours()<12;return`${e.getHours()%12||12}:${(e.getMinutes()<10?\"0\":\"\")+e.getMinutes()} ${t?\"A\":\"P\"}M`},null],currentdate:[()=>(new Date).toDateString(),null],min:[Di,xi(Number)],max:[_i,xi(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[Pi,Number],round:[Ii,Number],trunc:[e=>e>0?Pi(e):Ri(e),Number],ceil:[Ri,Number],pow:[Mi(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[Mi(Math.sqrt),Number],log:[Mi(Math.log),Number],log10:[Mi(Math.log10),Number],log2:[Mi(Math.log2),Number],random:[(e,t)=>{let n,r;return t?(n=Di(e,t),r=_i(e,t)):(n=0,r=e),r+=1,~~(Kt.random()*(r-n))+n},[parseInt,Pa.TypeSignature.optional(parseInt)]],\"\"(){for(let e in this)e&&ki(this,e)&&Pa.add(e,\"Number\",Vi(this[e][0]),this[e][1])}})[\"\"](),Pa.add(\"either\",\"Any\",((e,...t)=>t[~~(Kt.random()*t.length)]),xi(Ai))(\"nth\",\"Any\",((e,t,...n)=>t<=0?Se.create(\"datatype\",`(nth:)'s first value should be a positive whole number, not ${t}`):n[(t-1)%n.length]),[parseInt,xi(Ai)]);const{printBuiltinValue:Li,objectName:Fi,clone:Hi,toSource:qi}=wt,{dialog:zi,geomParse:Wi,geomStringRegExp:Bi}=$n,{Any:Ui,Everything:Gi,rest:Xi,either:Yi,optional:Ji,zeroOrMore:Ki,percent:Qi,nonNegativeInteger:Zi,positiveInteger:es,positiveNumber:ts}=Pa.TypeSignature,{assign:ns}=Object,{floor:rs,ceil:as,abs:os,max:is,min:ss}=Math,{noop:cs}=a;function ls(e){return`(${e} ${$.options.ifid}) `}[\"set\",\"put\",\"unpack\"].forEach((e=>Pa.add(e,\"Instant\",((t,...n)=>{for(let t=0;t<n.length;t+=1){const r=n[t];if(\"into\"===r.operator&&\"set\"===e)return Se.create(\"macrocall\",\"Please say 'to' when using the (set:) macro.\");if(\"to\"===r.operator&&\"set\"!==e)return Se.create(\"macrocall\",\"Please say 'into' when using the (put:) or (unpack:) macro.\");if((pr.isPrototypeOf(r.dest)||r.dest instanceof an)===(\"unpack\"===e))return Se.create(\"macrocall\",\"unpack\"===e?\"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.\":`Please use the (${e}:) macro with just single variables and typed variables to the ${\"set\"===e?\"left of 'to'.\":\"right of 'into'.\"}`,`You may wish to change this to the (${\"unpack\"!==e?\"unpack\":\"to\"===r.operator?\"set\":\"put\"}:) macro.`);const a=r.set();if(Se.containsError(a))return a}return{TwineScript_TypeID:\"instant\",TwineScript_TypeName:`a (${e}:) operation`,TwineScript_ObjectName:`a (${e}:) operation`,TwineScript_Unstorable:!0,TwineScript_Print:()=>($.options.debug,\"\")}}),[Xi(mr)]))),Pa.add(\"move\",\"Instant\",((e,...t)=>{for(let e=0;e<t.length;e+=1){const n=t[e];if(\"into\"!==n.operator)return Se.create(\"macrocall\",\"Please say 'into' when using the (move:) macro.\");const r=n.set(!0);if(Se.containsError(r))return r}return{TwineScript_TypeID:\"instant\",TwineScript_TypeName:\"a (move:) operation\",TwineScript_ObjectName:\"a (move:) operation\",TwineScript_Unstorable:!0,TwineScript_Print:()=>($.options.debug,\"\")}}),[Xi(mr)]),Pa.addCommand(\"display\",(e=>{if(!Re.hasValid(e))return Se.create(\"macrocall\",`I can't (display:) the passage '${e}' because it doesn't exist.`)}),((e,t,n)=>(e.source=Re.getTree(n),e)),[String])(\"print\",cs,((e,t,n)=>ns(e,{source:Li(n)})),[Ui])([\"verbatim-print\",\"v6m-print\"],cs,((e,t,n)=>ns(e,{verbatim:!0,source:Li(n)})),[Ui])([\"verbatim-source\",\"v6m-source\"],(()=>{}),((e,t,n)=>ns(e,{verbatim:!0,source:Li(qi(n))})),[Ui])(\"go-to\",(e=>{if(!Re.hasValid(e))return Se.create(\"macrocall\",`I can't (go-to:) to the passage '${e}' because it doesn't exist.`,\"Check that you didn't mistype the passage name, or rename the passage to something else.\")}),((e,t,n)=>{if(!$.options.ignoreGotos)return requestAnimationFrame((()=>Bo.goToPassage(n,{transition:e.data.passageT8n}))),{blocked:!0}}),[String])(\"redirect\",(e=>{if(!Re.hasValid(e))return Se.create(\"macrocall\",`I can't (redirect:) to the passage '${e}' because it doesn't exist.`,\"Check that you didn't mistype the passage name, or rename the passage to something else.\")}),((e,t,n)=>{if(!$.options.ignoreGotos)return requestAnimationFrame((()=>Bo.redirect(n,{transition:e.data.passageT8n}))),{blocked:!0}}),[String])(\"undo\",cs,((e,t,n)=>Kt.pastLength<1?ns(e,{source:n}):$.options.ignoreGotos?void 0:(requestAnimationFrame((()=>Bo.goBack({transition:e.data.passageT8n}))),{blocked:!0})),[Ji(String)])(\"debug\",cs,Bo.enableDebugMode,[],!1),$.onStartup((()=>$.storyElement.on(\"click.icon\",\"tw-icon\",(function(e){const t=a(this),n=t.data(\"clickEvent\"),r=t.attr(\"alt\");n&&n(t),\"Undo\"===r&&(e.stopPropagation(),Bo.goBack()),\"Redo\"===r&&(e.stopPropagation(),Bo.goForward()),\"Fullscreen\"===r&&(e.stopPropagation(),Bo.toggleFullscreen()),\"Restart\"===r&&(Kt.hasSessionStorage&&sessionStorage.removeItem(\"Saved Session\"),window.location.reload())})))),[[\"Undo\",\"&#8630;\",()=>Kt.pastLength>0],[\"Redo\",\"&#8631;\",()=>Kt.futureLength>0],[\"Fullscreen\",\"&#9974;\",()=>document.fullscreenEnabled],[\"Restart\",\"&#10226;\",Object]].forEach((([e,t,n])=>{Pa.addCommand(`icon-${e.toLowerCase()}`,((t,n)=>{if(\"string\"==typeof t&&\"string\"==typeof n){const r=[...t].length,a=[...n].length;if(r>1&&a>1)return Se.create(\"datatype\",`One of the two strings given to (icon-${e.toLowerCase()}:) should be 1 character long, for its icon.`);if(1===r&&1===a)return Se.create(\"datatype\",`One of the two strings given to (icon-${e.toLowerCase()}:) should be 2 or more characters long, for its label.`)}}),((r,o,i,s)=>((\"string\"==typeof s&&1===[...s].length||\"string\"==typeof i&&[...i].length>1)&&([i,s]=[s,i]),\"Undo\"===e&&(r.data.forgetUndosEvent=e=>{r.section.whenUnblocked((()=>a(e).css(\"visibility\",\"hidden\")))}),ns(r,{source:`<tw-icon tabindex=0 alt=\"${e}\" ${s?`data-label=\"${s.replace('\"',\"&quot;\")}\"`:\"\"} title=\"${e}\" ${n()?\"\":'style=\"visibility:hidden\"'}>${i||t}</tw-icon>`}))),[Ji(String),Ji(String)])})),Pa.addCommand(\"icon-counter\",((e,t,n)=>{const r=\" label string given to (icon-counter:) can't be empty or only whitespace.\";return t&&t.trim()?\"string\"!=typeof n||n.trim()?void 0:Se.create(\"datatype\",`The 2nd ${r}`):Se.create(\"datatype\",`The 1st ${r}`)}),((e,t,n,r,a)=>{e.attr.push({\"data-2bind\":!0}),e.data.twoWayBindEvent=(t,o,i)=>{if(n.varRef.matches(o,i)){const t=n.varRef.get();if(\"number\"==typeof t){e.target.children(\"tw-icon\").text(t>0?rs(t):as(t)).attr(\"data-label\",1!==os(t)&&void 0!==a?a:r)}}};const o=n.varRef.get();return\"number\"!=typeof o?Se.create(\"datatype\",`(icon-counter:) can only be bound to a variable holding a number, not ${Fi(o)}.`):ns(e,{source:`<tw-icon data-label=\"${$.escape(1!==os(o)&&void 0!==a?a:r)}\">${o>0?rs(o):as(o)}</tw-icon>`})}),[ha,String,Ji(String)]),Pa.addCommand(\"meter\",((e,t,n,r)=>\"two way\"===e.bind?Se.create(\"datatype\",\"(meter:) shouldn't be given two-way bound variables.\",'Change the \"2bind\" keyword to just \"bind\".'):\"string\"!=typeof r||r.trim()?-1===n.search(Bi)||!n.includes(\"=\")&&n.length>1?Se.create(\"datatype\",`The (meter:) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not ${JSON.stringify(n)}.`):void 0:Se.create(\"datatype\",\"The label string given to (meter:) can't be empty or only whitespace.\")),((e,t,n,r,a,o,i)=>{o&&\"string\"!=typeof o&&(i=o,o=void 0),i||(i=new Gr({h:0,s:0,l:.5,a:.5})),i instanceof Gr&&(i=new ca(90,[{colour:i,stop:0},{colour:i,stop:1}]));const{marginLeft:s,size:c}=Wi(a),l=s>0&&Math.ceil(s+c)<100,p=e=>{const t=is(0,ss(1,e/r)),n=i.repeating?i:i.multiply(r/e);return`height:100%;background-repeat:no-repeat;background-image:${(l?`${ns(n,n.repeating?{}:{angle:270}).toLinearGradientString()}, `:\"\")+ns(n,n.repeating?{}:{angle:l||0===s?90:270}).toLinearGradientString()};background-size:${l?Array(2).fill(50*t+\"%\"):100*t+\"%\"};background-position-x:${l?`${-100/(2-t)+100}%,${100/(2-t)}%`:0===s?\"left\":\"right\"};text-align:${l?\"center\":0===s?\"left\":\"right\"}`};e.styles.push({\"margin-left\":`${s}%`,width:`${c}%`,height:\"1.5em\",display:\"block\"}),e.attr.push({\"data-2bind\":!0});const u=o&&t.stackTop.tempVariables;e.data.twoWayBindEvent=(t,r,a)=>{if(n.varRef.matches(r,a)){const t=n.varRef.get();if(\"number\"==typeof t){const n=e.target.children(\"tw-meter\");n.attr(\"style\",p(t)),o&&e.section.renderInto(\"\",null,{source:o,target:n,append:\"replace\",transitionDeferred:!1},u)}}};let d=n.varRef.get();return\"number\"!=typeof d?Se.create(\"datatype\",`(meter:) can only be bound to a variable holding a number, not ${Fi(d)}.`):ns(e,{source:`<tw-meter style=\"${p(d)}\">${o||\"\"}</tw-meter>`})}),[ha,ts,String,Ji(Yi(String,Gr,ca)),Ji(Yi(Gr,ca))]),[[\"cycling-link\"],[\"seq-link\",\"sequence-link\"]].forEach(((e,t)=>Pa.addCommand(e,((...n)=>\"\"===n[0]?Se.create(\"datatype\",`The first string in a (${e[0]}:) can't be empty.`):n.length<=(ha.isPrototypeOf(n[0])?2:1)?Se.create(\"datatype\",`I need two or more strings to ${t?\"sequence\":\"cycle\"} through, not just '${n[n.length-1]}'.`):void 0),((e,n,...r)=>{let a;ha.isPrototypeOf(r[0])&&(a=r.shift());let o=0;if(\"two way\"===a?.bind){e.attr.push({\"data-2bind\":!0});const t=r.indexOf(a.varRef.get());t>-1&&(o=t)}const{tempVariables:i}=n.stackTop;function s(n,s){const c=o>=r.length-1&&t;let l=\"\"===r[o]?\"\":c?r[o]:`<tw-link>${r[o]}</tw-link>`;if(c&&(e.data.clickEvent=void 0),a&&!s){const e=a.set(r[o]);if(Se.containsError(e))return void n.replaceWith(e.render(r[o]))}const p={...e,source:l,transitionDeferred:!1};e.section.renderInto(\"\",null,p,i)}r[o]&&(e.data.clickEvent=e=>{o=(o+1)%r.length,s(e,!1)})&&(e.data.twoWayBindEvent=(e,t,n)=>{if(a.varRef.matches(t,n)){const t=a.varRef.get(),n=r.indexOf(t);n>-1&&n!==o&&(o=n,s(e,!0))}});let c=`<tw-link>${r[o]}</tw-link>`;if(a){const e=a.set(r[o]);if(Se.containsError(e))return e}return ns(e,{source:c,append:\"replace\",transitionDeferred:!0})}),[Yi(ha,String),Xi(String)]))),$.onStartup((()=>$.storyElement.on(\"change.dropdown-macro\",\"select\",(function(){const e=a(this),t=e.closest(\"tw-expression, tw-hook\").data(\"dropdownEvent\");t&&t(e)})))),Pa.addCommand(\"dropdown\",((e,...t)=>\"\"===t[0]||\"\"===t[t.length-1]?Se.create(\"datatype\",\"The first or last strings in a (dropdown:) can't be empty.\",\"Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense.\"):t.length<=1?Se.create(\"datatype\",`I need two or more strings to create a (dropdown:) menu, not just ${t.length}.`):void 0),((e,t,n,...r)=>{let o=0;if(\"two way\"===n.bind){e.attr.push({\"data-2bind\":!0});const t=r.indexOf(n.varRef.get());t>-1&&(o=t)}const i=Math.max(...r.map((e=>[...e].length)));let s=`<select>${r.map(((e,t)=>`<option${t===o?\" selected\":\"\"}${\"\"===e?\" disabled\":\"\"}>${$.escape(e||\"─\".repeat(i))}</option>`)).join(\"\\n\")}</select>`;e.data.dropdownEvent=e=>{const t=e.val(),r=n.set(t);Se.containsError(r)&&e.replaceWith(r.render(t))},e.data.twoWayBindEvent=(e,t,a)=>{if(n.varRef.matches(t,a)){const t=n.varRef.get(),a=r.indexOf(t);a>-1&&a!==o&&(e.find(\"select\").val(t),o=a)}},e.styles.push({\"background-color\"(){return $.parentColours(a(this)).backgroundColour}});const c=n.set(r[o]);return Se.containsError(c)?c:ns(e,{source:s,append:\"replace\"})}),[ha,String,Xi(String)]),$.onStartup((()=>$.storyElement.on(\"input.checkbox-macro\",\"input[type=checkbox]\",(function(){const e=a(this),t=e.closest(\"tw-expression\").data(\"checkboxEvent\");t&&t(e)}))));let ps=1;Pa.addCommand(\"checkbox\",(()=>{}),((e,t,n,r)=>{let a=!1,o=\"checkbox-\"+ ++ps;if(\"two way\"===n.bind){e.attr.push({\"data-2bind\":!0});const t=n.varRef.get();\"boolean\"==typeof t&&(a=t),e.data.twoWayBindEvent=(e,t,r)=>{if(n.varRef.matches(t,r)){const t=n.varRef.get();\"boolean\"==typeof t&&e.children(\"input[type=checkbox]\").prop(\"checked\",t)}}}e.data.checkboxEvent=e=>{const t=e.is(\":checked\"),r=n.set(t);Se.containsError(r)&&e.replaceWith(r.render(\"\"))};const i=n.set(a);return Se.containsError(i)?i:ns(e,{source:`<input id=\"${o}\" type=\"checkbox\" ${a?\"checked\":\"\"}><label for=\"${o}\">${r}</label>`,append:\"replace\"})}),[ha,String]),$.onStartup((()=>a(document).on(\"fullscreenchange\",(()=>{a(\"input[type=checkbox][id^=fullscreen]\",$.storyElement).each(((e,t)=>{(a(t).closest(\"tw-expression\").data(\"fullscreenEvent\")||Object)(t)}))})))),Pa.addCommand(\"checkbox-fullscreen\",(()=>{}),((e,t,n)=>{let r=\"fullscreenCheckbox-\"+ ++ps;return e.data.fullscreenEvent=e=>a(e).prop(\"checked\",!!document.fullscreenElement),e.data.checkboxEvent=()=>Bo.toggleFullscreen(),ns(e,{source:`<input id=\"${r}\" type=\"checkbox\" ${document.fullscreenEnabled?\" \":\"disabled \"}${document.fullscreenElement?\"checked\":\"\"}><label for=\"${r}\">${n}</label>`,append:\"replace\"})}),[String]),$.onStartup((()=>$.storyElement.on(\"input.input-box-macro\",\"textarea, input[type=text]\",(function(){const e=a(this),t=e.closest(\"tw-expression\").data(\"inputBoxEvent\");t&&t(e)})))),[\"input\",\"force-input\",\"input-box\",\"force-input-box\"].forEach((e=>Pa.addCommand(e,((...t)=>{const n=e.endsWith(\"box\"),r=ha.isPrototypeOf(t[0]),a=\"string\"==typeof t[+r],o=n&&\"number\"==typeof t[+a+ +r],i=a?t[+r]:t[+r+ +o],s=Wi(i).size>0,c=s?t[+r+ +o+ +a]:i;if(e.startsWith(\"force\")&&\"string\"!=typeof c)return Se.create(\"datatype\",`The (${e}:) macro requires a string of text to forcibly input.`);const l=+r+ +o+ +s+ +(\"string\"==typeof c);return t.length>l?Se.create(\"datatype\",`An incorrect combination of values was given to this (${e}:) macro.`):void 0}),((t,n,...r)=>{const a=e.startsWith(\"force\"),o=e.endsWith(\"box\"),i=ha.isPrototypeOf(r[0]),s=\"string\"==typeof r[+i],c=o&&\"number\"==typeof r[+s+ +i],l=i&&r[0],p=c?r[+i+1]:3,{marginLeft:u=0,size:d=0}=s?Wi(r[+i]):{},h=(d?r[+i+ +c+ +s]:+s&&r[+i])||\"\";let f=a?\"\":h,m=!1;if(\"two way\"===l.bind){t.attr.push({\"data-2bind\":!0});const e=l.varRef.get();if(\"string\"==typeof e){f=a?h.slice(0,e.length):e;const t=l.set(f);if(m=!0,Se.containsError(t))return t}t.data.twoWayBindEvent=(e,t,n)=>{if(l.varRef.matches(t,n)){const t=l.varRef.get();\"string\"==typeof t&&e.find(o?\"textarea\":\"input\").val(a?h.slice(0,t.length):t)}}}if(l&&!m){const e=l.set(a?\"\":h);if(Se.containsError(e))return e}!a&&l&&(t.data.inputBoxEvent=e=>{const t=e.val(),n=l.set(t);Se.containsError(n)&&e.replaceWith(n.render(\"\"))});let g=`<${o?\"textarea\":\"input type=text\"} style=\"width:100%\" ${o?`rows=${p}>`:'value=\"'}${$.escape(f)}${o?\"</textarea>\":'\">'}`;if(a){const e=Array.from(h);t.data.inputBoxEvent=t=>{const{length:n}=t.val(),r=e.slice(0,n).join(\"\");if(t.val(r),l){const e=l.set(r);Se.containsError(e)&&t.replaceWith(e.render(\"\"))}return!0}}return t.styles.push({display:\"block\",\"margin-left\":d?`${u}%`:void 0,width:d?`${d}%`:\"100%\",\"border-style\"(){return this.style.borderStyle||\"solid\"}}),ns(t,{source:g,append:\"replace\"})}),e.endsWith(\"box\")?[Yi(ha,String),Ji(Yi(es,String)),Ji(Yi(es,String)),Ji(String)]:[Ji(Yi(ha,String)),Ji(String),Ji(String)]))),[\"show\",\"rerun\"].forEach((e=>Pa.addCommand(e,((...e)=>{let t;return e.some((function e({selector:n,next:r}){return\"name\"===n.type&&\"page\"===n.data?(t=Se.create(\"macrocall\",\"You can't (hide:) the ?page. Sorry.\"),!0):!!(\"base\"===n.type&&e(n.data)||r&&e(r))||void 0})),t}),((t,n,...r)=>(r.forEach((r=>r.forEach(n,(r=>{const o=r.data(\"hidden\");if(void 0!==o!=(\"rerun\"===e))if(r.removeData(\"hidden\"),o instanceof a)r.empty().append(o);else{const e=r.data(\"tempVariables\"),a=\"tw-passage\"===r.tag(),o=a?Re.getTree(Kt.passage):r.data(\"originalSource\")||\"\";let i;a&&(i=r.find(\"tw-sidebar\").detach()),n.renderInto(\"\",null,{...t,append:\"replace\",source:o,target:r},e&&Object.create(e)),i&&r.prepend(i)}})))),t)),[Xi(jn)])));const us=e=>[`I can't use a dialog macro in ${e}.`,\"Please rewrite this without putting such macros here.\"];Pa.addCommand(\"hide\",((...e)=>{let t;return e.some((function e({selector:n,next:r}){return\"name\"===n.type&&\"page\"===n.data?(t=Se.create(\"macrocall\",\"You can't (hide:) the ?page. Sorry.\"),!0):!!(\"base\"===n.type&&e(n.data)||r&&e(r))||void 0})),t}),((e,...t)=>{for(let n of t)n.forEach(e,(e=>{e.data(\"hidden\")||e.data(\"hidden\",e.contents().detach())}))}),[Xi(jn)],!1)(\"scroll\",cs,((e,t,n)=>{const r=\"number\"==typeof n&&n;requestAnimationFrame((()=>{t.forEach(e,(t=>{if(!1!==r)t[0]===$.storyElement[0]&&t[0].scrollHeight===t[0].clientHeight&&(t=[document.body]),t[0].scrollTo?.(0,(t[0].scrollHeight-t[0].clientHeight)*r);else for(let r of n.hooks(e).get())if(t.find(r)){const e=[];let n=t[0];for(;(n=n.parentNode)&&n!==document.body;)e.push([n,n.scrollLeft,n.scrollTop]);r.scrollIntoView();for(let[t,n,r]of e)t.scrollLeft=n,t.scrollTop=r;break}}))}))}),[jn,Yi(Qi,jn)],!1)(\"stop\",cs,cs,[],!1)(\"load-game\",cs,((e,t)=>{if(e.loadedGame)return Se.create(\"infinite\",\"I can't use (load-game:) immediately after loading a game.\");const n=localStorage.getItem(ls(\"Saved Game\")+t);if(!n)return Se.create(\"saving\",`I can't find a save slot named '${t}'!`);const r=Kt.deserialise(e,n);if(r instanceof Error){const n=zi({message:`Sorry to interrupt... The story tried to load saved data, but there was a problem.\\n${r.message}\\n\\nThat data might have been saved from a different version of this story. Should I delete it?\\n(Type 'delete' and choose Yes to delete it.)\\n\\nEither way, the story will now continue without loading the data.`,defaultValue:\"\",buttons:[{name:\"Yes\",confirm:!0,callback:()=>{\"delete\"===n.find(\"input\").last().val()&&localStorage.removeItem(ls(\"Saved Game\")+t),e.unblock(\"\")}},{name:\"No\",confirm:!1,callback:()=>e.unblock()}]});return{blocked:n}}requestAnimationFrame(Bo.showPassage.bind(Bo,Kt.passage,{loadedGame:!0}))}),[String],!1)(\"forget-undos\",cs,((e,t)=>{Kt.futureLength||Kt.forgetUndos(t)}),[parseInt],!1)(\"forget-visits\",cs,((e,t)=>{Kt.forgetVisits(t)}),[parseInt],!1)(\"mock-visits\",((...e)=>{if(!$.options.debug)return Se.create(\"debugonly\",\"(mock-visits:) cannot be used outside of debug mode.\");const t=e.find((e=>!Re.hasValid(e)));return t?Se.create(\"datatype\",`I can't mock-visit '${t}' because no passage with that name exists.`):void 0}),((e,...t)=>{Kt.mockVisits=Hi(t)}),[Xi(String)],!1)(\"mock-turns\",(()=>{if(!$.options.debug)return Se.create(\"debugonly\",\"(mock-turns:) cannot be used outside of debug mode.\")}),((e,t)=>{Kt.mockTurns=t}),[Zi],!1)(\"seed\",cs,((e,t)=>{Kt.setSeed(t)}),[String],!1)([\"dialog\",\"alert\"],((e,t,...n)=>{if(ha.isPrototypeOf(e)){if(\"two way\"===e.bind)return Se.create(\"datatype\",\"(dialog:) shouldn't be given two-way bound variables.\",'Change the \"2bind\" keyword to just \"bind\".');if(void 0===t)return Se.create(\"datatype\",\"(dialog:) needs a message string or codehook to display.\")}else void 0!==t&&n.unshift(t);const r=n.findIndex((e=>\"\"===e));if(r>-1)return Se.create(\"datatype\",`(dialog:)'s ${$.nth(r+1)} link text shouldn't be an empty string.`)}),((e,t,n,r,...a)=>{ha.isPrototypeOf(n)||(void 0!==r&&a.unshift(r),r=n,n=void 0),a.length||(a=[\"OK\"]);return{blocked:zi({section:t,message:r,cd:e,buttons:a.map((e=>({name:e,callback(){t.unblock(n?.set(e)||\"\")}})))})}}),[Yi(ha,String,kr),Ji(Yi(kr,String)),Ki(String)])(\"open-url\",cs,((e,t)=>{window.open(t,\"\")}),[String],!1)([\"restart\",\"reload\"],cs,(()=>{if(!$.options.ignoreGotos){if(Kt.turns<=1)return Se.create(\"infinite\",\"I mustn't (restart:) the story in the starting passage.\");Kt.hasSessionStorage&&sessionStorage.removeItem(\"Saved Session\"),window.location.reload()}}),[],!1)(\"goto-url\",cs,((e,t)=>{window.location.assign(t)}),[String],!1)(\"ignore\",cs,cs,[Ki(Gi)])(\"assert-exists\",(e=>{if(\"\"===e)return Se.create(\"datatype\",\"(assert-exists:) mustn't be given an empty string.\")}),((e,t,n)=>{let r=0;return(\"string\"==typeof n?new jn({type:\"string\",data:n}):n).forEach(t,(()=>{++r})),r?e:Se.create(\"assertion\",`I didn't see any ${\"string\"==typeof n?\"text occurrences of\":\"hooks matching\"} ${qi(n)} in this passage.`)}),[Yi(jn,String)]),Pa.add(\"assert\",\"Instant\",((e,t)=>t?{TwineScript_TypeID:\"instant\",TwineScript_TypeName:\"an (assert:) operation\",TwineScript_ObjectName:\"an (assert:) operation\",TwineScript_Unstorable:!0,TwineScript_Print:()=>\"\"}:ns(Se.create(\"assertion\",\"An assertion failed: \"),{appendTitleText:!0})),[Boolean])(\"save-game\",\"Boolean\",((e,t,n)=>{if(n||=\"\",!Kt.hasStorage)return!1;const{pastAndPresent:r}=Kt.serialise(!1);if(Se.containsError(r))return r;if(!1===r)return!1;try{return localStorage.setItem(ls(\"Saved Game\")+t,r),localStorage.setItem(ls(\"Saved Game Filename\")+t,n),!0}catch(e){return!1}}),[String,Ji(String)])(\"prompt\",\"String\",((e,t,n,r,a)=>{if(e.stackTop?.evaluateOnly)return Se.create(\"macrocall\",...us(e.stackTop.evaluateOnly));if(\"\"===a)return Se.create(\"datatype\",\"The text for (prompt:)'s confirm link can't be blank.\");const o=zi({section:e,message:t,defaultValue:n,buttons:[{name:a||\"OK\",confirm:!0,callback:()=>e.unblock(o.find(\"input\").last().val())}].concat(\"\"===r?[]:{name:r||\"Cancel\",confirm:!1,callback:()=>e.unblock(n)})});return e.stackTop.blocked=o,0}),[Yi(String,kr),String,Ji(String),Ji(String)])(\"confirm\",\"Boolean\",((e,t,n,r)=>{if(e.stackTop?.evaluateOnly)return Se.create(\"macrocall\",...us(e.stackTop.evaluateOnly));if(\"\"===r)return Se.create(\"datatype\",\"The text for (confirm:)'s confirm link can't be blank.\");const a=zi({section:e,message:t,defaultValue:!1,buttons:[{name:r||\"OK\",confirm:!0,callback:()=>e.unblock(!0)}].concat(\"\"===n?[]:{name:n||\"Cancel\",confirm:!1,callback:()=>e.unblock(!1)})});return e.stackTop.blocked=a,0}),[Yi(String,kr),Ji(String),Ji(String)])(\"page-url\",\"String\",(()=>window.location.href),[])(\"mp3-url\",\"Boolean\",((e,t,n)=>{let r=a(void 0===n?\"#audioElement\":\"#\"+n);return 0!==r.length?(r.prop(\"src\",t),!0):(r=a(\"<audio>\").attr(\"id\",void 0===n?\"audioElement\":n).css(\"display\",\"none\").prop(\"controls\",!0).prop(\"src\",t),a(\"body\").append(r),!1)}),[String,Ji(String)])(\"mp3-set\",\"Boolean\",((e,t,n)=>{let r=a(void 0===n?\"#audioElement\":\"#\"+n)[0];return!!r&&(t?(r.pause(),r.play(),!0):(r.pause(),!0))}),[Boolean,Ji(String)])(\"mp3-loop\",\"Boolean\",((e,t,n)=>{let r=document.getElementById(void 0===n?\"#audioElement\":\"#\"+n);return!!r&&(t?(r.loop=!0,!0):(r.loop=!1,!0))}),[Boolean,Ji(String)]);const{permutations:ds,options:hs}=$,{objectName:fs,subset:ms,collectionType:gs,isValidDatamapName:ys,is:bs,unique:vs,clone:ws,range:ks}=wt,{optional:xs,rest:$s,either:Ts,zeroOrMore:Ss,Any:Es,nonNegativeInteger:Cs}=Pa.TypeSignature,Ns=T(\"en\");Pa.add([\"a\",\"array\"],\"Array\",((e,...t)=>t),Ss(Ts(an,Es)))(\"range\",\"Array\",((e,t,n)=>ks(t,n)),[parseInt,parseInt])(\"subarray\",\"Array\",((e,t,n,r)=>ms(t,n,r)),[Array,parseInt,parseInt])(\"reversed\",\"Array\",((e,...t)=>t.reverse().map(ws)),Ss(Es))(\"shuffled\",\"Array\",((e,...t)=>Kt.shuffled(...t).map(ws)),[Ss(Es)])(\"sorted\",\"Array\",((e,...t)=>{if(!(t[0]instanceof pa)){const e=t.filter((e=>\"string\"!=typeof e&&\"number\"!=typeof e));return e&&e.length?1===e.length&&Array.isArray(e[0])?Se.create(\"macrocall\",\"Please give multiple numbers or strings to (sorted:), not a single array.\",\"You can use the spread ... syntax to spread out the array's values into (sorted:).\"):Se.create(\"datatype\",`If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ${fs(e[0])}.`):t.sort(Ns)}let n=t.shift();if(\"making\"in n||\"where\"in n||\"when\"in n||!(\"via\"in n))return Se.create(\"datatype\",`The optional lambda given to (sorted:) must be a 'via' lambda, not ${fs(n)}.`);for(let r=0;r<t.length;r+=1){const a=n.apply(e,{loop:t[r],pos:r+1});if(Se.containsError(a))return a;if(\"string\"!=typeof a&&\"number\"!=typeof a)return Se.create(\"datatype\",`The \"via\" lambda given to (sorted:) couldn't convert ${fs(t[r])} into a string or number.`);t[r]=[t[r],a]}return t.sort(((e,t)=>Ns(e[1],t[1]))).map((e=>e[0]))}),[Ss(Es)])(\"rotated\",\"Array\",((e,t,...n)=>{if(0===t)return Se.create(\"macrocall\",\"I can't rotate these values by 0 positions.\");const r=-1*(t=Math.abs(t)%n.length*Math.sign(t));return n.slice(r).concat(n.slice(0,r)).map(ws)}),[parseInt,Ss(Es)])(\"rotated-to\",\"Array\",((e,t,...n)=>{const r=t.filter(e,n);if(Se.containsError(r))return r;if(!r.length)return Se.create(\"macrocall\",`None of these ${n.length} values matched the lambda, so I can't rotate them.`);const a=n.indexOf(r[0]);return n.slice(a).concat(n.slice(0,a)).map(ws)}),[pa.TypeSignature(\"where\"),$s(Es)])(\"repeated\",\"Array\",((e,t,...n)=>{const r=[];if(!n.length)return r;for(;t-- >0;)r.push(...n);return r.map(ws)}),[Cs,$s(Es)])(\"interlaced\",\"Array\",((e,...t)=>{let n=Math.min(...t.map((e=>e.length)));const r=[];for(let e=0;e<n;e+=1)for(let n=0;n<t.length;n+=1)r.push(ws(t[n][e]));return r}),[Array,$s(Array)])(\"permutations\",\"Array\",((e,...t)=>t.length?ds(...t):[]),[Ss(Es)])(\"unique\",\"Array\",((e,...t)=>t.filter(vs)),[Ss(Es)])(\"altered\",\"Array\",((e,t,...n)=>n.map(((n,r)=>{const a=t.apply(e,{loop:n,pos:r+1});return null===a?n:a}))),[Ts(pa.TypeSignature(\"via\"),pa.TypeSignature(\"where\",\"via\")),Ss(Es)])(\"find\",\"Array\",((e,t,...n)=>t.filter(e,n)),[pa.TypeSignature(\"where\"),Ss(Es)])([\"all-pass\",\"pass\"],\"Boolean\",((e,t,...n)=>{const r=t.filter(e,n);return Se.containsError(r)||r.length===n.length}),[pa.TypeSignature(\"where\"),Ss(Es)])(\"some-pass\",\"Boolean\",((e,t,...n)=>{const r=t.filter(e,n);return Se.containsError(r)||r.length>0}),[pa.TypeSignature(\"where\"),Ss(Es)])(\"none-pass\",\"Boolean\",((e,t,...n)=>{const r=t.filter(e,n);return Se.containsError(r)||0===r.length}),[pa.TypeSignature(\"where\"),Ss(Es)])(\"folded\",\"Any\",((e,t,...n)=>{if(\"where\"in t){let r,a=t.filter(e,n.slice(1));if(r=Se.containsError(a))return r;n=[n[0],...a]}return Se.containsError(n)||n.reduce(((n,r,a)=>t.apply(e,{making:n,loop:r,pos:a+1})))}),[Ts(pa.TypeSignature(\"where\",\"via\",\"making\"),pa.TypeSignature(\"via\",\"making\")),$s(Es)])([\"dm-names\",\"datamap-names\",\"datanames\"],\"Array\",((e,t)=>Array.from(t.keys()).sort(T(\"en\"))),[Map])([\"dm-values\",\"datamap-values\",\"datavalues\"],\"Array\",((e,t)=>Array.from(t.entries()).sort(T(\"en\",(e=>String(e[0])))).map((e=>ws(e[1])))),[Map])([\"dm-entries\",\"datamap-entries\",\"dataentries\"],\"Array\",((e,t)=>Array.from(t.entries()).sort(((e,t)=>[e[0],t[0]].sort(T(\"en\"))[0]===e[0]?-1:1)).map((e=>new Map([[\"name\",e[0]],[\"value\",ws(e[1])]])))),[Map])([\"dm-altered\",\"datamap-altered\"],\"Datamap\",((e,t,n)=>Array.from(n.entries()).sort(((e,t)=>[e[0],t[0]].sort(T(\"en\"))[0]===e[0]?-1:1)).reduce(((n,r,a)=>{if(Se.containsError(n))return n;const o=new Map([[\"name\",r[0]],[\"value\",ws(r[1])]]),i=t.apply(e,{loop:o,pos:a+1});return Se.containsError(i)?i:(n.set(r[0],null===i?r[1]:i),n)}),new Map)),[Ts(pa.TypeSignature(\"via\"),pa.TypeSignature(\"where\",\"via\")),Map])(\"history\",\"Array\",((e,t)=>{const n=Kt.history();if(!t)return n;const r=t.filter(e,n.map((e=>Re.get(e))));return Se.containsError(r)?r:r.map((e=>e.get(\"name\")))}),[xs(pa.TypeSignature(\"where\"))])(\"visited\",\"Boolean\",((e,t)=>{if(\"string\"==typeof t)return Re.has(t)?Kt.passageNameVisited(t)>0||Kt.passage===t:Se.create(\"macrocall\",`There's no passage named '${t}' in this story.`);let n=Kt.history();return n=t.filter(e,n.concat(Kt.passage).map((e=>Re.get(e)))),Se.containsError(n)?n:n.length>0}),[Ts(String,pa.TypeSignature(\"where\"))])(\"passage\",\"Datamap\",((e,t)=>ws(Re.get(t||Kt.passage))||Se.create(\"macrocall\",`There's no passage named '${t}' in this story.`)),[xs(String)])(\"passages\",\"Array\",((e,t)=>{const n=T(\"en\"),r=[...Re.values()].map((e=>ws(e))),a=t?t.filter(e,r):r,o=Se.containsError(a);return o||a.sort(((e,t)=>n(e.get(\"name\"),t.get(\"name\"))))}),[xs(pa.TypeSignature(\"where\"))])(\"open-storylets\",\"Array\",((e,t)=>{if(e.stackTop.evaluateOnly)return Se.create(\"macrocall\",`(open-storylets:) can't be used in ${e.stackTop.evaluateOnly}.`);const n=Re.getStorylets(e,t),r=Se.containsError(n);return r||n.map(ws)}),[xs(pa.TypeSignature(\"where\"))])(\"savedgames\",\"Datamap\",(()=>{function e(e){return`(${e} ${hs.ifid}) `}let t,n=0;const r=new Map;do{if(!Kt.hasStorage)break;t=localStorage.key(n),n+=1;const a=e(\"Saved Game\");t?.startsWith(a)&&(t=t.slice(a.length),r.set(t,localStorage.getItem(e(\"Saved Game Filename\")+t)))}while(t);return r}),[])([\"datamap\",\"dm\"],\"Datamap\",((e,...t)=>{let n;const r=new Map,a=t.reduce(((e,t)=>{let a;if(Se.containsError(e))return e;if(void 0===n)n=t;else{if(a=Se.containsError(ys(r,n)))return a;if(r.has(n))return Se.create(\"macrocall\",`You used the same data name (${fs(n)}) twice in the same (datamap:) call.`);r.set(n,ws(t)),n=void 0}return e}),!0);return Se.containsError(a)?a:void 0!==n?Se.create(\"macrocall\",\"This datamap has a data name without a value.\"):r}),Ss(Ts(an,Es)))([\"dataset\",\"ds\"],\"Dataset\",((e,...t)=>new Set(t.filter(vs).map(ws))),Ss(Es))(\"count\",\"Number\",(function e(t,n,...r){if(r.length>1){let a;const o=r.map((r=>e(t,n,r)));return(a=Se.containsError(o))?a:o.reduce(((e,t)=>e+t),0)}const[a]=r;switch(gs(n)){case\"dataset\":case\"datamap\":return Se.create(\"macrocall\",\"(count:) shouldn't be given a datamap or dataset.\",\"You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.\");case\"string\":return\"string\"!=typeof a?Se.create(\"macrocall\",`${fs(n)} can't contain ${fs(a)} because it isn't also a string.`):a?n.split(a).length-1:0;case\"array\":return n.reduce(((e,t)=>e+bs(t,a)),0);default:return Se.create(\"macrocall\",`${fs(n)} can't contain values, let alone ${fs(a)}.`)}}),[Es,$s(Es)]);const{geomParse:Os,geomStringRegExp:js}=$n,{assign:As}=Object,{either:_s,wrapped:Ds,optional:Is,Any:Ps,Everything:Rs,zeroOrMore:Ms,rest:Vs,insensitiveSet:Ls,positiveNumber:Fs,positiveInteger:Hs,nonNegativeNumber:qs,percent:zs}=Pa.TypeSignature,Ws=[Ds(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not \"\".')];$.onStartup((()=>$.storyElement.on(\"mouseenter.hover-macro\",\"[hover=false]\",(function(){const e=a(this),t=e.data(\"hoverChanger\");if($.options.debug&&$.options.ignoreClickEvents&&!e.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;e.data({mouseoutStyle:e.attr(\"style\")||\"\"});const n=new et({target:e});t?.run(n),n.update(),e.attr(\"hover\",\"true\")})).on(\"mouseleave.hover-macro\",\"[hover=true]\",(function(){const e=a(this),t=e.data(\"mouseoutStyle\");e.attr(\"style\",t).removeData(\"mouseoutStyle\").attr(\"hover\",\"false\")})))),Se.on((()=>{a(\"tw-expression, tw-hook\",$.storyElement).each(((e,t)=>{let n=a(t);(n.data(\"errorEvent\")||Object)(n)}))}));const Bs=Ls(\"instant\",\"dissolve\",\"fade\",\"rumble\",\"shudder\",\"pulse\",\"zoom\",\"flicker\",\"slideleft\",\"slideright\",\"slideup\",\"slidedown\",\"fadeleft\",\"faderight\",\"fadeup\",\"fadedown\",\"blur\"),Us=Ls(\"dotted\",\"dashed\",\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\",\"none\");Pa.addChanger(\"if\",((e,t)=>new wr(\"if\",[t])),((e,t)=>e.enabled&&=t),Ws)(\"unless\",((e,t)=>new wr(\"unless\",[t])),((e,t)=>e.enabled&&=!t),Ws)(\"elseif\",((e,t)=>\"lastHookShown\"in e.stack[0]?new wr(\"elseif\",[!1===e.stack[0].lastHookShown&&!!t]):Se.create(\"macrocall\",\"There's no (if:) or something else before this to do (else-if:) with.\")),((e,t)=>e.enabled&&=t),Ws)(\"else\",(e=>\"lastHookShown\"in e.stack[0]?new wr(\"else\",[!1===e.stack[0].lastHookShown]):Se.create(\"macrocall\",\"There's nothing before this to do (else:) with.\")),((e,t)=>e.enabled&&=t),null)(\"hidden\",(()=>new wr(\"hidden\")),(e=>e.enabled=!1),null)([\"verbatim\",\"v6m\"],(()=>new wr(\"verbatim\")),(e=>e.verbatim=!0),null)(\"live\",((e,t)=>new wr(\"live\",t?[t]:[])),((e,t)=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}}),Is(Number))(\"event\",((e,t)=>new wr(\"event\",[t])),((e,t)=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}}),pa.TypeSignature(\"when\"))(\"more\",(()=>new wr(\"more\")),(e=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:e=>0!==e.Identifiers.exits?[]:[!0]}}}),null)(\"after\",((e,t,n)=>new wr(\"after\",[t].concat(void 0!==n?[n]:[]))),((e,t,n)=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:e=>($.anyInputDown()&&n&&(t-=n),e.Identifiers.time>t?[!0]:[])}}}),[Fs,Is(qs)])(\"after-error\",(()=>new wr(\"after-error\",[])),(e=>{e.enabled=!1,e.transitionDeferred=!0;const{tempVariables:t}=e.section.stackTop;e.data.errorEvent=n=>{n.removeData(\"errorEvent\");const r={...e,enabled:!0,transitionDeferred:!1};r.data&&(r.data.errorEvent=void 0),e.section.whenUnblocked((()=>e.section.renderInto(\"\",null,r,t)))}}),[])(\"hook\",((e,t)=>{if(!t)return Se.create(\"datatype\",\"The string given to (hook:) was empty.\");const n=$.insensitiveName(t);return n?new wr(\"hook\",[n]):Se.create(\"datatype\",`The string given to (hook:), \"${t}\", contained only dashes and underscores.`)}),((e,t)=>e.attr.push({name:t})),[String])([\"for\",\"loop\"],((e,t,...n)=>t.loop?new wr(\"for\",[t].concat(n)):Se.create(\"datatype\",\"The lambda provided to (for:) must refer to a temp variable, not just 'it'.\")),((e,t,...n)=>{const r=t.filter(e.section,n);let a;if(a=Se.containsError(r))return a;e.loopVars[t.loop.getName()]=r||[]}),[pa.TypeSignature(\"where\"),Ms(Ps)])([\"transition\",\"t8n\"],((e,t)=>new wr(\"transition\",[$.insensitiveName(t)])),((e,t)=>(e.transition=t,\"zoom\"===t&&(e.transitionOrigin=function(){const e=a(this),{left:t,top:n}=e.offset();return`${$.mouseCoords.x-t}px ${$.mouseCoords.y-n}px`}),e)),[Bs])([\"transition-time\",\"t8n-time\"],((e,t)=>new wr(\"transition-time\",[t])),((e,t)=>(e.transitionTime=t,e.data.passageT8n=As(e.data.passageT8n||{},{time:t}),e)),[Fs])([\"transition-delay\",\"t8n-delay\"],((e,t)=>new wr(\"transition-delay\",[t])),((e,t)=>(e.transitionDelay=t,e)),[qs])([\"transition-skip\",\"t8n-skip\"],((e,t)=>new wr(\"transition-skip\",[t])),((e,t)=>(e.transitionSkip=t,e)),[Fs])([\"transition-depart\",\"t8n-depart\"],((e,t)=>new wr(\"transition-depart\",[$.insensitiveName(t)])),((e,t)=>(e.data.passageT8n=As(e.data.passageT8n||{},{depart:t}),\"zoom\"===t&&(e.data.passageT8n.departOrigin=function(){const e=a(this),{left:t,top:n}=e.offset();return`${$.mouseCoords.x-t}px ${$.mouseCoords.y-n}px`}),e)),[Bs])([\"transition-arrive\",\"t8n-arrive\"],((e,t)=>new wr(\"transition-arrive\",[$.insensitiveName(t)])),((e,t)=>(e.data.passageT8n=As(e.data.passageT8n||{},{arrive:t}),\"zoom\"===t&&(e.data.passageT8n.arriveOrigin=function(){const e=a(this),{left:t,top:n}=e.offset(),r=e.height();return{\"transform-origin\":`${100*($.mouseCoords.x-t)/e.width()}% ${100*($.mouseCoords.y-n)/r}%`,height:`${r}px`}}),e)),[Bs])(\"button\",((e,t)=>void 0===t||Os(t).size?new wr(\"button\",t?[t]:[]):Se.create(\"datatype\",`The string given to (button:) should be a sizing line (\"==X==\", \"==X\", \"=XXXX=\" etc.), not ${JSON.stringify(t)}.`)),((e,t)=>{const{marginLeft:n,size:r}=Os(t);return e.attr.push({class(){return this.className+(this.classList.contains(\"enchantment-button\")?\"\":`${\" \".repeat(+(this.className.length>0))}enchantment-button`)}}),e.styles.push({\"margin-left\":r?`${n}%`:void 0,width:r?`${r}%`:\"100%\"}),e}),[Is(String)])(...(()=>{const e={click:{className:\"enchantment-link\",blockClassName:\"enchantment-clickblock\"},doubleclick:{className:\"enchantment-dblclick\",blockClassName:\"enchantment-dblclickblock\"},mouseover:{className:\"enchantment-mouseover\",blockClassName:\"enchantment-mouseoverblock\"},mouseout:{className:\"enchantment-mouseout\",blockClassName:\"enchantment-mouseoutblock\"}};return[\"action\",(e,t)=>new wr(\"action\",[$.insensitiveName(t)]),(t,n)=>(t.attr.push({class(){const t=function e(t){return(t=a(t)).is(\"tw-story, tw-sidebar, tw-passage\")||[\"block\",\"flex\"].includes(t.css(\"display\"))||t.children().get().some(e)}(this);return Array.from(this.classList).filter((t=>!Object.keys(e).some((n=>e[n].className===t||e[n].blockClassName===t)))).concat(e[n][t?\"blockClassName\":\"className\"]).join(\" \")}}),t),[Ls(...Object.keys(e))]]})())([\"border\",\"b4r\"],((e,...t)=>new wr(\"border\",t.map($.insensitiveName))),((e,...t)=>(e.styles.push({display(){let e=a(this).css(\"display\");return t.every((e=>\"none\"===e))||!e.includes(\"inline\")?e:\"inline-block\"},\"border-style\":t.join(\" \"),\"border-width\"(){return this.style.borderWidth||\"2px\"}}),e)),[Us,...Array(3).fill(Is(Us))])([\"border-size\",\"b4r-size\"],((e,...t)=>new wr(\"border-size\",t)),((e,...t)=>(e.styles.push({\"border-width\":t.map((e=>`${e}px`)).join(\" \")}),e)),[qs,...Array(3).fill(Is(qs))])(\"corner-radius\",((e,...t)=>new wr(\"corner-radius\",t)),((e,...t)=>(e.styles.push({\"border-radius\":t.map((e=>`${e}px`)).join(\" \"),padding(){return this.style.padding||t.map((e=>`${e}px`)).join(\" \")}}),e)),[qs,...Array(3).fill(Is(qs))])([\"border-colour\",\"b4r-colour\",\"border-color\",\"b4r-color\"],((e,...t)=>new wr(\"border-colour\",t.map((e=>e instanceof Gr?e.toRGBAString():e)))),((e,...t)=>(e.styles.push({\"border-color\":t.join(\" \")}),e)),[_s(String,Gr),...Array(3).fill(Is(_s(String,Gr)))])(\"opacity\",((e,t)=>new wr(\"opacity\",[t])),((e,t)=>e.styles.push({opacity:t})),[zs])(\"font\",((e,t)=>new wr(\"font\",[t])),((e,t)=>(e.styles.push({\"font-family\":t}),e)),[String])(\"align\",((e,t)=>{let n,r=t.indexOf(\"><\");if(!/^(==+>|<=+|=+><=+|<==+>)$/.test(t))return Se.create(\"datatype\",`The (align:) macro requires an alignment arrow (\"==>\", \"<==\", \"==><=\" etc.) be provided, not \"${t}\"`);if(~r){const e=Math.round(r/(t.length-2)*50);n={\"text-align\":\"center\",\"max-width\":\"50%\",...25===e?{\"margin-left\":\"auto\",\"margin-right\":\"auto\"}:{\"margin-left\":`${e}%`}}}else n=\"<\"===t[0]&&\">\"===t.slice(-1)?{\"text-align\":\"justify\",\"max-width\":\"50%\"}:t.includes(\">\")?{\"text-align\":\"right\"}:{\"text-align\":\"left\"};return n.display=\"block\",new wr(\"align\",[n])}),((e,t)=>{e.styles.push(t)}),[String])([\"text-colour\",\"text-color\",\"color\",\"colour\"],((e,t)=>new wr(\"text-colour\",[t])),((e,t)=>(t instanceof Gr&&(t=t.toRGBAString()),e.styles.push({color:t}),e)),[_s(String,Gr)])([\"text-size\",\"size\"],((e,t)=>new wr(\"text-size\",[t])),((e,t)=>(e.styles.push({\"font-size\":24*t+\"px\",\"line-height\":36*t+\"px\"}),e)),[qs])(\"text-indent\",((e,t)=>new wr(\"text-indent\",[t])),((e,t)=>(e.styles.push({\"text-indent\":`${t}px`,display:\"inline-block\"}),e)),[qs])([\"text-rotate-z\",\"text-rotate\"],((e,t)=>new wr(\"text-rotate-z\",[t])),((e,t)=>(e.styles.push({display:\"inline-block\",transform(){let e=a(this).css(\"transform\")||\"\";return\"none\"===e&&(e=\"\"),`${e} rotate(${t}deg)`}}),e)),[Number])(\"text-rotate-y\",((e,t)=>new wr(\"text-rotate-y\",[t])),((e,t)=>(e.styles.push({display:\"inline-block\",transform(){let e=a(this).css(\"transform\")||\"\";return\"none\"===e&&(e=\"\"),`${e} perspective(50vw) rotateY(${t}deg)`}}),e)),[Number])(\"text-rotate-x\",((e,t)=>new wr(\"text-rotate-x\",[t])),((e,t)=>(e.styles.push({display:\"inline-block\",transform(){let e=a(this).css(\"transform\")||\"\";return\"none\"===e&&(e=\"\"),`${e} perspective(50vw) rotateX(${t}deg)`}}),e)),[Number])([\"background\",\"bg\"],((e,t)=>new wr(\"background\",[t])),((e,t)=>{let n;return t instanceof Gr?t=t.toRGBAString():t instanceof ca&&(t=t.toLinearGradientString()),n=Gr.isHexString(t)||Gr.isCSS3Function(t)?{\"background-color\":t}:t.startsWith(\"linear-gradient(\")||t.startsWith(\"repeating-linear-gradient(\")?{\"background-image\":t}:{\"background-size\":\"cover\",\"background-image\":`url(${t})`,\"background-attachment\":\"fixed\"},e.styles.push(n,{display(){const e=a(this);return!e.children().length||$.childrenProbablyInline(e)?a(this).css(\"display\"):\"block\"}}),e}),[_s(String,Gr,ca)])(...(()=>{const e={color:()=>\"transparent\"},t=As(Object.create(null),{none:{},bold:{\"font-weight\":\"bold\"},italic:{\"font-style\":\"italic\"},underline:{\"text-decoration\":\"underline\"},doubleunderline:{\"text-decoration\":\"underline\",\"text-decoration-style\":\"double\"},wavyunderline:{\"text-decoration\":\"underline\",\"text-decoration-style\":\"wavy\"},strike:{\"text-decoration\":\"line-through\"},doublestrike:{\"text-decoration\":\"line-through\",\"text-decoration-style\":\"double\"},wavystrike:{\"text-decoration\":\"line-through\",\"text-decoration-style\":\"wavy\"},superscript:{\"vertical-align\":\"super\",\"font-size\":\".83em\"},subscript:{\"vertical-align\":\"sub\",\"font-size\":\".83em\"},blink:{animation:\"fade-in-out 1s steps(1,end) infinite alternate\"},shudder:{animation:\"shudder linear 0.1s 0s infinite\"},mark:{\"background-color\":\"hsla(60, 100%, 50%, 0.6)\"},condense:{\"letter-spacing\":\"-0.08em\"},expand:{\"letter-spacing\":\"0.1em\"},outline:[{\"text-shadow\"(){const e=a(this).css(\"color\");return`-1px -1px 0 ${e}, 1px -1px 0 ${e},-1px  1px 0 ${e}, 1px  1px 0 ${e}`}},{color(){return $.parentColours(a(this)).backgroundColour}}],shadow:{\"text-shadow\"(){return`0.08em 0.08em 0.08em ${a(this).css(\"color\")}`}},emboss:{\"text-shadow\"(){return`0.04em 0.04em 0em ${a(this).css(\"color\")}`}},smear:[{\"text-shadow\"(){const e=a(this).css(\"color\");return`0em   0em 0.02em ${e},-0.2em 0em  0.5em ${e}, 0.2em 0em  0.5em ${e}`}},e],blur:[{\"text-shadow\"(){return`0em 0em 0.08em ${a(this).css(\"color\")}`}},e],blurrier:[{\"text-shadow\"(){return`0em 0em 0.2em ${a(this).css(\"color\")}`},\"user-select\":\"none\"},e],mirror:{display:\"inline-block\",transform:\"scaleX(-1)\"},upsidedown:{display:\"inline-block\",transform:\"scaleY(-1)\"},tall:{display:\"inline-block\",transform:\"scaleY(1.5) translateY(-0.25ex)\"},flat:{display:\"inline-block\",transform:\"scaleY(0.5) translateY(0.25ex)\"},fadeinout:{animation:\"fade-in-out 2s ease-in-out infinite alternate\"},rumble:{animation:\"rumble linear 0.1s 0s infinite\"},sway:{animation:\"sway linear 2.5s 0s infinite\"},buoy:{animation:\"buoy linear 2.5s 0s infinite\"},fidget:{animation:()=>`fidget step-end 60s ${60*-Math.random()}s infinite${Math.random()<.5?\" reverse\":\"\"}`}});return[\"text-style\",(e,...t)=>new wr(\"text-style\",t.map($.insensitiveName)),(e,...n)=>{for(let r=0;r<n.length;r+=1)\"none\"===n[r]?e.styles=[]:e.styles=e.styles.concat(t[n[r]]);return e},[Vs(Ls(...Object.keys(t)))]]})())(\"collapse\",(()=>new wr(\"collapse\")),(e=>(e.attr.push({collapsing:!0}),e)),[])(\"hover-style\",((e,t)=>{const n=new et,r=(t.run(n),n.summary());return\"styles\"==`${r}`||r.every((e=>\"styles\"===e||\"attr\"===e))&&n.attr.every((e=>\"style\"==`${Object.keys(e)}`))?new wr(\"hover-style\",[t]):Se.create(\"datatype\",\"The changer given to (hover-style:) must only change the hook's style.\")}),((e,t)=>(e.data.hoverChanger=t,e.attr.push({hover:(e,t)=>void 0!==t&&t}),e)),[wr])(\"css\",((e,t)=>(t.trim().endsWith(\";\")||(t+=\";\"),new wr(\"css\",[t]))),((e,t)=>(e.attr.push({style(){return(a(this).attr(\"style\")||\"\")+t}}),e)),[String])(\"test-true\",(()=>new wr(\"test-true\",[])),(e=>e.enabled=!0),Ms(Rs))(\"test-false\",(()=>new wr(\"test-false\",[])),(e=>e.enabled=!1),Ms(Rs)),Pa.addCommand(\"animate\",a.noop,((e,t,n,r,a)=>{n.forEach(t,(t=>{let n;if(\"zoom\"===r){const{left:e,top:r}=t.offset();n=`${$.mouseCoords.x-e}px ${$.mouseCoords.y-r}px`}$.transitionIn(t,r,e.transitionTime||a,e.transitionDelay,e.transitionSkip,0,n)}))}),[Vs(jn),Ls(...Bs.innerType.filter((e=>\"instant\"!==e))),Is(Fs)]),[\"box\",\"float-box\"].forEach((e=>Pa.addChanger(e,((t,n,r)=>{const a=-1===n.search(js)||n.length>1&&!n.includes(\"=\"),o=\"float-box\"===e&&(-1===r.search(js)||r.length>1&&!r.includes(\"=\"));return a||o?Se.create(\"datatype\",`The (${e}:) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not \"${a?n:r}\".`):new wr(e,[n,r].filter((e=>void 0!==e)))}),((t,n,r)=>{const{marginLeft:o,size:i}=Os(n);let s;\"float-box\"===e&&({marginLeft:s,size:r}=Os(r));const c=\"box\"===e?\"%\":\"vw\",l={display:\"block\",width:i+c,\"max-width\":i+c,[\"box\"===e?\"margin-left\":\"left\"]:o+c,\"overflow-y\":\"auto\",padding(){const e=a(this).css(\"padding\");return e&&\"0px\"!==e?e:\"1em\"}};return void 0!==r&&(l.height=\"box\"===e?1.5*r+2+\"em\":`${r}vh`),\"float-box\"===e&&As(l,{position:\"fixed\",top:`${s}vh`,\"background-color\"(){return $.parentColours(a(this)).backgroundColour}}),t.styles.push(l),t}),[String,\"box\"===e?Is(Hs):String])));const{is:Gs}=wt,{either:Xs,rest:Ys,optional:Js}=Pa.TypeSignature,{assign:Ks}=Object;function Qs(e,t){if(t instanceof wr&&!t.canEnchant)return Se.create(\"datatype\",`The changer given to (${e}:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).`)}[\"enchant\",\"change\"].forEach((e=>{Pa.addCommand(e,((t,n)=>{const r=Qs(e,n);if(r)return r}),((t,n,r)=>{n=jn.from(n);const a=[];if(r instanceof wr){const e=new et({section:t});if(r.run(e),(e.innerEnchantments||[]).length>0){const t=e.innerEnchantments.map((e=>e(n)));a.push(...t)}}return a.push(ba.create({scope:n,[r instanceof wr?\"changer\":\"lambda\"]:r,section:t})),a.forEach((n=>{\"enchant\"===e?(t.addEnchantment(n),t.updateEnchantments()):n.enchantScope()})),\"\"}),[Xs(jn,String),Xs(wr,pa.TypeSignature(\"via\"))],!1)})),Pa.addChanger(\"enchant-in\",((e,t,n)=>{const r=Qs(\"enchant-in\",n);return r||new wr(\"enchant-in\",[t,n])}),((e,t,n)=>(e.innerEnchantments=(e.innerEnchantments||[]).concat((r=>ba.create({scope:jn.from(t),localHook:r,[n instanceof wr?\"changer\":\"lambda\"]:n,section:e.section}))),e)),[Xs(jn,String),Xs(wr,pa.TypeSignature(\"via\"))]),[[\"link-style\",new jn({type:\"name\",data:\"link\"})],[\"line-style\",new jn({type:\"base\",data:new jn({type:\"name\",data:\"page\"})},\"lines\",void 0)],[\"char-style\",new jn({type:\"base\",data:new jn({type:\"name\",data:\"page\"})},\"chars\",void 0)]].forEach((([e,t])=>{Pa.addChanger(e,((t,n)=>{const r=Qs(e,n);return r||new wr(e,[n])}),((e,n)=>(e.innerEnchantments=(e.innerEnchantments||[]).concat((r=>ba.create({scope:t,localHook:r,[n instanceof wr?\"changer\":\"lambda\"]:n,section:e.section}))),e)),[Xs(wr,pa.TypeSignature(\"via\"))])}));const Zs=[\"replace\",\"append\",\"prepend\"];function ec(e,t){return $.onStartup((()=>{const t=e.classList.replace(/ /g,\".\"),n=e.blockClassList?e.blockClassList.replace(/ /g,\".\"):\"\",r=`.${t}${n?`,.${n}`:\"\"}`;$.storyElement.on(e.event.map((e=>`${e}.enchantment`)).join(\" \"),r,(function(){const e=a(this);if($.options.debug&&$.options.ignoreClickEvents&&!e.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;if(e.is(\"tw-open-button\"))return;const t=a(Array.from(e.parents(r).add(this)).sort(((e,t)=>8&e.compareDocumentPosition(t)?1:-1))[0]),n=t.data(\"enchantmentEvent\");n&&n(t)}))})),[(e,n,r)=>{if(!n)return Se.create(\"datatype\",`A string given to this (${t}:) macro was empty.`);if(r){const e=Qs(t,r);if(e)return e}return new wr(t,[jn.from(n)].concat(r?[r]:[]))},(n,r,a)=>{n.enabled=!1,n.transitionDeferred=!0,e.rerender&&(n.newTargets=(n.newTargets||[]).concat({target:r,append:e.rerender}));const o=n.section?.stackTop?n.section.stackTop.tempVariables:Object.create(null),i=ba.create({functions:[t=>{t.attr(\"class\",t.children().is(\"tw-story, tw-sidebar, tw-passage\")||[\"block\",\"flex\"].includes(t.children().css(\"display\"))?e.blockClassList:e.classList),t.attr({tabIndex:\"0\"})}],data:{enchantmentEvent(){n.section.stackTop?.blocked||(e.once&&n.section.removeEnchantment(i),e.goto?Bo.goToPassage(e.goto,{transition:e.transition}):e.undo?Bo.goBack({transition:e.transition}):n.section.renderInto(n.source,null,{...n,append:e.once?\"append\":\"replace\",enabled:!0,transitionDeferred:!1},o))}},scope:r,section:n.section,name:t,[a instanceof wr?\"changer\":\"lambda\"]:a});return n.section&&(n.section.addEnchantment(i),i.enchantScope()),n},[Xs(jn,String),Js(Xs(wr,pa.TypeSignature(\"via\")))]]}Zs.forEach((e=>{Pa.addChanger(e,((t,...n)=>n.every(Boolean)?new wr(e,n.map(jn.from),null,!1):Se.create(\"datatype\",`A string given to this (${e}:) macro was empty.`)),((t,...n)=>(a(t.target).parents().filter(\"tw-collapsed,[collapsing=true]\").length>0||t.attr.some((e=>e.collapsing))||(t.attr=[...t.attr,{collapsing:!1}]),t.newTargets||=[],t.newTargets.push(...n.filter((n=>!t.newTargets.some((({target:t,append:r})=>Gs(n,t)&&e===r)))).map((t=>({target:t,append:e,before:!0})))),t)),Ys(Xs(jn,String)))(`${e}-with`,((t,n)=>new wr(`${e}-with`,[n],null,!1)),((t,n)=>(n instanceof kr&&(n=n.code),t.appendSource=(t.appendSource||[]).concat({source:n,append:e}),t)),Xs(kr,String))}));const tc=\"ontouchstart\"in window||navigator.maxTouchPoints>0,nc=[{name:\"click\",enchantDesc:{event:[\"click\"],once:!0,rerender:\"\",classList:\"link enchantment-link\",blockClassList:\"enchantment-clickblock\"}},{name:\"mouseover\",enchantDesc:{event:[\"mouseenter\",tc?\"click\":\"\"].filter(Boolean),once:!0,rerender:\"\",classList:\"link enchantment-mouseover\",blockClassList:\"enchantment-mouseoverblock\"}},{name:\"mouseout\",enchantDesc:{event:[\"mouseleave\",tc?\"click\":\"\"].filter(Boolean),once:!0,rerender:\"\",classList:\"link enchantment-mouseout\",blockClassList:\"enchantment-mouseoutblock\"}},{name:\"doubleclick\",enchantDesc:{event:[\"dblclick\"],once:!0,rerender:\"\",classList:\"link enchantment-dblclick\",blockClassList:\"enchantment-dblclickblock\"}}];nc.forEach((e=>{\"doubleclick\"!==e.name&&(Pa.addChanger(e.name,...ec(e.enchantDesc,e.name)),\"click\"===e.name&&Pa.addChanger(`${e.name}-rerun`,...ec({...e.enchantDesc,once:!1},`${e.name}-rerun`)))})),$.onStartup((()=>{nc.forEach((({enchantDesc:e})=>{e.blockClassList&&$.storyElement.on(e.event.map((e=>`${e}.enchantment`)).join(\" \"),(function(){const t=a(this);if($.options.debug&&$.options.ignoreClickEvents&&!t.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;if(t.is(\"tw-open-button\"))return;const n=a(Array.from(t.parents(`.${e.blockClassList.replace(/ /g,\".\")}`)).sort(((e,t)=>8&e.compareDocumentPosition(t)?1:-1))[0]),r=n.data(\"enchantmentEvent\");r&&r(n)}))}))})),Zs.forEach((e=>{nc.forEach((t=>{const n={...t.enchantDesc,rerender:e},r=`${t.name}-${e}`;Pa.addChanger(r,...ec(n,r))}))})),nc.forEach((e=>{\"doubleclick\"!==e.name&&[\"goto\",\"undo\"].forEach((t=>{const n=`${e.name}-${t}`;Pa.addCommand(n,((e,r)=>!e||!r&&\"goto\"===t?Se.create(\"datatype\",`A string given to this (${n}:) macro was empty.`):\"goto\"!==t||Re.hasValid(r)?void 0:Se.create(\"macrocall\",`I can't (${n}:) the passage '${r}' because it doesn't exist.`)),((r,a,o,i)=>{if(\"undo\"===t&&Kt.pastLength<1)return Se.create(\"macrocall\",\"I can't (undo:) on the first turn.\");const[,s]=ec({...e.enchantDesc,transition:r.data.passageT8n,...\"undo\"===t?{undo:!0}:{goto:i}},n);return s({section:a},jn.from(o)),Ks(r,{source:\"\"})}),[Xs(jn,String),...\"undo\"===t?[]:[String]])}))}));const{clone:rc,objectName:ac,isValidDatamapName:oc}=wt,{zeroOrMore:ic,Any:sc}=Pa.TypeSignature,cc=e=>({TwineScript_TypeName:`a (${e}:) macro`,TwineScript_ObjectName:`a (${e}:) macro`,TwineScript_Unstorable:!0,TwineScript_Print:()=>\"\"});[[\"storylet\",pa.TypeSignature(\"when\")],[\"urgency\",Number],[\"exclusivity\",Number]].forEach((([e,t])=>{Pa.add(e,\"Metadata\",((t,n)=>t.stackTop.speculativePassage?n:cc(e)),t)})),Pa.add(\"metadata\",\"Metadata\",((e,...t)=>{let n;const r=new Map,a=t.reduce(((e,t)=>{let a;if(Se.containsError(e))return e;if(void 0===n)n=t;else{if(a=Se.containsError(oc(r,n)))return a;if(r.has(n))return Se.create(\"macrocall\",`You used the same data name (${ac(n)}) twice in the same (metadata:) call.`);r.set(n,rc(t)),n=void 0}return e}),!0);return Se.containsError(a)?a:void 0!==n?Se.create(\"macrocall\",\"This (metadata:) macro has a data name without a value.\"):e.stackTop.speculativePassage?r:cc(\"metadata\")}),ic(sc));const{anyRealLetter:lc,anyUppercase:pc,anyLowercase:uc,anyCasedLetter:dc,realWhitespace:hc,impossible:fc}=$,{objectName:mc,toSource:gc}=wt,{rest:yc,either:bc,optional:vc,nonNegativeInteger:wc}=Pa.TypeSignature,{assign:kc,create:xc}=Object,$c=yc(bc(String,dn,an)),Tc=({name:e,fullArgs:t,args:n,makeRegExpString:r=(e=>e.join(\"\")),insensitive:a=!1,canContainTypedVars:o=!0,canBeUsedAlone:i=!0,canContainTypedGlobals:s=!0})=>{const c=n||t,l=xc(null),p=c.map((function t(n){if(n instanceof an){const{varRef:r}=n;if(!o)return Se.create(\"operation\",`Optional string patterns, like (${e}:)${\"p-many\"===e?\" with a minimum of 0 matches\":\"\"}, can't have typed variables inside them.`);if(!s&&!Xr.isPrototypeOf(r.object))return Se.create(\"operation\",`Only typed temp variables can be used in patterns given to (${e}:)`);const a=r.getName();if(a in l)return Se.create(\"operation\",`There's already a typed temp variable named _${a} inside this (${e}:) call.`);l[a]=!0;const i=t(n.datatype);return Se.containsError(i)?i:`(${i})`}if(n instanceof dn){if(!(o&&s||\"function\"!=typeof n.typedVars)){const t=n.typedVars();if(!o&&t.length)return Se.create(\"operation\",`(${e}:) can't have typed variables inside its pattern.`);if(!s&&t.some((e=>!Xr.isPrototypeOf(e.varRef.object))))return Se.create(\"operation\",`Only typed temp variables can be used in patterns given to (${e}:)`)}if(n.regExp)return(n.rest?\"(?:\":\"\")+(a?n.insensitive().regExp:n.regExp)+(n.rest?\")*\":\"\");const t=n.name,r=n.rest?\"*\":\"\";return\"alnum\"===t?lc+r:\"whitespace\"===t?hc+r:\"uppercase\"===t?(a?dc:pc)+r:\"lowercase\"===t?(a?dc:uc)+r:\"anycase\"===t?dc+r:\"digit\"===t?`\\\\d${r}`:\"linebreak\"===t?`(?:\\\\r|\\\\n|\\\\r\\\\n)${r}`:\"str\"===t?\".*?\":[\"even\",\"odd\",\"int\",\"num\"].includes(t)?Se.create(\"datatype\",`Please use string datatypes like 'digit' in (${e}:) instead of number datatypes.`):Se.create(\"datatype\",`The (${e}:) macro must only be given string-related datatypes, not ${mc(n)}.`)}return\"string\"==typeof n?(n=n.replace(/[.*+\\-?^${}()|[\\]\\\\]/g,\"\\\\$&\"),a&&(n=n.replace(RegExp(`(${pc}|${uc})`,\"g\"),(e=>`[${e.toUpperCase()}${e.toLowerCase()}]`))),n):(fc(\"createPattern\",`mapper() was given a non-string non-datatype ${n}`),\"\")}));let u;if(u=Se.containsError(p))return u;const d=r(p),h=kc(new dn(e),{regExp:d,insensitive:()=>a?h:Tc({name:e,fullArgs:t,args:c.map((e=>e instanceof dn&&\"function\"==typeof e.insensitive?e.insensitive():e)),makeRegExpString:r,insensitive:!0,canContainTypedVars:o,canBeUsedAlone:i}),typedVars:()=>c.reduce(((e,t)=>{if(t instanceof an){let n=Tc({name:\"p-ins\",fullArgs:[t.datatype],insensitive:!0});e=e.concat(a?an.check(n,t.varRef)??new an(n,t.varRef):t),t=t.datatype}return t instanceof dn&&\"function\"==typeof t.typedVars&&(e=e.concat(t.typedVars())),e}),[]),destructure(e){if(\"string\"!=typeof e)return[Se.create(\"operation\",`I can't put ${mc(e)} into ${this.TwineScript_ToSource()} because it isn't a string.`)];const t=this.typedVars();if(!t.length)return[];const n=(RegExp(`^${this.rest?\"(?:\":\"\"}${d}${this.rest?\")*\":\"\"}$`).exec(e)||[]).slice(1);return n.length?n.map(((e,n)=>{let r=t[n];if(r)return r.datatype.rest&&!r.datatype.regExp&&(r=r.TwineScript_Clone(),r.datatype=Tc({name:\"p\",fullArgs:[r.datatype]})),{dest:r,value:e||\"\",src:void 0}})).filter(Boolean):[Se.create(\"operation\",`I can't put ${mc(e)} because it doesn't match the pattern ${this.TwineScript_ToSource()}.`)]},TwineScript_IsTypeOf(t){return i?\"string\"==typeof t&&!!t.match(`^${this.rest?\"(?:\":\"\"}${d}${this.rest?\")*\":\"\"}$`):Se.create(\"operation\",`A (${e}:) datatype must only be used with a (p:) macro.`)},TwineScript_toTypeSignatureObject(){return{pattern:\"range\",name:e,range:e=>this.TwineScript_IsTypeOf(e)}},TwineScript_ToSource(){return`${this.rest?\"...\":\"\"}(${e}:${t.map(gc)})`}});return Object.defineProperty(h,\"TwineScript_ObjectName\",{get:()=>`a (${e}:) datatype`}),h};Pa.add([\"p\",\"pattern\"],\"Datatype\",((e,...t)=>Tc({name:\"p\",fullArgs:t})),$c)([\"p-either\",\"pattern-either\"],\"Datatype\",((e,...t)=>Tc({name:\"p-either\",fullArgs:t,canContainTypedVars:!1,makeRegExpString:e=>`(?:${e.join(\"|\")})`})),$c)([\"p-opt\",\"pattern-opt\",\"p-optional\",\"pattern-optional\"],\"Datatype\",((e,...t)=>Tc({name:\"p-opt\",fullArgs:t,canContainTypedVars:!1,makeRegExpString:e=>`(?:${e.join(\"\")})?`})),$c)([\"p-not\",\"pattern-not\"],\"Datatype\",((e,...t)=>t.find((e=>\"string\"==typeof e?1!==[...e].length:e.rest||e.regExp||[\"str\",\"empty\"].includes(e.name)))?Se.create(\"datatype\",\"(p-not:) should only be given single characters, or datatypes that match single characters\"):Tc({name:\"p-not\",fullArgs:t,canContainTypedVars:!1,makeRegExpString:e=>`[^${e.map((e=>e.startsWith(\"[\")&&e.endsWith(\"]\")?e.slice(1,-1):e)).join(\"\")}]`})),$c)([\"p-not-before\",\"pattern-not-before\"],\"Datatype\",((e,...t)=>Tc({name:\"p-not-before\",fullArgs:t,canContainTypedVars:!1,makeRegExpString:e=>`(?!${e.join(\"\")})`})),$c)([\"p-before\",\"pattern-before\"],\"Datatype\",((e,...t)=>Tc({name:\"p-before\",fullArgs:t,canContainTypedVars:!1,makeRegExpString:e=>`(?=${e.join(\"\")})`})),$c)([\"p-start\",\"pattern-start\"],\"Datatype\",((e,...t)=>Tc({name:\"p-start\",fullArgs:t,makeRegExpString:e=>`^(?:${e.join(\"\")})`})),$c)([\"p-end\",\"pattern-end\"],\"Datatype\",((e,...t)=>Tc({name:\"p-end\",fullArgs:t,makeRegExpString:e=>`(?:${e.join(\"\")})$`})),$c)([\"p-many\",\"pattern-many\"],\"Datatype\",((e,...t)=>{const n=t.slice();let r,a;if(\"number\"==typeof t[0]&&(r=t.shift(),a=\"number\"==typeof t[0]?t.shift():1/0),void 0!==a&&a<r)return Se.create(\"datatype\",\"The (p-many:) macro needs to be given string patterns, not just min and max numbers.\");if(!t.length)return Se.create(\"datatype\",\"The (p-many:) macro needs to be given string patterns, not just min and max numbers.\");const o=t.find((e=>!(\"string\"==typeof e||e instanceof dn||e instanceof an)));return o?Se.create(\"datatype\",`This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given ${mc(o)}.`):Tc({name:\"p-many\",args:t,fullArgs:n,canContainTypedVars:r>0,makeRegExpString:e=>`(?:${e.join(\"\")})${void 0!==r?`{${r}${a===1/0?\",\":a!==r?`,${a}`:\"\"}}`:\"+\"}`})}),[yc(bc(wc,String,dn,an))])([\"p-ins\",\"pattern-ins\",\"p-insensitive\",\"pattern-insensitive\"],\"Datatype\",((e,...t)=>Tc({name:\"p-ins\",fullArgs:t,insensitive:!0})),$c)([\"split\",\"splitted\"],\"Array\",((e,t,n)=>{if(t=Tc({name:\"split\",fullArgs:[t],canContainTypedVars:!1}),Se.containsError(t))return t;if(!n)return[\"\"];if(!t.regExp)return[...n];const r=RegExp(t.regExp),a=[];let o;for(;n&&(o=r.exec(n));){if(o.index+o[0].length===0)return a;a.push(n.slice(0,o.index)),n=n.slice(o.index+o[0].length)}return a.concat(n||[])}),[bc(String,dn),String])(\"trimmed\",\"String\",((e,t,n)=>void 0===n||t instanceof dn&&\"whitespace\"===t.name?t.trim():(t=Tc({name:\"trimmed\",fullArgs:[t],canContainTypedVars:!1}),Se.containsError(t)?t:t.regExp?n.replace(RegExp(`^(${t.regExp})*|(${t.regExp})*$`,\"g\"),\"\"):n)),[bc(String,dn),vc(String)])([\"str-find\",\"string-find\"],\"String\",((e,t,n)=>{if(t=Tc({name:\"str-find\",fullArgs:[t],canContainTypedGlobals:!1}),Se.containsError(t))return t;const r=t.typedVars(),a=RegExp(t.regExp,\"g\");let o,i=[],{lastIndex:s}=a;for(;(o=a.exec(n))&&s!==a.lastIndex;)if(s=a.lastIndex,r.length){const e=new Map;for(let t=0;t<r.length;t+=1){if(\"match\"===r[t].varRef.getName())return Se.create(\"macrocall\",\"There was a typed temp variable named _match in the pattern given to (str-find:)\",\"The variable _match is reserved, and can't be used inside (str-find:)'s pattern.\");e.set(r[t].varRef.getName(),o[t+1]),e.set(\"match\",o[0])}i.push(e)}else i.push(o[0]);return i}),[dn,String])([\"str-replaced\",\"string-replaced\",\"replaced\"],\"String\",((e,t,n,r,a)=>{if(\"number\"!=typeof t){if(void 0!==a)return Se.create(\"macrocall\",\"1 too many values were given to (str-replaced:).\",\"If this is given 5 values, the first value must be a number of replacements.\");a=r,r=n,n=t,t=1/0}else if(void 0===a)return Se.create(\"macrocall\",\"The (str-replaced:) macro needs 1 more value.\",\"The final string seems to be missing.\");if(r instanceof dn)return Se.create(\"datatype\",`The replacement value for (str-replaced:) must be a string or lambda, not ${mc(r)}`);if(a instanceof pa||n instanceof pa)return Se.create(\"datatype\",`The ${a instanceof pa?\"final string\":\"search pattern\"} given to (str-replaced:) can't be a lambda.`,\"Only the replacement value (after the search pattern) can be a 'via' lambda.\");if(n=Tc({name:\"str-replaced\",fullArgs:[n],canContainTypedGlobals:!1}),Se.containsError(n))return n;if(!n.regExp)return a;const o=RegExp(n.regExp,\"g\"),i=r instanceof pa?n.typedVars():[];let s,c=1,l=0,p=\"\",{lastIndex:u}=o;for(;a&&(s=o.exec(a))&&t>0&&u!==o.lastIndex;){u=o.lastIndex;const n=Object.create(e.stack.length?e.stackTop.tempVariables:Xr);for(let e=0;e<i.length;e+=1){const t=i[e],r=t.varRef.create(n,t.varRef.propertyChain);if(Se.containsError(r))return r;const a=r.defineType(t.datatype);if(Se.containsError(a))return a;r.set(s[e+1])}const d=r instanceof pa?r.apply(e,{loop:s[0],pos:c,tempVariables:n}):r;if(Se.containsError(d))return d;if(\"string\"!=typeof d)return Se.create(\"datatype\",`(str-replaced:)'s lambda must produce a string, but it produced ${mc(d)} when given \"${s[0]}\".`);p+=a.slice(l,s.index)+d,c+=1,t-=1,l=s.index+s[0].length}return p+=a.slice(l),p}),[bc(wc,String,dn),bc(dn,String,pa.TypeSignature(\"via\")),bc(String,pa.TypeSignature(\"via\")),vc(String)]);const{optional:Sc,rest:Ec,either:Cc}=Pa.TypeSignature,Nc=[\"Links can't have empty strings for their displayed text.\",\"In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there.\"],{assign:Oc}=Object;function jc(e,t,n){n||=t;const r=Re.hasValid(t)&&t===n;let a,o=e.evaluateTwineMarkup($.unescape(n),\"a link's passage name\");if(r){let e=o.children().length>0?\"`\".repeat((n.match(/`+/)||[]).reduce(((e,t)=>Math.max(e,t.length+1)),1)):\"\";t=e+\"\\0\".repeat(+!!e)+t+\"\\0\".repeat(+!!e)+e}else o.findAndFilter(\"tw-error\").length&&(a=o.findAndFilter(\"tw-error\").data(\"TwineError\")),n=o.text();return{text:t,passage:n,error:a}}$.onStartup((()=>{const e=\"ontouchstart\"in window||navigator.maxTouchPoints>0;function t(e){const t=a(this),n=t.closest(\"tw-expression\"),r=t.closest(\"tw-expression, tw-hook\"),o=r.data(\"clickEvent\"),i=r.data(\"section\");if($.options.debug&&$.options.ignoreClickEvents&&!t.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;if(t.is(\"tw-open-button\"))return;if(i?.stackTop&&i.stackTop.blocked&&(!(i.stackTop.blocked instanceof a)||!i.stackTop.blocked.find(t).length))return;if(o){if(t.find(\"tw-error\").length>0)return;return e.stopPropagation(),void o(t)}const s=n.data(\"linkPassageName\");let c={...n.data(\"passageT8n\")||{}};return n.find(\"tw-enchantment\").each(((e,t)=>{Object.assign(c,a(t).data(\"passageT8n\")||{})})),s?(e.stopPropagation(),void Bo.goToPassage(s,{transition:c})):t.is(\"[undo]\")?(e.stopPropagation(),void Bo.goBack({transition:c})):t.is(\"[fullscreen]\")?(e.stopPropagation(),void Bo.toggleFullscreen()):void 0}$.storyElement.on(\"click.passage-link\",\"tw-link\"+(e?\"\":\":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)\"),t).on(\"mouseover.passage-link\",\"tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link\",t).on(\"mouseout.passage-link\",\"tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link\",t).on(\"dblclick.passage-link\",\"tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link\",t),a(document).on(\"fullscreenchange\",(()=>{a(\"tw-link[fullscreen]\",$.storyElement).each(((e,t)=>{(a(t).closest(\"tw-expression, tw-hook\").data(\"fullscreenEvent\")||Object)(t)}))}))})),[[\"link\",\"link-replace\"],[\"link-reveal\",\"link-append\"],[\"link-repeat\"],[\"link-rerun\"]].forEach((e=>Pa.addChanger(e,((t,n,r)=>n?r&&!r.canEnchant?Se.create(\"datatype\",`The changer given to (${e[0]}:) can't be (or include) a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).`):new wr(e[0],[n].concat(r||[]),null,!0):Se.create(\"datatype\",Nc[0])),((t,n,r)=>{const a=e[0],o=t.section?.stackTop?t.section.stackTop.tempVariables:Object.create(null),i=new et({source:`<tw-link tabindex=0>${n}</tw-link>`,target:t.target instanceof Function?t.target:()=>t.target,append:\"replace\",data:{section:t.section,clickEvent:e=>{t.enablers=t.enablers.filter((e=>e.descriptor!==i)),\"link-reveal\"===a&&e.contents().unwrap();let n=e.parentsUntil(\":not(tw-enchantment)\").parent();if(n.length||(n=e.parent()),\"link-rerun\"===a){const t=e.parentsUntil(\":not(tw-enchantment)\");e.detach(),t.remove()}\"link\"!==a&&\"link-rerun\"!==a||n.empty(),t.section.renderInto(\"\",null,t,o),\"link-rerun\"===a&&n.prepend(e)}}});return t.enablers=(t.enablers||[]).concat({descriptor:i,changer:r}),t}),[String,Sc(wr)]))),Pa.addCommand(\"link-goto\",(e=>{if(!e)return Se.create(\"datatype\",...Nc)}),((e,t,n,r)=>{let a,o;if(({text:n,passage:r,error:a}=jc(t,n,r)),a)return a;if(e.transition){const e=\"transition\";return Se.create(\"datatype\",`Please attach (${e}-depart:) or (${e}-arrive:) to a passage link, not (${e}:).`)}return Re.hasValid(r)||(o=`<tw-broken-link passage-name=\"${$.escape(r)}\">${n}</tw-broken-link>`),o||=`<tw-link tabindex=0 ${Kt.passageNameVisited(r)>0?'class=\"visited\" ':\"\"}>${n}</tw-link>`,e.data.linkPassageName=r,e.data.section=t,Oc(e,{source:o,transitionDeferred:!0})}),[String,Sc(String)])(\"link-storylet\",((...e)=>{const t=e[1===e.length||\"string\"!=typeof e[0]?0:1];if(!t||\"string\"==typeof t)return Se.create(\"datatype\",\"(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.\")}),((e,t,...n)=>{const r=n[\"string\"==typeof n[0]?1:0];let a=\"string\"==typeof n[0]&&n[0];const o=n[n.length-1]!==r&&n[n.length-1];if(e.transition){const e=\"transition\";return Se.create(\"datatype\",`Please attach (${e}-depart:) or (${e}-arrive:) to (link-storylet:), not (${e}:).`)}const i=r instanceof pa,s=Re.getStorylets(t,i&&r),c=Se.containsError(s);if(c)return c;let l,p=s[i?0:r<0?s.length+r:r-1];if(p)p=p.get(\"name\"),a||=p,l||=`<tw-link tabindex=0 ${Kt.passageNameVisited(p)>0?'class=\"visited\" ':\"\"}>${a}</tw-link>`,e.data.linkPassageName=p,e.data.section=t;else{if(!o)return e;l=o}return Oc(e,{source:l,transitionDeferred:!0})}),[Cc(parseInt,String,pa.TypeSignature(\"where\")),Sc(Cc(parseInt,String,pa.TypeSignature(\"where\"))),Sc(String)])(\"link-undo\",(e=>{if(!e)return Se.create(\"datatype\",Nc[0])}),((e,t,n,r=\"\")=>{if(Kt.pastLength<1)return Oc(e,{source:r});e.data.section=t;const{tempVariables:a}=t.stackTop;return e.data.forgetUndosEvent=()=>e.data.section.whenUnblocked((()=>{const t={...e,append:\"replace\",source:r,transitionDeferred:!1};e.section.renderInto(\"\",null,t,a)})),Oc(e,{source:`<tw-link tabindex=0 undo>${n}</tw-link>`,transitionDeferred:!0})}),[String,Sc(String)])(\"link-show\",(e=>{if(!e)return Se.create(\"datatype\",Nc[0])}),((e,t,n,...r)=>(e.data.section=t,e.data.clickEvent=n=>{n.contents().unwrap(),r.forEach((n=>n.forEach(t,(n=>{const r=n.data(\"originalSource\")||\"\",o=n.data(\"hidden\");if(o)if(n.removeData(\"hidden\"),o instanceof a)n.empty().append(o);else{const a=n.data(\"tempVariables\");t.renderInto(\"\",null,{...e,source:r,target:n,transitionDeferred:!1},a&&Object.create(a))}}))))},Oc(e,{source:`<tw-link tabindex=0>${n}</tw-link>`,transitionDeferred:!0}))),[String,Ec(jn)])(\"link-fullscreen\",((e,t)=>{if(!e||!t)return Se.create(\"datatype\",Nc[0])}),((e,t,n,r)=>{const a=()=>document.fullscreenEnabled?`<tw-link tabindex=0 fullscreen>${document.fullscreenElement?r:n}</tw-link>`:r?`<tw-broken-link>${r}</tw-broken-link>`:\"\",{tempVariables:o}=t.stackTop;return e.data.section=t,e.data.fullscreenEvent=()=>{document.fullscreenEnabled&&e.data.section.whenUnblocked((()=>{const t={...e,append:\"replace\",source:a(),transitionDeferred:!1};e.section.renderInto(\"\",null,t,o)}))},Oc(e,{source:a(),transitionDeferred:!0})}),[String,String,Sc(String)]),Pa.addChanger([\"link-reveal-goto\"],((e,t,n,r)=>{if(!t)return Se.create(\"datatype\",...Nc);if(n instanceof wr){if(r instanceof wr)return Se.create(\"datatype\",\"You mustn't give two changers to (link-reveal-goto:)\");r=n,n=void 0}if(r&&!r.canEnchant)return Se.create(\"datatype\",\"The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).\");let a;return({text:t,passage:n,error:a}=jc(e,t,n)),a||new wr(\"link-reveal-goto\",[t,n,r].filter((e=>void 0!==e)),null,!1)}),((e,t,n,r)=>{if(!Re.hasValid(n))return void(e.source=`<tw-broken-link passage-name=\"${$.escape(n)}\">${t}</tw-broken-link>`);const a=Kt.passageNameVisited(n),o=e.section?.stackTop?e.section.stackTop.tempVariables:Object.create(null),i=new et({source:`<tw-link tabindex=0 ${a>0?'class=\"visited\" ':\"\"}>${t}</tw-link>`,target:e.target,append:\"replace\",data:{section:e.section,append:\"replace\",clickEvent:t=>{e.enablers=e.enablers.filter((e=>e.descriptor!==i)),t.contents().unwrap(),e.section.renderInto(\"\",null,e,o),e.section.whenUnblocked((()=>Bo.goToPassage(n,{transition:e.data.passageT8n})))}}});return e.enablers=(e.enablers||[]).concat({descriptor:i,changer:r}),e}),[String,Sc(Cc(wr,String)),Sc(wr)]);const{objectName:Ac,toSource:_c}=wt,{add:Dc,addChanger:Ic,addCommand:Pc,TypeSignature:{rest:Rc,either:Mc,Any:Vc,Everything:Lc,zeroOrMore:Fc}}=Pa;Dc(\"macro\",\"CustomMacro\",((e,...t)=>{let n;const r=[];for(n=0;n<t.length;n+=1){const e=n===t.length-1;if(t[n]instanceof an===e)return Se.create(\"datatype\",`The ${e?\"\":`${$.nth(t.length-n+1)}-`}last value given to (macro:) should be a ${e?\"code hook\":\"datatyped variable\"}, not ${Ac(t[n])}`);if(!e){const e=\"A custom macro\";if(t[n].varRef.object===Kt.variables)return Se.create(\"datatype\",`${e}'s typed variables must be temp variables (with a '_'), not global variables (with a '$').`,\"Write them with a _ symbol at the start instead of a $ symbol.\");if(t[n].varRef.propertyChain.length>1)return Se.create(\"datatype\",`${e}'s typed variables can't be properties inside a data structure.`);if(t[n].datatype.rest&&n!==t.length-2)return Se.create(\"datatype\",`${e} can only have one spread variable, and it must be its last variable.`);const a=t[n].varRef.propertyChain[0];if(r.includes(a))return Se.create(\"datatype\",`${e}'s typed variables can't both be named '${a}'.`);r.push(a)}}return new ia(t.slice(0,-1),t[t.length-1])}),[Rc(Mc(an,kr))]);const Hc=(e,t,n)=>{if(!t.some((e=>{if(\"function\"==typeof e.output)return e.output(n),!0})))return Se.create(\"macrocall\",`(${e}:) should only be used inside a code hook passed to (macro:).`)};Pc([\"output-data\",\"out-data\"],(()=>{}),(({stack:e},t)=>Hc(\"output-data\",e,t)||{blocked:!0}),[Vc],!1),Ic([\"output\",\"out\"],(()=>Object.assign(new wr(\"output\",[]))),((e,t)=>{if(!e.section)return;const{section:{stack:n,stackTop:r}}=e,a={};for(let e in r.tempVariables)e.startsWith(\"TwineScript_\")||(a[e]=r.tempVariables[e]);const o=Array.isArray(e.source)?`[${e.source.map((e=>e.text)).join(\"\")}]`:e.source;Hc(\"output\",n,{changer:t,hook:o,variables:a}),e.output=!0,r.blocked=!0}),[]),Pc(\"error\",(e=>{if(!e)return Se.create(\"datatype\",\"This (error:) macro was given an empty string.\")}),(({stack:e},t)=>Hc(\"error\",e,Se.create(\"user\",t))||{blocked:!0}),[String],!1),Dc(\"partial\",\"CustomMacro\",((e,t,...n)=>{const r=\"string\"!=typeof t&&t,a=!r&&t;if(!r){if(!Pa.has(a))return Se.create(\"macrocall\",`The macro name given to (partial:), \"${t}\", isn't the name of a built-in macro.`);if(\"Metadata\"===Pa.get(a).returnType)return Se.create(\"macrocall\",`(partial:) can't be used with metadata macros such as (${t}:)`)}const o=`(partial:${_c(t)},${n.map((e=>_c(e)))})`,i=ia.createFromFn(((e,...r)=>{const a=Pa[\"string\"==typeof t?\"run\":\"runCustom\"](t,e,n.concat(r));return Se.containsError(a)&&(a.message=`An error occurred while running the (partial:)-created macro, ${i.TwineScript_ObjectName}:\\n${a.message}`),a}),\"a (partial:) custom macro of \"+(a||r.TwineScript_KnownName?`(${a||r.TwineScript_KnownName}:${n.map((e=>_c(e)))})`:\"another unnamed custom macro\"),(()=>o),(a?Pa.get(a).typeSignature:r.typeSignature).filter(((e,t)=>t>=n.length||\"rest\"===e.pattern||\"zero or more\"===e.pattern)));return i}),[Mc(String,ia),Fc(Lc)]),a.prototype.extend({popAttr(e){const t=this.attr(e);return this.removeAttr(e),t},popData(e){const t=this.data(e);return this.removeData(e),t},tag(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes(e=\"*\"){return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(((e,t,n)=>e?.nodeType===Node.TEXT_NODE&&n.indexOf(e)===t)).sort(((e,t)=>2&e.compareDocumentPosition(t)?1:-1))},findAndFilter(e){const t=this.find(e),n=this.filter(e);return n.length?t.add(n):t}}),$.onStartup((()=>setTimeout((()=>{$.options.debug&&(window.REPL=e=>{let t=Mo.create().eval(ve.lex(`(print:${e})`));return t.TwineScript_Run?t.TwineScript_Run().source:t},window.LEX=e=>{let t=ve.lex(e);return 1===t.length?t[0]:t})}))));const{dialog:qc}=$n;function zc(e){let t=`${e.name}: ${e.message}`;if(e.stack){const n=e.stack.split(\"\\n\"),r=n.findIndex((e=>e.includes(\"__HarloweEval\")));t+=`\\n${n.slice(0,r).join(\"\\n\").replace(/\\([^)]+\\)/g,\"\")}`}return`<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>\\`\\`\\`${t}\\`\\`\\`</div>`}var Wc;window.$=a,Wc=window.onerror,window.onerror=function(...e){window.onerror=Wc,$.storyElement.parent().append(qc({message:`Sorry to interrupt, but this page's code has got itself in a mess.\\n\\n${zc(e[4])}\\n(This is probably due to a bug in the Harlowe game engine.)`}).addClass(\"harlowe-crash\")),\"function\"==typeof Wc&&Wc(...e)},$.onStartup((()=>{const e=a(\"tw-storydata\");if(0===e.length)return;$.options.ifid=e.attr(\"ifid\"),(e.attr(\"tags\")||\"\").split(/\\s/).forEach((e=>{\"uncompressed-pure-values\"!==e&&\"uncompressed-saves\"!==e||($.options.uncompressedPureValues=!0),\"uncompressed-structures\"!==e&&\"uncompressed-saves\"!==e||($.options.uncompressedStructures=!0)})),(e.attr(\"options\")||\"\").split(/\\s/).forEach((e=>{e&&($.options[e]=!0),\"debug\"===e&&di()}));let t=e.attr(\"startnode\");t||(t=[].reduce.call(a(\"tw-passagedata\"),((e,t)=>{const n=t.getAttribute(\"pid\");return n<e?n:e}),1/0)),t=a(`tw-passagedata[pid='${t}']`).attr(\"name\"),a(document.documentElement).on(\"keydown\",(e=>{13===e.which&&\"0\"===e.target.getAttribute(\"tabindex\")&&a(e.target).trigger(\"click\")}));let n=!1;a(\"[role=script]\").each((function(e){try{t=a(this).html(),Function(\"script\",\"DebugMode\",\"Renderer\",\"State\",\"Section\",\"Engine\",\"Passages\",\"Utils\",\"RenderUtils\",\"arguments=void 0;eval([script,script=void 0][0]);\")(t,di,We,Kt,Mo,Bo,Re,$,$n)}catch(t){n||(n=!0,qc({parent:$.storyElement.parent(),message:`There is a problem with this story's ${$.nth(e+1)} script:\\n\\n${zc(t)}`}))}var t})),a(\"[role=stylesheet]\").each(((e,t)=>{a(document.head).append(`<style data-title=\"Story stylesheet '${e+1}'\">${a(t).html()}`)}));const r=Mo.create();r.stack=[{tempVariables:Object.create(Xr)}];const o=Re.loadMetadata(r);if(o.length){const e=qc({parent:$.storyElement.parent(),message:\"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>\"});o.forEach((t=>e.find(\"p\").append(t.render())))}const i=!$.options.debug&&Kt.hasSessionStorage&&sessionStorage.getItem(\"Saved Session\");i&&!0===Kt.deserialise(r,i)?Bo.showPassage(Kt.passage):Bo.goToPassage(t)}))}();//# sourceMappingURL=harlowe-min.js.map\n</script>\n\n</body>\n\n</html>","setup": function(){function escape(e){return e&&"object"==typeof e?(Object.keys(e).forEach((a=>{e[a]=escape(e[a])})),e):`${e}`.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function makeWrapper(e){return(...a)=>`(${e}${a.join("|")})`}const e=makeWrapper("?:"),a=makeWrapper("?!"),t=makeWrapper("?="),r="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",o=r.replace("*","+"),n="\\b",s="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",i=s.replace("\\-",""),l=e("\\n","$"),c=`${r}(\\*+)${o}`,h=`${r}((?:0\\.)+)${o}`,d=`${r}-{3,}${r}${l}`,m=`${r}(#{1,6})${r}`,p=`${r}(==+>|<=+|=+><=+|<==+>)${r}${l}`,u=`${r}(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)${r}${l}`,g={opener:"\\[\\[(?!\\[)",main:void 0,text:`(${function notChars(...e){return`[^${e.map(escape).join("")}]*`}("]")})`,rightSeparator:e("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:`(${e("[^\\|\\]]",`\\]${a("\\]")}`)}+)`},y=`${i}*${i.replace("\\w","a-zA-Z")}${i}*`,b=`\\$(${y})`,f=`_(${y})`,w=`'s${o}${a("_")}(${y})`,k=`(${y})${o}of${n}${a(`it${n}`)}`,v=`'s${o}`,x=`of${n}`,T=e("it","time","turns?","visits?","exits?","pos")+n,$=`its${o}(${y})`,C=`its${n}`,S=`(${y})${o}of${o}it${n}`,N=`of${o}it${n}`,A={opener:"\\(",name:`(${e("\\$","_")}?${s}+):${a("\\/")}`,closer:"\\)"},O=e("=<","=>",`[gl]te?${n}`,`n?eq${n}`,`isnot${n}`,`are${n}`,`x${n}`,`isa${n}`,`or${o}a${n}`),_="[a-zA-Z][\\w\\-]*",P="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",H=`\\|(${s}+)(>|\\))`,L=`(<|\\()(${s}+)\\|`,I=`((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)${a("m?s")}${n}`;g.main=g.opener+e(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text;const M={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:s,anyLetterStrict:i,whitespace:o.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:`<\\/?${_}${P}>`,scriptStyleTag:`<(${e("script","style","textarea")})${P}>[^]*?<\\/\\1>`,scriptStyleTagOpener:"<",url:`(${e("https?","mailto","javascript","ftp","data")}:\\/\\/[^\\s<]+[^<.,:;"')\\]\\s])`,bullet:"\\*",hr:d,heading:m,align:p,column:u,bulleted:c,numbered:h,verbatimOpener:"`+",hookAppendedFront:`\\[${a("=+")}`,hookPrependedFront:`${H}\\[${a("=+")}`,hookFront:`\\[${a("=+")}`,hookBack:`\\]${a(L)}`,hookAppendedBack:`\\]${L}`,unclosedHook:"\\[=+",unclosedHookPrepended:`${H}\\[=+`,unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+t(A.name),macroName:A.name,groupingFront:`\\(${a(A.name)}`,twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:v,belongingOperator:x,itsOperator:C,belongingItOperator:N,variable:b,tempVariable:f,hookName:`\\?(${s}+)\\b`,cssTime:`(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)${n}`,colour:e(e("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:e("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm",`data${e("map","type","set")}`,"ds","digit","gradient","empty","even",`int${a("o")}(?:eger)?`,"lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+n,number:I,boolean:e("true","false")+n,identifier:T,itsProperty:$,belongingItProperty:S,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:`is${a(`${o}not${n}`,`${o}an?${n}`,`${o}in${n}`,`${o}<`,`${o}>`)}${n}`,isNot:`is${o}not${a(o+e("an?","in")+n)}${n}`,isA:`is${o}an?${n}`,isNotA:`is${o}not${o}an?${n}`,matches:`matches${n}`,doesNotMatch:`does${o}not${o}match${n}`,and:`and${n}`,or:`or${n}`,not:`not${n}`,inequality:`((?:is(?:${o}not)?${r})*)(${e("<(?!=)","<=",">(?!=)",">=")})`,isIn:`is${o}in${n}`,contains:`contains${n}`,doesNotContain:`does${o}not${o}contain${n}`,isNotIn:`is${o}not${o}in${n}`,addition:escape("+")+a("="),subtraction:escape("-")+a("=","type"),multiplication:escape("*")+a("="),division:e("/","%")+a("="),spread:`\\.\\.\\.${a("\\.")}`,to:e(`to${n}`,"="),into:`into${n}`,making:`making${n}`,where:`where${n}`,when:`when${n}`,via:`via${n}`,each:`each${n}`,bind:`2?bind${n}`,typeSignature:escape("-type")+n,incorrectOperator:O,PlainCompare:{comma:",",commentFront:"\x3c!--",commentBack:"--\x3e",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}};let E;const{hasOwn:F}=Object,R={};class Token{constructor(e){for(let a in e)this[a]=e[a]}addChild(e){const a=this.lastChildEnd(),t=new Token(e);return t.start=a,t.end=e.text&&a+e.text.length,t.place=this.place,t.children=[],t.innerText&&lex$2(t),this.children.push(t),t}lastChildEnd(){const e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))}tokenAt(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(let a=0;a<this.children.length;a+=1)if(e>=this.children[a].start&&e<this.children[a].end){const t=this.children[a].tokenAt(e);if(t)return t}return this}pathAt(e){if(e<this.start||e>=this.end)return[];let a=[];if(this.children.length)for(let t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){const r=this.children[t].pathAt(e);if(r.length){a=a.concat(r);break}}return a.concat(this)}nearestTokenAt(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(((a,t)=>a||(e>=t.start&&e<t.end?t:null)),null):this}everyLeaf(e){return this.children&&0!==this.children.length?this.children.reduce(((a,t)=>a&&t.everyLeaf(e)),!0):!!e(this)}demote(){this.type="text"}error(e){this.type="error",this.message=e}toString(){let e=`${this.type}(${this.start}→${this.end})`;return this.children&&this.children.length>0&&(e+=`[${this.children}]`),e}copy(){const e=new Token(this);return e.children=e.children.slice(),e}foldChildren(){let e=[];const a=this.children.slice();for(let t=0;t<a.length;t+=1){const r=a[t];let o=!1;if(r.matches)for(let a=0;a<e.length;a+=1){let{type:t}=e[a];t in r.matches&&(foldTokens(this,r,e[a]),e=e.slice(a+1),o=!0)}!o&&r.isFront&&e.unshift(r)}}}function lex$2(e,a){const t=e.innerText;let r=null,o=0,n=o,s=t.length,i=null;for(;o<s;){const s=t.slice(o);let l=(r&&r.length?r[0]:e).innerMode,c=0,h=l.length;for(;c<h;c+=1){const h=R[l[c]];if(h.constraint&&!h.constraint(i)||h.cannotFollowText&&("text"===i?.type||n<o)||(h.plainCompare?!s.startsWith(h.pattern):!h.pattern.test(s)))continue;const d=h.fn(h.plainCompare?h.pattern:h.pattern.exec(s));let m=!1,p=0;if(d.matches){for(;r&&p<r.length;p+=1){let{type:e,aka:a}=r[p];if(e in d.matches){m=!0;break}a&&(e=a),d.cannotCross?.indexOf(e)>-1&&(p=r.length-1)}if((!r||p>=r.length)&&!d.isFront)continue}n<o&&e.addChild({type:"text",text:t.slice(n,o),innerMode:l}),i=e.addChild(d),o+=i.text.length,n=o;let u=!1;m&&(a&&foldTokens(e,i,r[p]),r=r.slice(p+1),u=!0),!u&&i.isFront&&(r?r.unshift(i):r=[i]);break}c===h&&(o+=1,null===i&&(i={type:"text"}))}for(n<o&&e.addChild({type:"text",text:t.slice(n,o),innerMode:(r?.length?r[0]:e).innerMode});r?.length>0;)r.shift().demote();return e}function foldTokens(e,a,t){const r=e.children.indexOf(a),o=e.children.indexOf(t);a.children=e.children.splice(o+1,r-(o+1)),a.type=a.matches[t.type],a.innerText="";for(let e=0,t=a.children.length;e<t;e++)a.innerText+=a.children[e].text;a.start=t.start,a.text=t.text+a.innerText+a.text;for(let e in t)F(t,e)&&!F(a,e)&&(a[e]=t[e]);a.isFront&&(a.isFront=!1),e.children.splice(o,1)}E={lex:(e,a="",t="start",r=!1)=>lex$2(new Token({type:"root",place:a,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:E.modes[t]}),!r),rules:R,modes:{}};var z=E;const{keys:B,assign:W,hasOwn:D}=Object;let q=Object.freeze({lex:function rules(e){function textTokenFn(e){return e||="innerText",function(a){const t=a.reduceRight(((e,a,t)=>e||(t?a:"")),""),r={};return r[e]=t,r}}function openerFn(e,a){const t={};return t[e]=a,()=>({isFront:!0,matches:t,cannotCross:["verbatimOpener"]})}const a=Object.bind(0,null);function setupRules(e,a){return Object.keys(a).forEach((t=>{const r=a[t].fn;a[t].fn=a=>{const o=r(a);return o.text||(o.text="string"==typeof a?a:a[0]),o.type||(o.type=t),o.innerMode||(o.innerMode=e),o}})),a}const t=[],r=[],o=[],n=setupRules(t,{hr:{fn:a},bulleted:{fn:e=>({depth:e[1].length})},numbered:{fn:e=>({depth:e[1].length/2})},heading:{fn:e=>({depth:e[1].length})},align:{fn(e){let a;const t=e[1],r=t.indexOf("><");return~r?(a=Math.round(r/(t.length-2)*50),25===a&&(a="center")):"<"===t[0]&&">"===t.slice(-1)?a="justify":t.indexOf(">")>-1?a="right":t.indexOf("<")>-1&&(a="left"),{align:a}}},column:{fn(e){let a;const t=e[1],r=t.indexOf("|");return r&&r<t.length-1?a="center":"|"===t[0]&&"|"===t.slice(-1)?a="none":r===t.length-1?a="right":r||(a="left"),{column:a,width:/\|+/.exec(t)[0].length,marginLeft:/^=*/.exec(t)[0].length,marginRight:/=*$/.exec(t)[0].length}}}}),blockRuleConstraint=e=>{switch(e&&e.type){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1};B(n).forEach((e=>{n[e].constraint=blockRuleConstraint,n[e].cannotFollowText=!0}));const s=setupRules(t,{twine1Macro:{fn:()=>({type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."})},emBack:{fn:()=>({matches:{emFront:"em"},cannotCross:["verbatimOpener"]})},strongBack:{fn:()=>({matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]})},strongFront:{fn:()=>({isFront:!0})},emFront:{fn:()=>({isFront:!0})},boldOpener:{fn:openerFn("boldOpener","bold")},italicOpener:{fn:openerFn("italicOpener","italic")},strikeOpener:{fn:openerFn("strikeOpener","strike")},supOpener:{fn:openerFn("supOpener","sup")},commentFront:{fn:()=>({isFront:!0})},commentBack:{fn:()=>({matches:{commentFront:"comment"}})},scriptStyleTag:{fn:a},tag:{fn:a},url:{fn:a},hookPrependedFront:{fn:e=>({name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"})},hookFront:{fn:()=>({isFront:!0})},hookBack:{fn:()=>({matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]})},hookAppendedBack:{fn:e=>({name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]})},unclosedHook:{fn:a},unclosedHookPrepended:{fn:e=>({type:"unclosedHook",name:e[1],hidden:")"===e[2]})},verbatimOpener:{fn(e){let a=e[0].length,t={};return t[`verbatim${a}`]="verbatim",{type:`verbatim${a}`,isFront:!0,matches:t,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:a},collapsedFront:{fn:()=>({isFront:!0})},collapsedBack:{fn:()=>({matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]})},escapedLine:{fn:a},legacyLink:{fn:e=>({type:"twineLink",innerText:e[1],passage:e[2],innerMode:t})},br:{fn:a}}),i=W(setupRules(r,{macroFront:{fn:e=>({isFront:!0,name:e[1]})},groupingBack:{fn:()=>({matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener","hookFront"]})},passageLink:{fn(e){const a=e[1]||"",r=e[2]||"",o=e[3]||"";return{type:"twineLink",innerText:r?o:a,passage:a?o:r,innerMode:t}}},simpleLink:{fn:e=>({type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:t})},variable:{constraint:e=>!e||"macroFront"!==e.type,fn:textTokenFn("name")},tempVariable:{constraint:e=>!e||"macroFront"!==e.type,fn:textTokenFn("name")}}),{hookFront:s.hookFront,hookBack:s.hookBack}),l=setupRules(r,{commentBack:{fn:()=>({matches:{commentFront:"comment"}})},macroName:{constraint:e=>e&&"macroFront"===e.type,fn:textTokenFn("name")},groupingFront:{fn:()=>({isFront:!0})},property:{fn:textTokenFn("name"),constraint(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0}}},possessiveOperator:{fn:a},itsProperty:{cannotFollowText:!0,fn:textTokenFn("name")},itsOperator:{cannotFollowText:!0,fn:a},belongingItProperty:{cannotFollowText:!0,fn:textTokenFn("name")},belongingItOperator:{cannotFollowText:!0,fn:a},belongingProperty:{cannotFollowText:!0,fn:textTokenFn("name")},belongingOperator:{cannotFollowText:!0,fn:a},escapedStringChar:{fn:()=>({type:"text"})},singleStringOpener:{fn:()=>({isFront:!0,matches:{singleStringOpener:"string"},innerMode:o})},doubleStringOpener:{fn:()=>({isFront:!0,matches:{doubleStringOpener:"string"},innerMode:o})},hookName:{fn:textTokenFn("name")},cssTime:{fn:e=>({value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)})},datatype:{cannotFollowText:!0,fn:e=>({name:e[0].toLowerCase()})},colour:{cannotFollowText:!0,fn(e){let a,t=e[0].toLowerCase(),r={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return a=D(r,t)?`#${r[t]}`:t,{colour:a}}},number:{fn:e=>({value:parseFloat(e[0])})},inequality:{fn:e=>({operator:e[2],negate:e[1].indexOf("not")>-1})},identifier:{fn:textTokenFn("name"),cannotFollowText:!0},whitespace:{fn:a,cannotFollowText:!0},incorrectOperator:{fn:e=>{const a={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:`Please say ${a?`'${a}'`:"something else"} instead of '${e[0]}'.`,explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0},...["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(((e,t)=>(e[t]={fn:a,cannotFollowText:!0},e)),{}),...["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(((e,t)=>(e[t]={fn:a},e)),{})}),c=setupRules(o,{singleStringCloser:l.singleStringOpener,doubleStringCloser:l.doubleStringOpener,escapedStringChar:l.escapedStringChar});t.push(...B(n),...B(i),...B(s)),r.push(...B(i),...B(l)),o.push(...B(c));const h={...n,...s,...i,...l,...c};B(h).forEach((e=>{M.PlainCompare[e]?(h[e].pattern=M.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp(`^(?:${M[e]})`,"i")})),W(e.rules,h);const{modes:d}=e;return d.start=d.markup=t,d.macro=r,d.string=o,e}(z).lex,Patterns:M});const{round:j}=Math,V={Macro:{set:{name:"set",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:"Stores data values in variables, optionally allowing you to permanently restrict the variable to a single datatype.  ",anchor:"macro_set",category:"basics",categoryOrder:"1"},put:{name:"put",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:"A left-to-right version of (set:) that requires the word `into` rather than `to`.  ",anchor:"macro_put",category:"basics",categoryOrder:"2"},unpack:{name:"unpack",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:'A specialised variation of (put:) that lets you extract multiple values from an array, datamap or string, at once, and put them into multiple variables, by placing a matching data structure on the right of `into` containing variables at the positions of those values. For instance, `(unpack: (a: 1, 2, 3) into (a: $x, 2, $y))` sets $x to 1 and $y to 3, and `(unpack: (dm: "B", 3, "A", 1) into (dm: "A", $x, "B", $y))` sets $x to 1 and $y to 3.   ',anchor:"macro_unpack",category:"data structure"},move:{name:"move",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:"A variant of (put:) that, if transferring data from a data structure, deletes the source value after copying it - in effect moving the value from the source to the destination.  ",anchor:"macro_move",category:"basics",categoryOrder:"3"},display:{name:"display",sig:" String",returnType:"Command",aka:[],abstract:"This command writes out the contents of the passage with the given string name. If a passage of that name does not exist, this produces an error.  ",anchor:"macro_display",category:"basics",categoryOrder:"5"},print:{name:"print",sig:" Any",returnType:"Command",aka:[],abstract:"This command prints out any data provided to it, as text.  ",anchor:"macro_print",category:"basics",categoryOrder:"4"},verbatimprint:{name:"verbatim-print",sig:" Any",returnType:"Command",aka:["v6m-print"],abstract:"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  ",anchor:"macro_verbatim-print",category:"basics",categoryOrder:"16"},v6mprint:{name:"verbatim-print",sig:" Any",returnType:"Command",aka:["v6m-print"],abstract:"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  ",anchor:"macro_verbatim-print",category:"basics",categoryOrder:"16"},verbatimsource:{name:"verbatim-source",sig:" Any",returnType:"Command",aka:["v6m-source"],abstract:"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  ",anchor:"macro_verbatim-source",category:"debugging"},v6msource:{name:"verbatim-source",sig:" Any",returnType:"Command",aka:["v6m-source"],abstract:"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  ",anchor:"macro_verbatim-source",category:"debugging"},goto:{name:"go-to",sig:" String",returnType:"Command",aka:[],abstract:"This command stops passage code and sends the player to a new passage, starting a new turn as if a passage link was clicked. If the passage named by the string does not exist, this produces an error.  ",anchor:"macro_go-to",category:"navigation",categoryOrder:"1"},redirect:{name:"redirect",sig:" String",returnType:"Command",aka:[],abstract:"This command sends the player to a new passage. However, unlike (goto:), this does *not* start a new turn - undoing after this will send the player to the turn before the redirect occurred.  ",anchor:"macro_redirect",category:"navigation",categoryOrder:"2"},undo:{name:"undo",sig:" [String]",returnType:"Command",aka:[],abstract:'This command stops passage code and "undoes" the current turn, sending the player to the previous visited passage and forgetting any variable changes that occurred in this passage. You may provide an optional string to display if undos aren\'t available.  ',anchor:"macro_undo",category:"navigation",categoryOrder:"3"},debug:{name:"debug",sig:"",returnType:"Command",aka:[],abstract:"This command, which takes no values, opens the Debug Mode panel if it wasn't open already. This can be used even if the story didn't begin in Debug Mode initially.  ",anchor:"macro_debug",category:"debugging"},iconundo:{name:"icon-undo",sig:" [String], [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, undoes the current turn, returning to the previous passage, as if by (undo:). It is not visible if undos aren't available.  ",anchor:"macro_icon-undo",category:"sidebar",categoryOrder:"2"},iconredo:{name:"icon-redo",sig:" [String], [String]",returnType:"Command",aka:[],abstract:'Creates an icon, similar to those in the sidebar, that, if visible and clicked, "re-does" a turn that was undone. It is only visible if a turn has been undone.  ',anchor:"macro_icon-redo",category:"sidebar",categoryOrder:"3"},iconfullscreen:{name:"icon-fullscreen",sig:" [String], [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, toggles fullscreen mode on or off.  ",anchor:"macro_icon-fullscreen",category:"sidebar",categoryOrder:"4"},iconrestart:{name:"icon-restart",sig:" [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, reloads the whole page, restarting the story from the beginning.  ",anchor:"macro_icon-restart",category:"sidebar",categoryOrder:"5"},iconcounter:{name:"icon-counter",sig:" Bind, String, [String]",returnType:"Command",aka:[],abstract:"A command that creates a numeric counter element with a text label, designed to fit in the sidebar, displaying the contents of a number variable (rounded to a whole number as if by (trunc:)), and updating it whenever another macro changes it.  ",anchor:"macro_icon-counter",category:"sidebar",categoryOrder:"6"},meter:{name:"meter",sig:" Bind, Number, String, [String], [Colour or Gradient]",returnType:"Command",aka:[],abstract:"A command that creates a horizontal bar-graph meter, showing the current value of a number variable, relative to a maximum value, and updating it whenever that variable changes.  ",anchor:"macro_meter",category:"input and interface"},cyclinglink:{name:"cycling-link",sig:" [Bind], ...String",returnType:"Command",aka:[],abstract:"A command that, when evaluated, creates a cycling link - a link which does not go anywhere, but changes its own text to the next in a looping sequence of strings, and sets the optional bound variable to match the string value of the text.  ",anchor:"macro_cycling-link",category:"input and interface",categoryOrder:"1"},seqlink:{name:"seq-link",sig:" [Bind], ...String",returnType:"Command",aka:["sequence-link"],abstract:"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  ",anchor:"macro_seq-link",category:"input and interface",categoryOrder:"2"},sequencelink:{name:"seq-link",sig:" [Bind], ...String",returnType:"Command",aka:["sequence-link"],abstract:"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  ",anchor:"macro_seq-link",category:"input and interface",categoryOrder:"2"},dropdown:{name:"dropdown",sig:" Bind, ...String",returnType:"Command",aka:[],abstract:"A command that, when evaluated, creates a dropdown menu with the given strings as options. When one option is selected, the bound variable is set to match the string value of the text.  ",anchor:"macro_dropdown",category:"input and interface"},checkbox:{name:"checkbox",sig:" Bind, String",returnType:"Command",aka:[],abstract:"A command that creates a checkbox input, which sets the given bound variable to `true` or `false`, depending on its state.  ",anchor:"macro_checkbox",category:"input and interface",categoryOrder:"7"},checkboxfullscreen:{name:"checkbox-fullscreen",sig:" String",returnType:"Command",aka:[],abstract:"A command that creates a checkbox input, which toggles the browser's fullscreen mode and windowed mode. The checkbox will automatically update to match the browser's fullscreen status. If fullscreen mode cannot be entered, the checkbox will be disabled.  ",anchor:"macro_checkbox-fullscreen",category:"input and interface",categoryOrder:"8"},input:{name:"input",sig:" [Bind], [String], [String]",returnType:"Command",aka:[],abstract:"A command macro that creates a single-line text input element, allowing the player to input any amount of text without newlines, which can optionally be automatically stored in a variable. The first string specifies the horizontal position and width, and the second string specifies an initial default value to fill the element with.  ",anchor:"macro_input",category:"input and interface",categoryOrder:"3"},forceinput:{name:"force-input",sig:" [Bind], [String], String",returnType:"Command",aka:[],abstract:"A command macro that creates a single-line text input element which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  ",anchor:"macro_force-input",category:"input and interface",categoryOrder:"4"},inputbox:{name:"input-box",sig:" [Bind], [String], [Number], [String]",returnType:"Command",aka:[],abstract:"A command macro that creates a multi-line text input box of the given position, width (specified by the first, optional string) and height (specified by the optional number), allowing the player to input any amount of text, which can optionally be automatically stored in a variable. The final optional string specifies an initial default value to fill the box with.  ",anchor:"macro_input-box",category:"input and interface",categoryOrder:"5"},forceinputbox:{name:"force-input-box",sig:" [Bind], [String], [Number], String",returnType:"Command",aka:[],abstract:"A command macro that creates an empty text input box of the given position, width (specified by the first, optional string) and height (specified by the optional number), which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  ",anchor:"macro_force-input-box",category:"input and interface",categoryOrder:"6"},show:{name:"show",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Reveals hidden hooks, running the code within if it's not been shown yet.  ",anchor:"macro_show",category:"showing and hiding"},rerun:{name:"rerun",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Reruns hooks, restoring them to their original contents, and running the macros within them an additional time.  ",anchor:"macro_rerun",category:"revision"},hide:{name:"hide",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Hides a hook, or hooks, that were already visible, without fully erasing them or their contained macro calls.  ",anchor:"macro_hide",category:"showing and hiding"},scroll:{name:"scroll",sig:" HookName, Number or HookName",returnType:"Command",aka:[],abstract:"This command, when given a HookName, followed by a fraction (a number between 0 and 1), will change the scroll position of every hook with that name to the percentage of their height signified by the fraction. You may alternatively give another HookName instead, which, if a hook of that name is inside the first hook, will scroll the first hook and each containing hook such that the second hook is visible.  ",anchor:"macro_scroll",category:"window"},stop:{name:"stop",sig:"",returnType:"Command",aka:[],abstract:"This macro, which accepts no arguments, creates a (stop:) command, which is not configurable.  ",anchor:"macro_stop",category:"live",categoryOrder:"2"},loadgame:{name:"load-game",sig:" String",returnType:"Command",aka:[],abstract:"This command attempts to load a saved game from the given slot, ending the current game and replacing it with the loaded one. This causes the passage to change.  ",anchor:"macro_load-game",category:"saving"},forgetundos:{name:"forget-undos",sig:" Number",returnType:"Command",aka:[],abstract:'This macro, when used, "forgets" previous turns, preventing the player from using undo features (like (link-undo:)) to return to them. Providing a positive number will forget that many turns from the start of the game, and providing a negative number will forget all the turns up to that point from the end.  ',anchor:"macro_forget-undos",category:"game state",categoryOrder:"6"},forgetvisits:{name:"forget-visits",sig:" Number",returnType:"Command",aka:[],abstract:'This macro "forgets" all visits that occurred before the given turn number - any passage visits that occurred on those turns are treated as if they didn\'t happen. This causes (history:) to no longer list those passages at the start of the array, the `visits` identifier to report a different number for those passages, and (if the only visit to a passage was erased) the (visited:) macro to no longer regard a passage as visited.  ',anchor:"macro_forget-visits",category:"game state",categoryOrder:"5"},mockvisits:{name:"mock-visits",sig:" ...String",returnType:"Command",aka:[],abstract:'A macro that can only be used in debug mode, this allows you to mark various passages as "visited", even though the player actually hasn\'t. This allows you to quickly test passages that use the `visits` keyword, or the `(history:)` datamap, without having to play through the whole game from the start.  ',anchor:"macro_mock-visits",category:"debugging"},mockturns:{name:"mock-turns",sig:" Number",returnType:"Command",aka:[],abstract:"A macro that can only be used in debug mode, this allows you to artificially increase the number that the `visits` keyword evaluates to, without having to play through that many turns yourself.  ",anchor:"macro_mock-turns",category:"debugging"},seed:{name:"seed",sig:" String",returnType:"Command",aka:[],abstract:'A command that "fixes" Harlowe\'s random number generator, causing all random macros and features to output predetermined values based on the given "seed" string.  ',anchor:"macro_seed",category:"game state"},dialog:{name:"dialog",sig:" [Bind], String or CodeHook, ...String",returnType:"Command",aka:["alert"],abstract:"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  ",anchor:"macro_dialog",category:"popup",categoryOrder:"1"},alert:{name:"dialog",sig:" [Bind], String or CodeHook, ...String",returnType:"Command",aka:["alert"],abstract:"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  ",anchor:"macro_dialog",category:"popup",categoryOrder:"1"},openurl:{name:"open-url",sig:" String",returnType:"Command",aka:[],abstract:"When this macro is evaluated, the player's browser attempts to open a new tab with the given URL. This will usually require confirmation from the player, as most browsers block Javascript programs such as Harlowe from opening tabs by default.  ",anchor:"macro_open-url",category:"window"},restart:{name:"restart",sig:"",returnType:"Command",aka:["reload"],abstract:"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  ",anchor:"macro_restart",category:"navigation"},reload:{name:"restart",sig:"",returnType:"Command",aka:["reload"],abstract:"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  ",anchor:"macro_restart",category:"navigation"},gotourl:{name:"goto-url",sig:" String",returnType:"Command",aka:[],abstract:"When this command is used, the player's browser will immediately attempt to leave the story's page, and navigate to the given URL in the same tab. If this succeeds, then the story session will \"end\".  ",anchor:"macro_goto-url",category:"window"},ignore:{name:"ignore",sig:" [...Any]",returnType:"Command",aka:[],abstract:"If you want to test your passage while ignoring a specific command macro in it, temporarily change that command macro's name to (ignore:), and it will ignore all of the data given to it.  ",anchor:"macro_ignore",category:"debugging",categoryOrder:"1"},assertexists:{name:"assert-exists",sig:" HookName or String",returnType:"Command",aka:[],abstract:"A debugging macro that confirms whether a hook with the given name, or passage text matching the given string, is present in the passage. If not, it will produce a helpful error. Use this to test whether enchantment macros like (click:), (enchant:) or (show:) are working properly.  ",anchor:"macro_assert-exists",category:"debugging",categoryOrder:"5"},assert:{name:"assert",sig:" Boolean",returnType:"Instant",aka:[],abstract:"A debugging macro that produces a helpful error whenever the expression given to it produces Boolean false. Use this when testing your story to help ensure that certain facts about the game state are true or not.  ",anchor:"macro_assert",category:"debugging",categoryOrder:"4"},savegame:{name:"save-game",sig:" String, [String]",returnType:"Boolean",aka:[],abstract:"This macro saves the current game's state in browser storage, in the given save slot, and including a special filename. It can then be restored using (load-game:).  ",anchor:"macro_save-game",category:"saving"},prompt:{name:"prompt",sig:" String or CodeHook, String, [String], [String]",returnType:"String",aka:[],abstract:'When this macro is evaluated, a browser pop-up dialog box is shown with the first string displayed, a text entry box containing the second string (as a default value), a confirm link and a cancel link. If the confirm link is clicked, it evaluates to the string in the text entry box. If "Cancel" is clicked, it evaluates to the default value regardless of the entry box\'s contents.  ',anchor:"macro_prompt",category:"popup"},confirm:{name:"confirm",sig:" String or CodeHook, [String], [String]",returnType:"Boolean",aka:[],abstract:"When this macro is evaluated, a pop-up dialog box is shown with the given string displayed, as well as two links (whose text can also be provided) to confirm or cancel whatever action or fact the string tells the player. When it is submitted, it evaluates to the boolean `true` if the confirm link had been clicked, and `false` if the cancel link had.  ",anchor:"macro_confirm",category:"popup"},pageurl:{name:"page-url",sig:"",returnType:"String",aka:[],abstract:"This macro produces the full URL of the story's HTML page, as it is in the player's browser.  ",anchor:"macro_page-url",category:"window"},mp3url:{name:"mp3-url",sig:"",returnType:"String",aka:[],abstract:"设置MP3音乐地址  ",anchor:"macro_mp3-url",category:"window"},mp3set:{name:"mp3-set",sig:"",returnType:"Boolean",aka:[],abstract:"\t 播放/暂停MP3音乐 \t ",anchor:"macro_mp3-set",category:"window"},mp3loop:{name:"mp3-loop",sig:"",returnType:"Boolean",aka:[],abstract:"\t 设置MP3音乐循环 \t ",anchor:"macro_mp3-loop",category:"window"},macro:{name:"macro",sig:" [...TypedVar], CodeHook",returnType:"CustomMacro",aka:[],abstract:"Use this macro to construct your own custom macros, which you can (set:) into variables and call as easily as a built-in macro.  ",anchor:"macro_macro",category:"custom macros",categoryOrder:"1"},outputdata:{name:"output-data",sig:" Any",returnType:"Instant",aka:["out-data"],abstract:"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  ",anchor:"macro_output-data",category:"custom macros",categoryOrder:"3"},outdata:{name:"output-data",sig:" Any",returnType:"Instant",aka:["out-data"],abstract:"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  ",anchor:"macro_output-data",category:"custom macros",categoryOrder:"3"},output:{name:"output",sig:"",returnType:"Changer",aka:["out"],abstract:"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  ",anchor:"macro_output",category:"custom macros",categoryOrder:"2"},out:{name:"output",sig:"",returnType:"Changer",aka:["out"],abstract:"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  ",anchor:"macro_output",category:"custom macros",categoryOrder:"2"},error:{name:"error",sig:" String",returnType:"Instant",aka:[],abstract:"Designed for use in custom macros, this causes the custom macro to immediately produce an error, with the given message string, and ceases running any further code in the CodeHook.  ",anchor:"macro_error",category:"custom macros",categoryOrder:"4"},partial:{name:"partial",sig:" String or CustomMacro, [...Any]",returnType:"CustomMacro",aka:[],abstract:"When given either the string name of a built-in macro, or a custom macro, followed by various values, this creates a custom macro that serves as a shorthand for calling the given macro with those values, plus any additional values.  ",anchor:"macro_partial",category:"custom macros"},a:{name:"a",sig:" [...Any]",returnType:"Array",aka:["array"],abstract:"Creates an array, which is an ordered collection of values.  ",anchor:"macro_a",category:"data structure",categoryOrder:"1"},array:{name:"a",sig:" [...Any]",returnType:"Array",aka:["array"],abstract:"Creates an array, which is an ordered collection of values.  ",anchor:"macro_a",category:"data structure",categoryOrder:"1"},range:{name:"range",sig:" Number, Number",returnType:"Array",aka:[],abstract:"Produces an array containing an inclusive range of whole numbers from a to b, in ascending order.  ",anchor:"macro_range",category:"data structure"},subarray:{name:"subarray",sig:" Array, Number, Number",returnType:"Array",aka:[],abstract:"When given an array, this returns a new array containing only the elements whose positions are between the two numbers, inclusively.  ",anchor:"macro_subarray",category:"data structure"},reversed:{name:"reversed",sig:" [...Any]",returnType:"Array",aka:[],abstract:"Similar to (a:), except that it creates an array containing the elements in reverse order.  ",anchor:"macro_reversed",category:"data structure"},shuffled:{name:"shuffled",sig:" ...Any",returnType:"Array",aka:[],abstract:"Similar to (a:), this produces an array of the given values, except that it randomly rearranges the elements instead of placing them in the given order.  ",anchor:"macro_shuffled",category:"data structure"},sorted:{name:"sorted",sig:" [Lambda], ...Any",returnType:"Array",aka:[],abstract:'This macro produces an array in which the values are sorted in English alphanumeric sort order. If any of the values are not numbers or strings, a "via" lambda must be given first, which is used to translate the value into a number or string that it should be sorted by.  ',anchor:"macro_sorted",category:"data structure"},rotated:{name:"rotated",sig:" Number, ...Any",returnType:"Array",aka:[],abstract:"Similar to the (a:) macro, but it also takes a number at the start, and moves each item forward by that number, wrapping back to the start if they pass the end of the array.  ",anchor:"macro_rotated",category:"data structure"},rotatedto:{name:"rotated-to",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:'Similar to the (a:) macro, but it also takes a "where" lambda at the start, and cycles the order of the subsequent values so that the first value to match the lambda is placed at the start.  ',anchor:"macro_rotated-to",category:"data structure"},repeated:{name:"repeated",sig:" Number, ...Any",returnType:"Array",aka:[],abstract:"When given a number and a sequence of values, this macro produces an array containing those values repeated, in order, by the given number of times.  ",anchor:"macro_repeated",category:"data structure"},interlaced:{name:"interlaced",sig:" Array, ...Array",returnType:"Array",aka:[],abstract:"Takes multiple arrays, and pairs up each value in those arrays: it creates an array containing each array's first value followed by each array's second value, and so forth. If some values have no matching pair (i.e. one array is longer than the other) then those values are ignored.  ",anchor:"macro_interlaced",category:"data structure"},permutations:{name:"permutations",sig:" ...Any",returnType:"Array",aka:[],abstract:"When given a sequence of values, this produces an array containing each permutation of the order of those values, as arrays.  ",anchor:"macro_permutations",category:"data structure"},unique:{name:"unique",sig:" ...Any",returnType:"Array",aka:[],abstract:"When given a sequence of values, this produces an array containing each unique value once, in the order that they appeared.  ",anchor:"macro_unique",category:"data structure"},altered:{name:"altered",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:'This takes a "via" lambda and a sequence of values, and creates a new array with the same values in the same order, but altered via the operation in the lambda\'s "via" clause. An optional "where" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ',anchor:"macro_altered",category:"data structure"},find:{name:"find",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:"This searches through the given values, and produces an array of those which match the given search test (which is expressed using a temp variable, the `where` keyword, and a boolean condition). If none match, an empty array is produced.  ",anchor:"macro_find",category:"data structure"},allpass:{name:"all-pass",sig:" Lambda, [...Any]",returnType:"Boolean",aka:["pass"],abstract:'This takes a "where" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:"macro_all-pass",category:"data structure"},pass:{name:"all-pass",sig:" Lambda, [...Any]",returnType:"Boolean",aka:["pass"],abstract:'This takes a "where" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:"macro_all-pass",category:"data structure"},somepass:{name:"some-pass",sig:" Lambda, ...Any",returnType:"Boolean",aka:[],abstract:"This is similar to (all-pass:), but produces true if one or more value, when given to the lambda, evaluated to true. It can be thought of as shorthand for putting `not` in front of (none-pass:). If zero values are given to (all-pass:), then it will return false by default. For more information, consult the description of (all-pass:).  ",anchor:"macro_some-pass",category:"data structure"},nonepass:{name:"none-pass",sig:" Lambda, ...Any",returnType:"Boolean",aka:[],abstract:"This can be thought of as the opposite of (all-pass:): it produces true if every value, when given to the lambda, never evaluated to true. If zero values are given to (none-pass:), then it will return true by default, just like (all-pass:). For more information, consult the description of (all-pass:).  ",anchor:"macro_none-pass",category:"data structure"},folded:{name:"folded",sig:" Lambda, ...Any",returnType:"Any",aka:[],abstract:'This takes a "making" lambda and a sequence of values, and creates a new value (the "total") by feeding every value in the sequence to the lambda, akin to folding a long strip of paper into a single square. The first value after the lambda is put into the total (which is the variable inside the lambda\'s "making" clause) before running the lambda on the remaining values.  ',anchor:"macro_folded",category:"data structure"},dmnames:{name:"dm-names",sig:" Datamap",returnType:"Array",aka:["data-names","datamap-names"],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_dm-names",category:"data structure"},datanames:{name:"dm-names",sig:" Datamap",returnType:"Array",aka:["data-names","datamap-names"],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_dm-names",category:"data structure"},datamapnames:{name:"dm-names",sig:" Datamap",returnType:"Array",aka:["data-names","datamap-names"],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_dm-names",category:"data structure"},dmvalues:{name:"dm-values",sig:" Datamap",returnType:"Array",aka:["data-values","datamap-values"],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_dm-values",category:"data structure"},datavalues:{name:"dm-values",sig:" Datamap",returnType:"Array",aka:["data-values","datamap-values"],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_dm-values",category:"data structure"},datamapvalues:{name:"dm-values",sig:" Datamap",returnType:"Array",aka:["data-values","datamap-values"],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_dm-values",category:"data structure"},dmentries:{name:"dm-entries",sig:" Datamap",returnType:"Array",aka:["data-entries","datamap-entries"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dm-entries",category:"data structure"},dataentries:{name:"dm-entries",sig:" Datamap",returnType:"Array",aka:["data-entries","datamap-entries"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dm-entries",category:"data structure"},datamapentries:{name:"dm-entries",sig:" Datamap",returnType:"Array",aka:["data-entries","datamap-entries"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dm-entries",category:"data structure"},dmaltered:{name:"dm-altered",sig:" Lambda, Datamap",returnType:"Datamap",aka:["datamap-altered"],abstract:"This is a variant of (altered:) which takes a \"via\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \"where\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ",anchor:"macro_dm-altered",category:"data structure"},datamapaltered:{name:"dm-altered",sig:" Lambda, Datamap",returnType:"Datamap",aka:["datamap-altered"],abstract:"This is a variant of (altered:) which takes a \"via\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \"where\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ",anchor:"macro_dm-altered",category:"data structure"},history:{name:"history",sig:" [Lambda]",returnType:"Array",aka:[],abstract:"This returns an array containing the string names of all of the passages the player has previously visited up to now, in the order that the player visited them. An optional lambda can filter the passages, by checking the (passage:) datamap of each. The (mock-visits:) macro can, during debugging, artifically add values to this array to simulate having visited various passages.  ",anchor:"macro_history",category:"game state",categoryOrder:"1"},visited:{name:"visited",sig:" String or Lambda",returnType:"Boolean",aka:[],abstract:'When given a string, this macro produces true if the passage has ever been visited during this game, and false otherwise. When given a "where" lambda, this returns true if any passage matching the lambda has ever been visited during this game. The (mock-visits:) macro can, during debugging, make this macro return true in cases where it would otherwise be false.  ',anchor:"macro_visited",category:"game state",categoryOrder:"2"},passage:{name:"passage",sig:" [String]",returnType:"Datamap",aka:[],abstract:"When given a passage string name, this provides a datamap containing information about that passage. If no name was provided, then it provides information about the current passage.  ",anchor:"macro_passage",category:"game state",categoryOrder:"3"},passages:{name:"passages",sig:" [Lambda]",returnType:"Array",aka:[],abstract:"This returns an array containing datamaps of information for the passages in the story, sorted by passage name, and using the optional search test to only include certain types of passages.  ",anchor:"macro_passages",category:"game state",categoryOrder:"4"},openstorylets:{name:"open-storylets",sig:" [Lambda]",returnType:"Array",aka:[],abstract:'Checks all of the (storylet:) macros in every passage, and provides an array of datamaps for every passage whose (storylet:) lambda produced true, sorted by their "urgency" metadata value, then by passage name. If a lambda was provided, the storylets are filtered using it as a search test.  ',anchor:"macro_open-storylets",category:"storylet",categoryOrder:"2"},savedgames:{name:"saved-games",sig:"",returnType:"Datamap",aka:[],abstract:"This returns a datamap containing the names of currently occupied save game slots.  ",anchor:"macro_saved-games",category:"saving"},dm:{name:"dm",sig:" [...Any]",returnType:"Datamap",aka:["datamap"],abstract:"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  ",anchor:"macro_dm",category:"data structure",categoryOrder:"2"},datamap:{name:"dm",sig:" [...Any]",returnType:"Datamap",aka:["datamap"],abstract:"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  ",anchor:"macro_dm",category:"data structure",categoryOrder:"2"},ds:{name:"ds",sig:" [...Any]",returnType:"Dataset",aka:["dataset"],abstract:"Creates a dataset, which is an unordered collection of unique values.  ",anchor:"macro_ds",category:"data structure",categoryOrder:"3"},dataset:{name:"ds",sig:" [...Any]",returnType:"Dataset",aka:["dataset"],abstract:"Creates a dataset, which is an unordered collection of unique values.  ",anchor:"macro_ds",category:"data structure",categoryOrder:"3"},count:{name:"count",sig:" Array or String, ...Any",returnType:"Number",aka:[],abstract:"Accepts a string or array, followed by a value, and produces the number of times any of the values are inside the string or array.  ",anchor:"macro_count",category:"data structure"},change:{name:"change",sig:" HookName or String, Changer or Lambda",returnType:"Command",aka:[],abstract:'Applies a changer (or a "via" lambda producing a changer) to every occurrence of a hook or string in a passage, once.  ',anchor:"macro_change",category:"basics",categoryOrder:"17"},enchant:{name:"enchant",sig:" HookName or String, Changer or Lambda",returnType:"Command",aka:[],abstract:'Applies a changer (or a "via" lambda producing a changer) to every occurrence of a hook or string in a passage, and continues applying that changer to any further occurrences that are made to appear in the same passage later.  ',anchor:"macro_enchant",category:"basics",categoryOrder:"18"},enchantin:{name:"enchant-in",sig:" HookName or String, Changer or Lambda",returnType:"Changer",aka:[],abstract:"A variation of (enchant:) and (change:), this applies a changer to every occurrence of a hook or string within just the attached hook, rather than the whole passage. As with (enchant:), the changer will be applied to every additional occurrence inserted into the attached hook.  ",anchor:"macro_enchant-in",category:"basics",categoryOrder:"19"},linkstyle:{name:"link-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the links inside the hook to be styled using the specified changer. This is equivalent to using (enchant-in:) with `?link`.  ",anchor:"macro_link-style",category:"styling"},linestyle:{name:"line-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the lines of prose inside the hook (identical to those that would be selected by `?page's lines`) to be styled using the specified changer.  ",anchor:"macro_line-style",category:"styling"},charstyle:{name:"char-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the individual non-whitespace characters inside the hook (identical to those that would be selected by `?page's chars`) to be styled using the specified changer.  ",anchor:"macro_char-style",category:"styling"},replace:{name:"replace",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"Creates a command which you can attach to a hook, and replace target destinations with the hook's contents. The targets are either text strings within the current passage, or hook references.  Not to be confused with (str-replaced:).  ",anchor:"macro_replace",category:"revision",categoryOrder:"1"},replacewith:{name:"replace-with",sig:" String or CodeHook",returnType:"Changer",aka:[],abstract:"A counterpart to (append-with:) and (prepend-with:), this replaces the entirety of the attached hook with the contents of the given string (or code hook).  ",anchor:"macro_replace-with",category:"revision",categoryOrder:"4"},append:{name:"append",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"A variation of (replace:) which adds the attached hook's contents to the end of each target, rather than replacing it entirely.  ",anchor:"macro_append",category:"revision",categoryOrder:"2"},appendwith:{name:"append-with",sig:" String or CodeHook",returnType:"Changer",aka:[],abstract:"Creates a changer that, when attached to a hook, adds the contents of the given string (or code hook) to the end of the hook.  ",anchor:"macro_append-with",category:"revision",categoryOrder:"5"},prepend:{name:"prepend",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"A variation of (replace:) which adds the attached hook's contents to the beginning of each target, rather than replacing it entirely.  ",anchor:"macro_prepend",category:"revision",categoryOrder:"3"},prependwith:{name:"prepend-with",sig:" String or CodeHook",returnType:"Changer",aka:[],abstract:"Creates a changer that, when attached to a hook, adds the contents of a given string (or code hook) to the start of the hook.  ",anchor:"macro_prepend-with",category:"revision",categoryOrder:"6"},click:{name:"click",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"Produces a changer which, when attached to a hook, hides it and enchants the specified target, such that it visually resembles a link, and that clicking it causes the attached hook to be revealed.  ",anchor:"macro_click",category:"links",categoryOrder:"9"},clickrerun:{name:"click-rerun",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special version of the (click:) macro which allows the enchanted hook or text (specified by the first value) to be activated multiple times to re-run the attached hook.  ",anchor:"macro_click-rerun",category:"links",categoryOrder:"10"},mouseover:{name:"mouseover",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover",category:"deprecated"},mouseout:{name:"mouseout",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout",category:"deprecated"},clickreplace:{name:"click-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (replace:) macros, this allows you to make a hook replace its own text with that of the attached hook whenever it's clicked. `(click: ?1)[(replace:?1)[...]]` can be rewritten as `(click-replace: ?1)[...]`.  ",anchor:"macro_click-replace",category:"links",categoryOrder:"10"},clickappend:{name:"click-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (append:) macros, this allows you to append text to a hook or string when it's clicked. `(click: ?1)[(append:?1)[...]]` can be rewritten as `(click-append: ?1)[...]`.  ",anchor:"macro_click-append",category:"links",categoryOrder:"11"},clickprepend:{name:"click-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (prepend:) macros, this allows you to prepend text to a hook or string when it's clicked. `(click: ?1)[(prepend:?1)[...]]` can be rewritten as `(click-prepend: ?1)[...]`.  ",anchor:"macro_click-prepend",category:"links",categoryOrder:"12"},mouseoverreplace:{name:"mouseover-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover-replace",category:"deprecated"},mouseoverappend:{name:"mouseover-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover-append",category:"deprecated"},mouseoverprepend:{name:"mouseover-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover-prepend",category:"deprecated"},mouseoutreplace:{name:"mouseout-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout-replace",category:"deprecated"},mouseoutappend:{name:"mouseout-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout-append",category:"deprecated"},mouseoutprepend:{name:"mouseout-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout-prepend",category:"deprecated"},clickgoto:{name:"click-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"A special shorthand combination of the (click:) and (go-to:) macros, this allows you to make a hook or bit of text into a passage link. `(click-goto: ?1, 'Passage Name')` is equivalent to `(click: ?1)[(goto:'Passage Name')]`  ",anchor:"macro_click-goto",category:"links",categoryOrder:"11"},mouseovergoto:{name:"mouseover-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseover-goto",category:"deprecated"},mouseoutgoto:{name:"mouseout-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseout-goto",category:"deprecated"},clickundo:{name:"click-undo",sig:" HookName or String",returnType:"Command",aka:[],abstract:"A special shorthand combination of the (click:) and (undo:) macros, this allows you to make a hook or bit of text into a passage link. `(click-undo: ?1)` is equivalent to `(click: ?1)[(undo: )]`  ",anchor:"macro_click-undo",category:"links",categoryOrder:"11"},mouseoverundo:{name:"mouseover-undo",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseover-undo",category:"deprecated"},mouseoutundo:{name:"mouseout-undo",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseout-undo",category:"deprecated"},link:{name:"link",sig:" String, [Changer]",returnType:"Changer",aka:["link-replace"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link",category:"links",categoryOrder:"1"},linkreplace:{name:"link",sig:" String, [Changer]",returnType:"Changer",aka:["link-replace"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link",category:"links",categoryOrder:"1"},linkreveal:{name:"link-reveal",sig:" String, [Changer]",returnType:"Changer",aka:["link-append"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-reveal",category:"links",categoryOrder:"2"},linkappend:{name:"link-reveal",sig:" String, [Changer]",returnType:"Changer",aka:["link-append"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-reveal",category:"links",categoryOrder:"2"},linkrepeat:{name:"link-repeat",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to repeat itself - a copy of the hook's code will be run, and the result appended to it, in a manner similar to (for:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-repeat",category:"links",categoryOrder:"3"},linkrerun:{name:"link-rerun",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to rerun itself, as if by the effect of (rerun:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-rerun",category:"links",categoryOrder:"4"},linkgoto:{name:"link-goto",sig:" String, [String]",returnType:"Command",aka:[],abstract:"Takes a string of link text, and an optional destination passage name, and makes a command to create a link that takes the player to another passage. The link functions identically to a standard link.  ",anchor:"macro_link-goto",category:"links",categoryOrder:"5"},linkstorylet:{name:"link-storylet",sig:" [String], Number or Lambda, [String]",returnType:"Command",aka:[],abstract:"If there are storylets (storylets are passages containing a (storylet:) call) in this story, this will create a link to the first open storylet that matches the passed-in 'where' lambda, or, if a number **n** was passed in, the **n**th (or, if negative, **n**thlast) open storylet. An optional first string can provide the link text - otherwise, the link text is the passage name of the storylet. An optional final string can provide text to display when no such storylet is open currently.  ",anchor:"macro_link-storylet",category:"links",categoryOrder:"8"},linkundo:{name:"link-undo",sig:" String, [String]",returnType:"Command",aka:[],abstract:"Takes a string of link text, and produces a link that, when clicked, undoes the current turn and sends the player back to the previously visited passage. The link appears identical to a typical passage link. An optional second string can be provided, which is shown instead of the link if it's not possible to undo.  ",anchor:"macro_link-undo",category:"links",categoryOrder:"7"},linkshow:{name:"link-show",sig:" String, ...HookName",returnType:"Command",aka:[],abstract:"Creates a link that, when clicked, shows the given hidden hooks, running the code within.  ",anchor:"macro_link-show",category:"links",categoryOrder:"8"},linkfullscreen:{name:"link-fullscreen",sig:" String, String, [String]",returnType:"Command",aka:[],abstract:"Creates a link that, when clicked, toggles the browser's fullscreen mode and windowed mode. The first string is used as its link text if the browser is currently in windowed mode, and the second string if it's currently in fullscreen mode. The link will automatically update (re-rendering the link text) to match the browser's current fullscreen state. The optional third string is used when fullscreen mode isn't allowed by the browser - if it's absent or an empty string, the link won't be displayed at all in that situation.  ",anchor:"macro_link-fullscreen",category:"links",categoryOrder:"8"},linkrevealgoto:{name:"link-reveal-goto",sig:" String, [String], [Changer]",returnType:"Changer",aka:[],abstract:"This is a convenient combination of the (link-reveal:) and (go-to:) macros, designed to let you run commands like (set:) just before going to another passage. The first string is the link text, and the second is the passage name. An optional changer, with which to style the link, can also be provided.  ",anchor:"macro_link-reveal-goto",category:"links",categoryOrder:"6"},storylet:{name:"storylet",sig:" Lambda",returnType:"Metadata",aka:[],abstract:"When placed in a passage, it marks that passage as the beginning of a storylet, using the lambda as the condition upon which it's available to the player, so that other macros, like (open-storylets:), can see and select the passage.  ",anchor:"macro_storylet",category:"storylet",categoryOrder:"1"},urgency:{name:"urgency",sig:" Number",returnType:"Metadata",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less "urgent", meaning that (open-storylets:) will sort it earlier or later than other passages.  ',anchor:"macro_urgency",category:"storylet",categoryOrder:"4"},exclusivity:{name:"exclusivity",sig:" Number",returnType:"Metadata",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less "exclusive", meaning that if it\'s open, it will prevent storylets with lesser exclusivity from appearing in (open-storylets:).  ',anchor:"macro_exclusivity",category:"storylet",categoryOrder:"3"},metadata:{name:"metadata",sig:" [...Any]",returnType:"Metadata",aka:[],abstract:"When placed in a passage, this adds the given names and values to the (passage:) datamap for this passage.  ",anchor:"macro_metadata",category:"game state"},p:{name:"p",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern"],abstract:"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  ",anchor:"macro_p",category:"patterns",categoryOrder:"1"},pattern:{name:"p",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern"],abstract:"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  ",anchor:"macro_p",category:"patterns",categoryOrder:"1"},peither:{name:"p-either",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-either"],abstract:"Creates a string pattern that matches either of the single strings or datatypes given.  ",anchor:"macro_p-either",category:"patterns",categoryOrder:"2"},patterneither:{name:"p-either",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-either"],abstract:"Creates a string pattern that matches either of the single strings or datatypes given.  ",anchor:"macro_p-either",category:"patterns",categoryOrder:"2"},popt:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},patternopt:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},poptional:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},patternoptional:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},pnot:{name:"p-not",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not"],abstract:"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  ",anchor:"macro_p-not",category:"patterns",categoryOrder:"6"},patternnot:{name:"p-not",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not"],abstract:"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  ",anchor:"macro_p-not",category:"patterns",categoryOrder:"6"},pnotbefore:{name:"p-not-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not-before"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-not-before",category:"patterns",categoryOrder:"8"},patternnotbefore:{name:"p-not-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not-before"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-not-before",category:"patterns",categoryOrder:"8"},pbefore:{name:"p-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-before"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-before",category:"patterns",categoryOrder:"7"},patternbefore:{name:"p-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-before"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-before",category:"patterns",categoryOrder:"7"},pstart:{name:"p-start",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-start"],abstract:"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very start of the string.  ",anchor:"macro_p-start",category:"patterns",categoryOrder:"9"},patternstart:{name:"p-end",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-start"],abstract:"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  ",anchor:"macro_p-end",category:"patterns",categoryOrder:"10"},pend:{name:"p-end",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-start"],abstract:"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  ",anchor:"macro_p-end",category:"patterns",categoryOrder:"10"},pmany:{name:"p-many",sig:" [Number], [Number], ...String or Datatype",returnType:"Datatype",aka:["pattern-many"],abstract:"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  ",anchor:"macro_p-many",category:"patterns",categoryOrder:"4"},patternmany:{name:"p-many",sig:" [Number], [Number], ...String or Datatype",returnType:"Datatype",aka:["pattern-many"],abstract:"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  ",anchor:"macro_p-many",category:"patterns",categoryOrder:"4"},pins:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},pinsensitive:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},patternins:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},patterninsensitive:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},split:{name:"split",sig:" String or Datatype, String",returnType:"Array",aka:["splitted"],abstract:"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  ",anchor:"macro_split",category:"string"},splitted:{name:"split",sig:" String or Datatype, String",returnType:"Array",aka:["splitted"],abstract:"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  ",anchor:"macro_split",category:"string"},trimmed:{name:"trimmed",sig:" [String or Datatype], String",returnType:"String",aka:[],abstract:"This macro takes one string (the last value), and produces a copy with every character matching the given pattern (the first value) removed from the start and end of it. If no pattern is given, it defaults to removing whitespace, as if `whitespace` was the first argument.  ",anchor:"macro_trimmed",category:"string"},strfind:{name:"str-find",sig:" Datatype, String",returnType:"Array",aka:["string-find"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a "match" data name for the full substring.  ',anchor:"macro_str-find",category:"string"},stringfind:{name:"str-find",sig:" Datatype, String",returnType:"Array",aka:["string-find"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a "match" data name for the full substring.  ',anchor:"macro_str-find",category:"string"},strreplaced:{name:"str-replaced",sig:" [Number], String or Datatype, String or Lambda, String",returnType:"String",aka:["string-replaced","replaced"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a "via" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the "via" lambda.  ',anchor:"macro_str-replaced",category:"string"},stringreplaced:{name:"str-replaced",sig:" [Number], String or Datatype, String or Lambda, String",returnType:"String",aka:["string-replaced","replaced"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a "via" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the "via" lambda.  ',anchor:"macro_str-replaced",category:"string"},replaced:{name:"str-replaced",sig:" [Number], String or Datatype, String or Lambda, String",returnType:"String",aka:["string-replaced","replaced"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a "via" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the "via" lambda.  ',anchor:"macro_str-replaced",category:"string"},if:{name:"if",sig:" Boolean",returnType:"Changer",aka:[],abstract:'This macro accepts only booleans (variables with `true` or `false`, or expressions using `is`, `contains`, or another such operator), and produces a changer that can be attached to hooks to hide them "if" the value was false.  ',anchor:"macro_if",category:"basics",categoryOrder:"6"},unless:{name:"unless",sig:" Boolean",returnType:"Changer",aka:[],abstract:'This macro is the negated form of (if:): it accepts only booleans, and returns a changer that can be attached hooks to hide them "if" the value was true.  For more information, see the documentation of (if:).  ',anchor:"macro_unless",category:"basics",categoryOrder:"7"},elseif:{name:"else-if",sig:" Boolean",returnType:"Changer",aka:[],abstract:"This macro's result changes depending on whether the previous hook in the passage was shown or hidden. If the previous hook was shown, then this changer hides the attached hook. Otherwise, it acts like (if:), showing the attached hook if it's true, and hiding it if it's false. If there was no preceding hook before this, then an error message will be printed.  ",anchor:"macro_else-if",category:"basics",categoryOrder:"8"},else:{name:"else",sig:"",returnType:"Changer",aka:[],abstract:"This is a convenient limited variant of the (else-if:) macro. It will simply show the attached hook if the preceding hook was hidden, and hide it otherwise. If there was no preceding hook before this, then an error message will be printed.  ",anchor:"macro_else",category:"basics",categoryOrder:"9"},hidden:{name:"hidden",sig:"",returnType:"Changer",aka:[],abstract:"Produces a changer that can be attached to hooks to hide them.  ",anchor:"macro_hidden",category:"showing and hiding"},verbatim:{name:"verbatim",sig:"",returnType:"Changer",aka:["v6m"],abstract:"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  ",anchor:"macro_verbatim",category:"basics",categoryOrder:"15"},v6m:{name:"verbatim",sig:"",returnType:"Changer",aka:["v6m"],abstract:"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  ",anchor:"macro_verbatim",category:"basics",categoryOrder:"15"},live:{name:"live",sig:" [Number]",returnType:"Changer",aka:[],abstract:'When you attach this changer to a hook, the hook becomes "live", which means that it\'s repeatedly re-run every certain number of milliseconds, replacing the source inside of the hook with a newly computed version.  ',anchor:"macro_live",category:"live",categoryOrder:"1"},event:{name:"event",sig:" Lambda",returnType:"Changer",aka:[],abstract:"Hooks that have this changer attached will only be run when the given condition becomes true.  ",anchor:"macro_event",category:"live",categoryOrder:"3"},more:{name:"more",sig:"",returnType:"Changer",aka:[],abstract:'Hooks that have this changer attached will only be run once no other exits - links and (click:)-enchanted areas - are remaining in the passage, and will reveal "more" prose.  ',anchor:"macro_more",category:"live",categoryOrder:"5"},after:{name:"after",sig:" Number, [Number]",returnType:"Changer",aka:[],abstract:"Hooks that have this changer attached will only be run once the given amount of time has passed since the passage was rendered. An optional second number specifies that the player can speed up the delay by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_after",category:"live",categoryOrder:"4"},aftererror:{name:"after-error",sig:"",returnType:"Changer",aka:[],abstract:"A bug-specific event macro, this hides the hook and only causes it to run once an error occurs.  ",anchor:"macro_after-error",category:"live",categoryOrder:"5"},hook:{name:"hook",sig:" String",returnType:"Changer",aka:[],abstract:"A changer that allows the author to give a hook a computed tag name.  ",anchor:"macro_hook",category:"styling"},for:{name:"for",sig:" Lambda, [...Any]",returnType:"Changer",aka:["loop"],abstract:"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  ",anchor:"macro_for",category:"basics",categoryOrder:"10"},loop:{name:"for",sig:" Lambda, [...Any]",returnType:"Changer",aka:["loop"],abstract:"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  ",anchor:"macro_for",category:"basics",categoryOrder:"10"},transition:{name:"transition",sig:" String",returnType:"Changer",aka:["t8n"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `"instant"`, `"dissolve"`, `"fade"`, `"rumble"`, `"shudder"`, `"pulse"`, `"zoom"`, `"flicker"`, `"slide-left"`, `"slide-right"`, `"slide-up"`, `"slide-down"`, `"fade-left"`, `"fade-right"`, `"fade-up"` and `"fade-down"`.  ',anchor:"macro_transition",category:"transitions",categoryOrder:"1"},t8n:{name:"transition",sig:" String",returnType:"Changer",aka:["t8n"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `"instant"`, `"dissolve"`, `"fade"`, `"rumble"`, `"shudder"`, `"pulse"`, `"zoom"`, `"flicker"`, `"slide-left"`, `"slide-right"`, `"slide-up"`, `"slide-down"`, `"fade-left"`, `"fade-right"`, `"fade-up"` and `"fade-down"`.  ',anchor:"macro_transition",category:"transitions",categoryOrder:"1"},transitiontime:{name:"transition-time",sig:" Number",returnType:"Changer",aka:["t8n-time"],abstract:"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  ",anchor:"macro_transition-time",category:"transitions",categoryOrder:"2"},t8ntime:{name:"transition-time",sig:" Number",returnType:"Changer",aka:["t8n-time"],abstract:"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  ",anchor:"macro_transition-time",category:"transitions",categoryOrder:"2"},transitiondelay:{name:"transition-delay",sig:" Number",returnType:"Changer",aka:["t8n-delay"],abstract:"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  ",anchor:"macro_transition-delay",category:"transitions",categoryOrder:"2"},t8ndelay:{name:"transition-delay",sig:" Number",returnType:"Changer",aka:["t8n-delay"],abstract:"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  ",anchor:"macro_transition-delay",category:"transitions",categoryOrder:"2"},transitionskip:{name:"transition-skip",sig:" Number",returnType:"Changer",aka:["t8n-skip"],abstract:"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_transition-skip",category:"transitions",categoryOrder:"6"},t8nskip:{name:"transition-skip",sig:" Number",returnType:"Changer",aka:["t8n-skip"],abstract:"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_transition-skip",category:"transitions",categoryOrder:"6"},transitiondepart:{name:"transition-depart",sig:" String",returnType:"Changer",aka:["t8n-depart"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  ",anchor:"macro_transition-depart",category:"transitions",categoryOrder:"4"},t8ndepart:{name:"transition-depart",sig:" String",returnType:"Changer",aka:["t8n-depart"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  ",anchor:"macro_transition-depart",category:"transitions",categoryOrder:"4"},transitionarrive:{name:"transition-arrive",sig:" String",returnType:"Changer",aka:["t8n-arrive"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  ",anchor:"macro_transition-arrive",category:"transitions",categoryOrder:"5"},t8narrive:{name:"transition-arrive",sig:" String",returnType:"Changer",aka:["t8n-arrive"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  ",anchor:"macro_transition-arrive",category:"transitions",categoryOrder:"5"},button:{name:"button",sig:" [String]",returnType:"Changer",aka:[],abstract:"When applied to a link, this changer styles it so that it resembles a button, and makes it take up the entire passage width. The optional sizing string lets you specify width and horizontal margins for the button. It is not recommended that this be used on non-link hooks.  ",anchor:"macro_button",category:"styling"},action:{name:"action",sig:" String",returnType:"Changer",aka:[],abstract:"When attached to a link command, or given to a link changer macro as the second value, this changer turns the link into a different kind of interaction element with a different appearance - one that is either activated by hovering the mouse pointer over it, hoving the mouse pointer off of it, or double-clicking it. This does nothing when attached or supplied to a non-link hook.  ",anchor:"macro_action",category:"links",categoryOrder:"99"},border:{name:"border",sig:" String, [String], [String], [String]",returnType:"Changer",aka:["b4r"],abstract:"A changer macro that applies a CSS border to the hook.  ",anchor:"macro_border",category:"borders",categoryOrder:"1"},b4r:{name:"border",sig:" String, [String], [String], [String]",returnType:"Changer",aka:["b4r"],abstract:"A changer macro that applies a CSS border to the hook.  ",anchor:"macro_border",category:"borders",categoryOrder:"1"},bordersize:{name:"border-size",sig:" Number, [Number], [Number], [Number]",returnType:"Changer",aka:["b4r-size"],abstract:"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by a given amount.  ",anchor:"macro_border-size",category:"borders",categoryOrder:"3"},b4rsize:{name:"border-size",sig:" Number, [Number], [Number], [Number]",returnType:"Changer",aka:["b4r-size"],abstract:"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by a given amount.  ",anchor:"macro_border-size",category:"borders",categoryOrder:"3"},cornerradius:{name:"corner-radius",sig:" Number, [Number], [Number], [Number]",returnType:"Changer",aka:[],abstract:"When applied to a hook, this rounds the corners by the given number of pixels, causing the hook to become increasingly round or button-like.  ",anchor:"macro_corner-radius",category:"borders",categoryOrder:"4"},bordercolour:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},b4rcolour:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},bordercolor:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},b4rcolor:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},opacity:{name:"opacity",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer changes how opaque the attached hook is, using a value from 0 to 1. Reducing the value makes it more transparent. An opacity of 0 makes the hook invisible.  ",anchor:"macro_opacity",category:"styling"},font:{name:"font",sig:" String",returnType:"Changer",aka:[],abstract:'This styling changer changes the font used to display the text of the attached hook. Provide the font\'s family name (such as "Helvetica Neue" or "Courier") as a string.  ',anchor:"macro_font",category:"styling"},align:{name:"align",sig:" String",returnType:"Changer",aka:[],abstract:"This styling changer changes the alignment of text in the attached hook, as if the `===>`~ arrow syntax was used. In fact, these same arrows (`==>`~, `=><=`~, `<==>`~, `====><=`~ etc.) should be supplied as a string to specify the degree of alignment.  ",anchor:"macro_align",category:"styling"},textcolour:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},colour:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},textcolor:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},color:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},textsize:{name:"text-size",sig:" Number",returnType:"Changer",aka:["size"],abstract:"This styling changer changes the text size of the attached hook by the given fraction. Give it a number greater than 1 to enlarge the text, and a number smaller to decrease the text. Providing 1 to this macro will revert the text size back to the default.  ",anchor:"macro_text-size",category:"styling"},size:{name:"text-size",sig:" Number",returnType:"Changer",aka:["size"],abstract:"This styling changer changes the text size of the attached hook by the given fraction. Give it a number greater than 1 to enlarge the text, and a number smaller to decrease the text. Providing 1 to this macro will revert the text size back to the default.  ",anchor:"macro_text-size",category:"styling"},textindent:{name:"text-indent",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer causes the attached hook to be indented by the given number of pixels.  ",anchor:"macro_text-indent",category:"styling"},textrotatez:{name:"text-rotate-z",sig:" Number",returnType:"Changer",aka:["text-rotate"],abstract:"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-z",category:"styling"},textrotate:{name:"text-rotate-z",sig:" Number",returnType:"Changer",aka:["text-rotate"],abstract:"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-z",category:"styling"},textrotatey:{name:"text-rotate-y",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer visually rotates the attached hook clockwise, around the Y axis (vertical), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-y",category:"styling"},textrotatex:{name:"text-rotate-x",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer visually rotates the attached hook clockwise, around the X axis (horizontal), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-x",category:"styling"},bg:{name:"bg",sig:" Colour or String or Gradient",returnType:"Changer",aka:["background"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like "#FA9138") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:"macro_bg",category:"styling"},background:{name:"bg",sig:" Colour or String or Gradient",returnType:"Changer",aka:["background"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like "#FA9138") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:"macro_bg",category:"styling"},textstyle:{name:"text-style",sig:" ...String",returnType:"Changer",aka:[],abstract:'This applies one or more selected built-in text styles to the hook\'s text. Give this macro one of these strings (capitalisation and hyphens ignored): `"none"`, `"bold"`, `"italic"`, `"underline"`, `"double-underline"`, `"wavy-underline"`, `"strike"`, `"double-strike"`, `"wavy-strike"`, `"superscript"`, `"subscript"`, `"blink"`, `"shudder"`, `"mark"`, `"condense"`, `"expand"`, `"outline"`, `"shadow"`, `"emboss"`, `"smear"`, `"blur"`, `"blurrier"`, `"mirror"`, `"upside-down"`, `"tall"`, `"flat"`, `"fade-in-out"`, `"rumble"`, `"sway"`, `"buoy"` or `"fidget"`.  ',anchor:"macro_text-style",category:"styling"},collapse:{name:"collapse",sig:"",returnType:"Changer",aka:[],abstract:"When attached to a hook, this collapses the whitespace within the hook, in the same manner as the collapsing whitespace markup.  ",anchor:"macro_collapse",category:"styling"},hoverstyle:{name:"hover-style",sig:" Changer",returnType:"Changer",aka:[],abstract:"Given a style-altering changer, it makes a changer which only applies when the hook or command is hovered over with the mouse pointer, and is removed when hovering off.  ",anchor:"macro_hover-style",category:"styling"},css:{name:"css",sig:" String",returnType:"Changer",aka:[],abstract:'This takes a string of inline CSS, and applies it to the hook, as if it were a HTML "style" property.  ',anchor:"macro_css",category:"styling"},testtrue:{name:"test-true",sig:" [...Any]",returnType:"Changer",aka:[],abstract:"If you want to test your passage, while ignoring a specific changer macro in it, temporarily change that changer macro's name to (test-true:), and it will ignore all of the data given to it, while enabling the hook.  ",anchor:"macro_test-true",category:"debugging",categoryOrder:"2"},testfalse:{name:"test-false",sig:" [...Any]",returnType:"Changer",aka:[],abstract:"If you want to test your passage in order to see what would happen if an (if:), (unless:) or (else-if:) macro would hide the hook it's attached to, you can temporarily change the name of the macro to (test-false:), which causes it to ignore the data given to it and act as if it was given `false`.  ",anchor:"macro_test-false",category:"debugging",categoryOrder:"3"},animate:{name:"animate",sig:" HookName, String, [Number]",returnType:"Command",aka:[],abstract:"A command that causes a hook to briefly animate, as if a (transition:) was applied to it. The length of time that the animation plays can be optionally altered by providing a number.  ",anchor:"macro_animate",category:"transitions"},box:{name:"box",sig:" String, [Number]",returnType:"Changer",aka:[],abstract:'When attached to a hook, it becomes a "box", with a given width proportional to the containing element\'s width, an optional number of lines tall, and a scroll bar if its contained text is longer than its height can contain.  ',anchor:"macro_box",category:"styling"},floatbox:{name:"float-box",sig:" String, String",returnType:"Changer",aka:[],abstract:'When attached to a hook, it becomes a "floating box", placed at a given portion of the window, sized proportionally to the window\'s dimensions, and with a scroll bar if its contained text is longer than its height can contain.  ',anchor:"macro_float-box",category:"styling"},str:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of values and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},string:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of values and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},text:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of values and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},source:{name:"source",sig:" Any",returnType:"String",aka:[],abstract:"When given almost any data value, this will produce a string representation of Harlowe source code that can, when run, create that value exactly.  ",anchor:"macro_source",category:"string"},substring:{name:"substring",sig:" String, Number, Number",returnType:"String",aka:[],abstract:"This macro produces a substring of the given string, cut from two inclusive number positions.  ",anchor:"macro_substring",category:"string"},lowercase:{name:"lowercase",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a lowercase version of the given string.  ",anchor:"macro_lowercase",category:"string"},uppercase:{name:"uppercase",sig:" String",returnType:"String",aka:[],abstract:"This macro produces an uppercase version of the given string.  ",anchor:"macro_uppercase",category:"string"},lowerfirst:{name:"lowerfirst",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a version of the given string, where the first alphanumeric character is lowercase, and other characters are left as-is.  ",anchor:"macro_lowerfirst",category:"string"},upperfirst:{name:"upperfirst",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a version of the given string, where the first alphanumeric character is uppercase, and other characters are left as-is.  ",anchor:"macro_upperfirst",category:"string"},words:{name:"words",sig:" String",returnType:"Array",aka:[],abstract:'This macro takes a string and creates an array of each word ("word" meaning a sequence of non-whitespace characters) in the string.  ',anchor:"macro_words",category:"string"},strrepeated:{name:"str-repeated",sig:" Number, String",returnType:"String",aka:["string-repeated"],abstract:"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  ",anchor:"macro_str-repeated",category:"string"},stringrepeated:{name:"str-repeated",sig:" Number, String",returnType:"String",aka:["string-repeated"],abstract:"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  ",anchor:"macro_str-repeated",category:"string"},strreversed:{name:"str-reversed",sig:" String",returnType:"String",aka:["string-reversed"],abstract:"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  ",anchor:"macro_str-reversed",category:"string"},stringreversed:{name:"str-reversed",sig:" String",returnType:"String",aka:["string-reversed"],abstract:"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  ",anchor:"macro_str-reversed",category:"string"},joined:{name:"joined",sig:" ...String",returnType:"String",aka:[],abstract:"Using the first string as a separator value, this macro takes all of the other strings given to it, and joins them into a single string.  ",anchor:"macro_joined",category:"string"},plural:{name:"plural",sig:" Number, String, [String]",returnType:"String",aka:[],abstract:'This macro takes a whole number and a string, then converts the number to a string, joins them up with a space character, and pluralises the string if the number wasn\'t 1 or -1. By default, this pluralisation is done by adding "s", as in some English plurals. An optional extra string can specify a different plural word to use instead.  ',anchor:"macro_plural",category:"string"},strnth:{name:"str-nth",sig:" Number",returnType:"String",aka:["string-nth"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form "nth", such as "1st", "22nd", etc.).  ',anchor:"macro_str-nth",category:"string"},stringnth:{name:"str-nth",sig:" Number",returnType:"String",aka:["string-nth"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form "nth", such as "1st", "22nd", etc.).  ',anchor:"macro_str-nth",category:"string"},digitformat:{name:"digit-format",sig:" String, Number",returnType:"String",aka:[],abstract:"",anchor:"macro_digit-format",category:"string"},num:{name:"num",sig:" String",returnType:"Number",aka:["number"],abstract:"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  ",anchor:"macro_num",category:"number"},number:{name:"num",sig:" String",returnType:"Number",aka:["number"],abstract:"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  ",anchor:"macro_num",category:"number"},datatype:{name:"datatype",sig:" Any",returnType:"Datatype",aka:[],abstract:"This macro takes any storeable value, and produces a datatype that matches it.  ",anchor:"macro_datatype",category:"custom macros",categoryOrder:"5"},datapattern:{name:"datapattern",sig:" Any",returnType:"Any",aka:[],abstract:"This takes any storeable value, and produces a datatype that matches it, in a manner similar to (datatype:). However, when given an array or datamap, it creates an array or datamap with its values replaced with their datatypes, which can be used as a more accurate pattern with `matches` or (set:) elsewhere.  ",anchor:"macro_datapattern",category:"custom macros",categoryOrder:"6"},rgb:{name:"rgb",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["rgba"],abstract:"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_rgb",category:"colour",categoryOrder:"2"},rgba:{name:"rgb",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["rgba"],abstract:"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_rgb",category:"colour",categoryOrder:"2"},hsl:{name:"hsl",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["hsla"],abstract:"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_hsl",category:"colour",categoryOrder:"1"},hsla:{name:"hsl",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["hsla"],abstract:"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_hsl",category:"colour",categoryOrder:"1"},lch:{name:"lch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["lcha"],abstract:"This macro creates a colour using three values in the CIELAB colour model - a lightness (l) percentage, a chroma (c) value, and a hue (h) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_lch",category:"colour",categoryOrder:"3"},lcha:{name:"lch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["lcha"],abstract:"This macro creates a colour using three values in the CIELAB colour model - a lightness (l) percentage, a chroma (c) value, and a hue (h) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_lch",category:"colour",categoryOrder:"3"},complement:{name:"complement",sig:" Colour",returnType:"Colour",aka:[],abstract:"When given a colour, this provides a complement to that colour.  ",anchor:"macro_complement",category:"colour",categoryOrder:"4"},mix:{name:"mix",sig:" Number, Colour, Number, Colour",returnType:"Colour",aka:[],abstract:"When given two pairs of values - each a number from 0 to 1 and a colour - this macro produces a mix of the two colours, using the numbers as ratios of each colour. The colours are mixed using the LCH colourspace, used by the (lch:) macro.  ",anchor:"macro_mix",category:"colour"},palette:{name:"palette",sig:" String, Colour",returnType:"Array",aka:[],abstract:"When given a string specifying a palette type, and a colour, this macro produces an array containing the given colour followed by three additional colours that together form a palette, for use with (text-colour:), (bg:), and other macros.  ",anchor:"macro_palette",category:"colour",categoryOrder:"5"},gradient:{name:"gradient",sig:" Number, ...Number, Colour",returnType:"Gradient",aka:[],abstract:'When given a degree angle, followed by any number of number-colour pairs called "colour stops", this macro produces a gradient that fades between those colours in the direction of the angle.  ',anchor:"macro_gradient",category:"colour",categoryOrder:"6"},stripes:{name:"stripes",sig:" Number, Number, Colour, Colour",returnType:"Gradient",aka:[],abstract:"When given a degree angle, a pixel distance, and two or more colours, this macro produces a gradient that draws a striped background, with each stripe as wide as the distance, and alternating through the given colours.  ",anchor:"macro_stripes",category:"colour",categoryOrder:"7"},hooksnamed:{name:"hooks-named",sig:" String",returnType:"HookName",aka:[],abstract:"When given a string, this creates a HookName from it. This can be used to dynamically create HookNames.  ",anchor:"macro_hooks-named",category:"basics"},cond:{name:"cond",sig:" Boolean, Any, ...Any",returnType:"Any",aka:[],abstract:'When given a sequence of booleans (the "conditions") paired with values, this provides the first value that was paired with a `true` condition. This can give you one value or another based on a quick check.  ',anchor:"macro_cond",category:"basics",categoryOrder:"12"},weekday:{name:"weekday",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces one of the strings "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday" or "Saturday", based on the weekday on the current player\'s system clock.  ',anchor:"macro_weekday",category:"date and time"},monthday:{name:"monthday",sig:"",returnType:"Number",aka:[],abstract:"This date/time macro produces a number corresponding to the day of the month on the current player's system clock. This should be between 1 (on the 1st of the month) and 31, inclusive.  ",anchor:"macro_monthday",category:"date and time"},currenttime:{name:"current-time",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces a string of the current 12-hour time on the current player\'s system clock, in the format "12:00 AM".  ',anchor:"macro_current-time",category:"date and time"},currentdate:{name:"current-date",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces a string of the current date the current player\'s system clock, in the format "Thu Jan 01 1970".  ',anchor:"macro_current-date",category:"date and time"},min:{name:"min",sig:" ...Number",returnType:"Number",aka:[],abstract:"This maths macro accepts numbers, and evaluates to the lowest valued number.  ",anchor:"macro_min",category:"maths"},max:{name:"max",sig:" ...Number",returnType:"Number",aka:[],abstract:"This maths macro accepts numbers, and evaluates to the highest valued number.  ",anchor:"macro_max",category:"maths"},abs:{name:"abs",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro finds the absolute value of a number (without the sign).  ",anchor:"macro_abs",category:"maths"},sign:{name:"sign",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces -1 when given a negative number, 0 when given 0, and 1 when given a positive number.  ",anchor:"macro_sign",category:"maths"},sin:{name:"sin",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the sine of the given number of radians.  ",anchor:"macro_sin",category:"maths"},cos:{name:"cos",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the cosine of the given number of radians.  ",anchor:"macro_cos",category:"maths"},tan:{name:"tan",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the tangent of the given number of radians.  ",anchor:"macro_tan",category:"maths"},floor:{name:"floor",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number downward to a whole number. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_floor",category:"number"},round:{name:"round",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number to the nearest whole number - downward if its decimals are smaller than 0.5, and upward otherwise. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_round",category:"number"},trunc:{name:"trunc",sig:" Number",returnType:"Number",aka:[],abstract:'This macro rounds the given number towards zero. This "truncates" the fractional portion of the number, removing it and leaving just the whole portion.  ',anchor:"macro_trunc",category:"number"},ceil:{name:"ceil",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number upward to a whole number. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_ceil",category:"number"},pow:{name:"pow",sig:" Number, Number",returnType:"Number",aka:[],abstract:"This maths macro raises the first number to the power of the second number, and provides the result.  ",anchor:"macro_pow",category:"maths"},exp:{name:"exp",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro raises Euler's number to the power of the given number, and provides the result.  ",anchor:"macro_exp",category:"maths"},sqrt:{name:"sqrt",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the square root of the given number.  ",anchor:"macro_sqrt",category:"maths"},log:{name:"log",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the natural logarithm (the base-e logarithm) of the given number.  ",anchor:"macro_log",category:"maths"},log10:{name:"log10",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the base-10 logarithm of the given number.  ",anchor:"macro_log10",category:"maths"},log2:{name:"log2",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the base-2 logarithm of the given number.  ",anchor:"macro_log2",category:"maths"},random:{name:"random",sig:" Number, [Number]",returnType:"Number",aka:[],abstract:"This macro produces a whole number randomly selected between the two whole numbers, inclusive (or, if the second number is absent, then between 0 and the first number, inclusive).  ",anchor:"macro_random",category:"number"},either:{name:"either",sig:" ...Any",returnType:"Any",aka:[],abstract:"Give this macro several values, separated by commas, and it will pick and return one of them randomly.  ",anchor:"macro_either",category:"basics",categoryOrder:"11"},nth:{name:"nth",sig:" Number, ...Any",returnType:"Any",aka:[],abstract:"Given a positive whole number and a sequence of values, this selects the nth value in the sequence, where n is the number. If n is larger than the number of items in the sequence, the selection loops around to the start.  ",anchor:"macro_nth",category:"basics",categoryOrder:"13"}}};if("object"!=typeof V)throw Error("Impossible: Shortdefs wasn't inserted at build time");const Y={"#e61919":"red","#e68019":"orange","#e5e619":"yellow","#80e619":"lime","#19e619":"green","#19e5e6":"cyan","#197fe6":"blue","#1919e6":"navy","#7f19e6":"purple","#e619e5":"magenta","#ffffff":"white","#000000":"black","#888888":"grey"},GCD$1=(e,a)=>e?a?e>a?GCD$1(e-a,a):GCD$1(e,a-e):e:a,fourDecimals$1=e=>j(1e4*e)/1e4;function setOptionalStyles$1({codeUsesCodeFont:e=!0}){const a="cm-harlowe-4-";let t=document.querySelector(`style#${a}optionalStyles`);t||(t=document.createElement("style"),t.setAttribute("id",`${a}optionalStyles`),document.head.appendChild(t));let r="",o=1;if(e)try{for(let e of localStorage.getItem("twine-prefs")?.split(",")||[]){let{name:a,value:t}=JSON.parse(localStorage.getItem(`twine-prefs-${e}`));"codeEditorFontFamily"===a?r=t.includes(" ")?`"${t}"`:t:"codeEditorFontScale"===a&&(o=t)}}catch(e){}t.innerHTML=e?`.${a}root:not([class^='${a}text']):not([class^='${a}verbatim']) { ${r?`font-family:${r}`:""}; ${o?`font-size:${100*o}%`:""}`:""}function getPrefs$2(){try{return JSON.parse(localStorage.getItem("harlowe-prefs"))||{}}catch(e){return{}}}const U=document.createElement("p");const G=!!document.querySelector('html[data-version^="2.3."]'),X={ShortDefs:V,toHarloweColour:function toHarloweColour$2(e,a){return e=e.toLowerCase(),0==+a?"transparent":+a<1?(e=function hexToHSL(e){e=e.slice(1);const a=parseInt(e.slice(0,2),16)/255,t=parseInt(e.slice(2,4),16)/255,r=parseInt(e.slice(4,6),16)/255,o=Math.max(a,t,r),n=Math.min(a,t,r),s=(o+n)/2,i=o-n;if(o===n)return{h:0,s:0,l:s};let l;switch(o){case a:l=(t-r)/i+(t<r?6:0);break;case t:l=(r-a)/i+2;break;case r:l=(a-t)/i+4}return l=Math.round(60*l),{h:l,s:s>.5?i/(2-o-n):i/(o+n),l:s}}(e),`(hsl:${fourDecimals$1(e.h)},${fourDecimals$1(e.s)},${fourDecimals$1(e.l)},${fourDecimals$1(a)})`):e in Y?Y[e]:e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?`#${e[1]}${e[3]}${e[5]}`:e},toCSSColour:function toCSSColour$2(e,a){if(0==+a)return"transparent";if(+a<1){e=e.slice(1);return`rgba(${parseInt(e.slice(0,2),16)},${parseInt(e.slice(2,4),16)},${parseInt(e.slice(4,6),16)},${a})`}return e},GCD:GCD$1,fourDecimals:fourDecimals$1,el:function el$2(e){return U.innerHTML=e,U.firstChild},twine23:G,buttonClass:e=>G?" ":`icon-button variant-${e?"primary":"secondary"} `,builtinColourNames:Y,fontIcon:(e,a=20,t=20)=>`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="${a}" height="${t}"><path fill='currentColor' d="${{search:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z","align-center":"M432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM108.1 96h231.81A12.09 12.09 0 0 0 352 83.9V44.09A12.09 12.09 0 0 0 339.91 32H108.1A12.09 12.09 0 0 0 96 44.09V83.9A12.1 12.1 0 0 0 108.1 96zm231.81 256A12.09 12.09 0 0 0 352 339.9v-39.81A12.09 12.09 0 0 0 339.91 288H108.1A12.09 12.09 0 0 0 96 300.09v39.81a12.1 12.1 0 0 0 12.1 12.1z","align-right":"M16 224h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16zm416 192H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm3.17-384H172.83A12.82 12.82 0 0 0 160 44.83v38.34A12.82 12.82 0 0 0 172.83 96h262.34A12.82 12.82 0 0 0 448 83.17V44.83A12.82 12.82 0 0 0 435.17 32zm0 256H172.83A12.82 12.82 0 0 0 160 300.83v38.34A12.82 12.82 0 0 0 172.83 352h262.34A12.82 12.82 0 0 0 448 339.17v-38.34A12.82 12.82 0 0 0 435.17 288z","list-ol":"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z","list-ul":"M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z","border-style":"M240 416h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm-96 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm192 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm96-192h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-288h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-96H32A32 32 0 0 0 0 64v400a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16V96h368a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z",columns:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64V160h160v256zm224 0H288V160h160v256z",eye:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z",comment:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z",plus:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",minus:"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",times:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",check:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z","chevron-up":"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z",gear:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z"}[e]}"/></svg>`,insensitiveName:e=>`${e}`.toLowerCase().replace(/-|_/g,""),getPrefs:getPrefs$2,setPref:function setPref(e,a){try{const t=getPrefs$2();t[e]=a,localStorage.setItem("harlowe-prefs",JSON.stringify(t)),setOptionalStyles$1(t)}catch(e){return{}}},setOptionalStyles:setOptionalStyles$1,disabledButtonCSS:"opacity:0.5;pointer-events:none"},{stringify:Z}=JSON;let{lex:J}=q,K={};const{twine23:Q,builtinColourNames:ee,buttonClass:ae,toHarloweColour:te,toCSSColour:re,el:oe,fontIcon:ne}=X,se="querySelector",ie=`${se}All`,le="addEventListener",ce="removeEventListener",he=[["#f8f9fa","#fff5f5","#fff0f6","#f8f0fc","#f3f0ff","#edf2ff","#e7f5ff","#e3fafc","#e6fcf5","#ebfbee","#f4fce3","#fff9db","#fff4e6"],["#f1f3f5","#ffe3e3","#ffdeeb","#f3d9fa","#e5dbff","#dbe4ff","#d0ebff","#c5f6fa","#c3fae8","#d3f9d8","#e9fac8","#fff3bf","#ffe8cc"],["#e9ecef","#ffc9c9","#fcc2d7","#eebefa","#d0bfff","#bac8ff","#a5d8ff","#99e9f2","#96f2d7","#b2f2bb","#d8f5a2","#ffec99","#ffd8a8"],["#dee2e6","#ffa8a8","#faa2c1","#e599f7","#b197fc","#91a7ff","#74c0fc","#66d9e8","#63e6be","#8ce99a","#c0eb75","#ffe066","#ffc078"],["#ced4da","#ff8787","#f783ac","#da77f2","#9775fa","#748ffc","#4dabf7","#3bc9db","#38d9a9","#69db7c","#a9e34b","#ffd43b","#ffa94d"],["#adb5bd","#ff6b6b","#f06595","#cc5de8","#845ef7","#5c7cfa","#339af0","#22b8cf","#20c997","#51cf66","#94d82d","#fcc419","#ff922b"],["#868e96","#fa5252","#e64980","#be4bdb","#7950f2","#4c6ef5","#228be6","#15aabf","#12b886","#40c057","#82c91e","#fab005","#fd7e14"],["#495057","#f03e3e","#d6336c","#ae3ec9","#7048e8","#4263eb","#1c7ed6","#1098ad","#0ca678","#37b24d","#74b816","#f59f00","#f76707"],["#343a40","#e03131","#c2255c","#9c36b5","#6741d9","#3b5bdb","#1971c2","#0c8599","#099268","#2f9e44","#66a80f","#f08c00","#e8590c"],["#212529","#c92a2a","#a61e4d","#862e9c","#5f3dc4","#364fc7","#1864ab","#0b7285","#087f5b","#2b8a3e","#5c940d","#e67700","#d9480f"]],dataValueRow$1=(e=((e,a)=>e.expression=a),a=void 0,t=!1)=>({type:"inline-dropdown-rows",text:"Value: ",name:"variable-datatype",width:"16%",options:[["text string",{type:"inline-string-textarea",width:"55%",text:"",placeholder:"Text",modelCallback:e,modelRegistry:a}],["number",{type:"inline-number-textarea",width:"20%",text:"",modelCallback:e,modelRegistry:a}],["Boolean value",{type:"inline-dropdown",text:"",options:["false","true"],model(a,t){e(a,`${!!t[se]("select").value}`)},modelRegistry:a}],["colour",{type:"inline-colour",text:"",value:"#ffffff",model(a,t){const r=t[se]("[type=color]").value,o=t[se]("[type=range]").value;e(a,te(r,o))},modelRegistry:a}],["array",{type:"datavalue-rows",text:"<div class='harlowe-4-datavalueRowHint'>An <b>array</b> is a sequence of ordered datavalues that can be used without having to create separate variables for each. Use it to store similar values whose order and position matter, or to store an ever-changing quantity of similar values.</div>",model(a,t){e(a,`(a:${t})`)},renumber(e,a){const t=`${a+=1}`.slice(-1);e.textContent=a+("1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th")+": "},modelRegistry:a}],["datamap",{type:"datavalue-map",text:"<div class='harlowe-4-datavalueRowHint'>A <b>datamap</b> is a value that holds any number of other values, each of which is \"mapped\" to a unique name. Use it to store data values that represent parts of a larger game entity, or rows of a table.</div>",model(a,t){t.every(((e,a)=>a%2!=0||'""'!==e&&"''"!==e))||(a.invalidSubrow=!0),e(a,`(dm:${t})`)},renumber(e){e.textContent=":"},modelRegistry:a}],[],["randomly chosen value",{type:"datavalue-rows",text:"<div class='harlowe-4-datavalueRowHint'>One of the following values is randomly chosen <b>each time the macro is run</b>.</div>",model(a,t){t.length||(a.invalidSubrow=!0),e(a,`(either:${t})`)},renumber(e){e.textContent="•",e.style.marginRight="0.5em"},modelRegistry:a}],["random number",oe("<div class='harlowe-4-datavalueRowHint'>A number between these two values is randomly chosen <b>each time the macro is run</b>.</div>"),{type:"inline-number-textarea",width:"20%",text:"From",model(){},modelRegistry:a},{type:"inline-number-textarea",width:"20%",text:"to",model(a,t){e(a,`(random:${+t.previousElementSibling[se]("input").value||0},${+t[se]("input").value||0})`)},modelRegistry:a}],...t?[]:[[],["itself + value",{type:"datavalue-inner",text:"<div class='harlowe-4-datavalueRowHint'>The following value is added to the existing value in the variable. NOTE: if the values aren't the same type of data, an error will result.</div>",model(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`it + ${t}`)},renumber(e){(e||{}).textContent="it + "},modelRegistry:a}],["variable + value",{type:"inline-dropdown",text:" Other variable: ",options:["$","_"],model(e,a){e.innerVariable=a[se]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model(e,a){const t=a[se]("input").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)&&(e.innerVariable+=t)}},{type:"datavalue-inner",text:"<div class='harlowe-4-datavalueRowHint'>The above variable's value and the value below are added together. NOTE: if the values aren't the same type of data, an error will result.</div>",model(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`${a.innerVariable} + ${t}`)},renumber(e){(e||{}).textContent=""},modelRegistry:a}]],[],["coded expression",{type:"expression-textarea",width:"90%",text:"<div>Write a Harlowe code expression that should be computed to produce the desired value.</div>",placeholder:"Code",modelCallback:e,modelRegistry:a}]]});K.Panel=(...e)=>()=>{if(!e.length)return;const a=[],t=[];function output(){return Object.entries(this.changers).map((([e,a])=>`(${e}:${a.join(",")})`)).join("+")}function changerNamed(e){return this.changers[e]||=[]}const model=e=>a.reduce(((e,a)=>a(e)||e),{changers:{},wrapStart:"[",wrapEnd:"]",wrapStringify:!1,innerText:void 0,valid:!1,output,changerNamed,initiator:e});function update({target:e}={}){const a=model(e);t.forEach((e=>e(a)))}const r=oe(`<div class="harlowe-4-toolbarPanel${Q?"":" card floating"}" style="transition:max-height 0.8s;overflow-y:auto">`),makeColourPicker=e=>{const makeSwatchRow=(e,a,t)=>oe(`<span class=harlowe-4-swatchRow data-index="${a}" ${t?"":'style="display:none"'}>${e.map((e=>`<span class=harlowe-4-swatch style="background-color:${e}"></span>`)).join("")}</span>`),a=oe(`<div class=harlowe-4-singleColourPicker><input style="width:48px;margin-right:8px" type=color value="${e}"></div>`),t=oe(`<span class="text-select-control"><select ${Q?"":'style="max-width: 9em;"'}><option value="" selected>Harlowe built-ins</option></select></span>`),r=t[se]("select");return a.append(makeSwatchRow(Object.keys(ee),"",!0)),he.forEach(((e,t)=>{a.append(makeSwatchRow(e,t)),r?.append(oe(`<option value=${t}>OpenColor ${t}</option>`))})),r?.[le]("change",(()=>{a[ie]("[data-index]").forEach((e=>e.style.display="none")),a[se](`[data-index="${r.value}"]`).style.display="inline-block"})),a.append(t,oe("<br>"),new Text("Opacity: "),oe('<input type=range style="width:64px;top:8px;position:relative" value=1 min=0 max=1 step=0.05>')),a[le]("click",(({target:e})=>{if(e instanceof HTMLElement&&e.classList.contains("harlowe-4-swatch")){const t=a[se]("input");t&&(t.value=e?.getAttribute("style")?.slice(-7)||"",t.dispatchEvent(new Event("change")))}})),a},o=e.reduce((function reducer(e,r){let o,n,s="";const i="label"===e.tagName.toLowerCase();if(Object.getPrototypeOf(r)!==Object.prototype?o=r:(({type:s}=r),n=s.startsWith("inline")),s.endsWith("text")&&(o=oe(`<${n?"span":"div"}>${r.text}</${n?"span":"div"}>`)),"notice"===s&&(o=oe(`<small style="display:block">${r.text}</small>`)),"buttons"===s&&e.append(...r.buttons.map((e=>{if("tagName"in e)return e;const a=oe(`<button title="${e.title}" class="${ae()}${e.active?" active":""}${e.danger?" variant-danger":""}">${e.html}</button>`);return e.onClick&&a[le]("click",e.onClick),e.update&&t.push((t=>e.update(t,a))),a}))),s.endsWith("preview")){const e=r.tagName||"span";if(o=oe(`<div class="harlowe-4-stylePreview" style="${s.startsWith("t8n")?"cursor:pointer;height: 2.6rem;":""}" ${s.startsWith("t8n")?'alt="Click to preview the transition"':""}><${e}>${r.text||""}</${e}>${s.startsWith("t8n")?`<${e}>${r.text2}</${e}>`:""}</div>`),s.startsWith("t8n")){o[le]("mouseup",update),o[le]("touchend",update);const e=o[se](":first-child");e[le]("animationend",(()=>e.style.visibility="hidden"))}}if((s.endsWith("checkbox")||s.endsWith("checkboxrow"))&&(o=oe(`<label${n?"":' style="display:block"'} class="harlowe-4-checkboxRow"><input type="checkbox" ${r.persist?"data-persist":""}></input>${r.text}</label>`),s.endsWith("w")&&(r.subrow.reduce(reducer,o),r.subrow.forEach((a=>{const{model:t}=a;a.model=(a,r)=>!o[se](":scope > input:checked")||i&&!e[se](":scope > input:checked")?a:t(a,r)}))),o[le]("change",update)),"checkboxes"===s&&(o=oe(`<div class="harlowe-4-toolbarCheckboxes" ${!1===r.bottomBorder?' style="border:none"':""}><div${r.bold?' style="font-weight:bold"':""}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=oe(`<label${r.capitalise?' style="text-transform:capitalize;"':""} class="${ae()}"><input type="checkbox" ${r.persist?"data-persist":""} ${r.checked?.(a)?"checked":""}></input>${e}</label>`);t[le]("change",update),o.append(t)}))),"radios"===s&&(o=oe(`<div class="harlowe-4-toolbarCheckboxes"><div${r.bold?' style="font-weight:bold"':""}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=oe(`<label${r.capitalise?' style="text-transform:capitalize;"':""} class="${ae()}"><input type="radio" name="${r.name}" value="${e}" ${a?"":"checked"} ${r.persist?"data-persist":""}></input>${e}</label>`);t[le]("change",update),o.append(t)}))),s.endsWith("textarea")){let e="text";const a=r.multiline?"textarea":"input";s.endsWith("expression-textarea")&&(r.update=(e,t)=>{!e.expression&&t[se](a).value?t.setAttribute("invalid","This doesn't seem to be valid code."):t.removeAttribute("invalid")},r.model=(e,t)=>{const o=(t[se](a).value||"").trim();if(o){if(J(o,"","macro").children.every((function recur(e){return"text"!==e.type&&"error"!==e.type&&("string"===e.type||"hook"===e.type||e.children.every(recur))})))return void r.modelCallback(e,o);e.valid=!0}}),s.endsWith("string-textarea")&&(r.model||=(e,t)=>{r.modelCallback(e,JSON.stringify(t[se](a).value||""))}),s.endsWith("number-textarea")&&(e="number",r.model||=(e,t)=>{r.modelCallback(e,+t[se](a).value||0)}),o=oe(`<${n?"span":"div"} class="harlowe-4-labeledInput">${r.text}<${a} ${r.useSelection?"data-use-selection":""}${s.includes("passage")?'list="harlowe-4-passages"':""} style="width:${r.width};${r.multiline?`max-width:${r.width};`:""}padding:var(--grid-size);margin${n?":2px 0.5rem 0 0.5rem":"-left:1rem"};${r.multiline&&n?"display:inline-block;height:40px":""}" type=${e} ${r.persist?"data-persist":""} placeholder="${r.placeholder||""}"></${a}></${n?"span":"div"}>`),o[se](a)[le]("input",update)}if((s.endsWith("number")||s.endsWith("range"))&&(o=oe(`<${n?"span":"div"} class="harlowe-4-labeledInput">${r.text}<input style="padding:var(--grid-size);${r.width?`width:${r.width}`:""}" type=${s.endsWith("range")?"range":"number"} min=${r.min} max=${r.max} value=${r.value}${r.step?` step=${r.step}`:""}></input></${n?"span":"div"}>`),o[se]("input")[le](s.endsWith("range")?"input":"change",update)),s.endsWith("colour")){o=oe(`<${n?"span":"div"} class="harlowe-4-labeledInput">${r.text}</${n?"span":"div"}>`);const e=makeColourPicker(r.value);o.append(e),o[ie]("input").forEach((e=>e[le]("change",update)))}if(s.endsWith("gradient")){o=oe(`<div style='position:relative'><span class=harlowe-4-gradientBar></span><button class="${ae()}">${ne("plus")} Colour</button></div>`);const e=o[se](".harlowe-4-gradientBar"),createColourStop=(a,t,r)=>{const o=oe(`<div ${r?"selected":""} data-colour="${t}" data-pos="${a}" class=harlowe-4-colourStop style="left:calc(${100*a}% - 8px); top:-8px"><div class=harlowe-4-colourStopButtons style="left:${-(Q?464:384)*a-(Q?0:40)}px"></div></div>`),n=makeColourPicker(t);n[ie]("input").forEach((e=>e[le]("change",(()=>{const e=n[se]("input[type=range]").value,a=n[se]("[type=color]").value;o.setAttribute("data-colour",re(a,e)),+e<1&&o.setAttribute("data-harlowe-colour",te(a,e)),update()}))));const s=oe(`<button class="${ae()}" style='float:right'>${ne("times")} Delete</button>`);s[le]("click",(()=>{o.remove(),update()})),n.append(s),o.firstElementChild?.prepend(n),e.append(o),update()};setTimeout((()=>{createColourStop(0,"#ffffff"),createColourStop(.5,"#000000",!0),createColourStop(1,"#ffffff")})),o[se]("button")[le]("click",(()=>createColourStop(.5,"#888888")));const listener=({target:a})=>{if(a.classList.contains("harlowe-4-colourStop")){const t=document.documentElement,{left:r,right:o}=e.getBoundingClientRect(),n=o-r,onMouseMove=e=>{let t="pageX"in e?e.pageX:e.touches[0].pageX;if(void 0===t)return;const o=Math.min(1,Math.max(0,(t-window.scrollX-r)/n));a.style.left=`calc(${100*o}% - 8px)`,a.firstChild.style.left=-(Q?464:384)*o-(Q?0:40)+"px",a.setAttribute("data-pos",o),update()},onMouseUp=()=>{t[ce]("mousemove",onMouseMove),t[ce]("mouseup",onMouseUp),t[ce]("touchmove",onMouseMove),t[ce]("touchend",onMouseUp)};t[le]("mousemove",onMouseMove),t[le]("mouseup",onMouseUp),t[le]("touchmove",onMouseMove),t[le]("touchend",onMouseUp),Array.from(e[ie]("[selected]")).forEach((e=>e.removeAttribute("selected"))),a.setAttribute("selected",!0)}};o[le]("mousedown",listener),o[le]("touchstart",listener),t.push((()=>{e.style.background=`linear-gradient(to right, ${Array.from(e[ie](".harlowe-4-colourStop")).sort(((e,a)=>(+e.getAttribute("data-pos")||0)-(+a.getAttribute("data-pos")||0))).map((e=>`${e.getAttribute("data-colour")} ${100*(+e.getAttribute("data-pos")||0)}%`))})`}))}if(s.endsWith("dropdown")){const e=oe(`<${n?"span":"div"} style="white-space:nowrap;${n?"":"width:50%;"}position:relative;">${r.text}<span class="text-select-control"><select style="${n?"margin:0.5rem;":"margin-left:1rem;"}font-size:0.9rem;margin-top:4px" ${r.persist?"data-persist":""}></select></span></${n?"span":"div"}>`);r.options.forEach(((a,t)=>{e[se]("select")?.append(oe(`<option value="${t?a:""}"${a?t?"":" selected":" disabled"}>${a||"───────"}</select>`))})),e[se]("select")?.[le]("change",update),o=e}if("radiorows"===s&&(o=oe("<div>"),r.options.forEach(((a,t)=>{const n=oe(`<label class='harlowe-4-radioRow'><input type="radio" name="${r.name}" value="${t||"none"}" ${t?"":"checked"}></input></label>`);o.append(a.reduce(reducer,n)),a.forEach((a=>{const{model:t}=a;t&&(a.model=(a,r)=>!n[se](":scope > input:checked")||i&&!e[se](":scope > input:checked")?a:t(a,r))})),n[se]("input")?.[le]("change",update)}))),"macro-list"===s){o=oe('<div><div style="text-align:center">Category: </div></div>');const e=oe("<span class='text-select-control'><select></span>");o.firstChild.append(e);const a=e[se]("select"),t=oe('<div style="margin-top:8px;border-top:1px solid hsla(0,0%,50%,0.5);max-height:40vh;overflow-y:scroll">');o.append(t),a?.[le]("change",(()=>{const e=t[se](`[name="${a.value}"]`);e?.scrollIntoView()})),Object.values(X.ShortDefs.Macro).sort((({name:e,category:a,categoryOrder:t},{name:r,category:o,categoryOrder:n})=>a!==o?(a||"").localeCompare(o||""):t!==n?isNaN(+t)?1:isNaN(+n)?-1:Math.sign(t-n):e.localeCompare(r))).forEach(((e,r,o)=>{if(0!==r&&e.category===o[r-1].category||(t.append(oe(`<h3 style="text-transform:capitalize" name="${e.category}">${e.category}</h3>`)),a?.append(oe(`<option value="${e.category}">${e.category}</option>`))),r>0&&e.name===o[r-1].name)return;const n=oe(`<label class='harlowe-4-radioRow'><input type="radio" name="macro-list" value="${e.name}"></input><code><a href="/twine/docs.html#${e.anchor}" target="_blank" rel="noopener noreferrer">(${e.name}: ${e.sig}) → ${e.returnType}</a></code>${e.aka.length?`<div><i>Also known as: ${e.aka.map((e=>`<code>(${e}:)</code>`)).join(", ")}</i>`:""}</div><div>${e.abstract.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`))}</div></label>`);t.append(n),n[se]("input")?.[le]("change",update)}))}if(s.endsWith("dropdown-rows")){o=oe(`<${n?"span":"div"}><span class="harlowe-4-dropdownRowLabel">${r.text}</span><span class="text-select-control"><select style="font-size:1rem;margin-top:4px;${r.width?`width:${r.width};text-overflow:ellipsis`:""}"></select></span><span class="harlowe-4-dropdownRows"></span></${n?"span":"div"}>`);const a=o[se]("select");r.options.forEach((([t,...r],n)=>{if(!t)return void a.append(oe("<option disabled>───────</option>"));a.append(oe(`<option value="${t}" ${n?"":"selected"}>${t}<option>`));const s=oe(`<span data-value="${t}" ${n?"hidden":""}>`);o[se](".harlowe-4-dropdownRows").append(r.reduce(reducer,s)),r.forEach((r=>{const{model:o}=r;o&&(r.model=(r,n)=>a.value!==t||i&&!e[se](":scope > input:checked")?r:o(r,n))}))})),a[le]("change",(()=>{const e=a.value;o[ie](":scope > .harlowe-4-dropdownRows > span").forEach((a=>{a[(a.getAttribute("data-value")===e?"remove":"set")+"Attribute"]("hidden","")})),update()}))}if("textarea-rows"===s){o=oe(`<div class="harlowe-4-textareaRows ${r.nonZeroRows?"harlowe-4-nonZeroRows":""}">`);const makeRow=()=>{if(o.childNodes.length>100)return;const e=oe(`<div class="harlowe-4-dataRow"><input type=text style="width:80%;padding:var(--grid-size)" placeholder="${r.placeholder}"></input><button class="${ae()} harlowe-4-rowMinus">${ne("minus")}</button><button class="${ae()} harlowe-4-rowPlus">${ne("plus")}</button></div>`);e[se]("input")?.[le]("input",update),e[se](".harlowe-4-rowPlus")?.[le]("click",(()=>{makeRow(),update()})),e[se](".harlowe-4-rowMinus")?.[le]("click",(()=>{e.remove(),update()})),o.append(e)};makeRow()}if("datavalue-inner"===s){o=oe(`<div class="harlowe-4-dataRow" style='margin:0.2em 0px'>${r.text}</div>`);const e=[];let a=[];reducer(o,dataValueRow$1(((e,t)=>a.push(t)),e,!0));const t=r.model;r.model=r=>{a=[],e.reduce(((e,a)=>a(e)||e),r),t?.(r,a)},r.renumber(o[se](":scope > * > .harlowe-4-dropdownRowLabel"))}if("datavalue-rows"===s||"datavalue-map"===s){o=oe(`<div class="harlowe-4-datavalueRows">${r.text||""}<div class="harlowe-4-dataEmptyRow"><i>No data</i></div><button class="${ae()} harlowe-4-rowPlus">${ne("plus")} Value</button></div>`);const e=o[se](".harlowe-4-rowPlus"),a=new Set;let t=[];const renumber=()=>{Array.from(o[ie](":scope > .harlowe-4-dataRow > * > .harlowe-4-dropdownRowLabel")).forEach(r.renumber)},makeRow=()=>{if(o.childNodes.length>50)return;const r=oe('<div class="harlowe-4-dataRow">'),n=[];o.insertBefore([...s.endsWith("map")?[{type:"inline-textarea",text:"",placeholder:"Data name",width:"15%",model(e,a){t.push(Z(a[se]("input").value))},modelRegistry:n}]:[],dataValueRow$1(((e,a)=>t.push(a)),n,!0)].reduce(reducer,r),e),n.forEach((e=>a.add(e))),r.append(oe(`<button class="${ae()} harlowe-4-rowMinus">${ne("minus")}</button>`)),r[se](":scope > .harlowe-4-rowMinus")?.[le]("click",(()=>{r.remove(),n.forEach((e=>a.delete(e))),0===o.childNodes.length&&makeRow(),update(),renumber()}))},n=r.model;r.model=e=>{t=[],[...a].reduce(((e,a)=>a(e)||e),e),n?.(e,t)},e[le]("click",(()=>{makeRow(),update(),renumber()}))}if("scroll-wrapper"===s&&(o=oe('<div class="harlowe-4-scrollWrapper"></div>'),r.contents.reduce(reducer,o)),"confirm"===s){if(!Q){const a=oe('<div class="harlowe-4-scrollWrapper"></div>');a.append(...e.childNodes),e.append(a)}const a=oe('<div class="harlowe-4-confirmButtons" style="padding-bottom:8px;"></div>'),r=oe(`<button class="${ae()}">${ne("times")} Cancel</button>`),n=oe(`<button class="${ae(!0)} create">${ne("check")} Add</button>`);n.setAttribute("style",X.disabledButtonCSS),t.push((e=>{const a=e.valid?"removeAttribute":"setAttribute";n[a]("style",X.disabledButtonCSS),e.valid&&("function"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),"function"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)))})),r[le]("click",K.switchPanel),n[le]("click",(()=>{const e=model();"function"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),"function"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)),K.wrapSelection(e.output()+e.wrapStart,e.wrapEnd,"",e.innerText,e.wrapStringify),K.switchPanel()})),a.append(r,n),o=a}if(i){const a=r.update;r.update=(t,r)=>{const o=e[se](":scope > input:checked");Array.from(e[ie]("div,br ~ *")).forEach((e=>e[(o?"remove":"set")+"Attribute"]("hidden",""))),Array.from(e[ie]("input,select")).slice(1).forEach((e=>e[(o?"remove":"set")+"Attribute"]("disabled",""))),a?.(t,r)}}return r.model&&(r.modelRegistry||a).push((e=>r.model(e,o))),r.update&&t.push((e=>r.update(e,o))),o&&e.append(o),e.onreset=update,e}),r);return e.splice(0,e.length),o},K.dataValueRow=dataValueRow$1;const{stringify:de,parse:me}=JSON,{round:pe}=Math;let ue,ge={},ye=X.getPrefs().tooltips;void 0===ye&&(ye=!0);const{Panel:be,dataValueRow:fe}=K,{twine23:we,toHarloweColour:ke,toCSSColour:ve,el:xe,fontIcon:Te,GCD:$e,fourDecimals:Ce}=X,Se="querySelector",Ne=`${Se}All`,Ae="addEventListener",Oe=xe('<div class="harloweToolbar">'),twine2KeymapOverride=e=>{Oe[Se](".harlowe-4-toolbarPanel")&&"Escape"===e.key&&(switchPanel(),e.stopPropagation())};function wrapSelection(e,a,t,r,o){if(0===(e+a).length)return;const n=void 0!==r?r:ue.doc.getSelection()||t||"Your Text Here";ue.doc.replaceSelection(e+(o||String)(n)+a,"around")}function switchPanel(e="default"){if(!we&&"default"===e)return void Oe[Ne](".harlowe-4-toolbarPanel").forEach((e=>e.remove()));Object.entries(ge).forEach((([a,t])=>{if("function"==typeof t){if(a!==e)return;t=ge[a]=t()}t[Ne]("[type=radio]:not([data-persist])").forEach((e=>e.checked=e.parentNode?.parentNode?.[Se]("label:first-of-type")===e.parentNode)),t[Ne]("[type=checkbox]:not([data-persist])").forEach((e=>e.checked=e.hasAttribute("checked"))),t[Ne]("[type=text]:not([data-persist])").forEach((e=>e.value="")),t[Ne]("select:not([data-persist])").forEach((e=>{e.value=e.firstElementChild?.getAttribute("value")||"";const{nextElementSibling:a}=e;a?.className.includes("harlowe-4-dropdownRows")&&Array.from(a.children).forEach((a=>{a[(a.getAttribute("data-value")===e.value?"remove":"set")+"Attribute"]("hidden","")}))})),"onreset"in t&&"function"==typeof t.onreset&&t.onreset()}));let a=ge[e];if(!(a instanceof HTMLElement))return;const{height:t}=getComputedStyle(Oe);Oe[Ne](".harlowe-4-toolbarPanel").forEach((e=>e.remove())),we?(a.style.maxHeight=t,Oe[Ne]("[data-use-selection]").forEach((e=>e.value=ue.doc.getSelection())),setTimeout((()=>a.style.maxHeight="70vh"),100)):a.classList.add("card-button-card","card","floating"),Oe.append(a),Oe.parentNode?.addEventListener("keydown",twine2KeymapOverride),document.addEventListener("keydown",twine2KeymapOverride)}K.wrapSelection=wrapSelection,K.switchPanel=switchPanel;const _e={default:e=>e?"appear step-end":"appear",dissolve:()=>"appear",shudder:()=>"shudder-in",rumble:()=>"rumble-in",zoom:()=>"zoom-in","slide-left":e=>e?"slide-right":"slide-left","slide-right":e=>e?"slide-left":"slide-right","slide-up":e=>e?"slide-down":"slide-up","slide-down":e=>e?"slide-up":"slide-down",flicker:()=>"flicker",pulse:()=>"pulse",instant:e=>"appear step-"+(e?"end":"start"),"fade-right":e=>e?"fade-left":"fade-right","fade-left":e=>e?"fade-right":"fade-left","fade-up":e=>e?"fade-down":"fade-up","fade-down":e=>e?"fade-up":"fade-down",blur:()=>"blur"},Pe=["default","","instant","dissolve","blur","rumble","shudder","pulse","zoom","flicker","slide-left","slide-right","slide-up","slide-down","fade-left","fade-right","fade-up","fade-down"],He={type:"checkbox",text:"Affect the entire remainder of the passage or hook",model(e,a){a[Se](":checked")&&(e.wrapStart="[=\n",e.wrapEnd="")}},Le="A <b>hook</b> is a section of passage prose enclosed in <code>[</code> or <code>]</code>, or preceded with <code>[=</code>.",Ie={type:"confirm"},doneRow=()=>{const e=xe(`<span style="${we?"float:right;":"position:absolute;bottom:var(--grid-size);right:var(--grid-size);"}"><button class="variant-primary primary icon-button">Done</button></span>`);return e?.firstChild?.[Ae]("click",(()=>{switchPanel(),ue.constructor.signal(ue,"harlowe-4-findDone")})),e};ge={textstyle:(()=>{const e={bold:"font-weight:bold",italic:"font-style:italic",underline:"text-decoration: underline","double-underline":"text-decoration: underline;text-decoration-style:double","wavy-underline":"text-decoration: underline;text-decoration-style:wavy",strike:"text-decoration: line-through","double-strike":"text-decoration: line-through;text-decoration-style:double","wavy-strike":"text-decoration: line-through;text-decoration-style:wavy",superscript:"vertical-align:super;font-size:.83em",subscript:"vertical-align:sub;font-size:.83em",mark:"background-color: hsla(60, 100%, 50%, 0.6)",outline:"color:black; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px  1px 0 white, 1px  1px 0 white",shadow:"text-shadow: 0.08em 0.08em 0.08em white",emboss:"text-shadow: 0.04em 0.04em 0em white",condense:"letter-spacing:-0.08em",expand:"letter-spacing:0.1em",blur:"text-shadow: 0em 0em 0.08em white; color:transparent",blurrier:"text-shadow: 0em 0em 0.2em white; color:transparent",smear:"text-shadow: 0em 0em 0.02em white, -0.2em 0em 0.5em white, 0.2em 0em 0.5em white; color:transparent",mirror:"display:inline-block;transform:scaleX(-1)","upside-down":"display:inline-block;transform:scaleY(-1)",tall:"display:inline-block;transform:scaleY(1.5) translateY(-0.25ex)",flat:"display:inline-block;transform:scaleY(0.5) translateY(0.25ex)",blink:"animation:harlowe-4-fade-in-out 1s steps(1,end) infinite alternate","fade-in-out":"animation:harlowe-4-fade-in-out 2s ease-in-out infinite alternate",rumble:"display:inline-block;animation:harlowe-4-rumble linear 0.1s 0s infinite",shudder:"display:inline-block;animation:harlowe-4-shudder linear 0.1s 0s infinite",sway:"display:inline-block;animation:harlowe-4-sway 5s linear 0s infinite",buoy:"display:inline-block;animation:harlowe-4-buoy 5s linear 0s infinite",fidget:"display:inline-block;animation:harlowe-4-fidget 60s linear 0s infinite"};function model(e,a){const t=Array.from(a[Ne]("[type=radio]:checked")).map((e=>e.value)).filter((e=>"none"!==e)).concat(Array.from(a[Ne]("[type=checkbox]:checked")).map((e=>e?.parentNode?.textContent||"")));e.changerNamed("text-style").push(...t.map((e=>de(e)))),e.valid||=t.length>0}return be({type:"preview",text:"Example text preview",update(a,t){t.firstChild.setAttribute("style",`position:relative;${a.changers["text-style"].map((a=>e[me(a)])).join(";")}`)}},{type:"small",text:"This preview doesn't account for other modifications to this passage's text colour, font, or background, and is meant only for you to examine each of these styles."},{type:"checkboxes",name:"Font variants",capitalise:!0,bold:!0,options:["bold","italic","mark"],model},{type:"radios",name:"Underlines and strikes",capitalise:!0,bold:!0,options:["none","underline","double-underline","wavy-underline","strike","double-strike","wavy-strike"],model},{type:"radios",name:"Superscript and subscript",capitalise:!0,bold:!0,options:["none","superscript","subscript"],model},{type:"radios",name:"Outlines",capitalise:!0,bold:!0,options:["none","outline","shadow","emboss","blur","blurrier","smear"],model},{type:"radios",name:"Letter spacing",capitalise:!0,bold:!0,options:["none","condense","expand"],model},{type:"radios",name:"Flips and stretches",capitalise:!0,bold:!0,options:["none","mirror","upside-down","tall","flat"],model},{type:"radios",name:"Animations",capitalise:!0,bold:!0,options:["none","blink","fade-in-out","rumble","shudder","sway","buoy","fidget"],model},He,Ie)})(),borders:(()=>{function dropdownControls(e,a){return[xe(`<div><b>${e}</b></div>`),{type:"inline-dropdown",text:"Style:",options:["none","","dotted","dashed","solid","double","groove","ridge","inset","outset"],model(e,t){const r=t[Se]("select").value;e.changerNamed("b4r").push(de(r||"none")),(e.borderEnabled||=[])[a]=!!r}},{type:"inline-number",text:"Size:",value:1,min:.1,max:20,step:.1,model(e,a){e.changerNamed("b4r-size").push(a[Se]("input").value)}},{type:"inline-colour",text:"Colour:",value:"#ffffff",update(e,t){t.setAttribute("style",e.borderEnabled[a]?"":"display:none")},model(e,a){const t=a[Se]("[type=color]").value,r=a[Se]("[type=range]").value;e.changerNamed("b4r-colour").push(ke(t,r)),e.borderColours=(e.borderColours||[]).concat(ve(t,r))}}]}return be({type:"preview",text:"Example border preview",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute("style",`border-style:${t.b4r?`${t.b4r.map(me).join(" ")};`:""}${t["b4r-size"]?`border-width:${t["b4r-size"].reduce(((e,a)=>`${e} ${2*a}px`),"")};`:""}${t["b4r-colour"]?`border-color:${e.borderColours.join(" ")};`:""}`)}},...dropdownControls("Top",0),...dropdownControls("Right",1),...dropdownControls("Bottom",2),...dropdownControls("Left",3),{type:"radios",name:"Affect:",options:["The attached hook","The remainder of the passage or hook.","The entire passage."],model(e,a){const t=a[Se]("input:checked"),r=Array.from(a[Ne]("label")).indexOf(t.parentNode);r>=2&&Object.keys(e.changers).length?(e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart="[=\n",e.wrapEnd="")}},{type:"confirm",model(e){e.valid=!0;const a=e.suppressedChangers||e.changers;[["b4r",e=>"none"===me(e)],["b4r-size",e=>1==+e],["b4r-colour",e=>"transparent"===e]].forEach((([t,r])=>{a[t]=function reduce4ValueProp(e){return 4===e.length&&e[3]===e[1]&&e.pop(),3===e.length&&e[2]===e[0]&&e.pop(),2===e.length&&e[1]===e[0]&&e.pop(),e}(a[t]),a[t].every(r)&&(delete a[t],"b4r"===t&&(e.valid=!1))})),e.valid&&e.suppressedChangers&&(e.wrapStart=`(enchant:?passage,${Object.entries(a).map((([e,a])=>`(${e}:${a.join(",")})`)).join("+")})`,e.wrapEnd="")}})})(),textcolor:be({type:"preview",text:"Example text preview",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute("style",`${t["text-colour"]?`color:${e.textColour};`:""}${e.stops?`background:linear-gradient(${e.angle}deg, ${e.stops.map((e=>`${e.getAttribute("data-colour")} ${100*e.getAttribute("data-pos")}%`))})`:t.bg?`background:${e.backgroundColour}`:""}`)}},{type:"small",text:"This preview doesn't account for other modifications to this passage's text colour or background, and is meant only for you to examine the selected colours."},xe("<div><b>Text colour</b></div>"),{type:"radiorows",name:"txtcolor",options:[[{type:"inline-text",text:"Default text colour"}],[new Text("Flat colour"),{type:"colour",text:"",value:"#ffffff",model(e,a){const t=a[Se]("[type=color]").value,r=a[Se]("[type=range]").value;e.changerNamed("text-colour").push(ke(t,r)),e.textColour=ve(t,r)}}]]},xe("<div><b>Background</b></div>"),{type:"radiorows",name:"bgcolor",options:[[{type:"inline-text",text:"Default background",model(e){e.valid=!0}}],[new Text("Flat colour"),{type:"colour",text:"",value:"#000000",model(e,a){const t=a[Se]("[type=color]").value,r=a[Se]("[type=range]").value;e.changerNamed("bg").push(ke(t,r)),e.backgroundColour=ve(t,r),e.valid=!0}}],[new Text("Linear gradient"),{type:"gradient",model(e,a){const t=Array.from(a[Ne](".harlowe-4-colourStop")).sort(((e,a)=>Number(e.getAttribute("data-pos"))-Number(a.getAttribute("data-pos"))));t.length>1&&(e.valid=!0,e.changerNamed("bg").push(`(gradient: $deg, ${t.map((e=>`${Ce(e.getAttribute("data-pos"))},${e.getAttribute("data-harlowe-colour")||e.getAttribute("data-colour")}`))})`),e.stops=t,e.angle=0)}},xe(`<br style="height:${we?1:4}rem">`),{type:"inline-range",text:"Angle (deg):",value:0,min:0,max:359,step:1,model(e,a){if(e.valid){const t=e.changerNamed("bg");e.angle=+a[Se]("input").value,t[0]=t[0].replace("$deg",e.angle)}}}]]},{type:"radios",name:"Affect:",options:["The attached hook","The remainder of the passage or hook.","The entire passage.","The entire page."],model(e,a){const t=a[Se]("input:checked"),r=Array.from(a[Ne]("label")).indexOf(t.parentNode),o=Object.entries(e.changers);r>=2&&o.length?(e.wrapStart=`(enchant:?pa${2===r?"ssa":""}ge,${o.map((([e,a])=>`(${e}:${a.join(",")})`)).join("+")})`,e.wrapEnd="",e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart="[=\n",e.wrapEnd="")}},Ie),passagelink:(()=>{const passageT8nPreviews=()=>[xe("<br>"),{type:"inline-dropdown",text:"Departing transition: ",options:Pe,model(e,a){const{value:t}=a[Se]("select");""!==t&&e.changerNamed("t8n-depart").push(de(t))}},{type:"inline-dropdown",text:"Arriving transition: ",options:Pe,model(e,a){const{value:t}=a[Se]("select");""!==t&&e.changerNamed("t8n-arrive").push(de(t))}},xe("<br>"),{type:"inline-number",text:"Transition time (sec): ",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[Se]("input").value;.8!=+t&&e.changerNamed("t8n-time").push(`${t}s`)}},{type:"t8n-preview",text:"Departing Text",text2:"Arriving Text",update(e,a){if(e.initiator&&!["select","div","span"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${_e[e.changers["t8n-depart"]?me(e.changers["t8n-depart"][0]):"default"](!0)}`,r=`harlowe-4-${_e[e.changers["t8n-arrive"]?me(e.changers["t8n-arrive"][0]):"default"](!1)}`,o=e.changers["t8n-time"]?e.changers["t8n-time"][0]:"0.8s",n=a.firstChild,s=a.lastChild;n.setAttribute("style",`animation:${t} reverse ${o} 1;`),s.setAttribute("style",`animation:${r} ${o} 1;`),n.remove(),s.remove(),setTimeout((()=>a.append(n,s)))}}];return be({type:"radiorows",name:"whichclick",options:[[{type:"inline-textarea",text:"Create a hyperlink, with this text:",placeholder:"Link text (can't be empty)",useSelection:!0,width:"50%",model(e,a){const t=a[Se]("input").value;t.length>0&&(e.linkText=t,e.valid=!0)}}],[{type:"inline-text",text:"Allow the entire page to be clicked.",model(e){e.changerNamed("click").push("?page"),e.clickPage=!0,e.valid=!0}},{type:"text",text:"This will place a faint blue border around the edges of the page, and change the mouse cursor to the hand pointer, until it is clicked."}]]},{type:"text",text:"<b>When it is clicked, perform this action:</b>"},{type:"radiorows",name:"passagelink",update(e,a){a.lastChild.firstChild[(e.clickPage?"set":"remove")+"Attribute"]("disabled",""),e.clickPage&&a.lastChild.firstChild.checked&&a.firstChild.firstChild.click()},options:[[{type:"inline-passage-textarea",text:"Go to this passage:",width:"70%",placeholder:"Passage name",model(e,a){const t=a[Se]("input").value;t.length||(e.valid=!1),"click"in e.changers?(delete e.changers.click,e.wrapStart=`(click-goto:?page,${de(t)})`,e.wrapEnd=""):["]]","->","<-"].some((a=>t.includes(a)||e.linkText&&e.linkText.includes(a)))?(e.wrapStart=`(link-goto:${de(e.linkText)},`,e.wrapEnd=`${de(t)})`):(e.wrapStart=`[[${e.linkText}`,e.wrapEnd=`->${t}]]`),e.innerText=""}},...passageT8nPreviews()],[{type:"inline-text",text:"Undo the current turn, returning to the previous passage.",model(e){"click"in e.changers?(e.wrapStart=`(click-undo:${e.changers.click})`,e.wrapEnd="",delete e.changers.click):(e.changerNamed("link-undo").push(de(e.linkText)),e.wrapStart="",e.wrapEnd="")}},...passageT8nPreviews()],[{type:"inline-dropdown",text:"Reveal ",options:["an attached hook.","the remainder of the passage."],model(e,a){a[Se]("select").value&&(e.wrapStart="[=\n",e.wrapEnd="")}},xe("<br>"),{type:"text",text:`(${Le})`},{type:"inline-dropdown",text:"Revealed text transition: ",options:Pe,model(e,a){const{value:t}=a[Se]("select");""!==t&&e.changerNamed("t8n").push(de(t))}},{type:"inline-number",text:"Transition time (sec): ",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[Se]("input").value;.8!=+t&&e.changerNamed("t8n-time").push(`${t}s`)}},{type:"t8n-preview",text2:"Revealed Text",update(e,a){if(e.initiator&&!["select","div","span"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${_e[e.changers.t8n?me(e.changers.t8n[0]):"default"](!1)}`,r=e.changers["t8n-time"]?e.changers["t8n-time"][0]:"0.8s",o=a.lastChild;o.setAttribute("style",`animation:${t} ${r} 1;`),o.remove(),setTimeout((()=>a.append(o)))}},{type:"radiorows",name:"linkReveal",update(e,a){a[Ne]("input").forEach((a=>a[(e.clickPage?"set":"remove")+"Attribute"]("disabled","")))},options:[[{type:"inline-text",text:"Then remove the link's own text.",model(e){e.clickPage||e.changerNamed("link").push(de(e.linkText))}}],[{type:"inline-text",text:"Then unlink the link's own text.",model(e){e.clickPage||e.changerNamed("link-reveal").push(de(e.linkText))}}],[{type:"inline-text",text:"Re-run the hook each time the link is clicked.",model(e){e.clickPage||e.changerNamed("link-rerun").push(de(e.linkText))}}],[{type:"inline-text",text:"Repeat the hook each time the link is clicked.",model(e){e.clickPage||e.changerNamed("link-repeat").push(de(e.linkText))}}]]}],[{type:"inline-text",text:"Cycle the link's text to the next alternative in a list."},xe("<br>"),{type:"textarea-rows",nonZeroRows:!0,placeholder:"Link text (can't be empty)",model(e,a){const t=[e.linkText].concat(Array.from(a[Ne]("input")).map((e=>e.value)));!e.clickPage&&t.every(Boolean)?(e.wrapStart=`(cycling-link:${t.map((e=>JSON.stringify(e)))})`,e.wrapEnd="",e.innerText=""):a.parentNode.firstChild.checked&&(e.valid=!1)}},{type:"radios",name:"Upon reaching the end:",options:["Loop to the start.","Remove the link.","Unlink the link."],model(e,a){if(!e.valid)return;const{value:t}=a[Se]("[type=radio]:checked");"U"===t[0]?e.wrapStart=e.wrapStart.replace(/^\(cycling/,"(seq"):"R"===t[0]&&(e.wrapStart=e.wrapStart.replace(/\)$/,',"")'))}}]]},Ie)})(),if:be({type:"text",text:"<b>Only show a section of the passage if this condition is met:</b>"},{type:"radiorows",name:"if",options:[[{type:"inline-dropdown",text:"The player visited this passage",options:["exactly","at most","at least","anything but","a multiple of"],model(e,a){e.changerNamed("if").push(`visits${{"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[a[Se]("select").value]}`)}},{type:"inline-number",text:"",value:0,min:0,max:999,model(e,a){const t=e.changerNamed("if");t[0]+=a[Se]("input").value,t[0].includes(" % ")&&(t[0]+=" is 0",t[0]=t[0].replace(" % 2 is 0"," is an even")),e.valid=!0}},new Text(" times.")],[{type:"inline-dropdown",text:"The player has now visited this passage an",options:["even","odd"],model(e,a){e.changerNamed("if").push({"":"visits is an even",odd:"visits is an odd"}[a[Se]("select").value]),e.valid=!0}},new Text(" number of times.")],[{type:"inline-number",text:"",value:2,min:1,max:999,model(e,a){e.changerNamed("after").push(`${a[Se]("input").value}s`),e.valid=!0}},new Text(" seconds have passed since this passage was entered.")],[{type:"inline-textarea",width:"20%",text:"The passage ",placeholder:"Passage name",model(e,a){const t=a[Se]("input").value;t&&(e.changerNamed("if").push(`(history: where its name contains ${de(t)})'s length`),e.valid=!0)}},{type:"inline-dropdown",text:"was visited ",options:["exactly","at most","at least","anything but","a multiple of"],model(e,a){e.changerNamed("if")[0]+={"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[a[Se]("select").value]}},{type:"inline-number",text:"",value:1,min:1,max:999,model(e,a){const t=e.changerNamed("if");t[0]+=a[Se]("input").value,t[0].includes(" % ")&&(t[0]+=" is 0",t[0]=t[0].replace(" % 2 is 0"," is even"))}},new Text(" times.")],[{type:"inline-textarea",width:"15%",text:"Passages tagged ",placeholder:"Tag name",model(e,a){const t=a[Se]("input").value;t&&(e.changerNamed("if").push(`(history: where (passage:it)'s tags contains ${de(t)})'s length`),e.valid=!0)}},{type:"inline-dropdown",text:"were visited ",options:["exactly","at most","at least","anything but","a multiple of"],model(e,a){const t=a[Se]("select").value;e.changerNamed("if")[0]+={"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[t]}},{type:"inline-number",text:"",value:1,min:1,max:999,model(e,a){const t=e.changerNamed("if");t[0]+=a[Se]("input").value,t[0].includes(" % ")&&(t[0]+=" is 0",t[0]=t[0].replace(" % 2 is 0"," is even"))}},new Text(" times.")],[{type:"inline-text",text:"There are no more interactable elements in the passage.",model(e){e.changerNamed("more"),e.valid=!0}},{type:"text",text:"Interactable elements are link, mouseover, or mouseout areas. If you're using links that reveal additional lines of prose and then remove or unlink themselves, this will reveal the attached text when all of those are gone."}],[{type:"inline-dropdown",text:"The variable ",options:["$","_"],model(e,a){e.variable=a[Se]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model(e,a){const t=a[Se]("input").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)&&(e.variable+=t)}},{type:"inline-dropdown",text:"",options:["is","is not","is greater than","is less than","contains","is in"],model(e,a){const t=a[Se]("select").value;e.operator={"is greater than":">","is less than":"<","":"is"}[t]||t}},new Text("a value."),xe("<br>"),fe(),{type:"text",text:"",model(e){void 0!==e.expression&&""!==e.expression&&e.operator&&e.variable&&!e.invalidSubrow&&(e.changerNamed("if").push(`${e.variable} ${e.operator} ${e.expression}`),e.valid=!0)}}]]},{type:"checkbox",text:"Also, only if the previous (if:), (else-if:) or (unless:) hook's condition wasn't fulfilled.",model(e,a){a[Se](":checked")&&("if"in e.changers?(e.changerNamed("else-if").push(...e.changerNamed("if")),delete e.changers.if):e.changerNamed("else"))}},He,Ie),hook:be({type:"text",text:`${Le} The main purpose of hooks is that they can be visually or textually altered by special data values called <b>changers</b>. Changers are usually placed in front of hooks to change them.`,model(e){e.wrapStart="[",e.wrapEnd="]",e.valid=!0}},{type:"textarea",width:"25%",text:"Hook name (letters, numbers and underscores only):",placeholder:"Hook name",model(e,a){const t=a[Se]("input").value;t&&(RegExp(`^${M.validPropertyName}$`).exec(t)?(e.wrapStart=`|${t}>[`,e.hookName=t):e.valid=!1)}},{type:"text",text:"",update(e,a){const t=(e.hookName||"").toLowerCase();t?["link","page","passage","sidebar"].includes(t)?a.innerHTML=`The hook name <b><code>?${t}</code></b> is <b>reserved</b> by Harlowe. It refers to <b>${"link"===t?"all of the links in the passage":"page"===t?"the entire HTML page":"passage"===t?"the element that contains the current passage's text":"sidebar"===t?"the passage's sidebar, containing the undo/redo icons":"unknown"}</b>.`:a.innerHTML=`You can refer to this hook (and every other one with this name) using the code <b><code>?${t}</code></b>.`:a.innerHTML="Hook names are optional, but giving a hook a nametag allows it to be remotely altered using macros like <code>(click:)</code>, <code>(replace:)</code>, or <code>(enchant:)</code>. You can use these macros elsewhere in the passage, keeping your prose uncluttered."}},Ie),align:be({type:"preview",text:"You can apply left, center and right alignment to your passage text, as well as adjust the margins and width.",update(e,a){a.setAttribute("style","width:100%;height:6em;overflow-y:hidden;");let t=`width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`;"center"!==e.align&&(t+=`text-align:${e.align};`),a.firstChild.setAttribute("style",`display:block;${t}`)}},{type:"inline-range",text:"Placement: ",value:0,min:0,max:10,step:1,model(e,a){e.placement=a[Se]("input").value/10}},{type:"inline-range",text:"Width: ",value:5,min:1,max:10,step:1,model(e,a){e.width=a[Se]("input").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:"radios",name:"Alignment",capitalise:!0,options:["left","center","justify","right"],model(e,a){e.align=a[Se]("input:checked").value}},{type:"checkbox",text:"Affect the entire remainder of the passage",model(e,a){const t=!!a[Se](":checked");if(e.width===("center"===e.align?.5:1)&&(!e.left||!e.right)==("center"!==e.align&&"justify"!==e.align)){const a=pe(10*e.left),r=pe(10*e.right),o=$e(a,r),n="left"===e.align?"<==":"right"===e.align?"==>":"=".repeat(a/o)+(a?">":"")+(r?"<":"")+"=".repeat(r/o);t?(e.wrapStart=`${n}\n`,e.wrapEnd=""):e.changerNamed("align").push(de(n))}else{const a=pe(100*e.left),r=pe(100*e.width),o=pe(100*e.right),n=$e(r,$e(a,o));e.changerNamed("align").push(de("left"===e.align?"<==":"right"===e.align?"==>":"justify"===e.align?"<==>":"=><=")),e.changerNamed("box").push(de("=".repeat(a/n)+"X".repeat(r/n)+"=".repeat(o/n))),t&&(e.wrapStart="[=\n",e.wrapEnd="")}e.valid=!0}},Ie),rotate:be({type:"preview",text:"Rotated text preview",update(e,a){a.setAttribute("style","height:6em;");const t=a[Se]("span"),{changers:r}=e,o=r["text-rotate-x"],n=r["text-rotate-y"],s=r["text-rotate-z"];let i="margin-top:2em;transform:";(o||n)&&(i+="perspective(50vw) "),o&&(i+=`rotateX(${o}deg) `),n&&(i+=`rotateY(${n}deg) `),s&&(i+=`rotateZ(${s}deg)`),t.setAttribute("style",i)}},{type:"range",text:"Rotation (X axis):",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[Se]("input");+t&&(e.changerNamed("text-rotate-x").push(t),e.valid=!0)}},{type:"range",text:"Rotation (Y axis):",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[Se]("input");+t&&(e.changerNamed("text-rotate-y").push(t),e.valid=!0)}},{type:"range",text:"Rotation (Z axis):",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[Se]("input");+t&&(e.changerNamed("text-rotate-z").push(t),e.valid=!0)}},He,Ie),columns:be({type:"preview",text:"Use columns to lay out two or more spans of prose alongside each other. Each column has its own margins and can occupy a different amount of horizontal space.",update(e,a){a.setAttribute("style","width:90%;display:flex;justify-content:space-between;height:5em;overflow-y:hidden;");const t=e.columns||[],r=Array.from(a[Ne]("span"));for(let e=0;e<Math.max(t.length,r.length);e+=1)e>=t.length?r[e].remove():e>=r.length&&a.append(xe(`<span>${r[0].textContent}</span>`));const o=t.reduce(((e,a)=>e+a.width),0)(Array.from(a[Ne]("span"))).forEach(((e,a)=>e.setAttribute("style",`position:relative; font-size:50%; width:${t[a].width/o*100}%;margin-left:${t[a].left}em;margin-right:${t[a].right}em`)))}},{type:"inline-dropdown",text:"Columns:",options:["1","2","3","4","5","6"],model(e,a){e.columns=[...Array(+a[Se]("select").value||1)].map((()=>({left:1,width:1,right:1}))),e.wrapStart="",e.innerText="",e.wrapEnd=e.columns.length>1?"\n|==|":"",e.valid=!0},update(e,a){Array.from(a.parentNode[Ne](".harlowe-4-labeledInput")).forEach((e=>e.removeAttribute("style"))),Array.from(a.parentNode[Ne](`p:nth-of-type(${e.columns.length}) ~ .harlowe-4-labeledInput`)).forEach((e=>e.setAttribute("style","display:none")))}},xe("<br>"),...[0,1,2,3,4,5].reduce(((e,a)=>e.concat({type:"inline-number",text:`Column ${a+1} left margin:`,value:1,min:0,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].left=+t[Se]("input").value)}},{type:"inline-number",text:"Width:",value:1,min:1,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].width=+t[Se]("input").value)}},{type:"inline-number",text:"Right margin:",value:1,min:0,max:9,step:1,model(e,t){const r=e.columns[a];r&&(r.right=+t[Se]("input").value,e.wrapStart+=`\n${"=".repeat(r.left)}${"|".repeat(r.width)}${"=".repeat(r.right)}\nColumn ${a+1}`)}},xe("<p>"))),[]),Ie),collapse:be({type:"inline-dropdown",text:"Collapse the whitespace within ",options:["a section of the passage.","the remainder of the passage."],model(e,a){a[Se]("select").value?(e.wrapStart="{=\n",e.wrapEnd=""):(e.wrapStart="{",e.wrapEnd="}"),e.valid=!0}},{type:"text",text:"The <b>collapsing markup</b> hides line breaks and reduces sequences of consecutive spaces to just a single space."},{type:"text",text:"If you wish to include whitespace that's exempt from this, you may include <b>HTML &lt;br&gt; tags</b>, or use the verbatim (Vb) markup."},Ie),basicValue:be({type:"text",text:"Use <b>variables</b> to store <b>data values</b>, either across your story or within a passage.<br>That data can then be used in the passage, or in other macro calls, by using the variable's name in place of that value."},{type:"textarea",width:"25%",text:"Variable name (letters, numbers and underscores only):",placeholder:"Variable name",model(e,a){const t=a[Se]("input").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)&&(e.variableName=t)}},fe(),{type:"checkbox",text:"Temp variable (the variable only exists in this passage and hook).",model(e,a){e.sigil=a[Se]("input").checked?"_":"$",e.variableName&&e.expression&&!e.invalidSubrow?(e.wrapStart=`(set: ${e.sigil}${e.variableName} to ${e.expression})`,e.wrapEnd=e.innerText="",e.valid=!0):e.valid=!1}},{type:"text",text:"",update(e,a){const t=e.valid?`${e.sigil}${e.variableName}`:"";a.innerHTML=e.valid?`<p>You can refer to this variable using the code <b><code>${t}</code></b>.</p><p>Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are storage containers for other values.<br>You can access a specific value stored in them using that value's <b>data name</b> (or a string or number value in brackets) by writing <b><code>${t}'s</code></b> <i>name</i>, or <i>name</i> <b><code>of ${t}</code></b>.</p><p>(If you want to display that stored value in the passage, you'll need to give it to a macro, such as <code>(print: ${t}'s </code> <i>name</i><code>)</code>.)</p>`:""}},Ie),input:be({type:"radiorows",name:"inputelement",options:[[new Text("Create a text input box."),xe("<br>"),{type:"preview",tagName:"textarea",text:"You can type sample text into this preview box.",update(e,a){a.setAttribute("style","width:100%;height:6em;"),a.firstChild.setAttribute("style",`display:block;resize:none;font-family:Georgia,serif;border-style:solid;border-color:#fff;color:#fff;width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`),a.firstChild.setAttribute("rows",e.rows||3)},model(e){e.wrapStart=e=>{const a=pe(100*e.left),t=pe(100*e.width),r=pe(100*e.right),o=$e(t,$e(a,r));return`(${"forcedText"in e?"force-":""}input-box:${e.variable?`2bind ${e.variable},`:""}${de("=".repeat(a/o)+"X".repeat(t/o)+"=".repeat(r/o))}${3!==e.rows?`,${e.rows}`:""}${"forcedText"in e?`,${de(e.forcedText)}`:e.initialText?`,${de(e.initialText)}`:""})`},e.wrapEnd=e.innerText="",e.valid=!0}},{type:"inline-range",text:"Placement: ",value:5,min:0,max:10,step:1,width:"25%",model(e,a){e.placement=a[Se]("input").value/10}},{type:"inline-range",text:"Width: ",value:5,min:1,max:10,step:1,width:"25%",model(e,a){e.width=a[Se]("input").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:"inline-number",text:"Rows:",value:3,min:1,max:9,step:1,model(e,a){e.rows=+a[Se]("input").value}},{type:"radiorows",name:"inputboxtype",options:[[{type:"inline-textarea",width:"50%",text:"The box initially contains this text:",placeholder:"Initial text",model(e,a){e.initialText=a[Se]("input").value||""}}],[{type:"inline-textarea",width:"50%",text:"Force the player to type this text:",placeholder:"Text to display",model(e,a){e.forcedText=a[Se]("input").value||""}},xe("<div>Instead of being a normal input box, this will instead slowly write the above text into the box as the player presses keys.</div>")]]}],[new Text("Create a dropdown menu."),xe("<br>"),{type:"inline-text",text:"Dropdown options (leave blank to make a separator):"},{type:"textarea-rows",nonZeroRows:!0,placeholder:"Option text (leave blank to make a separator)",model(e,a){const t=Array.from(a[Ne]("input")).map((e=>e.value));t.some(Boolean)&&(e.wrapStart=e=>`(dropdown: ${e.variable?`2bind ${e.variable},`:""}${t.map((e=>de(e)))})`,e.wrapEnd=e.innerText="",e.valid=!0)}}],[new Text("Create a checkbox."),xe("<br>"),{type:"inline-textarea",width:"50%",text:"Checkbox label:",placeholder:"Label text",model(e,a){const t=a[Se]("input").value||"";t&&(e.wrapStart=e=>`(checkbox: ${e.variable?`2bind ${e.variable},`:""}${de(t)})`,e.wrapEnd=e.innerText="",e.valid=!0),e.needsVariable=!0}}],[new Text("Show a dialog box."),xe("<br>"),xe("<div>This dialog box will appear as soon as the macro is displayed. This is best used inside a hook that's only shown if a condition is met.</div>"),{type:"textarea",width:"80%",text:"Text:",placeholder:"Your text here",model(e,a){const t=a[Se]("input").value||"";e.wrapStart=e=>`(dialog: ${e.variable?`bind ${e.variable},`:""}${de(t)}, ${e.links.map((e=>de(e)))})`,e.wrapEnd=e.innerText=""}},{type:"inline-text",text:"Link options:"},{type:"textarea-rows",nonZeroRows:!0,placeholder:"Link text (can't be blank)",model(e,a){const t=Array.from(a[Ne]("input")).map((e=>e.value));t.every(Boolean)&&(e.links=t,e.valid=!0)}}]]},{type:"checkboxrow",text:"",update(e,a){const t=a[Se]("input");e.needsVariable?(t.setAttribute("disabled",!0),t.checked=!0):t.removeAttribute("disabled",!0)},model(e,a){e.needsVariable&&!a[Se]("input:checked")&&(e.valid=!1)},subrow:[{type:"inline-dropdown",text:"Bind this input element to the variable",options:["$","_"],model(e,a){e.variable=a[Se]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model(e,a){const t=a[Se]("input").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)?e.variable+=t:e.valid=!1}}]},Ie),prefs:be({type:"text",text:'<b style="font-size:1rem;height:var(--control-height);display:block;padding:var(--grid-size)">Harlowe editor toolbar preferences</b>'},{type:"checkboxes",name:"Show text completion tooltips when you type:",capitalise:!0,bold:!1,options:["macro names","keywords"],checked:e=>!1!==X.getPrefs()[e?"completionsForKeywords":"completionsForMacros"],update(e,a){const[t,r]=a[Ne]("[type=checkbox]");t.checked=!1!==X.getPrefs().completionsForMacros,r.checked=!1!==X.getPrefs().completionsForKeywords},model(e,a){const[t,r]=a[Ne]("[type=checkbox]");X.setPref("completionsForMacros",t.checked),X.setPref("completionsForKeywords",r.checked)}},{type:"checkboxes",name:"Other preferences:",capitalise:!1,bold:!1,bottomBorder:!1,options:["Macro code uses the Code Editor Font instead of the Passage Editor Font"],checked:e=>!1!==X.getPrefs()[e?"":"codeUsesCodeFont"],update(e,a){const[t]=a[Ne]("[type=checkbox]");t.checked=!1!==X.getPrefs().codeUsesCodeFont},model(e,a){const[t]=a[Ne]("[type=checkbox]");X.setPref("codeUsesCodeFont",t.checked)}},doneRow()),macro:be({type:"text",text:"<b>Macros</b> are code used for programming and styling your story. The vast majority of Harlowe's features are available through macros.<br>All of the built-in Harlowe macros are listed here. For more details, click their signatures to open the documentation."},{type:"macro-list",model(e,a){const t=a[Se]("input:checked");t&&(e.wrapStart=`(${t.value}:`,e.wrapEnd=")",e.innerText="Your Code Here",e.valid=!0)}},Ie),find:(()=>{let updateButton=(e,a)=>a.setAttribute("style",!e.query||e.matches<=0?X.disabledButtonCSS:"");return be({type:"scroll-wrapper",contents:[xe('<div><span style="width:50%;display:inline-block;margin-left:0.5rem">Find in This Passage</span><span style="display:inline-block;">Replace With</span></div>'),{type:"inline-textarea",multiline:!0,width:"calc(50% - 1rem)",text:"",placeholder:"",persist:!0,model(e,a){e.query=a[Se]("textarea").value}},{type:"inline-textarea",multiline:!0,width:"calc(50% - 1rem)",text:"",placeholder:"",persist:!0,model(e,a){e.replaceQuery=a[Se]("textarea").value}},xe("<br>"),{type:"buttons",buttons:[{title:"Previous Result",html:'<b style="font-size:150%">↑</b>',onClick:()=>ue.constructor.signal(ue,"harlowe-4-findNext",-1),update:updateButton},{title:"Next Result",html:'<b style="font-size:150%">↓</b>',onClick:()=>ue.constructor.signal(ue,"harlowe-4-findNext",1),update:updateButton}]},{type:"inline-dropdown",text:"",options:["Everywhere","Only in prose","Only in code","Only in selection"],persist:!0,model(e,a){e.onlyIn=a[Se]("select").value}},{type:"inline-checkbox",text:"Match Case&nbsp;",persist:!0,model(e,a){e.matchCase=a&&a[Se]("input").checked,ue.constructor.signal(ue,"harlowe-4-find",e)}},{type:"inline-checkbox",text:"Use Regular Expressions",persist:!0,model(e,a){e.useRegExp=a&&a[Se]("input").checked,ue.constructor.signal(ue,"harlowe-4-find",e)}},xe("<br>"),{type:"text",text:"",update(e,a){a.innerHTML=e.useRegExp?'You can use <code>$1</code>, <code>$2</code>, <code>$3</code>, etc. in the "Replace With" text to access capturing groups.':""}},{type:"buttons",buttons:[{title:"Replace",html:"Replace",onClick:({target:e})=>ue.constructor.signal(ue,"harlowe-4-replace",e.parentNode.childNodes[2].lastChild.value,!1),update:updateButton},{title:"Replace All",html:"Replace All",danger:!0,onClick:({target:e})=>ue.constructor.signal(ue,"harlowe-4-replace",e.parentNode.childNodes[2].lastChild.value,!0),update:updateButton}]},{type:"text",text:"",update:function update(e,a){e.query&&e.matches>0?(a.textContent=`${e.matchIndex+1} of ${e.matches} result${1!==e.matches?"s":""}`,a.setAttribute("style","display:inline-block; margin-left:calc(var(--grid-size) * 2);")):(a.textContent="",a.setAttribute("style","display:none")),e.updateResultsDisplay||=()=>update(e,a)}}]},doneRow())})(),default:we?be({type:"buttons",buttons:[{title:"Bold",html:"<div style='font-family:serif;font-weight:bold'>B</div>",onClick:()=>wrapSelection("''","''","Bold Text")},{title:"Italic",html:"<div style='font-family:serif;font-style:italic'>I</div>",onClick:()=>wrapSelection("//","//","Italic Text")},{title:"Strikethrough",html:"<div style='font-family:serif;text-decoration:line-through'>S</div>",onClick:()=>wrapSelection("~~","~~","Strikethrough Text")},{title:"Superscript",html:"<div style='font-family:serif'>X<sup>2</sup></div>",onClick:()=>wrapSelection("^^","^^","Superscript Text")},{title:"Text and background colour",html:"<div class='harlowe-4-bgColourButton'>",onClick:()=>switchPanel("textcolor")},{title:"Borders",html:Te("border-style"),onClick:()=>switchPanel("borders")},{title:"Rotated text",html:'<div style="transform:rotate(-30deg);font-family:serif;font-weight:bold">R</div>',onClick:()=>switchPanel("rotate")},{title:"Special text style",html:"Styles…",onClick:()=>switchPanel("textstyle")},xe('<span class="harlowe-4-toolbarBullet">'),{title:"Heading",html:"<div style='font-family:serif;font-weight:bold'>H</div>",onClick:()=>wrapSelection("\n#","","Heading Text")},{title:"Bulleted list item",html:Te("list-ul"),onClick:()=>wrapSelection("\n* ","")},{title:"Numbered list item",html:Te("list-ol"),onClick:()=>wrapSelection("\n0. ","")},{title:"Horizontal rule",html:"<b>—</b>",onClick:()=>wrapSelection("\n---\n","")},{title:"Alignment",html:Te("align-right"),onClick:()=>switchPanel("align")},{title:"Columns",html:Te("columns"),onClick:()=>switchPanel("columns")},xe('<span class="harlowe-4-toolbarBullet">'),{title:"Collapse whitespace (in-game)",html:"<b>{}</b>",onClick:()=>switchPanel("collapse")},{title:"Verbatim (ignore all markup)",html:"Vb",onClick(){const e=(ue.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection("`".repeat(e+1),"`".repeat(e+1),"Verbatim Text")}},{title:"Comments",html:"<b>&lt;!--</b>",onClick:()=>wrapSelection("\x3c!--","--\x3e","HTML Comments (Not Visible In-Game)")},xe('<span class="harlowe-4-toolbarBullet">'),{title:"Link element",html:"Link…",onClick:()=>switchPanel("passagelink")},{title:"Only show a portion of text if a condition is met",html:"If…",onClick:()=>switchPanel("if")},{title:"Input element",html:"Input…",onClick:()=>switchPanel("input")},{title:"Hook (named section of the passage)",html:"Hook…",onClick:()=>switchPanel("hook")},{title:"Set a variable with a data value",html:"Var…",onClick:()=>switchPanel("basicValue")},{title:"Peruse a list of all built-in macros",html:"Macro…",onClick:()=>switchPanel("macro")},xe('<span class="harlowe-4-toolbarBullet">'),{title:"Proofreading view (dim all code except strings)",html:Te("eye"),onClick:({target:e})=>{ue.display.wrapper.classList.toggle("harlowe-4-hideCode"),"svg"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle("active")}},{title:"Coding tooltips (show a tooltip when the cursor rests on code structures)",html:Te("comment"),active:!0,onClick:({target:e})=>{ue.display.wrapper.classList.toggle("harlowe-4-hideHelpTooltip"),"svg"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle("active")}},xe('<span class="harlowe-4-toolbarBullet">'),{title:"Find and replace",html:Te("search"),onClick:()=>{switchPanel("find");const e=ue.doc.getSelection(),a=document[Se](".harlowe-4-toolbarPanel textarea");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event("input"))))}},{title:"Open the Harlowe documentation",html:"<div style='font-weight:bold'>?</div>",onClick:()=>window.open("http://www.cnbbx.com/twine/","Harlowe Documentation","noopener,noreferrer")},(()=>{const e=xe(`<button style="position:absolute;right:0em;margin-top:-2em">${Te("chevron-up")}</button>`);return e[Ae]("click",(()=>{Oe.classList.toggle("harlowe-4-minimised");const a=e.firstElementChild?.classList;a?.toggle("fa-chevron-down"),a?.toggle("fa-chevron-up")})),e})()]}):be()},switchPanel();const Me="data:image/svg+xml,",svgURI=e=>`${Me}${window.escape(`<svg viewBox='0 0 14 14' width='80' height='80' xmlns='http://www.w3.org/2000/svg'>${e}</svg>`)}`,t24Icon=(e,a,t,r)=>svgURI(`<text y='${a}' x='${e}' fill='currentColor' style='/*harlowe-4*/${t}'>${r}</text>`),fontIconURI=e=>`${Me}${window.escape(Te(e))}`,Ee=navigator.userAgent.includes("Macintosh")?"Cmd-":"Ctrl-",Fe={},Re={name:"harlowe-4-keymap",[`${Ee}G`](){"parentNode"in ge.find&&ge.find.parentNode&&ue.constructor.signal(ue,"harlowe-4-findNext",1)},[`Shift-${Ee}G`](){"parentNode"in ge.find&&ge.find.parentNode&&ue.constructor.signal(ue,"harlowe-4-findNext",-1)},[`${Ee}H`](){if("parentNode"in ge.find&&ge.find.parentNode){const e=ge.find[Ne]("textarea")[1];ue.constructor.signal(ue,"harlowe-4-replace",e.value,!1)}else switchPanel("find")}};let ze,Be;const We=navigator.userAgent.includes("Macintosh")?"⌘":"Ctrl+",De=we?[]:[{type:"menu",label:"Styles",iconOnly:!0,icon:svgURI("<text y='11' x='-3' fill='currentColor' style='/*harlowe-4*/font-weight:bold;font-size:80%'>B</text><text y='8' x='4' fill='currentColor' style='/*harlowe-4*/font-style:italic;font-size:80%'>I</text><text y='13' x='7' fill='currentColor' style='/*harlowe-4*/text-decoration:line-through;font-size:80%'>S</text>").replace("%2780%27","%27108%27"),items:[{type:"button",key:`${Ee}B`,command(){wrapSelection("''","''","Bold Text")},label:`Bold [${We}B]`},{type:"button",key:`${Ee}I`,command(){wrapSelection("//","//","Italic Text")},label:`Italic [${We}I]`},{type:"button",key:`${Ee}-`,command(){wrapSelection("~~","~~","Strikethrough Text")},label:`Strikethrough [${We}-]`},{type:"button",key:`${Ee}.`,command(){wrapSelection("^^","^^","Superscript Text")},label:`Superscript [${We}.]`},{type:"separator"},{type:"button",command(){switchPanel("textstyle")},label:"More Styles…"}]},{type:"button",command(){switchPanel("textcolor")},label:"Colours",iconOnly:!0,icon:svgURI('<defs><linearGradient id="X"><stop offset="0%" stop-color="hsla(0,100%,50%,0.5)"/><stop offset="16%" stop-color="hsla(30,100%,50%,0.5)"/><stop offset="33%" stop-color="hsla(60,100%,50%,0.5)"/><stop offset="50%" stop-color="hsla(120,100%,50%,0.5)"/><stop offset="66%" stop-color="hsla(180,100%,50%,0.5)"/><stop offset="83%" stop-color="hsla(240,100%,50%,0.5)"/><stop offset="100%" stop-color="hsla(320,100%,50%,0.5)"/></linearGradient></defs><circle cx="8" cy="8" r="6" fill="url(\'#X\')"/>')},{type:"button",command(){switchPanel("borders")},label:"Borders",iconOnly:!0,icon:fontIconURI("border-style")},{type:"button",command(){switchPanel("rotate")},label:"Rotated text",iconOnly:!0,icon:t24Icon(-3,14,"transform:rotate(-30deg);font-family:serif;","R")},{type:"menu",icon:fontIconURI("list-ul"),label:"List and line items",iconOnly:!0,items:[{type:"button",command(){wrapSelection("\n* ","")},label:"Bulleted List Item"},{type:"button",command(){wrapSelection("\n0. ","")},label:"Numbered List Item"},{type:"separator"},{type:"button",command(){wrapSelection("\n#","","Heading Text")},label:"Heading"},{type:"button",command(){wrapSelection("\n---\n","")},label:"Horizontal Rule"}]},{type:"menu",icon:fontIconURI("align-center"),label:"Alignment and columns",iconOnly:!0,items:[{type:"button",command(){switchPanel("align")},label:"Alignment"},{type:"button",command(){switchPanel("columns")},label:"Columns"}]},{type:"button",command(){switchPanel("collapse")},label:"Collapse Whitespace (In-Game)",iconOnly:!0,icon:t24Icon(0,10,"font-weight:bold;font-size:12px","{ }")},{type:"button",command(){const e=(ue.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection("`".repeat(e+1),"`".repeat(e+1),"Verbatim Text")},label:"Verbatim (Ignore All Markup Inside)",iconOnly:!0,icon:t24Icon(1,12,"font-size:11px","Vb")},{type:"button",command(){wrapSelection("\x3c!--","--\x3e","Comment Text")},label:"HTML Comments (Not Run In-Game)",iconOnly:!0,icon:t24Icon(-1,10,"font-weight:bold","&#10216;!-")},{type:"menu",label:"(Macro:)",items:[{type:"button",command(){switchPanel("passagelink")},label:"Link…",icon:""},{type:"button",command(){switchPanel("if")},label:"If…",icon:""},{type:"button",command(){switchPanel("input")},label:"Input…",icon:""},{type:"button",command(){switchPanel("hook")},label:"Hook…",icon:""},{type:"button",command(){switchPanel("basicValue")},label:"Value…",icon:""},{type:"separator"},{type:"button",command(){switchPanel("macro")},label:"List All Macros…",icon:""}]},ze={type:"button",command(){ue.display.wrapper.classList.toggle("harlowe-4-hideCode"),ue.constructor.signal(ue,"cursorActivity")},label:"Proofreading View (dim all code except strings)",iconOnly:!0,icon:fontIconURI("eye")},Be={type:"button",command(){const{wrapper:e}=ue.display;e.classList.toggle("harlowe-4-hideHelpTooltip"),e.classList.toggle("harlowe-4-showHelpTooltip"),ye=e.classList.contains("harlowe-4-showHelpTooltip"),X.setPref("tooltips",ye),ue.constructor.signal(ue,"cursorActivity")},label:"Coding Tooltips (when the cursor rests on code structures)",iconOnly:!0,icon:fontIconURI("comment")},{type:"button",key:`${Ee}F`,command(){switchPanel("find");const e=ue.doc.getSelection(),a=ge.find[Se](".harlowe-4-toolbarPanel textarea");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event("input"))))},label:`Find and Replace [${We}F]`,iconOnly:!0,icon:fontIconURI("search")},{type:"button",command(){window.open("http://www.cnbbx.com/twine/","Harlowe Documentation","noopener,noreferrer")},label:"Show Manual (opens a new tab)",iconOnly:!0,icon:t24Icon(3,14,"font-weight:bold;font-size:19px;","?")},{type:"button",command(){switchPanel("prefs")},label:"Editor Preferences",iconOnly:!0,icon:fontIconURI("gear")}].map((function recur(e,a){if("button"===e.type){const{command:t}=e;Fe[a]=e=>{ue=e,t()},e.key&&(Re[e.key]=t),e.command=`${a}`}return"menu"===e.type&&(e.items=e.items.map(((e,t)=>recur(e,`${a}.${t}`)))),e}));function Toolbar(e,{foregroundColor:a}){const t=document[Ne](".story-format-toolbar"),r=t[t.length-1]||document[Se](".editor .passageTags");return r&&r.nextElementSibling!==Oe&&r[we?"after":"before"](Oe),ue=e,we||(ue.addKeyMap(Re),ue.display.wrapper.className.match(/harlowe-4-....HelpTooltip/)||ue.display.wrapper.classList.toggle(`harlowe-4-${ye?"show":"hide"}HelpTooltip`)),De.forEach((e=>{let t=a;(e===ze&&ue.display.wrapper.classList.contains("harlowe-4-hideCode")||e===Be&&!ue.display.wrapper.classList.contains("harlowe-4-hideHelpTooltip"))&&(t="#0a60c2"),e.icon&&=e.icon.replace(/fill%3D%27[^']+?%27/g,`fill%3D%27${window.escape(t)}%27`)})),De}let{ShortDefs:qe,twine23:je,insensitiveName:Ve,getPrefs:Ye}=X;const{hasOwn:Ue}=Object,docsURL=(e,a)=>`<a href="/twine/docs.html#${e}" target="_blank" rel="noopener noreferrer">${a}</a>`,Ge="This markup gives the enclosed text ",producesBooleanTrueIf=e=>`The <b>"${e}" operator</b> produces the boolean value \`true\` if `,Xe=" Otherwise, it produces `false`.",Ze="If they contain strings, numbers, commands or changers, you can place them directly in your prose to display the value, run the command, or apply the changer.",lambdaClause=e=>`The keyword <b>"${e}"</b> makes the code on the right into a <b>"${e}" lambda clause</b>. `,specialHookName=(e,a)=>`<br><br>Additionally, because it uses the special name "\`${e}\`", it also refers to <b>${a}</b>, and can be used to apply changers to ${a}.`,Je="Only matches ",Ke={num:`${Je}numbers.`,str:`${Je}strings.`,bool:`${Je}booleans.`,array:`${Je}arrays.`,dm:`${Je}datamaps.`,ds:`${Je}datasets.`,command:`${Je}commands.`,changer:`${Je}changers.`,color:`${Je}colours.`,gradient:`${Je}gradients.`,lambda:`${Je}lambdas.`,macro:`${Je}custom macros.`,datatype:`${Je}other datatypes.`,codehook:`${Je}code hooks.`,even:`${Je}even numbers.`,odd:`${Je}odd numbers.`,int:`${Je}whole numbers (numbers with no fractional component, and which are positive or negative).`,empty:`${Je}these empty structures: <code>""</code> (the empty string), <code>(a:)</code>, <code>(dm:)</code> and <code>(ds:)</code>.`,whitespace:`${Je}a single character of whitespace (spaces, newlines, and other kinds of space).`,lowercase:`${Je}a single lowercase character. Lowercase characters are characters that change when put through <code>(uppercase:)</code>.`,uppercase:`${Je}a single uppercase character. Uppercase characters are characters that change when put through <code>(lowercase:)</code>.`,anycase:"This matches any character which is case-sensitive - that is, where its <code>(lowercase:)</code> form doesn't match its <code>(uppercase:)</code> form.",alnum:`${Je}a single alphanumeric character (letters and numbers).`,digit:`${Je}a string consisting of exactly one of the characters '0', '1', '2', '3', '4', '5', '6', '7', '8', and '9'.`,newline:`${Je}a line break character (also known as a "newline" character).`,const:"Matches nothing; Use this only with <code>(set:)</code> to make constants.",any:"Matches anything; Use this with <code>(macro:)</code> to make variables that accept any storable type, or with <code>(set:)</code> inside data structure patterns."};Object.assign(Ke,{number:Ke.num,string:Ke.str,boolean:Ke.bool,datamap:Ke.dm,dataset:Ke.ds,colour:Ke.color,integer:Ke.int,alphanumeric:Ke.alnum,linebreak:Ke.newline});const Qe={hr:"This is a <b>horizontal rule</b>. It extends across the entire passage width (or the column width, if it's in a column).",bulleted:"The `*` at the start of this line makes this a <b>bulleted list item</b>.",numbered:"The `0.` at the start of this line makes this a <b>numbered list item</b>.",heading:({depth:e})=>`This is a <b>level ${e} ${1===e?"(largest) ":""}heading</b> mark.`,align:({align:e})=>`This is an <b>aligner</b> mark. The text after this is ${"justify"===e?"justified (spaced out to touch both edges)":`aligned to the ${e}`}. Write \`<==\` for left alignment, \`==>\` for right alignment, \`=><=\` for centering, and \`<==>\` for justified alignment.`,column:({text:e,width:a,marginRight:t,marginLeft:r})=>e.trim().startsWith("|")&&e.trim().endsWith("|")?"This mark ends all of the preceding columns. The text after this is not in a column.":`The text after this mark is in a <b>column</b> with width multiplier ${a}x, a left margin of ${r}em, and a right margin of ${t}em. Write more consecutive \`|\` marks to increase the width, and place \`=\` to the left and right to increase the margin on that side.`,em:`${Ge}<b>emphasis style</b>. This is visually the same as italic style by default.`,strong:`${Ge}<b>strong emphasis style</b>. This is visually the same as bold style by default.`,bold:`${Ge}<b>bold style</b>.`,italic:`${Ge}<b>italic style</b>.`,strike:`${Ge}<b>strikethrough style</b>.`,sup:`${Ge}<b>superscript style</b>.`,comment:"This is a <b>HTML comment</b>. Everything inside it will be ignored by Harlowe.",scriptStyleTag:()=>Qe.tag,tag:"This is a <b>HTML tag</b>. Harlowe supports raw HTML in passage code.",hook:({type:e,name:a,tagPosition:t})=>`${"hook"===e?"These square brackets are a <b>hook</b>, enclosing this section of passage code.":""} Changer values can be attached to the left of hooks.${a?`<br>This hook has a <b>nametag</b> on the ${"prepended"===t?"left":"right"}. This allows the hook to be referred to in macro calls using the hook name <code>?${a}</code>.`:""}`,unclosedHook:e=>`This marks all of the remaining code in the passage as being inside a <b>hook</b>.${Qe.hook(e)}`,verbatim:"This is <b>verbatim markup</b>. Place text between matching pairs and amounts of <code>`</code> marks, and Harlowe will ignore the markup within, instead displaying it as-is.",unclosedCollapsed:e=>Qe.collapsed(e),collapsed:({type:e})=>`This is <b>${"unclosedCollapsed"===e?"unclosed ":""}collapsed whitespace</b> markup. All sequences of consecutive whitespace within ${"unclosedCollapsed"===e?"the remainder of the passage ":"the <code>{</code> and <code>}</code> marks"} will be replaced with a single space. You can use this to space out your code and keep your passage readable.<br>To include a line break within this markup that will be preserved, use a HTML <code>&lt;br&gt;</code> tag.`,escapedLine:"This is an <b>escaped line break</b> mark. This removes the line break before or after it from the displayed passage.",twineLink:({passage:e})=>`This is a <b>link to the passage "${e}"</b>. Links, like hooks and commands, can have changer values attached to the left.`,br:"",url:"",variable:`This is a <b>story-wide variable</b>. After this has been set to a data value, it can be used anywhere else in the story. Use these to store data values related to your story's game state, or changers that are commonly used. ${Ze}`,tempVariable:`This is a <b>temp variable</b>. It can only be used in the same passage and hook (plus any nested hooks therein) in which it's first set to a data value. Use these to store values temporarily, or that won't be needed elsewhere. ${Ze}`,macroName:(e,[,a])=>Qe.macro(a),grouping:"Use these <b>grouping brackets</b> to ensure operations are performed in a certain order. Code in brackets will be computed before the code adjacent to it.",property:({type:e,name:a})=>(a?`This retrieves the data stored at <b>the \`${a}\` ${a.match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)?"position"+(a.includes("to")?"s":""):"name"}</b> of the container value on the ${e.startsWith("belonging")?"right":"left"}.<br><br>`:"")+"Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are also storage containers for other values. You can access a specific value stored in them using that value's <b>data name</b> (or a string, number, or array value in brackets) by writing <i>value</i> `'s` <i>name</i>, or <i>name</i> `of` <i>value</i>.",possessiveOperator:e=>Qe.property(e),itsProperty:e=>Qe.property(e),itsOperator:e=>Qe.identifier(e),belongingItProperty:e=>Qe.property(e),belongingItOperator:e=>Qe.property(e),belongingProperty:e=>Qe.property(e),belongingOperator:e=>Qe.property(e),escapedStringChar:"",string:'This is <b>string data</b>. Strings are sequences of text data enclosed in matching " or \' marks. Use a `\\` inside a string to "escape" the next character. Escaped " or \' marks don\'t count as the end of the string.<br><br>If a string matches a passage name, it will be <span class="cm-harlowe-4-passageString">underlined</span>. If it matches a tag name, it will be <span class="cm-harlowe-4-tagString">dotted</span>.',hookName:({name:e})=>`This <b>hook name</b> refers to all hooks named "\`${e=e.toLowerCase()}\`" in this passage.${"page"===e?specialHookName("page","the entire HTML page"):"passage"===e?specialHookName("passage","the entire passage"):"link"===e?specialHookName("link","every link in the passage"):"sidebar"===e?specialHookName("sidebar","the sidebar"):""}`,cssTime:({value:e})=>`This is <b>number data</b> in CSS time format. Harlowe automatically converts this to a number of milliseconds, so this is identical to ${e}.`,datatype:({text:e})=>(e=e.toLowerCase(),`This is the name of a <b>datatype</b>. Use these names to check what kind of data a data value is, using the \`matches\` or \`is a\` operators.<br>You can also use them in a \`(set:)\` or \`(put:)\` to restrict that variable's data for error-checking purposes. (See ${docsURL("type_datatype","the documentation")} for details.)${Ue(Ke,e)?`<code class='harlowe-4-tooltipMacroSignature cm-harlowe-4-datatype'>${e}</code>${Ke[e]}`:""}`),colour:({text:e})=>"This is a "+(e.startsWith("#")?"<b>HTML colour value</b>. Harlowe can use this as colour data.":"built-in Harlowe <b>colour value</b>. The built-in colours are `red`, `orange`, `yellow`, `lime`, `green`, `cyan` (alias `aqua`), `blue`, `navy`, `purple`, `fuchsia` (alias `magenta`), `white`, `gray` (alias `grey`), `black`, and `transparent`."),number:"This is <b>number data</b>. Harlowe supports whole numbers (like `2`), negative numbers (like `-2`), and numbers with a decimal fraction component (like `2.2`).",inequality:({operator:e,negate:a})=>{const t=`${">"===(e=a?{">":"<=","<":">=",">=":"<","<=":">"}[e]:e)[0]?"greater ":"less "}than${e.endsWith("=")?" or equal to":""}`;return`${producesBooleanTrueIf(t)} the number value on the left is ${t} the number value on the right.${Xe}`},identifier:({text:e})=>(e=Ve(e)).startsWith("it")?"The keyword <b>it</b> is a shorthand for the leftmost part of an operation. You can write `(if: $candles < 2 and it > 5)` instead of `(if: $candles < 2 and $candles > 5)` or `(set: $candles to it + 3)` instead of `(set: $candles to $candles + 3)`. When accessing a data value from it, you can write it as <b>its</b>, such as in `its length > 0`.":"time"===e?"The keyword <b>time</b> equals the number of milliseconds passed since the passage was displayed.":e.startsWith("exit")?'The keyword <b>exits</b> or <b>exit</b> equals the number of currently available "exits" in a passage - the number of link, mouseover, and mouseout elements that are still active on the page, which could lead to new content and progress.':e.startsWith("visit")?"The keyword <b>visits</b> or <b>visit</b> equals the number of times the current passage has been visited this game, including the current visit. In `(storylet:)` macros, when Harlowe decides whether this passage is available to `(open-storylets:)`, this will often be 0, but when actually visiting the passage, it will be at least 1.":"pos"===e?'The keyword <b>pos</b> should ONLY be used within a "where" or "via" lambda clause. It refers to the position of the current data value that this lambda is processing.':"",whitespace:"<b>Whitespace</b> within macro calls is simply used to separate syntax elements. You can use as much or as little as you like to make your code more readable.",error:(e,[{message:a,explanation:t}])=>a+(t?`<br>${t}`:""),boolean:"The keywords <b>true</b> or <b>false</b> are the two <b>boolean values</b>. They are produced by comparison operators (`<`, `>`, `is`, etc.) and other macros.",is:`The <b>"is" operator</b> produces the boolean value \`true\` if the values on each sides of it are exactly the same.${Xe}`,to:'Use the <b>"to" operator</b> only inside a `(set:)` macro call. Place it to the left of the data, and right of the variable to set the data to.',into:'Use the <b>"into" operator</b> only inside a `(put:)`, `(move:)` or `(unpack:)` macro call. Place it to the right of the data, and left of the destination to put the data.',where:`${lambdaClause("where")}This lambda will search for input values <i>where</i> the right side, once computed, produces \`true\`.`,when:`${lambdaClause("when")}This lambda will cause the macro (if it accepts "when" lambdas) to only do something <i>when</i> the right side, once computed, produces \`true\`.`,via:`${lambdaClause("via")}This lambda is used to convert input values into new values <i>via</i> computing the expression to the right.`,making:`${lambdaClause("making")}This is used only by the \`(folded:)\` macro. The lambda <i>makes</i> the temp variable on the right, which becomes the final value of the \`(folded:)\` call.`,each:`${lambdaClause("each")}This causes the macro (if it accepts lambdas) to, for <i>each</i> input value, place that value in the temp variable on the right, before running the other lambda clauses adjacent to this one (if any).`,and:`${producesBooleanTrueIf("and")}the values on each side of it are both \`true\`.${Xe}`,or:`${producesBooleanTrueIf("or")}the values on each side of it are both \`false\`.${Xe}`,not:'The <b>"not" operator</b> inverts the boolean value to its right, turning `true` to `false` and vice-versa.',isNot:`${producesBooleanTrueIf("is not")}the values on each sides of it are NOT exactly the same.${Xe}`,contains:`${producesBooleanTrueIf("contains")}the array, string, or dataset on the left contains the data on the right, or if the datamap on the left has the data name on the right.${Xe}`,doesNotContain:`${producesBooleanTrueIf("does not contain")}the array, string, or dataset on the left does NOT contain the data on the right, or if the datamap on the left does NOT have the data name on the right.${Xe}`,isIn:`${producesBooleanTrueIf("is in")}the data on the left is in the array, string, datamap or dataset on the right.${Xe}`,isA:`${producesBooleanTrueIf("is a")}the data on the left matches the datatype on the right.${Xe}`,isNotA:`${producesBooleanTrueIf("is not a")}the data on the left does NOT match the datatype on the right.${Xe}`,isNotIn:`${producesBooleanTrueIf("is not in")}the data on the left is NOT in the array, string, datamap or dataset on the right.${Xe}`,matches:`${producesBooleanTrueIf("matches")}one side describes the other - that is, if one side is a datatype that describes the other, or both sides are arrays, datamaps, or datasets, with data in positions that matches those in the other, or if both sides are equal.${Xe}`,doesNotMatch:`${producesBooleanTrueIf("does not match")}one side does NOT describe the other.${Xe}`,bind:'The <b>bind</b> or <b>2bind</b> keyword specifies that the variable to the right should be "bound" to an interactable element. This is used only by certain command macros, like `(dialog:)` or `(cycling-link:)`.',comma:"Use <b>commas</b> to separate the values that you give to macro calls.",spread:"This is a <b>spreader</b>. These spread out the values in the array, string or dataset to the right of it, as if each value was individually placed in the call and separated with commas.<br><br>Alternatively, if a datatype is to the right of it, that datatype becomes a <b>spread datatype</b> that matches zero or more of itself.",typeSignature:"The <b>-type</b> suffix is used to restrict the variable on the right to only holding data that matches the data pattern on the left. Variables restricted in this way are called <b>typed variables</b>.",addition:"Use the <b>addition operator</b> to add two numbers together, as well as join two strings or two arrays, and combine two datamaps, two datasets, two changers, or two colours. This operator can also combine two hook names, creating a hook name that applies to both sets of hooks.",subtraction:"Use the <b>subtraction operator</b> to subtract two numbers, as well as create a copy of the array or dataset on the left that doesn't contain values of the array or dataset on the right.",multiplication:"Use the <b>multiplication operator</b> to multiply two numbers.",division:({text:e})=>("/"===e?"Use the <b>division operator</b> to divide":"Use the <b>modulo operator</b> to get the remainder (modulo) from dividing")+" two numbers. Dividing a number by 0 produces an error.",macro:({name:e})=>{if(void 0===e)return"This macro call is incomplete or erroneously written. Macro calls should consist of `(`, the name (which is case-insensitive and dash-insensitive), `:`, zero or more expressions separated by commas, then `)`, in that order.";if("_"===e[0]||"$"===e[0])return`This is a <b>call to a custom macro stored in the ${e} variable</b>. Custom macros are created with the \`(macro:)\` macro, and must be stored in variables in order to be used.`;const a=qe.Macro[Ve(e)];if(!a)return"This is a call to a nonexistent or misspelled macro. This will cause an error.";const t=a.returnType.toLowerCase();return`This is a <b>call to the \`(${a.name}:)\` macro</b>. ${"metadata"===t?"Metadata macros like this should be placed at the very top of the passage, before all other macros.":"instant"===t||"command"===t?'It produces a <span class="cm-harlowe-4-macroName-command">command</span>, so it should appear in passage code without being connected to a hook.':"changer"===t?'It produces a <span class="cm-harlowe-4-macroName-changer">changer</span>, which can be placed to the left of a hook or a command (passage links are commands), or combined with other changers.':"any"===t||"string"===t?"":`Since it produces a <span class="cm-harlowe-4-macroName-${t}">${t}</span>, it should be nested inside another macro call that can use ${t} (or any) data, or modified with an operator like \`is\` or \`is in\`.${"array"===t||"dataset"===t?" You may also use it in a macro call which can accept any number of values, and spread its contents out using the spreader `...` syntax.":""}`}${"command"===t||"changer"===t?" You may also put it in a variable to reuse it multiple times, like other kinds of data.":""}<code class='harlowe-4-tooltipMacroSignature'>${docsURL(a.anchor,`(${a.name}: ${a.sig}) -> ${a.returnType}`)}</code>${a.aka.length?`<div><i>Also known as: ${a.aka.map((e=>`<code>(${e}:)</code>`)).join(", ")}</i>`:""}</div><div>${a.abstract}</div>`},text:({text:e},a)=>{if(e.trim()){if(a.reduce(((e,a)=>void 0===e?"macro"===a.type||"hook"!==a.type&&e:e),void 0))return"This doesn't seem to be valid code.<br>Note that inside macro calls, only other macro calls, data, operators and whitespace are permitted."}}},ea=document.createElement("div");ea.className="harlowe-4-tooltip";let aa=0,ta=0,ra=4,oa=0,na=0,sa=Object;function tooltipAppear(){aa<1?(ea.style.display="",ta=10):(aa-=1,requestAnimationFrame(tooltipAppear))}const ia={Up(){updateTooltipMenuCursor(Math.max(0,oa-1))},Down(){updateTooltipMenuCursor(Math.min(na-1,oa+1))},PageUp(){updateTooltipMenuCursor(0)},PageDown(){updateTooltipMenuCursor(na-1)},Home(){updateTooltipMenuCursor(0)},End(){updateTooltipMenuCursor(na-1)},Enter(){sa(oa)},Tab(){sa(oa)}};function tooltipClear(e){e.removeKeyMap(ia),oa=0,sa=Object,ea.setAttribute("style","display:none")}const docCursorPlus=(e,a)=>e.posFromIndex(e.indexFromPos(e.getCursor())+a);function positionTooltip(e,a,t=!1){ea.removeAttribute("style");const{width:r}=ea.getBoundingClientRect(),o=e.display.wrapper,{width:n}=o.getBoundingClientRect(),s=e.charCoords(a,"local"),i=je?30:0,l=Math.min(n-r,Math.max((0|s.left)+i-(t?r/2:0),i));ea.setAttribute("style",`left:${l}px; top:${(0|s.top)+(t?30:24)-o.querySelector(".CodeMirror-scroll").scrollTop}px;`),t&&ea.lastElementChild?.setAttribute("style",`left:${s.right-l+(je?(s.right-s.left)/2+6:-12)}px; top:-24px`),o.addEventListener("keydown",(a=>{"display:none"!==ea.getAttribute("style")&&"Escape"===a.key&&(tooltipClear(e),a.stopPropagation())}))}function makeHelpTooltip(e,a,t){if(t.display.wrapper.classList.contains("harlowe-4-hideHelpTooltip")||t.doc.somethingSelected())return!1;const[r]=e;let o=Qe[r.type];return"function"==typeof o&&(o=o(r,e)),!!o&&(o=o.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`)),ea.innerHTML=o+(ra>0?(ra--,`<br><br><i>Use the ${(document.querySelector('[aria-label^="Coding tooltips"],[title^="Coding tooltips"]')||{}).innerHTML||"tooltip"} toolbar button to toggle these popups!</i>`):"")+"<div class=harlowe-4-tooltipTail>",ea.className="harlowe-4-tooltip harlowe-4-helpTooltip",positionTooltip(t,a,!0),ea.style.display="none",aa=50,!0)}const la=Object.values(qe?.Macro||{}).reduce(((e,{name:a,returnType:t,aka:r})=>e.find((e=>e.name===a))?e:e.concat({name:a,returnType:t}).concat(r.map((e=>({name:e,returnType:t}))))),[]);const ca=[..."exit,exits,it,pos,time,turn,turns,visit,visits".split(",").map((e=>({name:e,type:"identifier"}))),..."where,when,each,via,making".split(",").map((e=>({name:e,type:"lambda",label:"lambda keyword"}))),..."number,num,string,str,boolean,bool,array,datamap,dm,dataset,ds,command,changer,color,colour,gradient,lambda,macro,datatype,codehook".split(",").map((e=>({name:e,type:"datatype"}))),..."even,odd,integer,int,empty,whitespace,lowercase,uppercase,anycase,alphanumeric,alnum,digit,linebreak,newline,const,any".split(",").map((e=>({name:e,type:"datatype",label:"specific datatype"}))),..."red,orange,yellow,lime,green,cyan,aqua,blue,navy,purple,fuchsia,magenta,white,gray,grey,black,transparent".split(",").map((e=>({name:e,type:"colour"}))),..."is,is not,contains,does not contain,is in,is not in,is a,is not a,matches,does not match,and,or,not".split(",").map((e=>({name:e,type:"boolean",label:"boolean operator"}))),..."to,into,bind,2bind,-type".split(",").map((e=>({name:e,type:"operator"}))),{name:"true",type:"boolean"},{name:"false",type:"boolean"}];function updateTooltipMenuCursor(e){oa=e,ea.querySelector(".harlowe-4-tooltipItemSelected")?.classList.remove("harlowe-4-tooltipItemSelected");const a=ea.querySelectorAll(".harlowe-4-tooltipItem")[e];a&&(a.classList.add("harlowe-4-tooltipItemSelected"),a.scrollIntoView({block:"center"}))}function makeCompletion(e,a,t){const r=e[e.length-1],{doc:o}=t,n=r.text.slice(0,o.indexFromPos(o.getCursor())),s=function macroCompletion(e,a,t){if(!1===Ye().completionsForMacros)return;if(t.some((e=>"string"===e.type)))return;let[,r]=/\(([\w_-]+)$/.exec(a)||[];if(!r)return;const o=Ve(r),n=la.filter((({name:e})=>Ve(e).startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(sa=a=>{e.replaceRange(`(${n[a].name}:)`,docCursorPlus(e,-(r.length+1)),e.getCursor()),e.setCursor(docCursorPlus(e,-1))},oa=0,na=n.length,n.map(((e,a)=>`<div class='cm-harlowe-4-macro cm-harlowe-4-root harlowe-4-tooltipItem${a?"":" harlowe-4-tooltipItemSelected"}'>(<span class="cm-harlowe-4-macroName-${e.returnType.toLowerCase()}">${e.name}</span>:)</div>`)).join("")):void 0}(o,n,e)||function keywordCompletion(e,a,t){if(!1===Ye().completionsForKeywords)return;if(!t.reduce(((e,a)=>void 0===e?"macro"===a.type||"hook"!==a.type&&"string"!==a.type&&e:e),void 0))return;let[,r]=/[^$\w?]([-2]?[a-zA-Z ]+)$/.exec(a)||[];if(!r||"-"===r||""===r[r.length-1].trim())return;const o=r.trimLeft().toLowerCase(),n=ca.filter((({name:e})=>e.startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(sa=a=>{e.replaceRange(n[a].name,docCursorPlus(e,-r.length),e.getCursor())},oa=0,na=n.length,n.map(((e,a)=>`<div style='display:flex;justify-content:space-between' class="harlowe-4-tooltipItem${a?"":" harlowe-4-tooltipItemSelected"}"><span class='cm-harlowe-4-${e.type} cm-harlowe-4-root'>${e.name}</span><i style="display:inline-block;margin-left:2em;">${e.label||e.type}</i></div>`)).join("")):void 0}(o,n,e);if(s)return ea.innerHTML=s,ea.className="harlowe-4-tooltip harlowe-4-completion",positionTooltip(t,a,!1),aa=0,t.addKeyMap(ia),oa=0,!0}function Tooltips(e,a){const{tree:t,lastAction:r}=a,{cm:o}=e;tooltipClear(o);const n=o.display.wrapper;ea.parentNode!==n&&(n.append(ea),n.addEventListener("mousemove",(()=>{"none"===ea.style.display||n.querySelector(".harlowe-4-tooltip:hover")?aa>0&&(aa+=1):(ta-=1,ta<=0&&tooltipClear(o))})));const s=e.getCursor(),i=t.pathAt(Math.min(t.text.length-1,e.indexFromPos(s)));if(!i.length)return void(aa=0);const l=aa>0;("change"===r?makeCompletion:makeHelpTooltip)(i,s,o)&&(l||tooltipAppear())}let ha=q.lex,{ShortDefs:da,insensitiveName:ma,getPrefs:pa,setOptionalStyles:ua}=X;const ga=Object.entries(da.Macro).reduce(((e,[a,t])=>([a,...t.aka].forEach((a=>e[a]=t)),e)),{}),mode=()=>{let e,a,t;const r=new WeakMap,docData=e=>(r.has(e)||refreshTree(e),r.get(e));function lexTreePostProcess(e,r,o){"variable"!==r.type&&"tempVariable"!==r.type&&"hook"!==r.type&&"hookName"!==r.type||e.referenceTokens[r.type].push(r),"string"===r.type&&(r.childAt=void 0,r.children=[]);let n={},s="";for(let e=-1;e<o.length;e+=1){const{type:i,text:l}=-1===e?r:o[e];"verbatim"!==i&&"comment"!==i||(s="");let c=`harlowe-4-${i}`;switch(n[c]=(n[c]||0)+1,n[c]>1&&(c+=`-${n[c]}`),i){case"string":{const e=l.slice(1,-1);a.has(e)?c+=" harlowe-4-passageString":t.has(e)&&(c+=" harlowe-4-tagString");break}case"text":if(l.trim()){o.slice(e+1).reduce(((e,a)=>void 0===e?"macro"===a.type||"hook"!==a.type&&e:e),void 0)&&(c+=" harlowe-4-error")}break;case"macroName":{const e=l[0];if("_"===e||"$"===e){c+=` harlowe-4-customMacro harlowe-4-${"_"===e?"tempV":"v"}ariable`;break}const a=ma(l.slice(0,-1));Object.hasOwn(ga,a)?c+=`-${ga[a].returnType.toLowerCase()}`:c+=" harlowe-4-error";break}}s+=`${c} `}e.cssClasses[r.start]=s,r.children?.length&&(e.cssClasses[r.children[r.children.length-1].end]=s);for(let a=0;a<r.children.length;a+=1)lexTreePostProcess(e,r.children[a],[r].concat(o))}function refreshTree(e){let a;r.has(e)?a=r.get(e):(a={tooltipsEnabled:!0,lastAction:""},r.set(e,a)),a.tree=ha(e.getValue()),a.referenceTokens={variable:[],tempVariable:[],hook:[],hookName:[]},a.cssClasses=Object.create(null),a.cursorMarks?.forEach((e=>e.clear())),a.cursorMarks=[];for(let e=0;e<a.tree.children.length;e+=1)lexTreePostProcess(a,a.tree.children[e],[a.tree])}let o,n,s=[],i=-1;const l={token(e){const{line:a}=e.lineOracle,t=e.pos;for(let r=0;r<s.length;r+=1){const{start:n,end:i}=s[r];if(!(n.line>a||i.line<a)&&(n.line<=a&&i.line>=a)){if((n.line<a||n.ch<=t)&&(i.line>a||i.ch>t))return i.line>a?e.skipToEnd():e.pos=i.ch,o===r?"harlowe-4-findResultCurrent":"harlowe-4-findResult";if(n.line===a&&n.ch>t)return void(e.pos=n.ch)}}e.skipToEnd()}};function harlowe3Find(a){if(e.removeOverlay(l),s=[],o=-1,a.matches=void 0,!a.query)return void(n=void 0);n=a;const{doc:t}=e,r=i>-1?i:Math.max(0,t.indexFromPos(t.getCursor())-1);try{a.regExp=new RegExp(a.useRegExp?a.query:a.query.replace(/[-[\]/{}()*+?.\\^$|]/gm,"\\$&"),a.matchCase?"g":"gi")}catch(e){return void(n=void 0)}const c=t.getValue(),h=docData(t).tree,{onlyIn:d}=a;let m;e:for(;m=a.regExp.exec(c);){const a=m[0].length;if(!a)break;const{index:n}=m,l=m.slice(1);if("Only in prose"===d||"Only in code"===d){let e=h.pathAt(n),t=e[0];for(let r=n;r<n+a;r+=1){let a;for(r>t.end&&(e=h.pathAt(r),t=e[0]),a=0;a<e.length;a+=1){const{type:t}=e[a];if("text"===t||"string"===t){if("Only in code"===d)continue e;break}}if(a===e.length&&"Only in prose"===d)continue e}}else if("Only in selection"===d){const e=t.listSelections();let r=!1;for(let o=0;o<e.length&&!r;o+=1){const s=t.indexFromPos(e[o].anchor),i=t.indexFromPos(e[o].head);n>=Math.min(s,i)&&n+a<Math.max(s,i)&&(r=!0)}if(!r)continue e}const c=t.posFromIndex(n),p=t.posFromIndex(n+a);s.push({start:c,end:p,groups:l.length?l:null}),-1===o&&(n>r&&(o=s.length-1),i||e.scrollIntoView(c,e.display.wrapper.offsetHeight/2))}-1===o&&(o=0),e.addOverlay(l),a.matches=s.length,a.matchIndex=o,a.updateResultsDisplay?.(),i=-1}function harlowe3FindNext(a){o=(o+a)%s.length,o<0&&(o+=s.length),s[o]&&e.scrollIntoView(s[o].start,e.display.wrapper.offsetHeight/2),e.removeOverlay(l),e.addOverlay(l),n.matchIndex=o,n.updateResultsDisplay?.()}function harlowe3Replace(a,t){const{doc:r}=e,l=s[o];if(!t&&l)l.groups?.length&&(a=a.replace(/\$(\d+)/g,((e,a)=>l.groups[+a-1]||`$${a}`))),i=r.indexFromPos(l.start)+a.length-1,r.replaceRange(a,l.start,l.end);else if(s.length){const e=s[0].start,t=s[s.length-1].end;r.replaceRange(r.getValue().slice(r.indexFromPos(e),r.indexFromPos(t)).replace(n.regExp,a),e,t)}}const on=(e,a,t)=>(!e._handlers||!(e._handlers[a]||[]).some((e=>e.name===t.name)))&&e.on(a,t);let init=r=>{e||(e=r.cm,window===this&&(e.setOption("lineNumbers",!0),e.setOption("lineNumberFormatter",(()=>"•")))),X.twine23&&Toolbar?.(e,{foregroundColor:"#888"}),(()=>{let e;a=new Set,t=new Set;try{e=localStorage.getItem("twine-stories").split(",")}catch(e){return}let r,o=0;for(let a of e)try{a=JSON.parse(localStorage.getItem(`twine-stories-${a}`));const e=Date.parse(a.lastUpdate);e>o&&document.title.includes(a.name)&&(r=a,o=e)}catch(e){continue}if(r)try{for(let e of localStorage.getItem("twine-passages")?.split(",")||[]){let o=JSON.parse(localStorage.getItem(`twine-passages-${e}`));if(o.story===r.id){a.add(o.name);for(let e of o.tags)t.add(e)}}}catch(e){return}})(),ua(pa()),refreshTree(r),on(r,"beforeChange",(function harlowe3beforeChange(e,a){if(!r.cm.display.wrapper.parentNode)return;!function forceFullChange(e,a){if(!e.update)return;const t=e.from.line;let r=a.split("\n").slice(0,e.from.line+1);return r[t]=r[t].slice(0,e.from.ch)+e.text[0],r=r.concat(e.text.slice(1)),e.update({line:0,ch:0},e.to,r),r.join("\n")}(a,r.getValue())})),on(r,"change",(function harlowe3Change(){r.cm.display.wrapper.parentNode&&(docData(r).lastAction="changing",refreshTree(r),n&&s[o]&&(-1===i&&(i=r.indexFromPos(s[o].start)-1),harlowe3Find(n)))})),on(r,"cursorActivity",(function harlowe3CursorActivity(){!function cursorMarking(e){const a=docData(e);let{tree:t,cursorMarks:r,referenceTokens:o}=a;r.length&&(r.forEach((e=>e.clear())),r=a.cursorMarks=[]);const n=t.tokenAt(e.indexFromPos(e.getCursor()));n&&(r.push(e.markText(e.posFromIndex(n.start),e.posFromIndex(n.end),{className:"cm-harlowe-4-cursor"})),("variable"===n.type||"tempVariable"===n.type||"hookName"===n.type||"hook"===n.type)&&o["hook"===n.type?"hookName":n.type].forEach((a=>{a!==n&&a.name===n.name&&r.push(e.markText(e.posFromIndex(a.start),e.posFromIndex(a.end),{className:"cm-harlowe-4-variableOccurrence"}))})),"hookName"!==n.type&&"hook"!==n.type||o.hook.forEach((a=>{if(a!==n&&a.name&&a.name===n.name){const t="appended"===a.tagPosition?a.end-a.name.length-1:a.start+1;r.push(e.markText(e.posFromIndex(t),e.posFromIndex(t+a.name.length),{className:"cm-harlowe-4-hookOccurrence"}))}})))}(r);const e=docData(r);e.lastAction="changing"===e.lastAction?"change":"cursorActivity",Tooltips?.(r,e)})),on(e,"renderLine",(function harlowe3RenderLine(e,a,t){Array.from(t.querySelectorAll(".cm-harlowe-4-colour")).forEach((e=>{const{colour:a}=ha(e.textContent,"","macro").tokenAt(0);e.setAttribute("style",`background:linear-gradient(to bottom,transparent,transparent 80%,${a} 80.1%,${a})`)}))})),on(e,"scroll",(function harlowe3Scroll(){const e=document.querySelector(".harlowe-4-tooltip");e?.remove()})),on(e,"harlowe-4-find",harlowe3Find),on(e,"harlowe-4-findNext",harlowe3FindNext),on(e,"harlowe-4-replace",harlowe3Replace),on(e,"harlowe-4-findDone",(function harlowe3FindDone(){e.removeOverlay(l)})),init=null};return{startState:()=>({pos:0,disconnected:null,styleBeforeNewline:""}),blankLine(e){e.pos++},token(e,a){const{doc:t}=e.lineOracle;if(null===a.disconnected?a.disconnected=!t.cm.display.wrapper.parentNode:a.disconnected)return a.pos++,e.next(),null;init?.(t);const{cssClasses:r}=docData(t),o=r[a.pos]||a.styleBeforeNewline||null;do{a.pos++,e.next()}while(!(r[a.pos]!==o&&a.pos in r||e.eol()));return e.eol()?(a.styleBeforeNewline=o,a.pos++):a.styleBeforeNewline="",o}}};"CodeMirror"in window?window.CodeMirror.defineMode("harlowe-4",mode):this.editorExtensions={twine:{2:{codeMirror:{mode,toolbar:Toolbar,commands:Fe}}}};let ya=document.querySelector("style#cm-harlowe-4");ya||(ya=document.createElement("style"),ya.setAttribute("id","cm-harlowe-4"),document.head.appendChild(ya)),ya.innerHTML=".cm-harlowe-4-cursor:not([class^='cm-harlowe-4-verbatim']):not([class^='cm-harlowe-4-text cm-harlowe-4-root']) { border-bottom: 2px solid darkgray; }.cm-harlowe-4-findResult { background-color: hsla(280,100%,70%,0.4) !important; } .cm-harlowe-4-findResultCurrent { background-color: hsla(320,100%,70%,0.6) !important; }.cm-harlowe-4-root .cm-tab { text-decoration: line-through dotted #888; border-right: dotted 1px #888; }.CodeMirror {padding: 0 !important}.CodeMirror-linenumber {color: hsla(0,0%,80%,1.0);}.CodeMirror-gutters {left: 0px !important;}.cm-harlowe-4-root{box-sizing:border-box;}.cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.theme-dark .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.theme-dark .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.theme-dark .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.theme-dark .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.theme-dark .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.theme-dark .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.theme-dark .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}.theme-dark .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[class^='cm-harlowe-4-hook '], [class^='cm-harlowe-4-hook-']{font-weight:bold;}.cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.theme-dark .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}[data-app-theme=dark] .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}.theme-dark .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[data-app-theme=dark] .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[class^='cm-harlowe-4-macroName']{font-style:italic;}.cm-harlowe-4-macroName-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-macroName-array{color:hsla(0,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}.cm-harlowe-4-macroName-dataset{color:hsla(30,100%,40%,1.0)}.theme-dark .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}.cm-harlowe-4-macroName-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-macroName-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-macroName-datamap{color:hsla(60,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}.cm-harlowe-4-macroName-changer{color:hsla(90,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}.cm-harlowe-4-macroName-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-macroName-colour, .cm-harlowe-4-macroName-gradient{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-colour, .theme-dark .cm-harlowe-4-macroName-gradient{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-colour, [data-app-theme=dark] .cm-harlowe-4-macroName-gradient{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-macroName-command, .cm-harlowe-4-macroName-instant, .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-macroName-command, .theme-dark .cm-harlowe-4-macroName-instant, .theme-dark .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-command, [data-app-theme=dark] .cm-harlowe-4-macroName-instant, [data-app-theme=dark] .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-macroName-custommacro, .cm-harlowe-4-macroName-macro, .cm-harlowe-4-macroName-any{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-custommacro, .theme-dark .cm-harlowe-4-macroName-macro, .theme-dark .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-custommacro, [data-app-theme=dark] .cm-harlowe-4-macroName-macro, [data-app-theme=dark] .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,80%,30%,1.0)}.theme-dark [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-comma, .cm-harlowe-4-spread{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-comma, .theme-dark .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-comma, [data-app-theme=dark] .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-addition{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-subtraction, .cm-harlowe-4-multiplication, .cm-harlowe-4-division{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-subtraction, .theme-dark .cm-harlowe-4-multiplication, .theme-dark .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-subtraction, [data-app-theme=dark] .cm-harlowe-4-multiplication, [data-app-theme=dark] .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-is, .cm-harlowe-4-and, .cm-harlowe-4-or, .cm-harlowe-4-not, .cm-harlowe-4-isNot, .cm-harlowe-4-contains, .cm-harlowe-4-doesNotContain, .cm-harlowe-4-isIn, .cm-harlowe-4-isA, .cm-harlowe-4-isNotA, .cm-harlowe-4-isNotIn, .cm-harlowe-4-matches, .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-is, .theme-dark .cm-harlowe-4-and, .theme-dark .cm-harlowe-4-or, .theme-dark .cm-harlowe-4-not, .theme-dark .cm-harlowe-4-isNot, .theme-dark .cm-harlowe-4-contains, .theme-dark .cm-harlowe-4-doesNotContain, .theme-dark .cm-harlowe-4-isIn, .theme-dark .cm-harlowe-4-isA, .theme-dark .cm-harlowe-4-isNotA, .theme-dark .cm-harlowe-4-isNotIn, .theme-dark .cm-harlowe-4-matches, .theme-dark .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-is, [data-app-theme=dark] .cm-harlowe-4-and, [data-app-theme=dark] .cm-harlowe-4-or, [data-app-theme=dark] .cm-harlowe-4-not, [data-app-theme=dark] .cm-harlowe-4-isNot, [data-app-theme=dark] .cm-harlowe-4-contains, [data-app-theme=dark] .cm-harlowe-4-doesNotContain, [data-app-theme=dark] .cm-harlowe-4-isIn, [data-app-theme=dark] .cm-harlowe-4-isA, [data-app-theme=dark] .cm-harlowe-4-isNotA, [data-app-theme=dark] .cm-harlowe-4-isNotIn, [data-app-theme=dark] .cm-harlowe-4-matches, [data-app-theme=dark] .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-bold, .cm-harlowe-4-strong{font-weight:bold;}.cm-harlowe-4-italic, .cm-harlowe-4-em{font-style:italic;}.cm-harlowe-4-sup{vertical-align: super;font-size:0.8em;}.cm-harlowe-4-strike{text-decoration: line-through;}.cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)}.theme-dark .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)}[data-app-theme=dark] .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)}[class^='cm-harlowe-4-bold'], [class^='cm-harlowe-4-strong'], [class^='cm-harlowe-4-italic'], [class^='cm-harlowe-4-em'], [class^='cm-harlowe-4-sup'], [class^='cm-harlowe-4-verbatim'], [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,0%,0.5)}.theme-dark [class^='cm-harlowe-4-bold'], .theme-dark [class^='cm-harlowe-4-strong'], .theme-dark [class^='cm-harlowe-4-italic'], .theme-dark [class^='cm-harlowe-4-em'], .theme-dark [class^='cm-harlowe-4-sup'], .theme-dark [class^='cm-harlowe-4-verbatim'], .theme-dark [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[data-app-theme=dark] [class^='cm-harlowe-4-bold'], [data-app-theme=dark] [class^='cm-harlowe-4-strong'], [data-app-theme=dark] [class^='cm-harlowe-4-italic'], [data-app-theme=dark] [class^='cm-harlowe-4-em'], [data-app-theme=dark] [class^='cm-harlowe-4-sup'], [data-app-theme=dark] [class^='cm-harlowe-4-verbatim'], [data-app-theme=dark] [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.theme-dark .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}[data-app-theme=dark] .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-tag, .cm-harlowe-4-scriptStyleTag, .cm-harlowe-4-comment{color: hsla(240,34%,25%,1.0);}.theme-dark .cm-harlowe-4-tag, .theme-dark .cm-harlowe-4-scriptStyleTag, .theme-dark .cm-harlowe-4-comment{color: hsla(240,51%,75%,1.0);}[data-app-theme=dark] .cm-harlowe-4-tag, [data-app-theme=dark] .cm-harlowe-4-scriptStyleTag, [data-app-theme=dark] .cm-harlowe-4-comment{color: hsla(240,51%,75%,1.0);}.cm-harlowe-4-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-variable{color:hsla(200,100%,30%,1.0)}.theme-dark .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}.cm-harlowe-4-tempVariable{color:hsla(200,70%,20%,1.0)}.theme-dark .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}.cm-harlowe-4-hookName{color:hsla(160,100%,30%,1.0)}.theme-dark .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}.cm-harlowe-4-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-colour{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-cssTime{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-passageString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px;}.theme-dark .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}[data-app-theme=dark] .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}.cm-harlowe-4-tagString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px dotted;}.theme-dark .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}[data-app-theme=dark] .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}.cm-harlowe-4-variableOccurrence, .cm-harlowe-4-hookOccurrence{background: hsla(159,50%,75%,1.0) !important;}.theme-dark .cm-harlowe-4-variableOccurrence, .theme-dark .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[data-app-theme=dark] .cm-harlowe-4-variableOccurrence, [data-app-theme=dark] .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[class^='cm-harlowe-4-where'], [class^='cm-harlowe-4-via'], [class^='cm-harlowe-4-with'], [class^='cm-harlowe-4-making'], [class^='cm-harlowe-4-each'], [class^='cm-harlowe-4-when']{color:hsla(120,100%,40%,1.0); font-style:italic;}.theme-dark [class^='cm-harlowe-4-where'], .theme-dark [class^='cm-harlowe-4-via'], .theme-dark [class^='cm-harlowe-4-with'], .theme-dark [class^='cm-harlowe-4-making'], .theme-dark [class^='cm-harlowe-4-each'], .theme-dark [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}[data-app-theme=dark] [class^='cm-harlowe-4-where'], [data-app-theme=dark] [class^='cm-harlowe-4-via'], [data-app-theme=dark] [class^='cm-harlowe-4-with'], [data-app-theme=dark] [class^='cm-harlowe-4-making'], [data-app-theme=dark] [class^='cm-harlowe-4-each'], [data-app-theme=dark] [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}.cm-harlowe-4-heading{font-weight:bold;}.cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);}.theme-dark .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}[data-app-theme=dark] .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}.cm-harlowe-4-align{color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);}.theme-dark .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}.cm-harlowe-4-column{color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);}.theme-dark .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}.cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,30%,1.0);}.theme-dark .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}.cm-harlowe-4-identifier, .cm-harlowe-4-property, .cm-harlowe-4-belongingProperty, .cm-harlowe-4-itsProperty, .cm-harlowe-4-belongingItProperty, .cm-harlowe-4-belongingItOperator, .cm-harlowe-4-possessiveOperator, .cm-harlowe-4-belongingOperator{color:hsla(200,80%,40%,1.0)}.theme-dark .cm-harlowe-4-identifier, .theme-dark .cm-harlowe-4-property, .theme-dark .cm-harlowe-4-belongingProperty, .theme-dark .cm-harlowe-4-itsProperty, .theme-dark .cm-harlowe-4-belongingItProperty, .theme-dark .cm-harlowe-4-belongingItOperator, .theme-dark .cm-harlowe-4-possessiveOperator, .theme-dark .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-identifier, [data-app-theme=dark] .cm-harlowe-4-property, [data-app-theme=dark] .cm-harlowe-4-belongingProperty, [data-app-theme=dark] .cm-harlowe-4-itsProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItOperator, [data-app-theme=dark] .cm-harlowe-4-possessiveOperator, [data-app-theme=dark] .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}@keyframes harlowe-4-appear{0%{opacity:0}to{opacity:1}}@keyframes harlowe-4-fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes harlowe-4-rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes harlowe-4-shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes harlowe-4-buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes harlowe-4-sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes harlowe-4-pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes harlowe-4-zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes harlowe-4-shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes harlowe-4-rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes harlowe-4-fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes harlowe-4-slide-right{0%{transform:translateX(-100vw)}}@keyframes harlowe-4-slide-left{0%{transform:translateX(100vw)}}@keyframes harlowe-4-slide-up{0%{transform:translateY(100vh)}}@keyframes harlowe-4-slide-down{0%{transform:translateY(-100vh)}}@keyframes harlowe-4-fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes harlowe-4-fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes harlowe-4-fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes harlowe-4-fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes harlowe-4-flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes harlowe-4-blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}\n.harlowe-4-toolbarPanel{transition:max-height .8s;overflow-y:auto;margin-bottom:4px}.harlowe-4-minimised .harlowe-4-toolbarPanel>:not(:last-child){display:none}.harlowe-4-toolbarPanel code:not(:empty){font-size:1rem;border:1px dotted hsl(0, 0%, 50%)}.harlowe-4-toolbarPanel [type=radio][disabled]~*{opacity:.5}.harlowe-4-stylePreview{text-align:center;user-select:none;background:black;color:white;font-family:\"Georgia\",serif;padding:8px;font-size:1.5rem;margin:8px auto;width:60%;position:sticky;top:0;z-index:1}.harlowe-4-stylePreview textarea{background:black;color:white}.harlowe-4-stylePreview>span{display:inline-block}.harlowe-4-stylePreview>span:first-child{position:absolute}.harlowe-4-stylePreview>span:last-child{position:relative}.harlowe-4-toolbarPanel>button{border-radius:.8rem;margin:0px 2px;padding:0px 4px;height:36px;font-size:1.2rem;min-width:28px}.harlowe-4-toolbarPanel>button:not(:active):not(.active):not(:last-child){border:1px solid hsla(0, 0%, 50%, 0.5);border-top:none;border-left:none}.harlowe-4-toolbarCheckboxes{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);position:relative;padding-bottom:8px;margin-bottom:8px}.harlowe-4-toolbarPanel label:not(.harlowe-4-radioRow){white-space:nowrap}.harlowe-4-toolbarCheckboxes>label{min-width:20%;display:inline-block}.harlowe-4-swatch{width:24px;height:24px;display:inline-block;cursor:pointer;border-bottom:1px solid hsla(0, 0%, 50%, 0.5);border-right:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-labeledInput{position:relative;padding-bottom:8px}.harlowe-4-labeledInput>input[type=text]{display:inline-block;font-size:1rem}.harlowe-4-labeledInput>input[type=range]{vertical-align:middle}.harlowe-4-labeledInput>input[type=number]{box-shadow:0 1px 0 hsla(0, 0%, 50%, 0.5);background:transparent;color:inherit;border:none;font-family:\"Source Code Pro\",monospace;font-family:var(--font-monospaced);width:4rem;margin:0 .5rem;display:inline-block;font-size:1rem}.harlowe-4-radioRow{margin:8px 0px;display:block}.harlowe-4-radioRow .harlowe-4-radioRow{margin-left:2rem}.harlowe-4-toolbarPanel>*>.harlowe-4-radioRow{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);padding-bottom:8px}.harlowe-4-confirmButtons>span{display:inline-block;align-items:center}.harlowe-4-resultCode{max-width:50%;overflow-x:auto;white-space:pre;display:inline-block;padding:1px 0px}.harlowe-4-resultCode *{white-space:nowrap}.harlowe-4-toolbarBullet{padding:0px 2px;color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarBullet::before{content:\"•\"}.harlowe-4-bgColourButton{display:inline-block;border-radius:8px;width:16px;height:16px;margin-bottom:-2px;background:linear-gradient(to right, hsla(0, 100%, 50%, 0.5), hsla(30, 100%, 50%, 0.5), hsla(60, 100%, 50%, 0.5), hsla(120, 100%, 50%, 0.5), hsla(180, 100%, 50%, 0.5), hsla(240, 100%, 50%, 0.5), hsla(300, 100%, 50%, 0.5), hsla(320, 100%, 50%, 0.5))}.harlowe-4-gradientBar{display:inline-block;position:relative;width:75%;height:32px;margin:12px 8px 96px 40px;border:1px solid hsla(0, 0%, 50%, 0.5);border-radius:5px}.harlowe-4-gradientBar+button{position:absolute;top:8px;right:8px}.harlowe-4-colourStop{position:absolute;height:48px;width:16px;background:hsla(0, 0%, 50%, 0.5);border-radius:5px;cursor:grab}.harlowe-4-colourStop:active{cursor:grabbing}.harlowe-4-colourStopButtons{display:none;position:relative;top:64px;width:540px;background:hsla(0, 0%, 50%, 0.5);padding:8px;cursor:auto}.harlowe-4-colourStop[selected]{border-bottom-right-radius:0px;border-bottom-left-radius:0px;height:64px}.harlowe-4-colourStop[selected]>.harlowe-4-colourStopButtons{display:block}.harlowe-4-singleColourPicker{display:inline-block}.harlowe-4-singleColourPicker select{position:relative;top:-4px;font-size:1rem;margin-left:8px}.harlowe-4-directionPicker{width:48px;height:48px;border-radius:24px;border:1px solid hsla(0, 0%, 50%, 0.5);display:inline-block}.harlowe-4-hideCode .cm-harlowe-4-root:not(.cm-harlowe-4-text):not(.cm-harlowe-4-string):not(.cm-harlowe-4-verbatim){opacity:.25}.harlowe-4-hideHelpTooltip .harlowe-4-helpTooltip{display:none}.harlowe-4-tooltip{font-family:var(--font-system);max-width:20vw;position:absolute;border:1px solid hsla(0, 0%, 50%, 0.5);padding:8px;display:block;z-index:8}[data-version^=\"2.3\"] .harlowe-4-tooltip{font-family:\"Source Sans Pro\",sans-serif}.theme-light .harlowe-4-tooltip,[data-app-theme=light] .harlowe-4-tooltip{background:white}.theme-dark .harlowe-4-tooltip,[data-app-theme=dark] .harlowe-4-tooltip{background:black}.harlowe-4-tooltipMacroSignature{display:block;padding-top:.5em;margin-top:.5em;border-top:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail{position:absolute;height:0;width:0;border:12px solid transparent;border-bottom-color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail::after{content:\"\";position:absolute;height:0;width:0;left:-12px;top:-10px;border:12px solid transparent}.harlowe-4-completion{max-height:12em;overflow-y:scroll}.harlowe-4-tooltipItemSelected{background-color:#888;background-color:var(--light-gray-translucent)}.theme-light .harlowe-4-tooltipTail::after,[data-app-theme=light] .harlowe-4-tooltipTail::after{border-bottom-color:white}.theme-dark .harlowe-4-tooltipTail::after,[data-app-theme=dark] .harlowe-4-tooltipTail::after{border-bottom-color:black}.harlowe-4-dataEmptyRow:not(:last-child){display:none}.harlowe-4-dataRow .harlowe-4-dropdownRowLabel{font-family:\"Source Code Pro\",monospace;font-family:var(--font-monospaced)}.harlowe-4-textareaRows{margin-bottom:.5em}.harlowe-4-nonZeroRows>:first-child>.harlowe-4-rowMinus{display:none}.harlowe-4-datavalueRows{margin-left:6px;padding-left:6px;border-left:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarPanel [invalid]::after{display:block;position:absolute;content:attr(invalid);background-color:hsla(17, 100%, 50%, 0.5);right:0px;bottom:8px}.harlowe-4-datavalueRows .harlowe-4-datavalueRows .harlowe-4-datavalueRowHint{display:none}.story-format-toolbar .icon>img:only-child{margin-right:0px}.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{display:flex;justify-content:end}.passage-edit-dialog.collapsed .harlowe-4-toolbarPanel{display:none}.harlowe-4-scrollWrapper{overflow:hidden auto;max-height:60vh}.harlowe-4-toolbarPanel a[href]{color:var(--dark-blue);font-weight:bold}.harlowe-4-toolbarPanel.card{position:absolute;width:576px;height:auto;top:0px;padding:8px}.story-format-toolbar+.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{justify-content:start;flex-flow:row-reverse}.harlowe-4-toolbarPanel textarea,.harlowe-4-toolbarPanel [type=text]{background:var(--white-translucent);border-radius:var(--corner-round);border:1px solid var(--faint-gray);color:var(--dark-gray)}html:not([data-version^=\"2.3\"]) .harlowe-4-toolbarPanel [type=checkbox]{background:transparent;border:2px solid var(--dark-gray);width:16px;height:16px;appearance:none;position:relative;border-radius:2px;margin:0px 6px;vertical-align:middle}html:not([data-version^=\"2.3\"]) .harlowe-4-toolbarPanel [type=checkbox]:checked::before{content:\"✔\";position:absolute;right:-2px;top:-4px;margin-right:3px}select>option{background-color:var(--light-gray);color:var(--dark-gray) !important}.harlowe-4-radioRow{padding-left:0px;padding-right:0px;user-select:none;position:relative}.harlowe-4-radioRow>:first-child,.harlowe-4-radioRow>:nth-child(2){cursor:pointer}.harlowe-4-radioRow>div{padding:var(--grid-size)}.harlowe-4-toolbarPanel select{padding:var(--grid-size)}.harloweToolbar+.story-format-toolbar button{padding:calc(var(--grid-size) - 1px)}#root>.dialogs>:not(.passag-edit-stack){z-index:-1}\n";
},"hydrate":"function escape(e){return e&&\"object\"==typeof e?(Object.keys(e).forEach((a=>{e[a]=escape(e[a])})),e):`${e}`.replace(/[-[\\]/{}()*+?.\\\\^$|]/g,\"\\\\$&\")}function makeWrapper(e){return(...a)=>`(${e}${a.join(\"|\")})`}const e=makeWrapper(\"?:\"),a=makeWrapper(\"?!\"),t=makeWrapper(\"?=\"),r=\"[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*\",o=r.replace(\"*\",\"+\"),n=\"\\\\b\",s=\"[\\\\w\\\\-\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",i=s.replace(\"\\\\-\",\"\"),l=e(\"\\\\n\",\"$\"),c=`${r}(\\\\*+)${o}`,h=`${r}((?:0\\\\.)+)${o}`,d=`${r}-{3,}${r}${l}`,m=`${r}(#{1,6})${r}`,p=`${r}(==+>|<=+|=+><=+|<==+>)${r}${l}`,u=`${r}(=+\\\\|+|\\\\|+=+|=+\\\\|+=+|\\\\|=+\\\\|)${r}${l}`,g={opener:\"\\\\[\\\\[(?!\\\\[)\",main:void 0,text:`(${function notChars(...e){return`[^${e.map(escape).join(\"\")}]*`}(\"]\")})`,rightSeparator:e(\"\\\\->\",\"\\\\|\"),leftSeparator:\"<\\\\-\",closer:\"\\\\]\\\\]\",legacySeparator:\"\\\\|\",legacyText:`(${e(\"[^\\\\|\\\\]]\",`\\\\]${a(\"\\\\]\")}`)}+)`},y=`${i}*${i.replace(\"\\\\w\",\"a-zA-Z\")}${i}*`,b=`\\\\$(${y})`,f=`_(${y})`,w=`'s${o}${a(\"_\")}(${y})`,k=`(${y})${o}of${n}${a(`it${n}`)}`,v=`'s${o}`,x=`of${n}`,T=e(\"it\",\"time\",\"turns?\",\"visits?\",\"exits?\",\"pos\")+n,$=`its${o}(${y})`,C=`its${n}`,S=`(${y})${o}of${o}it${n}`,N=`of${o}it${n}`,A={opener:\"\\\\(\",name:`(${e(\"\\\\$\",\"_\")}?${s}+):${a(\"\\\\/\")}`,closer:\"\\\\)\"},O=e(\"=<\",\"=>\",`[gl]te?${n}`,`n?eq${n}`,`isnot${n}`,`are${n}`,`x${n}`,`isa${n}`,`or${o}a${n}`),_=\"[a-zA-Z][\\\\w\\\\-]*\",P=\"(?:\\\"[^\\\"]*\\\"|'[^']*'|[^'\\\">])*?\",H=`\\\\|(${s}+)(>|\\\\))`,L=`(<|\\\\()(${s}+)\\\\|`,I=`((?:\\\\b\\\\d+(?:\\\\.\\\\d+)?|\\\\.\\\\d+)(?:[eE][+\\\\-]?\\\\d+)?)${a(\"m?s\")}${n}`;g.main=g.opener+e(g.text+g.rightSeparator,g.text.replace(\"*\",\"*?\")+g.leftSeparator)+g.text;const M={upperLetter:\"[A-Z\\\\u00c0-\\\\u00de\\\\u0150\\\\u0170]\",lowerLetter:\"[a-z0-9_\\\\-\\\\u00df-\\\\u00ff\\\\u0151\\\\u0171]\",anyLetter:s,anyLetterStrict:i,whitespace:o.replace(\"[\",\"[\\\\n\\\\r\"),escapedLine:\"\\\\\\\\\\\\n\\\\\\\\?|\\\\n\\\\\\\\\",br:\"\\\\n(?!\\\\\\\\)\",tag:`<\\\\/?${_}${P}>`,scriptStyleTag:`<(${e(\"script\",\"style\",\"textarea\")})${P}>[^]*?<\\\\/\\\\1>`,scriptStyleTagOpener:\"<\",url:`(${e(\"https?\",\"mailto\",\"javascript\",\"ftp\",\"data\")}:\\\\/\\\\/[^\\\\s<]+[^<.,:;\"')\\\\]\\\\s])`,bullet:\"\\\\*\",hr:d,heading:m,align:p,column:u,bulleted:c,numbered:h,verbatimOpener:\"`+\",hookAppendedFront:`\\\\[${a(\"=+\")}`,hookPrependedFront:`${H}\\\\[${a(\"=+\")}`,hookFront:`\\\\[${a(\"=+\")}`,hookBack:`\\\\]${a(L)}`,hookAppendedBack:`\\\\]${L}`,unclosedHook:\"\\\\[=+\",unclosedHookPrepended:`${H}\\\\[=+`,unclosedCollapsed:\"\\\\{=+\",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+t(A.name),macroName:A.name,groupingFront:`\\\\(${a(A.name)}`,twine1Macro:\"<<[^>\\\\s]+\\\\s*(?:\\\\\\\\.|'(?:[^'\\\\\\\\]*\\\\\\\\.)*[^'\\\\\\\\]*'|\\\"(?:[^\\\"\\\\\\\\]*\\\\\\\\.)*[^\\\"\\\\\\\\]*\\\"|[^'\\\"\\\\\\\\>]|>(?!>))*>>\",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:v,belongingOperator:x,itsOperator:C,belongingItOperator:N,variable:b,tempVariable:f,hookName:`\\\\?(${s}+)\\\\b`,cssTime:`(\\\\d+\\\\.?\\\\d*|\\\\d*\\\\.?\\\\d+)(m?s)${n}`,colour:e(e(\"Red\",\"Orange\",\"Yellow\",\"Lime\",\"Green\",\"Cyan\",\"Aqua\",\"Blue\",\"Navy\",\"Purple\",\"Fuchsia\",\"Magenta\",\"White\",\"Gray\",\"Grey\",\"Black\",\"Transparent\"),\"#[\\\\dA-Fa-f]{3}(?:[\\\\dA-Fa-f]{3})?\"),datatype:e(\"alnum\",\"alphanumeric\",\"any(?:case)?\",\"array\",\"bool(?:ean)?\",\"changer\",\"codehook\",\"colou?r\",\"const\",\"command\",\"dm\",`data${e(\"map\",\"type\",\"set\")}`,\"ds\",\"digit\",\"gradient\",\"empty\",\"even\",`int${a(\"o\")}(?:eger)?`,\"lambda\",\"lowercase\",\"macro\",\"linebreak\",\"newline\",\"num(?:ber)?\",\"odd\",\"str(?:ing)?\",\"uppercase\",\"whitespace\")+n,number:I,boolean:e(\"true\",\"false\")+n,identifier:T,itsProperty:$,belongingItProperty:S,escapedStringChar:\"\\\\\\\\[^\\\\n]\",singleStringOpener:\"'\",doubleStringOpener:'\"',singleStringCloser:\"'\",doubleStringCloser:'\"',is:`is${a(`${o}not${n}`,`${o}an?${n}`,`${o}in${n}`,`${o}<`,`${o}>`)}${n}`,isNot:`is${o}not${a(o+e(\"an?\",\"in\")+n)}${n}`,isA:`is${o}an?${n}`,isNotA:`is${o}not${o}an?${n}`,matches:`matches${n}`,doesNotMatch:`does${o}not${o}match${n}`,and:`and${n}`,or:`or${n}`,not:`not${n}`,inequality:`((?:is(?:${o}not)?${r})*)(${e(\"<(?!=)\",\"<=\",\">(?!=)\",\">=\")})`,isIn:`is${o}in${n}`,contains:`contains${n}`,doesNotContain:`does${o}not${o}contain${n}`,isNotIn:`is${o}not${o}in${n}`,addition:escape(\"+\")+a(\"=\"),subtraction:escape(\"-\")+a(\"=\",\"type\"),multiplication:escape(\"*\")+a(\"=\"),division:e(\"/\",\"%\")+a(\"=\"),spread:`\\\\.\\\\.\\\\.${a(\"\\\\.\")}`,to:e(`to${n}`,\"=\"),into:`into${n}`,making:`making${n}`,where:`where${n}`,when:`when${n}`,via:`via${n}`,each:`each${n}`,bind:`2?bind${n}`,typeSignature:escape(\"-type\")+n,incorrectOperator:O,PlainCompare:{comma:\",\",commentFront:\"\\x3c!--\",commentBack:\"--\\x3e\",strikeOpener:\"~~\",italicOpener:\"//\",boldOpener:\"''\",supOpener:\"^^\",strongFront:\"**\",strongBack:\"**\",emFront:\"*\",emBack:\"*\",collapsedFront:\"{\",collapsedBack:\"}\",groupingBack:\")\"}};let E;const{hasOwn:F}=Object,R={};class Token{constructor(e){for(let a in e)this[a]=e[a]}addChild(e){const a=this.lastChildEnd(),t=new Token(e);return t.start=a,t.end=e.text&&a+e.text.length,t.place=this.place,t.children=[],t.innerText&&lex$2(t),this.children.push(t),t}lastChildEnd(){const e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))}tokenAt(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(let a=0;a<this.children.length;a+=1)if(e>=this.children[a].start&&e<this.children[a].end){const t=this.children[a].tokenAt(e);if(t)return t}return this}pathAt(e){if(e<this.start||e>=this.end)return[];let a=[];if(this.children.length)for(let t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){const r=this.children[t].pathAt(e);if(r.length){a=a.concat(r);break}}return a.concat(this)}nearestTokenAt(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(((a,t)=>a||(e>=t.start&&e<t.end?t:null)),null):this}everyLeaf(e){return this.children&&0!==this.children.length?this.children.reduce(((a,t)=>a&&t.everyLeaf(e)),!0):!!e(this)}demote(){this.type=\"text\"}error(e){this.type=\"error\",this.message=e}toString(){let e=`${this.type}(${this.start}→${this.end})`;return this.children&&this.children.length>0&&(e+=`[${this.children}]`),e}copy(){const e=new Token(this);return e.children=e.children.slice(),e}foldChildren(){let e=[];const a=this.children.slice();for(let t=0;t<a.length;t+=1){const r=a[t];let o=!1;if(r.matches)for(let a=0;a<e.length;a+=1){let{type:t}=e[a];t in r.matches&&(foldTokens(this,r,e[a]),e=e.slice(a+1),o=!0)}!o&&r.isFront&&e.unshift(r)}}}function lex$2(e,a){const t=e.innerText;let r=null,o=0,n=o,s=t.length,i=null;for(;o<s;){const s=t.slice(o);let l=(r&&r.length?r[0]:e).innerMode,c=0,h=l.length;for(;c<h;c+=1){const h=R[l[c]];if(h.constraint&&!h.constraint(i)||h.cannotFollowText&&(\"text\"===i?.type||n<o)||(h.plainCompare?!s.startsWith(h.pattern):!h.pattern.test(s)))continue;const d=h.fn(h.plainCompare?h.pattern:h.pattern.exec(s));let m=!1,p=0;if(d.matches){for(;r&&p<r.length;p+=1){let{type:e,aka:a}=r[p];if(e in d.matches){m=!0;break}a&&(e=a),d.cannotCross?.indexOf(e)>-1&&(p=r.length-1)}if((!r||p>=r.length)&&!d.isFront)continue}n<o&&e.addChild({type:\"text\",text:t.slice(n,o),innerMode:l}),i=e.addChild(d),o+=i.text.length,n=o;let u=!1;m&&(a&&foldTokens(e,i,r[p]),r=r.slice(p+1),u=!0),!u&&i.isFront&&(r?r.unshift(i):r=[i]);break}c===h&&(o+=1,null===i&&(i={type:\"text\"}))}for(n<o&&e.addChild({type:\"text\",text:t.slice(n,o),innerMode:(r?.length?r[0]:e).innerMode});r?.length>0;)r.shift().demote();return e}function foldTokens(e,a,t){const r=e.children.indexOf(a),o=e.children.indexOf(t);a.children=e.children.splice(o+1,r-(o+1)),a.type=a.matches[t.type],a.innerText=\"\";for(let e=0,t=a.children.length;e<t;e++)a.innerText+=a.children[e].text;a.start=t.start,a.text=t.text+a.innerText+a.text;for(let e in t)F(t,e)&&!F(a,e)&&(a[e]=t[e]);a.isFront&&(a.isFront=!1),e.children.splice(o,1)}E={lex:(e,a=\"\",t=\"start\",r=!1)=>lex$2(new Token({type:\"root\",place:a,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:E.modes[t]}),!r),rules:R,modes:{}};var z=E;const{keys:B,assign:W,hasOwn:D}=Object;let q=Object.freeze({lex:function rules(e){function textTokenFn(e){return e||=\"innerText\",function(a){const t=a.reduceRight(((e,a,t)=>e||(t?a:\"\")),\"\"),r={};return r[e]=t,r}}function openerFn(e,a){const t={};return t[e]=a,()=>({isFront:!0,matches:t,cannotCross:[\"verbatimOpener\"]})}const a=Object.bind(0,null);function setupRules(e,a){return Object.keys(a).forEach((t=>{const r=a[t].fn;a[t].fn=a=>{const o=r(a);return o.text||(o.text=\"string\"==typeof a?a:a[0]),o.type||(o.type=t),o.innerMode||(o.innerMode=e),o}})),a}const t=[],r=[],o=[],n=setupRules(t,{hr:{fn:a},bulleted:{fn:e=>({depth:e[1].length})},numbered:{fn:e=>({depth:e[1].length/2})},heading:{fn:e=>({depth:e[1].length})},align:{fn(e){let a;const t=e[1],r=t.indexOf(\"><\");return~r?(a=Math.round(r/(t.length-2)*50),25===a&&(a=\"center\")):\"<\"===t[0]&&\">\"===t.slice(-1)?a=\"justify\":t.indexOf(\">\")>-1?a=\"right\":t.indexOf(\"<\")>-1&&(a=\"left\"),{align:a}}},column:{fn(e){let a;const t=e[1],r=t.indexOf(\"|\");return r&&r<t.length-1?a=\"center\":\"|\"===t[0]&&\"|\"===t.slice(-1)?a=\"none\":r===t.length-1?a=\"right\":r||(a=\"left\"),{column:a,width:/\\|+/.exec(t)[0].length,marginLeft:/^=*/.exec(t)[0].length,marginRight:/=*$/.exec(t)[0].length}}}}),blockRuleConstraint=e=>{switch(e&&e.type){case null:case\"br\":case\"hr\":case\"bulleted\":case\"numbered\":case\"heading\":case\"align\":case\"column\":case\"escapedLine\":return!0}return!1};B(n).forEach((e=>{n[e].constraint=blockRuleConstraint,n[e].cannotFollowText=!0}));const s=setupRules(t,{twine1Macro:{fn:()=>({type:\"error\",message:\"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros.\"})},emBack:{fn:()=>({matches:{emFront:\"em\"},cannotCross:[\"verbatimOpener\"]})},strongBack:{fn:()=>({matches:{strongFront:\"strong\"},cannotCross:[\"verbatimOpener\"]})},strongFront:{fn:()=>({isFront:!0})},emFront:{fn:()=>({isFront:!0})},boldOpener:{fn:openerFn(\"boldOpener\",\"bold\")},italicOpener:{fn:openerFn(\"italicOpener\",\"italic\")},strikeOpener:{fn:openerFn(\"strikeOpener\",\"strike\")},supOpener:{fn:openerFn(\"supOpener\",\"sup\")},commentFront:{fn:()=>({isFront:!0})},commentBack:{fn:()=>({matches:{commentFront:\"comment\"}})},scriptStyleTag:{fn:a},tag:{fn:a},url:{fn:a},hookPrependedFront:{fn:e=>({name:e[1],hidden:\")\"===e[2],isFront:!0,tagPosition:\"prepended\"})},hookFront:{fn:()=>({isFront:!0})},hookBack:{fn:()=>({matches:{hookPrependedFront:\"hook\",hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},hookAppendedBack:{fn:e=>({name:e[2],hidden:\"(\"===e[1],tagPosition:\"appended\",matches:{hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},unclosedHook:{fn:a},unclosedHookPrepended:{fn:e=>({type:\"unclosedHook\",name:e[1],hidden:\")\"===e[2]})},verbatimOpener:{fn(e){let a=e[0].length,t={};return t[`verbatim${a}`]=\"verbatim\",{type:`verbatim${a}`,isFront:!0,matches:t,aka:\"verbatimOpener\"}}},unclosedCollapsed:{fn:a},collapsedFront:{fn:()=>({isFront:!0})},collapsedBack:{fn:()=>({matches:{collapsedFront:\"collapsed\"},cannotCross:[\"verbatimOpener\"]})},escapedLine:{fn:a},legacyLink:{fn:e=>({type:\"twineLink\",innerText:e[1],passage:e[2],innerMode:t})},br:{fn:a}}),i=W(setupRules(r,{macroFront:{fn:e=>({isFront:!0,name:e[1]})},groupingBack:{fn:()=>({matches:{groupingFront:\"grouping\",macroFront:\"macro\"},cannotCross:[\"singleStringOpener\",\"doubleStringOpener\",\"hookFront\"]})},passageLink:{fn(e){const a=e[1]||\"\",r=e[2]||\"\",o=e[3]||\"\";return{type:\"twineLink\",innerText:r?o:a,passage:a?o:r,innerMode:t}}},simpleLink:{fn:e=>({type:\"twineLink\",innerText:e[1]||\"\",passage:e[1]||\"\",innerMode:t})},variable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:textTokenFn(\"name\")},tempVariable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:textTokenFn(\"name\")}}),{hookFront:s.hookFront,hookBack:s.hookBack}),l=setupRules(r,{commentBack:{fn:()=>({matches:{commentFront:\"comment\"}})},macroName:{constraint:e=>e&&\"macroFront\"===e.type,fn:textTokenFn(\"name\")},groupingFront:{fn:()=>({isFront:!0})},property:{fn:textTokenFn(\"name\"),constraint(e){if(e)switch(e.type){case\"variable\":case\"hookName\":case\"property\":case\"tempVariable\":case\"colour\":case\"itsProperty\":case\"belongingItProperty\":case\"macro\":case\"grouping\":case\"string\":case\"datatype\":case\"hook\":case\"boolean\":case\"number\":return!0}}},possessiveOperator:{fn:a},itsProperty:{cannotFollowText:!0,fn:textTokenFn(\"name\")},itsOperator:{cannotFollowText:!0,fn:a},belongingItProperty:{cannotFollowText:!0,fn:textTokenFn(\"name\")},belongingItOperator:{cannotFollowText:!0,fn:a},belongingProperty:{cannotFollowText:!0,fn:textTokenFn(\"name\")},belongingOperator:{cannotFollowText:!0,fn:a},escapedStringChar:{fn:()=>({type:\"text\"})},singleStringOpener:{fn:()=>({isFront:!0,matches:{singleStringOpener:\"string\"},innerMode:o})},doubleStringOpener:{fn:()=>({isFront:!0,matches:{doubleStringOpener:\"string\"},innerMode:o})},hookName:{fn:textTokenFn(\"name\")},cssTime:{fn:e=>({value:+e[1]*(\"s\"===e[2].toLowerCase()?1e3:1)})},datatype:{cannotFollowText:!0,fn:e=>({name:e[0].toLowerCase()})},colour:{cannotFollowText:!0,fn(e){let a,t=e[0].toLowerCase(),r={red:\"e61919\",orange:\"e68019\",yellow:\"e5e619\",lime:\"80e619\",green:\"19e619\",cyan:\"19e5e6\",aqua:\"19e5e6\",blue:\"197fe6\",navy:\"1919e6\",purple:\"7f19e6\",fuchsia:\"e619e5\",magenta:\"e619e5\",white:\"fff\",black:\"000\",gray:\"888\",grey:\"888\"};return a=D(r,t)?`#${r[t]}`:t,{colour:a}}},number:{fn:e=>({value:parseFloat(e[0])})},inequality:{fn:e=>({operator:e[2],negate:e[1].indexOf(\"not\")>-1})},identifier:{fn:textTokenFn(\"name\"),cannotFollowText:!0},whitespace:{fn:a,cannotFollowText:!0},incorrectOperator:{fn:e=>{const a={\"=>\":\">=\",\"=<\":\"<=\",gte:\">=\",lte:\"<=\",gt:\">\",lt:\"<\",eq:\"is\",isnot:\"is not\",neq:\"is not\",isa:\"is a\",are:\"is\",x:\"*\",\"or a\":\"or\"}[e[0].toLowerCase().replace(/\\s+/g,\" \")];return{type:\"error\",message:`Please say ${a?`'${a}'`:\"something else\"} instead of '${e[0]}'.`,explanation:\"In the interests of readability, I want certain operators to be in a specific form.\"}},cannotFollowText:!0},...[\"boolean\",\"is\",\"to\",\"into\",\"where\",\"when\",\"via\",\"making\",\"each\",\"and\",\"or\",\"not\",\"isNot\",\"contains\",\"doesNotContain\",\"isIn\",\"isA\",\"isNotA\",\"isNotIn\",\"matches\",\"doesNotMatch\",\"bind\"].reduce(((e,t)=>(e[t]={fn:a,cannotFollowText:!0},e)),{}),...[\"comma\",\"spread\",\"typeSignature\",\"addition\",\"subtraction\",\"multiplication\",\"division\"].reduce(((e,t)=>(e[t]={fn:a},e)),{})}),c=setupRules(o,{singleStringCloser:l.singleStringOpener,doubleStringCloser:l.doubleStringOpener,escapedStringChar:l.escapedStringChar});t.push(...B(n),...B(i),...B(s)),r.push(...B(i),...B(l)),o.push(...B(c));const h={...n,...s,...i,...l,...c};B(h).forEach((e=>{M.PlainCompare[e]?(h[e].pattern=M.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp(`^(?:${M[e]})`,\"i\")})),W(e.rules,h);const{modes:d}=e;return d.start=d.markup=t,d.macro=r,d.string=o,e}(z).lex,Patterns:M});const{round:j}=Math,V={Macro:{set:{name:\"set\",sig:\" ...VariableToValue\",returnType:\"Instant\",aka:[],abstract:\"Stores data values in variables, optionally allowing you to permanently restrict the variable to a single datatype.  \",anchor:\"macro_set\",category:\"basics\",categoryOrder:\"1\"},put:{name:\"put\",sig:\" ...VariableToValue\",returnType:\"Instant\",aka:[],abstract:\"A left-to-right version of (set:) that requires the word `into` rather than `to`.  \",anchor:\"macro_put\",category:\"basics\",categoryOrder:\"2\"},unpack:{name:\"unpack\",sig:\" ...VariableToValue\",returnType:\"Instant\",aka:[],abstract:'A specialised variation of (put:) that lets you extract multiple values from an array, datamap or string, at once, and put them into multiple variables, by placing a matching data structure on the right of `into` containing variables at the positions of those values. For instance, `(unpack: (a: 1, 2, 3) into (a: $x, 2, $y))` sets $x to 1 and $y to 3, and `(unpack: (dm: \"B\", 3, \"A\", 1) into (dm: \"A\", $x, \"B\", $y))` sets $x to 1 and $y to 3.   ',anchor:\"macro_unpack\",category:\"data structure\"},move:{name:\"move\",sig:\" ...VariableToValue\",returnType:\"Instant\",aka:[],abstract:\"A variant of (put:) that, if transferring data from a data structure, deletes the source value after copying it - in effect moving the value from the source to the destination.  \",anchor:\"macro_move\",category:\"basics\",categoryOrder:\"3\"},display:{name:\"display\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command writes out the contents of the passage with the given string name. If a passage of that name does not exist, this produces an error.  \",anchor:\"macro_display\",category:\"basics\",categoryOrder:\"5\"},print:{name:\"print\",sig:\" Any\",returnType:\"Command\",aka:[],abstract:\"This command prints out any data provided to it, as text.  \",anchor:\"macro_print\",category:\"basics\",categoryOrder:\"4\"},verbatimprint:{name:\"verbatim-print\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-print\"],abstract:\"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  \",anchor:\"macro_verbatim-print\",category:\"basics\",categoryOrder:\"16\"},v6mprint:{name:\"verbatim-print\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-print\"],abstract:\"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  \",anchor:\"macro_verbatim-print\",category:\"basics\",categoryOrder:\"16\"},verbatimsource:{name:\"verbatim-source\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-source\"],abstract:\"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  \",anchor:\"macro_verbatim-source\",category:\"debugging\"},v6msource:{name:\"verbatim-source\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-source\"],abstract:\"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  \",anchor:\"macro_verbatim-source\",category:\"debugging\"},goto:{name:\"go-to\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command stops passage code and sends the player to a new passage, starting a new turn as if a passage link was clicked. If the passage named by the string does not exist, this produces an error.  \",anchor:\"macro_go-to\",category:\"navigation\",categoryOrder:\"1\"},redirect:{name:\"redirect\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command sends the player to a new passage. However, unlike (goto:), this does *not* start a new turn - undoing after this will send the player to the turn before the redirect occurred.  \",anchor:\"macro_redirect\",category:\"navigation\",categoryOrder:\"2\"},undo:{name:\"undo\",sig:\" [String]\",returnType:\"Command\",aka:[],abstract:'This command stops passage code and \"undoes\" the current turn, sending the player to the previous visited passage and forgetting any variable changes that occurred in this passage. You may provide an optional string to display if undos aren\\'t available.  ',anchor:\"macro_undo\",category:\"navigation\",categoryOrder:\"3\"},debug:{name:\"debug\",sig:\"\",returnType:\"Command\",aka:[],abstract:\"This command, which takes no values, opens the Debug Mode panel if it wasn't open already. This can be used even if the story didn't begin in Debug Mode initially.  \",anchor:\"macro_debug\",category:\"debugging\"},iconundo:{name:\"icon-undo\",sig:\" [String], [String]\",returnType:\"Command\",aka:[],abstract:\"Creates an icon, similar to those in the sidebar, that, if visible and clicked, undoes the current turn, returning to the previous passage, as if by (undo:). It is not visible if undos aren't available.  \",anchor:\"macro_icon-undo\",category:\"sidebar\",categoryOrder:\"2\"},iconredo:{name:\"icon-redo\",sig:\" [String], [String]\",returnType:\"Command\",aka:[],abstract:'Creates an icon, similar to those in the sidebar, that, if visible and clicked, \"re-does\" a turn that was undone. It is only visible if a turn has been undone.  ',anchor:\"macro_icon-redo\",category:\"sidebar\",categoryOrder:\"3\"},iconfullscreen:{name:\"icon-fullscreen\",sig:\" [String], [String]\",returnType:\"Command\",aka:[],abstract:\"Creates an icon, similar to those in the sidebar, that, if visible and clicked, toggles fullscreen mode on or off.  \",anchor:\"macro_icon-fullscreen\",category:\"sidebar\",categoryOrder:\"4\"},iconrestart:{name:\"icon-restart\",sig:\" [String]\",returnType:\"Command\",aka:[],abstract:\"Creates an icon, similar to those in the sidebar, that, if visible and clicked, reloads the whole page, restarting the story from the beginning.  \",anchor:\"macro_icon-restart\",category:\"sidebar\",categoryOrder:\"5\"},iconcounter:{name:\"icon-counter\",sig:\" Bind, String, [String]\",returnType:\"Command\",aka:[],abstract:\"A command that creates a numeric counter element with a text label, designed to fit in the sidebar, displaying the contents of a number variable (rounded to a whole number as if by (trunc:)), and updating it whenever another macro changes it.  \",anchor:\"macro_icon-counter\",category:\"sidebar\",categoryOrder:\"6\"},meter:{name:\"meter\",sig:\" Bind, Number, String, [String], [Colour or Gradient]\",returnType:\"Command\",aka:[],abstract:\"A command that creates a horizontal bar-graph meter, showing the current value of a number variable, relative to a maximum value, and updating it whenever that variable changes.  \",anchor:\"macro_meter\",category:\"input and interface\"},cyclinglink:{name:\"cycling-link\",sig:\" [Bind], ...String\",returnType:\"Command\",aka:[],abstract:\"A command that, when evaluated, creates a cycling link - a link which does not go anywhere, but changes its own text to the next in a looping sequence of strings, and sets the optional bound variable to match the string value of the text.  \",anchor:\"macro_cycling-link\",category:\"input and interface\",categoryOrder:\"1\"},seqlink:{name:\"seq-link\",sig:\" [Bind], ...String\",returnType:\"Command\",aka:[\"sequence-link\"],abstract:\"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  \",anchor:\"macro_seq-link\",category:\"input and interface\",categoryOrder:\"2\"},sequencelink:{name:\"seq-link\",sig:\" [Bind], ...String\",returnType:\"Command\",aka:[\"sequence-link\"],abstract:\"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  \",anchor:\"macro_seq-link\",category:\"input and interface\",categoryOrder:\"2\"},dropdown:{name:\"dropdown\",sig:\" Bind, ...String\",returnType:\"Command\",aka:[],abstract:\"A command that, when evaluated, creates a dropdown menu with the given strings as options. When one option is selected, the bound variable is set to match the string value of the text.  \",anchor:\"macro_dropdown\",category:\"input and interface\"},checkbox:{name:\"checkbox\",sig:\" Bind, String\",returnType:\"Command\",aka:[],abstract:\"A command that creates a checkbox input, which sets the given bound variable to `true` or `false`, depending on its state.  \",anchor:\"macro_checkbox\",category:\"input and interface\",categoryOrder:\"7\"},checkboxfullscreen:{name:\"checkbox-fullscreen\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"A command that creates a checkbox input, which toggles the browser's fullscreen mode and windowed mode. The checkbox will automatically update to match the browser's fullscreen status. If fullscreen mode cannot be entered, the checkbox will be disabled.  \",anchor:\"macro_checkbox-fullscreen\",category:\"input and interface\",categoryOrder:\"8\"},input:{name:\"input\",sig:\" [Bind], [String], [String]\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates a single-line text input element, allowing the player to input any amount of text without newlines, which can optionally be automatically stored in a variable. The first string specifies the horizontal position and width, and the second string specifies an initial default value to fill the element with.  \",anchor:\"macro_input\",category:\"input and interface\",categoryOrder:\"3\"},forceinput:{name:\"force-input\",sig:\" [Bind], [String], String\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates a single-line text input element which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  \",anchor:\"macro_force-input\",category:\"input and interface\",categoryOrder:\"4\"},inputbox:{name:\"input-box\",sig:\" [Bind], [String], [Number], [String]\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates a multi-line text input box of the given position, width (specified by the first, optional string) and height (specified by the optional number), allowing the player to input any amount of text, which can optionally be automatically stored in a variable. The final optional string specifies an initial default value to fill the box with.  \",anchor:\"macro_input-box\",category:\"input and interface\",categoryOrder:\"5\"},forceinputbox:{name:\"force-input-box\",sig:\" [Bind], [String], [Number], String\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates an empty text input box of the given position, width (specified by the first, optional string) and height (specified by the optional number), which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  \",anchor:\"macro_force-input-box\",category:\"input and interface\",categoryOrder:\"6\"},show:{name:\"show\",sig:\" ...HookName\",returnType:\"Command\",aka:[],abstract:\"Reveals hidden hooks, running the code within if it's not been shown yet.  \",anchor:\"macro_show\",category:\"showing and hiding\"},rerun:{name:\"rerun\",sig:\" ...HookName\",returnType:\"Command\",aka:[],abstract:\"Reruns hooks, restoring them to their original contents, and running the macros within them an additional time.  \",anchor:\"macro_rerun\",category:\"revision\"},hide:{name:\"hide\",sig:\" ...HookName\",returnType:\"Command\",aka:[],abstract:\"Hides a hook, or hooks, that were already visible, without fully erasing them or their contained macro calls.  \",anchor:\"macro_hide\",category:\"showing and hiding\"},scroll:{name:\"scroll\",sig:\" HookName, Number or HookName\",returnType:\"Command\",aka:[],abstract:\"This command, when given a HookName, followed by a fraction (a number between 0 and 1), will change the scroll position of every hook with that name to the percentage of their height signified by the fraction. You may alternatively give another HookName instead, which, if a hook of that name is inside the first hook, will scroll the first hook and each containing hook such that the second hook is visible.  \",anchor:\"macro_scroll\",category:\"window\"},stop:{name:\"stop\",sig:\"\",returnType:\"Command\",aka:[],abstract:\"This macro, which accepts no arguments, creates a (stop:) command, which is not configurable.  \",anchor:\"macro_stop\",category:\"live\",categoryOrder:\"2\"},loadgame:{name:\"load-game\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command attempts to load a saved game from the given slot, ending the current game and replacing it with the loaded one. This causes the passage to change.  \",anchor:\"macro_load-game\",category:\"saving\"},forgetundos:{name:\"forget-undos\",sig:\" Number\",returnType:\"Command\",aka:[],abstract:'This macro, when used, \"forgets\" previous turns, preventing the player from using undo features (like (link-undo:)) to return to them. Providing a positive number will forget that many turns from the start of the game, and providing a negative number will forget all the turns up to that point from the end.  ',anchor:\"macro_forget-undos\",category:\"game state\",categoryOrder:\"6\"},forgetvisits:{name:\"forget-visits\",sig:\" Number\",returnType:\"Command\",aka:[],abstract:'This macro \"forgets\" all visits that occurred before the given turn number - any passage visits that occurred on those turns are treated as if they didn\\'t happen. This causes (history:) to no longer list those passages at the start of the array, the `visits` identifier to report a different number for those passages, and (if the only visit to a passage was erased) the (visited:) macro to no longer regard a passage as visited.  ',anchor:\"macro_forget-visits\",category:\"game state\",categoryOrder:\"5\"},mockvisits:{name:\"mock-visits\",sig:\" ...String\",returnType:\"Command\",aka:[],abstract:'A macro that can only be used in debug mode, this allows you to mark various passages as \"visited\", even though the player actually hasn\\'t. This allows you to quickly test passages that use the `visits` keyword, or the `(history:)` datamap, without having to play through the whole game from the start.  ',anchor:\"macro_mock-visits\",category:\"debugging\"},mockturns:{name:\"mock-turns\",sig:\" Number\",returnType:\"Command\",aka:[],abstract:\"A macro that can only be used in debug mode, this allows you to artificially increase the number that the `visits` keyword evaluates to, without having to play through that many turns yourself.  \",anchor:\"macro_mock-turns\",category:\"debugging\"},seed:{name:\"seed\",sig:\" String\",returnType:\"Command\",aka:[],abstract:'A command that \"fixes\" Harlowe\\'s random number generator, causing all random macros and features to output predetermined values based on the given \"seed\" string.  ',anchor:\"macro_seed\",category:\"game state\"},dialog:{name:\"dialog\",sig:\" [Bind], String or CodeHook, ...String\",returnType:\"Command\",aka:[\"alert\"],abstract:\"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  \",anchor:\"macro_dialog\",category:\"popup\",categoryOrder:\"1\"},alert:{name:\"dialog\",sig:\" [Bind], String or CodeHook, ...String\",returnType:\"Command\",aka:[\"alert\"],abstract:\"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  \",anchor:\"macro_dialog\",category:\"popup\",categoryOrder:\"1\"},openurl:{name:\"open-url\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"When this macro is evaluated, the player's browser attempts to open a new tab with the given URL. This will usually require confirmation from the player, as most browsers block Javascript programs such as Harlowe from opening tabs by default.  \",anchor:\"macro_open-url\",category:\"window\"},restart:{name:\"restart\",sig:\"\",returnType:\"Command\",aka:[\"reload\"],abstract:\"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  \",anchor:\"macro_restart\",category:\"navigation\"},reload:{name:\"restart\",sig:\"\",returnType:\"Command\",aka:[\"reload\"],abstract:\"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  \",anchor:\"macro_restart\",category:\"navigation\"},gotourl:{name:\"goto-url\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"When this command is used, the player's browser will immediately attempt to leave the story's page, and navigate to the given URL in the same tab. If this succeeds, then the story session will \\\"end\\\".  \",anchor:\"macro_goto-url\",category:\"window\"},ignore:{name:\"ignore\",sig:\" [...Any]\",returnType:\"Command\",aka:[],abstract:\"If you want to test your passage while ignoring a specific command macro in it, temporarily change that command macro's name to (ignore:), and it will ignore all of the data given to it.  \",anchor:\"macro_ignore\",category:\"debugging\",categoryOrder:\"1\"},assertexists:{name:\"assert-exists\",sig:\" HookName or String\",returnType:\"Command\",aka:[],abstract:\"A debugging macro that confirms whether a hook with the given name, or passage text matching the given string, is present in the passage. If not, it will produce a helpful error. Use this to test whether enchantment macros like (click:), (enchant:) or (show:) are working properly.  \",anchor:\"macro_assert-exists\",category:\"debugging\",categoryOrder:\"5\"},assert:{name:\"assert\",sig:\" Boolean\",returnType:\"Instant\",aka:[],abstract:\"A debugging macro that produces a helpful error whenever the expression given to it produces Boolean false. Use this when testing your story to help ensure that certain facts about the game state are true or not.  \",anchor:\"macro_assert\",category:\"debugging\",categoryOrder:\"4\"},savegame:{name:\"save-game\",sig:\" String, [String]\",returnType:\"Boolean\",aka:[],abstract:\"This macro saves the current game's state in browser storage, in the given save slot, and including a special filename. It can then be restored using (load-game:).  \",anchor:\"macro_save-game\",category:\"saving\"},prompt:{name:\"prompt\",sig:\" String or CodeHook, String, [String], [String]\",returnType:\"String\",aka:[],abstract:'When this macro is evaluated, a browser pop-up dialog box is shown with the first string displayed, a text entry box containing the second string (as a default value), a confirm link and a cancel link. If the confirm link is clicked, it evaluates to the string in the text entry box. If \"Cancel\" is clicked, it evaluates to the default value regardless of the entry box\\'s contents.  ',anchor:\"macro_prompt\",category:\"popup\"},confirm:{name:\"confirm\",sig:\" String or CodeHook, [String], [String]\",returnType:\"Boolean\",aka:[],abstract:\"When this macro is evaluated, a pop-up dialog box is shown with the given string displayed, as well as two links (whose text can also be provided) to confirm or cancel whatever action or fact the string tells the player. When it is submitted, it evaluates to the boolean `true` if the confirm link had been clicked, and `false` if the cancel link had.  \",anchor:\"macro_confirm\",category:\"popup\"},pageurl:{name:\"page-url\",sig:\"\",returnType:\"String\",aka:[],abstract:\"This macro produces the full URL of the story's HTML page, as it is in the player's browser.  \",anchor:\"macro_page-url\",category:\"window\"},mp3url:{name:\"mp3-url\",sig:\"\",returnType:\"String\",aka:[],abstract:\"设置MP3音乐地址  \",anchor:\"macro_mp3-url\",category:\"window\"},mp3set:{name:\"mp3-set\",sig:\"\",returnType:\"Boolean\",aka:[],abstract:\"\\t 播放/暂停MP3音乐 \\t \",anchor:\"macro_mp3-set\",category:\"window\"},mp3loop:{name:\"mp3-loop\",sig:\"\",returnType:\"Boolean\",aka:[],abstract:\"\\t 设置MP3音乐循环 \\t \",anchor:\"macro_mp3-loop\",category:\"window\"},macro:{name:\"macro\",sig:\" [...TypedVar], CodeHook\",returnType:\"CustomMacro\",aka:[],abstract:\"Use this macro to construct your own custom macros, which you can (set:) into variables and call as easily as a built-in macro.  \",anchor:\"macro_macro\",category:\"custom macros\",categoryOrder:\"1\"},outputdata:{name:\"output-data\",sig:\" Any\",returnType:\"Instant\",aka:[\"out-data\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  \",anchor:\"macro_output-data\",category:\"custom macros\",categoryOrder:\"3\"},outdata:{name:\"output-data\",sig:\" Any\",returnType:\"Instant\",aka:[\"out-data\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  \",anchor:\"macro_output-data\",category:\"custom macros\",categoryOrder:\"3\"},output:{name:\"output\",sig:\"\",returnType:\"Changer\",aka:[\"out\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  \",anchor:\"macro_output\",category:\"custom macros\",categoryOrder:\"2\"},out:{name:\"output\",sig:\"\",returnType:\"Changer\",aka:[\"out\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  \",anchor:\"macro_output\",category:\"custom macros\",categoryOrder:\"2\"},error:{name:\"error\",sig:\" String\",returnType:\"Instant\",aka:[],abstract:\"Designed for use in custom macros, this causes the custom macro to immediately produce an error, with the given message string, and ceases running any further code in the CodeHook.  \",anchor:\"macro_error\",category:\"custom macros\",categoryOrder:\"4\"},partial:{name:\"partial\",sig:\" String or CustomMacro, [...Any]\",returnType:\"CustomMacro\",aka:[],abstract:\"When given either the string name of a built-in macro, or a custom macro, followed by various values, this creates a custom macro that serves as a shorthand for calling the given macro with those values, plus any additional values.  \",anchor:\"macro_partial\",category:\"custom macros\"},a:{name:\"a\",sig:\" [...Any]\",returnType:\"Array\",aka:[\"array\"],abstract:\"Creates an array, which is an ordered collection of values.  \",anchor:\"macro_a\",category:\"data structure\",categoryOrder:\"1\"},array:{name:\"a\",sig:\" [...Any]\",returnType:\"Array\",aka:[\"array\"],abstract:\"Creates an array, which is an ordered collection of values.  \",anchor:\"macro_a\",category:\"data structure\",categoryOrder:\"1\"},range:{name:\"range\",sig:\" Number, Number\",returnType:\"Array\",aka:[],abstract:\"Produces an array containing an inclusive range of whole numbers from a to b, in ascending order.  \",anchor:\"macro_range\",category:\"data structure\"},subarray:{name:\"subarray\",sig:\" Array, Number, Number\",returnType:\"Array\",aka:[],abstract:\"When given an array, this returns a new array containing only the elements whose positions are between the two numbers, inclusively.  \",anchor:\"macro_subarray\",category:\"data structure\"},reversed:{name:\"reversed\",sig:\" [...Any]\",returnType:\"Array\",aka:[],abstract:\"Similar to (a:), except that it creates an array containing the elements in reverse order.  \",anchor:\"macro_reversed\",category:\"data structure\"},shuffled:{name:\"shuffled\",sig:\" ...Any\",returnType:\"Array\",aka:[],abstract:\"Similar to (a:), this produces an array of the given values, except that it randomly rearranges the elements instead of placing them in the given order.  \",anchor:\"macro_shuffled\",category:\"data structure\"},sorted:{name:\"sorted\",sig:\" [Lambda], ...Any\",returnType:\"Array\",aka:[],abstract:'This macro produces an array in which the values are sorted in English alphanumeric sort order. If any of the values are not numbers or strings, a \"via\" lambda must be given first, which is used to translate the value into a number or string that it should be sorted by.  ',anchor:\"macro_sorted\",category:\"data structure\"},rotated:{name:\"rotated\",sig:\" Number, ...Any\",returnType:\"Array\",aka:[],abstract:\"Similar to the (a:) macro, but it also takes a number at the start, and moves each item forward by that number, wrapping back to the start if they pass the end of the array.  \",anchor:\"macro_rotated\",category:\"data structure\"},rotatedto:{name:\"rotated-to\",sig:\" Lambda, [...Any]\",returnType:\"Array\",aka:[],abstract:'Similar to the (a:) macro, but it also takes a \"where\" lambda at the start, and cycles the order of the subsequent values so that the first value to match the lambda is placed at the start.  ',anchor:\"macro_rotated-to\",category:\"data structure\"},repeated:{name:\"repeated\",sig:\" Number, ...Any\",returnType:\"Array\",aka:[],abstract:\"When given a number and a sequence of values, this macro produces an array containing those values repeated, in order, by the given number of times.  \",anchor:\"macro_repeated\",category:\"data structure\"},interlaced:{name:\"interlaced\",sig:\" Array, ...Array\",returnType:\"Array\",aka:[],abstract:\"Takes multiple arrays, and pairs up each value in those arrays: it creates an array containing each array's first value followed by each array's second value, and so forth. If some values have no matching pair (i.e. one array is longer than the other) then those values are ignored.  \",anchor:\"macro_interlaced\",category:\"data structure\"},permutations:{name:\"permutations\",sig:\" ...Any\",returnType:\"Array\",aka:[],abstract:\"When given a sequence of values, this produces an array containing each permutation of the order of those values, as arrays.  \",anchor:\"macro_permutations\",category:\"data structure\"},unique:{name:\"unique\",sig:\" ...Any\",returnType:\"Array\",aka:[],abstract:\"When given a sequence of values, this produces an array containing each unique value once, in the order that they appeared.  \",anchor:\"macro_unique\",category:\"data structure\"},altered:{name:\"altered\",sig:\" Lambda, [...Any]\",returnType:\"Array\",aka:[],abstract:'This takes a \"via\" lambda and a sequence of values, and creates a new array with the same values in the same order, but altered via the operation in the lambda\\'s \"via\" clause. An optional \"where\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ',anchor:\"macro_altered\",category:\"data structure\"},find:{name:\"find\",sig:\" Lambda, [...Any]\",returnType:\"Array\",aka:[],abstract:\"This searches through the given values, and produces an array of those which match the given search test (which is expressed using a temp variable, the `where` keyword, and a boolean condition). If none match, an empty array is produced.  \",anchor:\"macro_find\",category:\"data structure\"},allpass:{name:\"all-pass\",sig:\" Lambda, [...Any]\",returnType:\"Boolean\",aka:[\"pass\"],abstract:'This takes a \"where\" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:\"macro_all-pass\",category:\"data structure\"},pass:{name:\"all-pass\",sig:\" Lambda, [...Any]\",returnType:\"Boolean\",aka:[\"pass\"],abstract:'This takes a \"where\" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:\"macro_all-pass\",category:\"data structure\"},somepass:{name:\"some-pass\",sig:\" Lambda, ...Any\",returnType:\"Boolean\",aka:[],abstract:\"This is similar to (all-pass:), but produces true if one or more value, when given to the lambda, evaluated to true. It can be thought of as shorthand for putting `not` in front of (none-pass:). If zero values are given to (all-pass:), then it will return false by default. For more information, consult the description of (all-pass:).  \",anchor:\"macro_some-pass\",category:\"data structure\"},nonepass:{name:\"none-pass\",sig:\" Lambda, ...Any\",returnType:\"Boolean\",aka:[],abstract:\"This can be thought of as the opposite of (all-pass:): it produces true if every value, when given to the lambda, never evaluated to true. If zero values are given to (none-pass:), then it will return true by default, just like (all-pass:). For more information, consult the description of (all-pass:).  \",anchor:\"macro_none-pass\",category:\"data structure\"},folded:{name:\"folded\",sig:\" Lambda, ...Any\",returnType:\"Any\",aka:[],abstract:'This takes a \"making\" lambda and a sequence of values, and creates a new value (the \"total\") by feeding every value in the sequence to the lambda, akin to folding a long strip of paper into a single square. The first value after the lambda is put into the total (which is the variable inside the lambda\\'s \"making\" clause) before running the lambda on the remaining values.  ',anchor:\"macro_folded\",category:\"data structure\"},dmnames:{name:\"dm-names\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-names\",\"datamap-names\"],abstract:\"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  \",anchor:\"macro_dm-names\",category:\"data structure\"},datanames:{name:\"dm-names\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-names\",\"datamap-names\"],abstract:\"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  \",anchor:\"macro_dm-names\",category:\"data structure\"},datamapnames:{name:\"dm-names\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-names\",\"datamap-names\"],abstract:\"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  \",anchor:\"macro_dm-names\",category:\"data structure\"},dmvalues:{name:\"dm-values\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-values\",\"datamap-values\"],abstract:\"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  \",anchor:\"macro_dm-values\",category:\"data structure\"},datavalues:{name:\"dm-values\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-values\",\"datamap-values\"],abstract:\"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  \",anchor:\"macro_dm-values\",category:\"data structure\"},datamapvalues:{name:\"dm-values\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-values\",\"datamap-values\"],abstract:\"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  \",anchor:\"macro_dm-values\",category:\"data structure\"},dmentries:{name:\"dm-entries\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-entries\",\"datamap-entries\"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has \"name\" and \"value\" data. The pairs are ordered by their name.  ',anchor:\"macro_dm-entries\",category:\"data structure\"},dataentries:{name:\"dm-entries\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-entries\",\"datamap-entries\"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has \"name\" and \"value\" data. The pairs are ordered by their name.  ',anchor:\"macro_dm-entries\",category:\"data structure\"},datamapentries:{name:\"dm-entries\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-entries\",\"datamap-entries\"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has \"name\" and \"value\" data. The pairs are ordered by their name.  ',anchor:\"macro_dm-entries\",category:\"data structure\"},dmaltered:{name:\"dm-altered\",sig:\" Lambda, Datamap\",returnType:\"Datamap\",aka:[\"datamap-altered\"],abstract:\"This is a variant of (altered:) which takes a \\\"via\\\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \\\"where\\\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  \",anchor:\"macro_dm-altered\",category:\"data structure\"},datamapaltered:{name:\"dm-altered\",sig:\" Lambda, Datamap\",returnType:\"Datamap\",aka:[\"datamap-altered\"],abstract:\"This is a variant of (altered:) which takes a \\\"via\\\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \\\"where\\\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  \",anchor:\"macro_dm-altered\",category:\"data structure\"},history:{name:\"history\",sig:\" [Lambda]\",returnType:\"Array\",aka:[],abstract:\"This returns an array containing the string names of all of the passages the player has previously visited up to now, in the order that the player visited them. An optional lambda can filter the passages, by checking the (passage:) datamap of each. The (mock-visits:) macro can, during debugging, artifically add values to this array to simulate having visited various passages.  \",anchor:\"macro_history\",category:\"game state\",categoryOrder:\"1\"},visited:{name:\"visited\",sig:\" String or Lambda\",returnType:\"Boolean\",aka:[],abstract:'When given a string, this macro produces true if the passage has ever been visited during this game, and false otherwise. When given a \"where\" lambda, this returns true if any passage matching the lambda has ever been visited during this game. The (mock-visits:) macro can, during debugging, make this macro return true in cases where it would otherwise be false.  ',anchor:\"macro_visited\",category:\"game state\",categoryOrder:\"2\"},passage:{name:\"passage\",sig:\" [String]\",returnType:\"Datamap\",aka:[],abstract:\"When given a passage string name, this provides a datamap containing information about that passage. If no name was provided, then it provides information about the current passage.  \",anchor:\"macro_passage\",category:\"game state\",categoryOrder:\"3\"},passages:{name:\"passages\",sig:\" [Lambda]\",returnType:\"Array\",aka:[],abstract:\"This returns an array containing datamaps of information for the passages in the story, sorted by passage name, and using the optional search test to only include certain types of passages.  \",anchor:\"macro_passages\",category:\"game state\",categoryOrder:\"4\"},openstorylets:{name:\"open-storylets\",sig:\" [Lambda]\",returnType:\"Array\",aka:[],abstract:'Checks all of the (storylet:) macros in every passage, and provides an array of datamaps for every passage whose (storylet:) lambda produced true, sorted by their \"urgency\" metadata value, then by passage name. If a lambda was provided, the storylets are filtered using it as a search test.  ',anchor:\"macro_open-storylets\",category:\"storylet\",categoryOrder:\"2\"},savedgames:{name:\"saved-games\",sig:\"\",returnType:\"Datamap\",aka:[],abstract:\"This returns a datamap containing the names of currently occupied save game slots.  \",anchor:\"macro_saved-games\",category:\"saving\"},dm:{name:\"dm\",sig:\" [...Any]\",returnType:\"Datamap\",aka:[\"datamap\"],abstract:\"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  \",anchor:\"macro_dm\",category:\"data structure\",categoryOrder:\"2\"},datamap:{name:\"dm\",sig:\" [...Any]\",returnType:\"Datamap\",aka:[\"datamap\"],abstract:\"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  \",anchor:\"macro_dm\",category:\"data structure\",categoryOrder:\"2\"},ds:{name:\"ds\",sig:\" [...Any]\",returnType:\"Dataset\",aka:[\"dataset\"],abstract:\"Creates a dataset, which is an unordered collection of unique values.  \",anchor:\"macro_ds\",category:\"data structure\",categoryOrder:\"3\"},dataset:{name:\"ds\",sig:\" [...Any]\",returnType:\"Dataset\",aka:[\"dataset\"],abstract:\"Creates a dataset, which is an unordered collection of unique values.  \",anchor:\"macro_ds\",category:\"data structure\",categoryOrder:\"3\"},count:{name:\"count\",sig:\" Array or String, ...Any\",returnType:\"Number\",aka:[],abstract:\"Accepts a string or array, followed by a value, and produces the number of times any of the values are inside the string or array.  \",anchor:\"macro_count\",category:\"data structure\"},change:{name:\"change\",sig:\" HookName or String, Changer or Lambda\",returnType:\"Command\",aka:[],abstract:'Applies a changer (or a \"via\" lambda producing a changer) to every occurrence of a hook or string in a passage, once.  ',anchor:\"macro_change\",category:\"basics\",categoryOrder:\"17\"},enchant:{name:\"enchant\",sig:\" HookName or String, Changer or Lambda\",returnType:\"Command\",aka:[],abstract:'Applies a changer (or a \"via\" lambda producing a changer) to every occurrence of a hook or string in a passage, and continues applying that changer to any further occurrences that are made to appear in the same passage later.  ',anchor:\"macro_enchant\",category:\"basics\",categoryOrder:\"18\"},enchantin:{name:\"enchant-in\",sig:\" HookName or String, Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"A variation of (enchant:) and (change:), this applies a changer to every occurrence of a hook or string within just the attached hook, rather than the whole passage. As with (enchant:), the changer will be applied to every additional occurrence inserted into the attached hook.  \",anchor:\"macro_enchant-in\",category:\"basics\",categoryOrder:\"19\"},linkstyle:{name:\"link-style\",sig:\" Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this causes all of the links inside the hook to be styled using the specified changer. This is equivalent to using (enchant-in:) with `?link`.  \",anchor:\"macro_link-style\",category:\"styling\"},linestyle:{name:\"line-style\",sig:\" Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this causes all of the lines of prose inside the hook (identical to those that would be selected by `?page's lines`) to be styled using the specified changer.  \",anchor:\"macro_line-style\",category:\"styling\"},charstyle:{name:\"char-style\",sig:\" Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this causes all of the individual non-whitespace characters inside the hook (identical to those that would be selected by `?page's chars`) to be styled using the specified changer.  \",anchor:\"macro_char-style\",category:\"styling\"},replace:{name:\"replace\",sig:\" ...HookName or String\",returnType:\"Changer\",aka:[],abstract:\"Creates a command which you can attach to a hook, and replace target destinations with the hook's contents. The targets are either text strings within the current passage, or hook references.  Not to be confused with (str-replaced:).  \",anchor:\"macro_replace\",category:\"revision\",categoryOrder:\"1\"},replacewith:{name:\"replace-with\",sig:\" String or CodeHook\",returnType:\"Changer\",aka:[],abstract:\"A counterpart to (append-with:) and (prepend-with:), this replaces the entirety of the attached hook with the contents of the given string (or code hook).  \",anchor:\"macro_replace-with\",category:\"revision\",categoryOrder:\"4\"},append:{name:\"append\",sig:\" ...HookName or String\",returnType:\"Changer\",aka:[],abstract:\"A variation of (replace:) which adds the attached hook's contents to the end of each target, rather than replacing it entirely.  \",anchor:\"macro_append\",category:\"revision\",categoryOrder:\"2\"},appendwith:{name:\"append-with\",sig:\" String or CodeHook\",returnType:\"Changer\",aka:[],abstract:\"Creates a changer that, when attached to a hook, adds the contents of the given string (or code hook) to the end of the hook.  \",anchor:\"macro_append-with\",category:\"revision\",categoryOrder:\"5\"},prepend:{name:\"prepend\",sig:\" ...HookName or String\",returnType:\"Changer\",aka:[],abstract:\"A variation of (replace:) which adds the attached hook's contents to the beginning of each target, rather than replacing it entirely.  \",anchor:\"macro_prepend\",category:\"revision\",categoryOrder:\"3\"},prependwith:{name:\"prepend-with\",sig:\" String or CodeHook\",returnType:\"Changer\",aka:[],abstract:\"Creates a changer that, when attached to a hook, adds the contents of a given string (or code hook) to the start of the hook.  \",anchor:\"macro_prepend-with\",category:\"revision\",categoryOrder:\"6\"},click:{name:\"click\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"Produces a changer which, when attached to a hook, hides it and enchants the specified target, such that it visually resembles a link, and that clicking it causes the attached hook to be revealed.  \",anchor:\"macro_click\",category:\"links\",categoryOrder:\"9\"},clickrerun:{name:\"click-rerun\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special version of the (click:) macro which allows the enchanted hook or text (specified by the first value) to be activated multiple times to re-run the attached hook.  \",anchor:\"macro_click-rerun\",category:\"links\",categoryOrder:\"10\"},mouseover:{name:\"mouseover\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover\",category:\"deprecated\"},mouseout:{name:\"mouseout\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout\",category:\"deprecated\"},clickreplace:{name:\"click-replace\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special shorthand combination of the (click:) and (replace:) macros, this allows you to make a hook replace its own text with that of the attached hook whenever it's clicked. `(click: ?1)[(replace:?1)[...]]` can be rewritten as `(click-replace: ?1)[...]`.  \",anchor:\"macro_click-replace\",category:\"links\",categoryOrder:\"10\"},clickappend:{name:\"click-append\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special shorthand combination of the (click:) and (append:) macros, this allows you to append text to a hook or string when it's clicked. `(click: ?1)[(append:?1)[...]]` can be rewritten as `(click-append: ?1)[...]`.  \",anchor:\"macro_click-append\",category:\"links\",categoryOrder:\"11\"},clickprepend:{name:\"click-prepend\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special shorthand combination of the (click:) and (prepend:) macros, this allows you to prepend text to a hook or string when it's clicked. `(click: ?1)[(prepend:?1)[...]]` can be rewritten as `(click-prepend: ?1)[...]`.  \",anchor:\"macro_click-prepend\",category:\"links\",categoryOrder:\"12\"},mouseoverreplace:{name:\"mouseover-replace\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover-replace\",category:\"deprecated\"},mouseoverappend:{name:\"mouseover-append\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover-append\",category:\"deprecated\"},mouseoverprepend:{name:\"mouseover-prepend\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover-prepend\",category:\"deprecated\"},mouseoutreplace:{name:\"mouseout-replace\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout-replace\",category:\"deprecated\"},mouseoutappend:{name:\"mouseout-append\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout-append\",category:\"deprecated\"},mouseoutprepend:{name:\"mouseout-prepend\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout-prepend\",category:\"deprecated\"},clickgoto:{name:\"click-goto\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"A special shorthand combination of the (click:) and (go-to:) macros, this allows you to make a hook or bit of text into a passage link. `(click-goto: ?1, 'Passage Name')` is equivalent to `(click: ?1)[(goto:'Passage Name')]`  \",anchor:\"macro_click-goto\",category:\"links\",categoryOrder:\"11\"},mouseovergoto:{name:\"mouseover-goto\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseover-goto\",category:\"deprecated\"},mouseoutgoto:{name:\"mouseout-goto\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseout-goto\",category:\"deprecated\"},clickundo:{name:\"click-undo\",sig:\" HookName or String\",returnType:\"Command\",aka:[],abstract:\"A special shorthand combination of the (click:) and (undo:) macros, this allows you to make a hook or bit of text into a passage link. `(click-undo: ?1)` is equivalent to `(click: ?1)[(undo: )]`  \",anchor:\"macro_click-undo\",category:\"links\",categoryOrder:\"11\"},mouseoverundo:{name:\"mouseover-undo\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseover-undo\",category:\"deprecated\"},mouseoutundo:{name:\"mouseout-undo\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseout-undo\",category:\"deprecated\"},link:{name:\"link\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-replace\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link\",category:\"links\",categoryOrder:\"1\"},linkreplace:{name:\"link\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-replace\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link\",category:\"links\",categoryOrder:\"1\"},linkreveal:{name:\"link-reveal\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-append\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-reveal\",category:\"links\",categoryOrder:\"2\"},linkappend:{name:\"link-reveal\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-append\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-reveal\",category:\"links\",categoryOrder:\"2\"},linkrepeat:{name:\"link-repeat\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to repeat itself - a copy of the hook's code will be run, and the result appended to it, in a manner similar to (for:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-repeat\",category:\"links\",categoryOrder:\"3\"},linkrerun:{name:\"link-rerun\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to rerun itself, as if by the effect of (rerun:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-rerun\",category:\"links\",categoryOrder:\"4\"},linkgoto:{name:\"link-goto\",sig:\" String, [String]\",returnType:\"Command\",aka:[],abstract:\"Takes a string of link text, and an optional destination passage name, and makes a command to create a link that takes the player to another passage. The link functions identically to a standard link.  \",anchor:\"macro_link-goto\",category:\"links\",categoryOrder:\"5\"},linkstorylet:{name:\"link-storylet\",sig:\" [String], Number or Lambda, [String]\",returnType:\"Command\",aka:[],abstract:\"If there are storylets (storylets are passages containing a (storylet:) call) in this story, this will create a link to the first open storylet that matches the passed-in 'where' lambda, or, if a number **n** was passed in, the **n**th (or, if negative, **n**thlast) open storylet. An optional first string can provide the link text - otherwise, the link text is the passage name of the storylet. An optional final string can provide text to display when no such storylet is open currently.  \",anchor:\"macro_link-storylet\",category:\"links\",categoryOrder:\"8\"},linkundo:{name:\"link-undo\",sig:\" String, [String]\",returnType:\"Command\",aka:[],abstract:\"Takes a string of link text, and produces a link that, when clicked, undoes the current turn and sends the player back to the previously visited passage. The link appears identical to a typical passage link. An optional second string can be provided, which is shown instead of the link if it's not possible to undo.  \",anchor:\"macro_link-undo\",category:\"links\",categoryOrder:\"7\"},linkshow:{name:\"link-show\",sig:\" String, ...HookName\",returnType:\"Command\",aka:[],abstract:\"Creates a link that, when clicked, shows the given hidden hooks, running the code within.  \",anchor:\"macro_link-show\",category:\"links\",categoryOrder:\"8\"},linkfullscreen:{name:\"link-fullscreen\",sig:\" String, String, [String]\",returnType:\"Command\",aka:[],abstract:\"Creates a link that, when clicked, toggles the browser's fullscreen mode and windowed mode. The first string is used as its link text if the browser is currently in windowed mode, and the second string if it's currently in fullscreen mode. The link will automatically update (re-rendering the link text) to match the browser's current fullscreen state. The optional third string is used when fullscreen mode isn't allowed by the browser - if it's absent or an empty string, the link won't be displayed at all in that situation.  \",anchor:\"macro_link-fullscreen\",category:\"links\",categoryOrder:\"8\"},linkrevealgoto:{name:\"link-reveal-goto\",sig:\" String, [String], [Changer]\",returnType:\"Changer\",aka:[],abstract:\"This is a convenient combination of the (link-reveal:) and (go-to:) macros, designed to let you run commands like (set:) just before going to another passage. The first string is the link text, and the second is the passage name. An optional changer, with which to style the link, can also be provided.  \",anchor:\"macro_link-reveal-goto\",category:\"links\",categoryOrder:\"6\"},storylet:{name:\"storylet\",sig:\" Lambda\",returnType:\"Metadata\",aka:[],abstract:\"When placed in a passage, it marks that passage as the beginning of a storylet, using the lambda as the condition upon which it's available to the player, so that other macros, like (open-storylets:), can see and select the passage.  \",anchor:\"macro_storylet\",category:\"storylet\",categoryOrder:\"1\"},urgency:{name:\"urgency\",sig:\" Number\",returnType:\"Metadata\",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less \"urgent\", meaning that (open-storylets:) will sort it earlier or later than other passages.  ',anchor:\"macro_urgency\",category:\"storylet\",categoryOrder:\"4\"},exclusivity:{name:\"exclusivity\",sig:\" Number\",returnType:\"Metadata\",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less \"exclusive\", meaning that if it\\'s open, it will prevent storylets with lesser exclusivity from appearing in (open-storylets:).  ',anchor:\"macro_exclusivity\",category:\"storylet\",categoryOrder:\"3\"},metadata:{name:\"metadata\",sig:\" [...Any]\",returnType:\"Metadata\",aka:[],abstract:\"When placed in a passage, this adds the given names and values to the (passage:) datamap for this passage.  \",anchor:\"macro_metadata\",category:\"game state\"},p:{name:\"p\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern\"],abstract:\"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  \",anchor:\"macro_p\",category:\"patterns\",categoryOrder:\"1\"},pattern:{name:\"p\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern\"],abstract:\"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  \",anchor:\"macro_p\",category:\"patterns\",categoryOrder:\"1\"},peither:{name:\"p-either\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-either\"],abstract:\"Creates a string pattern that matches either of the single strings or datatypes given.  \",anchor:\"macro_p-either\",category:\"patterns\",categoryOrder:\"2\"},patterneither:{name:\"p-either\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-either\"],abstract:\"Creates a string pattern that matches either of the single strings or datatypes given.  \",anchor:\"macro_p-either\",category:\"patterns\",categoryOrder:\"2\"},popt:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},patternopt:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},poptional:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},patternoptional:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},pnot:{name:\"p-not\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not\"],abstract:\"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  \",anchor:\"macro_p-not\",category:\"patterns\",categoryOrder:\"6\"},patternnot:{name:\"p-not\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not\"],abstract:\"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  \",anchor:\"macro_p-not\",category:\"patterns\",categoryOrder:\"6\"},pnotbefore:{name:\"p-not-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not-before\"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-not-before\",category:\"patterns\",categoryOrder:\"8\"},patternnotbefore:{name:\"p-not-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not-before\"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-not-before\",category:\"patterns\",categoryOrder:\"8\"},pbefore:{name:\"p-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-before\"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-before\",category:\"patterns\",categoryOrder:\"7\"},patternbefore:{name:\"p-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-before\"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-before\",category:\"patterns\",categoryOrder:\"7\"},pstart:{name:\"p-start\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-start\"],abstract:\"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very start of the string.  \",anchor:\"macro_p-start\",category:\"patterns\",categoryOrder:\"9\"},patternstart:{name:\"p-end\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-start\"],abstract:\"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  \",anchor:\"macro_p-end\",category:\"patterns\",categoryOrder:\"10\"},pend:{name:\"p-end\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-start\"],abstract:\"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  \",anchor:\"macro_p-end\",category:\"patterns\",categoryOrder:\"10\"},pmany:{name:\"p-many\",sig:\" [Number], [Number], ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-many\"],abstract:\"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  \",anchor:\"macro_p-many\",category:\"patterns\",categoryOrder:\"4\"},patternmany:{name:\"p-many\",sig:\" [Number], [Number], ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-many\"],abstract:\"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  \",anchor:\"macro_p-many\",category:\"patterns\",categoryOrder:\"4\"},pins:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},pinsensitive:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},patternins:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},patterninsensitive:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},split:{name:\"split\",sig:\" String or Datatype, String\",returnType:\"Array\",aka:[\"splitted\"],abstract:\"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  \",anchor:\"macro_split\",category:\"string\"},splitted:{name:\"split\",sig:\" String or Datatype, String\",returnType:\"Array\",aka:[\"splitted\"],abstract:\"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  \",anchor:\"macro_split\",category:\"string\"},trimmed:{name:\"trimmed\",sig:\" [String or Datatype], String\",returnType:\"String\",aka:[],abstract:\"This macro takes one string (the last value), and produces a copy with every character matching the given pattern (the first value) removed from the start and end of it. If no pattern is given, it defaults to removing whitespace, as if `whitespace` was the first argument.  \",anchor:\"macro_trimmed\",category:\"string\"},strfind:{name:\"str-find\",sig:\" Datatype, String\",returnType:\"Array\",aka:[\"string-find\"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a \"match\" data name for the full substring.  ',anchor:\"macro_str-find\",category:\"string\"},stringfind:{name:\"str-find\",sig:\" Datatype, String\",returnType:\"Array\",aka:[\"string-find\"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a \"match\" data name for the full substring.  ',anchor:\"macro_str-find\",category:\"string\"},strreplaced:{name:\"str-replaced\",sig:\" [Number], String or Datatype, String or Lambda, String\",returnType:\"String\",aka:[\"string-replaced\",\"replaced\"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a \"via\" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the \"via\" lambda.  ',anchor:\"macro_str-replaced\",category:\"string\"},stringreplaced:{name:\"str-replaced\",sig:\" [Number], String or Datatype, String or Lambda, String\",returnType:\"String\",aka:[\"string-replaced\",\"replaced\"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a \"via\" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the \"via\" lambda.  ',anchor:\"macro_str-replaced\",category:\"string\"},replaced:{name:\"str-replaced\",sig:\" [Number], String or Datatype, String or Lambda, String\",returnType:\"String\",aka:[\"string-replaced\",\"replaced\"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a \"via\" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the \"via\" lambda.  ',anchor:\"macro_str-replaced\",category:\"string\"},if:{name:\"if\",sig:\" Boolean\",returnType:\"Changer\",aka:[],abstract:'This macro accepts only booleans (variables with `true` or `false`, or expressions using `is`, `contains`, or another such operator), and produces a changer that can be attached to hooks to hide them \"if\" the value was false.  ',anchor:\"macro_if\",category:\"basics\",categoryOrder:\"6\"},unless:{name:\"unless\",sig:\" Boolean\",returnType:\"Changer\",aka:[],abstract:'This macro is the negated form of (if:): it accepts only booleans, and returns a changer that can be attached hooks to hide them \"if\" the value was true.  For more information, see the documentation of (if:).  ',anchor:\"macro_unless\",category:\"basics\",categoryOrder:\"7\"},elseif:{name:\"else-if\",sig:\" Boolean\",returnType:\"Changer\",aka:[],abstract:\"This macro's result changes depending on whether the previous hook in the passage was shown or hidden. If the previous hook was shown, then this changer hides the attached hook. Otherwise, it acts like (if:), showing the attached hook if it's true, and hiding it if it's false. If there was no preceding hook before this, then an error message will be printed.  \",anchor:\"macro_else-if\",category:\"basics\",categoryOrder:\"8\"},else:{name:\"else\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"This is a convenient limited variant of the (else-if:) macro. It will simply show the attached hook if the preceding hook was hidden, and hide it otherwise. If there was no preceding hook before this, then an error message will be printed.  \",anchor:\"macro_else\",category:\"basics\",categoryOrder:\"9\"},hidden:{name:\"hidden\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"Produces a changer that can be attached to hooks to hide them.  \",anchor:\"macro_hidden\",category:\"showing and hiding\"},verbatim:{name:\"verbatim\",sig:\"\",returnType:\"Changer\",aka:[\"v6m\"],abstract:\"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  \",anchor:\"macro_verbatim\",category:\"basics\",categoryOrder:\"15\"},v6m:{name:\"verbatim\",sig:\"\",returnType:\"Changer\",aka:[\"v6m\"],abstract:\"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  \",anchor:\"macro_verbatim\",category:\"basics\",categoryOrder:\"15\"},live:{name:\"live\",sig:\" [Number]\",returnType:\"Changer\",aka:[],abstract:'When you attach this changer to a hook, the hook becomes \"live\", which means that it\\'s repeatedly re-run every certain number of milliseconds, replacing the source inside of the hook with a newly computed version.  ',anchor:\"macro_live\",category:\"live\",categoryOrder:\"1\"},event:{name:\"event\",sig:\" Lambda\",returnType:\"Changer\",aka:[],abstract:\"Hooks that have this changer attached will only be run when the given condition becomes true.  \",anchor:\"macro_event\",category:\"live\",categoryOrder:\"3\"},more:{name:\"more\",sig:\"\",returnType:\"Changer\",aka:[],abstract:'Hooks that have this changer attached will only be run once no other exits - links and (click:)-enchanted areas - are remaining in the passage, and will reveal \"more\" prose.  ',anchor:\"macro_more\",category:\"live\",categoryOrder:\"5\"},after:{name:\"after\",sig:\" Number, [Number]\",returnType:\"Changer\",aka:[],abstract:\"Hooks that have this changer attached will only be run once the given amount of time has passed since the passage was rendered. An optional second number specifies that the player can speed up the delay by holding down a keyboard key or mouse button, or by touching the touch device.  \",anchor:\"macro_after\",category:\"live\",categoryOrder:\"4\"},aftererror:{name:\"after-error\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"A bug-specific event macro, this hides the hook and only causes it to run once an error occurs.  \",anchor:\"macro_after-error\",category:\"live\",categoryOrder:\"5\"},hook:{name:\"hook\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"A changer that allows the author to give a hook a computed tag name.  \",anchor:\"macro_hook\",category:\"styling\"},for:{name:\"for\",sig:\" Lambda, [...Any]\",returnType:\"Changer\",aka:[\"loop\"],abstract:\"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  \",anchor:\"macro_for\",category:\"basics\",categoryOrder:\"10\"},loop:{name:\"for\",sig:\" Lambda, [...Any]\",returnType:\"Changer\",aka:[\"loop\"],abstract:\"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  \",anchor:\"macro_for\",category:\"basics\",categoryOrder:\"10\"},transition:{name:\"transition\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n\"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `\"instant\"`, `\"dissolve\"`, `\"fade\"`, `\"rumble\"`, `\"shudder\"`, `\"pulse\"`, `\"zoom\"`, `\"flicker\"`, `\"slide-left\"`, `\"slide-right\"`, `\"slide-up\"`, `\"slide-down\"`, `\"fade-left\"`, `\"fade-right\"`, `\"fade-up\"` and `\"fade-down\"`.  ',anchor:\"macro_transition\",category:\"transitions\",categoryOrder:\"1\"},t8n:{name:\"transition\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n\"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `\"instant\"`, `\"dissolve\"`, `\"fade\"`, `\"rumble\"`, `\"shudder\"`, `\"pulse\"`, `\"zoom\"`, `\"flicker\"`, `\"slide-left\"`, `\"slide-right\"`, `\"slide-up\"`, `\"slide-down\"`, `\"fade-left\"`, `\"fade-right\"`, `\"fade-up\"` and `\"fade-down\"`.  ',anchor:\"macro_transition\",category:\"transitions\",categoryOrder:\"1\"},transitiontime:{name:\"transition-time\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-time\"],abstract:\"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  \",anchor:\"macro_transition-time\",category:\"transitions\",categoryOrder:\"2\"},t8ntime:{name:\"transition-time\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-time\"],abstract:\"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  \",anchor:\"macro_transition-time\",category:\"transitions\",categoryOrder:\"2\"},transitiondelay:{name:\"transition-delay\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-delay\"],abstract:\"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  \",anchor:\"macro_transition-delay\",category:\"transitions\",categoryOrder:\"2\"},t8ndelay:{name:\"transition-delay\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-delay\"],abstract:\"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  \",anchor:\"macro_transition-delay\",category:\"transitions\",categoryOrder:\"2\"},transitionskip:{name:\"transition-skip\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-skip\"],abstract:\"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  \",anchor:\"macro_transition-skip\",category:\"transitions\",categoryOrder:\"6\"},t8nskip:{name:\"transition-skip\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-skip\"],abstract:\"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  \",anchor:\"macro_transition-skip\",category:\"transitions\",categoryOrder:\"6\"},transitiondepart:{name:\"transition-depart\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-depart\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  \",anchor:\"macro_transition-depart\",category:\"transitions\",categoryOrder:\"4\"},t8ndepart:{name:\"transition-depart\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-depart\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  \",anchor:\"macro_transition-depart\",category:\"transitions\",categoryOrder:\"4\"},transitionarrive:{name:\"transition-arrive\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-arrive\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  \",anchor:\"macro_transition-arrive\",category:\"transitions\",categoryOrder:\"5\"},t8narrive:{name:\"transition-arrive\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-arrive\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  \",anchor:\"macro_transition-arrive\",category:\"transitions\",categoryOrder:\"5\"},button:{name:\"button\",sig:\" [String]\",returnType:\"Changer\",aka:[],abstract:\"When applied to a link, this changer styles it so that it resembles a button, and makes it take up the entire passage width. The optional sizing string lets you specify width and horizontal margins for the button. It is not recommended that this be used on non-link hooks.  \",anchor:\"macro_button\",category:\"styling\"},action:{name:\"action\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"When attached to a link command, or given to a link changer macro as the second value, this changer turns the link into a different kind of interaction element with a different appearance - one that is either activated by hovering the mouse pointer over it, hoving the mouse pointer off of it, or double-clicking it. This does nothing when attached or supplied to a non-link hook.  \",anchor:\"macro_action\",category:\"links\",categoryOrder:\"99\"},border:{name:\"border\",sig:\" String, [String], [String], [String]\",returnType:\"Changer\",aka:[\"b4r\"],abstract:\"A changer macro that applies a CSS border to the hook.  \",anchor:\"macro_border\",category:\"borders\",categoryOrder:\"1\"},b4r:{name:\"border\",sig:\" String, [String], [String], [String]\",returnType:\"Changer\",aka:[\"b4r\"],abstract:\"A changer macro that applies a CSS border to the hook.  \",anchor:\"macro_border\",category:\"borders\",categoryOrder:\"1\"},bordersize:{name:\"border-size\",sig:\" Number, [Number], [Number], [Number]\",returnType:\"Changer\",aka:[\"b4r-size\"],abstract:\"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by a given amount.  \",anchor:\"macro_border-size\",category:\"borders\",categoryOrder:\"3\"},b4rsize:{name:\"border-size\",sig:\" Number, [Number], [Number], [Number]\",returnType:\"Changer\",aka:[\"b4r-size\"],abstract:\"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by a given amount.  \",anchor:\"macro_border-size\",category:\"borders\",categoryOrder:\"3\"},cornerradius:{name:\"corner-radius\",sig:\" Number, [Number], [Number], [Number]\",returnType:\"Changer\",aka:[],abstract:\"When applied to a hook, this rounds the corners by the given number of pixels, causing the hook to become increasingly round or button-like.  \",anchor:\"macro_corner-radius\",category:\"borders\",categoryOrder:\"4\"},bordercolour:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},b4rcolour:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},bordercolor:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},b4rcolor:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},opacity:{name:\"opacity\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer changes how opaque the attached hook is, using a value from 0 to 1. Reducing the value makes it more transparent. An opacity of 0 makes the hook invisible.  \",anchor:\"macro_opacity\",category:\"styling\"},font:{name:\"font\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:'This styling changer changes the font used to display the text of the attached hook. Provide the font\\'s family name (such as \"Helvetica Neue\" or \"Courier\") as a string.  ',anchor:\"macro_font\",category:\"styling\"},align:{name:\"align\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"This styling changer changes the alignment of text in the attached hook, as if the `===>`~ arrow syntax was used. In fact, these same arrows (`==>`~, `=><=`~, `<==>`~, `====><=`~ etc.) should be supplied as a string to specify the degree of alignment.  \",anchor:\"macro_align\",category:\"styling\"},textcolour:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},colour:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},textcolor:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},color:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},textsize:{name:\"text-size\",sig:\" Number\",returnType:\"Changer\",aka:[\"size\"],abstract:\"This styling changer changes the text size of the attached hook by the given fraction. Give it a number greater than 1 to enlarge the text, and a number smaller to decrease the text. Providing 1 to this macro will revert the text size back to the default.  \",anchor:\"macro_text-size\",category:\"styling\"},size:{name:\"text-size\",sig:\" Number\",returnType:\"Changer\",aka:[\"size\"],abstract:\"This styling changer changes the text size of the attached hook by the given fraction. Give it a number greater than 1 to enlarge the text, and a number smaller to decrease the text. Providing 1 to this macro will revert the text size back to the default.  \",anchor:\"macro_text-size\",category:\"styling\"},textindent:{name:\"text-indent\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer causes the attached hook to be indented by the given number of pixels.  \",anchor:\"macro_text-indent\",category:\"styling\"},textrotatez:{name:\"text-rotate-z\",sig:\" Number\",returnType:\"Changer\",aka:[\"text-rotate\"],abstract:\"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-z\",category:\"styling\"},textrotate:{name:\"text-rotate-z\",sig:\" Number\",returnType:\"Changer\",aka:[\"text-rotate\"],abstract:\"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-z\",category:\"styling\"},textrotatey:{name:\"text-rotate-y\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer visually rotates the attached hook clockwise, around the Y axis (vertical), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-y\",category:\"styling\"},textrotatex:{name:\"text-rotate-x\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer visually rotates the attached hook clockwise, around the X axis (horizontal), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-x\",category:\"styling\"},bg:{name:\"bg\",sig:\" Colour or String or Gradient\",returnType:\"Changer\",aka:[\"background\"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like \"#FA9138\") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:\"macro_bg\",category:\"styling\"},background:{name:\"bg\",sig:\" Colour or String or Gradient\",returnType:\"Changer\",aka:[\"background\"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like \"#FA9138\") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:\"macro_bg\",category:\"styling\"},textstyle:{name:\"text-style\",sig:\" ...String\",returnType:\"Changer\",aka:[],abstract:'This applies one or more selected built-in text styles to the hook\\'s text. Give this macro one of these strings (capitalisation and hyphens ignored): `\"none\"`, `\"bold\"`, `\"italic\"`, `\"underline\"`, `\"double-underline\"`, `\"wavy-underline\"`, `\"strike\"`, `\"double-strike\"`, `\"wavy-strike\"`, `\"superscript\"`, `\"subscript\"`, `\"blink\"`, `\"shudder\"`, `\"mark\"`, `\"condense\"`, `\"expand\"`, `\"outline\"`, `\"shadow\"`, `\"emboss\"`, `\"smear\"`, `\"blur\"`, `\"blurrier\"`, `\"mirror\"`, `\"upside-down\"`, `\"tall\"`, `\"flat\"`, `\"fade-in-out\"`, `\"rumble\"`, `\"sway\"`, `\"buoy\"` or `\"fidget\"`.  ',anchor:\"macro_text-style\",category:\"styling\"},collapse:{name:\"collapse\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this collapses the whitespace within the hook, in the same manner as the collapsing whitespace markup.  \",anchor:\"macro_collapse\",category:\"styling\"},hoverstyle:{name:\"hover-style\",sig:\" Changer\",returnType:\"Changer\",aka:[],abstract:\"Given a style-altering changer, it makes a changer which only applies when the hook or command is hovered over with the mouse pointer, and is removed when hovering off.  \",anchor:\"macro_hover-style\",category:\"styling\"},css:{name:\"css\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:'This takes a string of inline CSS, and applies it to the hook, as if it were a HTML \"style\" property.  ',anchor:\"macro_css\",category:\"styling\"},testtrue:{name:\"test-true\",sig:\" [...Any]\",returnType:\"Changer\",aka:[],abstract:\"If you want to test your passage, while ignoring a specific changer macro in it, temporarily change that changer macro's name to (test-true:), and it will ignore all of the data given to it, while enabling the hook.  \",anchor:\"macro_test-true\",category:\"debugging\",categoryOrder:\"2\"},testfalse:{name:\"test-false\",sig:\" [...Any]\",returnType:\"Changer\",aka:[],abstract:\"If you want to test your passage in order to see what would happen if an (if:), (unless:) or (else-if:) macro would hide the hook it's attached to, you can temporarily change the name of the macro to (test-false:), which causes it to ignore the data given to it and act as if it was given `false`.  \",anchor:\"macro_test-false\",category:\"debugging\",categoryOrder:\"3\"},animate:{name:\"animate\",sig:\" HookName, String, [Number]\",returnType:\"Command\",aka:[],abstract:\"A command that causes a hook to briefly animate, as if a (transition:) was applied to it. The length of time that the animation plays can be optionally altered by providing a number.  \",anchor:\"macro_animate\",category:\"transitions\"},box:{name:\"box\",sig:\" String, [Number]\",returnType:\"Changer\",aka:[],abstract:'When attached to a hook, it becomes a \"box\", with a given width proportional to the containing element\\'s width, an optional number of lines tall, and a scroll bar if its contained text is longer than its height can contain.  ',anchor:\"macro_box\",category:\"styling\"},floatbox:{name:\"float-box\",sig:\" String, String\",returnType:\"Changer\",aka:[],abstract:'When attached to a hook, it becomes a \"floating box\", placed at a given portion of the window, sized proportionally to the window\\'s dimensions, and with a scroll bar if its contained text is longer than its height can contain.  ',anchor:\"macro_float-box\",category:\"styling\"},str:{name:\"str\",sig:\" ...[Number or String or Boolean or Array]\",returnType:\"String\",aka:[\"string\",\"text\"],abstract:\"(str:) accepts any amount of values and tries to convert them all to a single String.  \",anchor:\"macro_str\",category:\"string\",categoryOrder:\"1\"},string:{name:\"str\",sig:\" ...[Number or String or Boolean or Array]\",returnType:\"String\",aka:[\"string\",\"text\"],abstract:\"(str:) accepts any amount of values and tries to convert them all to a single String.  \",anchor:\"macro_str\",category:\"string\",categoryOrder:\"1\"},text:{name:\"str\",sig:\" ...[Number or String or Boolean or Array]\",returnType:\"String\",aka:[\"string\",\"text\"],abstract:\"(str:) accepts any amount of values and tries to convert them all to a single String.  \",anchor:\"macro_str\",category:\"string\",categoryOrder:\"1\"},source:{name:\"source\",sig:\" Any\",returnType:\"String\",aka:[],abstract:\"When given almost any data value, this will produce a string representation of Harlowe source code that can, when run, create that value exactly.  \",anchor:\"macro_source\",category:\"string\"},substring:{name:\"substring\",sig:\" String, Number, Number\",returnType:\"String\",aka:[],abstract:\"This macro produces a substring of the given string, cut from two inclusive number positions.  \",anchor:\"macro_substring\",category:\"string\"},lowercase:{name:\"lowercase\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces a lowercase version of the given string.  \",anchor:\"macro_lowercase\",category:\"string\"},uppercase:{name:\"uppercase\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces an uppercase version of the given string.  \",anchor:\"macro_uppercase\",category:\"string\"},lowerfirst:{name:\"lowerfirst\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces a version of the given string, where the first alphanumeric character is lowercase, and other characters are left as-is.  \",anchor:\"macro_lowerfirst\",category:\"string\"},upperfirst:{name:\"upperfirst\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces a version of the given string, where the first alphanumeric character is uppercase, and other characters are left as-is.  \",anchor:\"macro_upperfirst\",category:\"string\"},words:{name:\"words\",sig:\" String\",returnType:\"Array\",aka:[],abstract:'This macro takes a string and creates an array of each word (\"word\" meaning a sequence of non-whitespace characters) in the string.  ',anchor:\"macro_words\",category:\"string\"},strrepeated:{name:\"str-repeated\",sig:\" Number, String\",returnType:\"String\",aka:[\"string-repeated\"],abstract:\"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  \",anchor:\"macro_str-repeated\",category:\"string\"},stringrepeated:{name:\"str-repeated\",sig:\" Number, String\",returnType:\"String\",aka:[\"string-repeated\"],abstract:\"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  \",anchor:\"macro_str-repeated\",category:\"string\"},strreversed:{name:\"str-reversed\",sig:\" String\",returnType:\"String\",aka:[\"string-reversed\"],abstract:\"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  \",anchor:\"macro_str-reversed\",category:\"string\"},stringreversed:{name:\"str-reversed\",sig:\" String\",returnType:\"String\",aka:[\"string-reversed\"],abstract:\"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  \",anchor:\"macro_str-reversed\",category:\"string\"},joined:{name:\"joined\",sig:\" ...String\",returnType:\"String\",aka:[],abstract:\"Using the first string as a separator value, this macro takes all of the other strings given to it, and joins them into a single string.  \",anchor:\"macro_joined\",category:\"string\"},plural:{name:\"plural\",sig:\" Number, String, [String]\",returnType:\"String\",aka:[],abstract:'This macro takes a whole number and a string, then converts the number to a string, joins them up with a space character, and pluralises the string if the number wasn\\'t 1 or -1. By default, this pluralisation is done by adding \"s\", as in some English plurals. An optional extra string can specify a different plural word to use instead.  ',anchor:\"macro_plural\",category:\"string\"},strnth:{name:\"str-nth\",sig:\" Number\",returnType:\"String\",aka:[\"string-nth\"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form \"nth\", such as \"1st\", \"22nd\", etc.).  ',anchor:\"macro_str-nth\",category:\"string\"},stringnth:{name:\"str-nth\",sig:\" Number\",returnType:\"String\",aka:[\"string-nth\"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form \"nth\", such as \"1st\", \"22nd\", etc.).  ',anchor:\"macro_str-nth\",category:\"string\"},digitformat:{name:\"digit-format\",sig:\" String, Number\",returnType:\"String\",aka:[],abstract:\"\",anchor:\"macro_digit-format\",category:\"string\"},num:{name:\"num\",sig:\" String\",returnType:\"Number\",aka:[\"number\"],abstract:\"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  \",anchor:\"macro_num\",category:\"number\"},number:{name:\"num\",sig:\" String\",returnType:\"Number\",aka:[\"number\"],abstract:\"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  \",anchor:\"macro_num\",category:\"number\"},datatype:{name:\"datatype\",sig:\" Any\",returnType:\"Datatype\",aka:[],abstract:\"This macro takes any storeable value, and produces a datatype that matches it.  \",anchor:\"macro_datatype\",category:\"custom macros\",categoryOrder:\"5\"},datapattern:{name:\"datapattern\",sig:\" Any\",returnType:\"Any\",aka:[],abstract:\"This takes any storeable value, and produces a datatype that matches it, in a manner similar to (datatype:). However, when given an array or datamap, it creates an array or datamap with its values replaced with their datatypes, which can be used as a more accurate pattern with `matches` or (set:) elsewhere.  \",anchor:\"macro_datapattern\",category:\"custom macros\",categoryOrder:\"6\"},rgb:{name:\"rgb\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"rgba\"],abstract:\"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_rgb\",category:\"colour\",categoryOrder:\"2\"},rgba:{name:\"rgb\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"rgba\"],abstract:\"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_rgb\",category:\"colour\",categoryOrder:\"2\"},hsl:{name:\"hsl\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"hsla\"],abstract:\"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_hsl\",category:\"colour\",categoryOrder:\"1\"},hsla:{name:\"hsl\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"hsla\"],abstract:\"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_hsl\",category:\"colour\",categoryOrder:\"1\"},lch:{name:\"lch\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"lcha\"],abstract:\"This macro creates a colour using three values in the CIELAB colour model - a lightness (l) percentage, a chroma (c) value, and a hue (h) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_lch\",category:\"colour\",categoryOrder:\"3\"},lcha:{name:\"lch\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"lcha\"],abstract:\"This macro creates a colour using three values in the CIELAB colour model - a lightness (l) percentage, a chroma (c) value, and a hue (h) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_lch\",category:\"colour\",categoryOrder:\"3\"},complement:{name:\"complement\",sig:\" Colour\",returnType:\"Colour\",aka:[],abstract:\"When given a colour, this provides a complement to that colour.  \",anchor:\"macro_complement\",category:\"colour\",categoryOrder:\"4\"},mix:{name:\"mix\",sig:\" Number, Colour, Number, Colour\",returnType:\"Colour\",aka:[],abstract:\"When given two pairs of values - each a number from 0 to 1 and a colour - this macro produces a mix of the two colours, using the numbers as ratios of each colour. The colours are mixed using the LCH colourspace, used by the (lch:) macro.  \",anchor:\"macro_mix\",category:\"colour\"},palette:{name:\"palette\",sig:\" String, Colour\",returnType:\"Array\",aka:[],abstract:\"When given a string specifying a palette type, and a colour, this macro produces an array containing the given colour followed by three additional colours that together form a palette, for use with (text-colour:), (bg:), and other macros.  \",anchor:\"macro_palette\",category:\"colour\",categoryOrder:\"5\"},gradient:{name:\"gradient\",sig:\" Number, ...Number, Colour\",returnType:\"Gradient\",aka:[],abstract:'When given a degree angle, followed by any number of number-colour pairs called \"colour stops\", this macro produces a gradient that fades between those colours in the direction of the angle.  ',anchor:\"macro_gradient\",category:\"colour\",categoryOrder:\"6\"},stripes:{name:\"stripes\",sig:\" Number, Number, Colour, Colour\",returnType:\"Gradient\",aka:[],abstract:\"When given a degree angle, a pixel distance, and two or more colours, this macro produces a gradient that draws a striped background, with each stripe as wide as the distance, and alternating through the given colours.  \",anchor:\"macro_stripes\",category:\"colour\",categoryOrder:\"7\"},hooksnamed:{name:\"hooks-named\",sig:\" String\",returnType:\"HookName\",aka:[],abstract:\"When given a string, this creates a HookName from it. This can be used to dynamically create HookNames.  \",anchor:\"macro_hooks-named\",category:\"basics\"},cond:{name:\"cond\",sig:\" Boolean, Any, ...Any\",returnType:\"Any\",aka:[],abstract:'When given a sequence of booleans (the \"conditions\") paired with values, this provides the first value that was paired with a `true` condition. This can give you one value or another based on a quick check.  ',anchor:\"macro_cond\",category:\"basics\",categoryOrder:\"12\"},weekday:{name:\"weekday\",sig:\"\",returnType:\"String\",aka:[],abstract:'This date/time macro produces one of the strings \"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\" or \"Saturday\", based on the weekday on the current player\\'s system clock.  ',anchor:\"macro_weekday\",category:\"date and time\"},monthday:{name:\"monthday\",sig:\"\",returnType:\"Number\",aka:[],abstract:\"This date/time macro produces a number corresponding to the day of the month on the current player's system clock. This should be between 1 (on the 1st of the month) and 31, inclusive.  \",anchor:\"macro_monthday\",category:\"date and time\"},currenttime:{name:\"current-time\",sig:\"\",returnType:\"String\",aka:[],abstract:'This date/time macro produces a string of the current 12-hour time on the current player\\'s system clock, in the format \"12:00 AM\".  ',anchor:\"macro_current-time\",category:\"date and time\"},currentdate:{name:\"current-date\",sig:\"\",returnType:\"String\",aka:[],abstract:'This date/time macro produces a string of the current date the current player\\'s system clock, in the format \"Thu Jan 01 1970\".  ',anchor:\"macro_current-date\",category:\"date and time\"},min:{name:\"min\",sig:\" ...Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro accepts numbers, and evaluates to the lowest valued number.  \",anchor:\"macro_min\",category:\"maths\"},max:{name:\"max\",sig:\" ...Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro accepts numbers, and evaluates to the highest valued number.  \",anchor:\"macro_max\",category:\"maths\"},abs:{name:\"abs\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro finds the absolute value of a number (without the sign).  \",anchor:\"macro_abs\",category:\"maths\"},sign:{name:\"sign\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces -1 when given a negative number, 0 when given 0, and 1 when given a positive number.  \",anchor:\"macro_sign\",category:\"maths\"},sin:{name:\"sin\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro computes the sine of the given number of radians.  \",anchor:\"macro_sin\",category:\"maths\"},cos:{name:\"cos\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro computes the cosine of the given number of radians.  \",anchor:\"macro_cos\",category:\"maths\"},tan:{name:\"tan\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro computes the tangent of the given number of radians.  \",anchor:\"macro_tan\",category:\"maths\"},floor:{name:\"floor\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This macro rounds the given number downward to a whole number. If a whole number is provided, it returns the number as-is.  \",anchor:\"macro_floor\",category:\"number\"},round:{name:\"round\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This macro rounds the given number to the nearest whole number - downward if its decimals are smaller than 0.5, and upward otherwise. If a whole number is provided, it returns the number as-is.  \",anchor:\"macro_round\",category:\"number\"},trunc:{name:\"trunc\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:'This macro rounds the given number towards zero. This \"truncates\" the fractional portion of the number, removing it and leaving just the whole portion.  ',anchor:\"macro_trunc\",category:\"number\"},ceil:{name:\"ceil\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This macro rounds the given number upward to a whole number. If a whole number is provided, it returns the number as-is.  \",anchor:\"macro_ceil\",category:\"number\"},pow:{name:\"pow\",sig:\" Number, Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro raises the first number to the power of the second number, and provides the result.  \",anchor:\"macro_pow\",category:\"maths\"},exp:{name:\"exp\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro raises Euler's number to the power of the given number, and provides the result.  \",anchor:\"macro_exp\",category:\"maths\"},sqrt:{name:\"sqrt\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the square root of the given number.  \",anchor:\"macro_sqrt\",category:\"maths\"},log:{name:\"log\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the natural logarithm (the base-e logarithm) of the given number.  \",anchor:\"macro_log\",category:\"maths\"},log10:{name:\"log10\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the base-10 logarithm of the given number.  \",anchor:\"macro_log10\",category:\"maths\"},log2:{name:\"log2\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the base-2 logarithm of the given number.  \",anchor:\"macro_log2\",category:\"maths\"},random:{name:\"random\",sig:\" Number, [Number]\",returnType:\"Number\",aka:[],abstract:\"This macro produces a whole number randomly selected between the two whole numbers, inclusive (or, if the second number is absent, then between 0 and the first number, inclusive).  \",anchor:\"macro_random\",category:\"number\"},either:{name:\"either\",sig:\" ...Any\",returnType:\"Any\",aka:[],abstract:\"Give this macro several values, separated by commas, and it will pick and return one of them randomly.  \",anchor:\"macro_either\",category:\"basics\",categoryOrder:\"11\"},nth:{name:\"nth\",sig:\" Number, ...Any\",returnType:\"Any\",aka:[],abstract:\"Given a positive whole number and a sequence of values, this selects the nth value in the sequence, where n is the number. If n is larger than the number of items in the sequence, the selection loops around to the start.  \",anchor:\"macro_nth\",category:\"basics\",categoryOrder:\"13\"}}};if(\"object\"!=typeof V)throw Error(\"Impossible: Shortdefs wasn't inserted at build time\");const Y={\"#e61919\":\"red\",\"#e68019\":\"orange\",\"#e5e619\":\"yellow\",\"#80e619\":\"lime\",\"#19e619\":\"green\",\"#19e5e6\":\"cyan\",\"#197fe6\":\"blue\",\"#1919e6\":\"navy\",\"#7f19e6\":\"purple\",\"#e619e5\":\"magenta\",\"#ffffff\":\"white\",\"#000000\":\"black\",\"#888888\":\"grey\"},GCD$1=(e,a)=>e?a?e>a?GCD$1(e-a,a):GCD$1(e,a-e):e:a,fourDecimals$1=e=>j(1e4*e)/1e4;function setOptionalStyles$1({codeUsesCodeFont:e=!0}){const a=\"cm-harlowe-4-\";let t=document.querySelector(`style#${a}optionalStyles`);t||(t=document.createElement(\"style\"),t.setAttribute(\"id\",`${a}optionalStyles`),document.head.appendChild(t));let r=\"\",o=1;if(e)try{for(let e of localStorage.getItem(\"twine-prefs\")?.split(\",\")||[]){let{name:a,value:t}=JSON.parse(localStorage.getItem(`twine-prefs-${e}`));\"codeEditorFontFamily\"===a?r=t.includes(\" \")?`\"${t}\"`:t:\"codeEditorFontScale\"===a&&(o=t)}}catch(e){}t.innerHTML=e?`.${a}root:not([class^='${a}text']):not([class^='${a}verbatim']) { ${r?`font-family:${r}`:\"\"}; ${o?`font-size:${100*o}%`:\"\"}`:\"\"}function getPrefs$2(){try{return JSON.parse(localStorage.getItem(\"harlowe-prefs\"))||{}}catch(e){return{}}}const U=document.createElement(\"p\");const G=!!document.querySelector('html[data-version^=\"2.3.\"]'),X={ShortDefs:V,toHarloweColour:function toHarloweColour$2(e,a){return e=e.toLowerCase(),0==+a?\"transparent\":+a<1?(e=function hexToHSL(e){e=e.slice(1);const a=parseInt(e.slice(0,2),16)/255,t=parseInt(e.slice(2,4),16)/255,r=parseInt(e.slice(4,6),16)/255,o=Math.max(a,t,r),n=Math.min(a,t,r),s=(o+n)/2,i=o-n;if(o===n)return{h:0,s:0,l:s};let l;switch(o){case a:l=(t-r)/i+(t<r?6:0);break;case t:l=(r-a)/i+2;break;case r:l=(a-t)/i+4}return l=Math.round(60*l),{h:l,s:s>.5?i/(2-o-n):i/(o+n),l:s}}(e),`(hsl:${fourDecimals$1(e.h)},${fourDecimals$1(e.s)},${fourDecimals$1(e.l)},${fourDecimals$1(a)})`):e in Y?Y[e]:e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?`#${e[1]}${e[3]}${e[5]}`:e},toCSSColour:function toCSSColour$2(e,a){if(0==+a)return\"transparent\";if(+a<1){e=e.slice(1);return`rgba(${parseInt(e.slice(0,2),16)},${parseInt(e.slice(2,4),16)},${parseInt(e.slice(4,6),16)},${a})`}return e},GCD:GCD$1,fourDecimals:fourDecimals$1,el:function el$2(e){return U.innerHTML=e,U.firstChild},twine23:G,buttonClass:e=>G?\" \":`icon-button variant-${e?\"primary\":\"secondary\"} `,builtinColourNames:Y,fontIcon:(e,a=20,t=20)=>`<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\" width=\"${a}\" height=\"${t}\"><path fill='currentColor' d=\"${{search:\"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z\",\"align-center\":\"M432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM108.1 96h231.81A12.09 12.09 0 0 0 352 83.9V44.09A12.09 12.09 0 0 0 339.91 32H108.1A12.09 12.09 0 0 0 96 44.09V83.9A12.1 12.1 0 0 0 108.1 96zm231.81 256A12.09 12.09 0 0 0 352 339.9v-39.81A12.09 12.09 0 0 0 339.91 288H108.1A12.09 12.09 0 0 0 96 300.09v39.81a12.1 12.1 0 0 0 12.1 12.1z\",\"align-right\":\"M16 224h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16zm416 192H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm3.17-384H172.83A12.82 12.82 0 0 0 160 44.83v38.34A12.82 12.82 0 0 0 172.83 96h262.34A12.82 12.82 0 0 0 448 83.17V44.83A12.82 12.82 0 0 0 435.17 32zm0 256H172.83A12.82 12.82 0 0 0 160 300.83v38.34A12.82 12.82 0 0 0 172.83 352h262.34A12.82 12.82 0 0 0 448 339.17v-38.34A12.82 12.82 0 0 0 435.17 288z\",\"list-ol\":\"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z\",\"list-ul\":\"M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z\",\"border-style\":\"M240 416h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm-96 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm192 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm96-192h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-288h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-96H32A32 32 0 0 0 0 64v400a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16V96h368a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\",columns:\"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64V160h160v256zm224 0H288V160h160v256z\",eye:\"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z\",comment:\"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z\",plus:\"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\",minus:\"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\",times:\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\",check:\"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z\",\"chevron-up\":\"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z\",gear:\"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z\"}[e]}\"/></svg>`,insensitiveName:e=>`${e}`.toLowerCase().replace(/-|_/g,\"\"),getPrefs:getPrefs$2,setPref:function setPref(e,a){try{const t=getPrefs$2();t[e]=a,localStorage.setItem(\"harlowe-prefs\",JSON.stringify(t)),setOptionalStyles$1(t)}catch(e){return{}}},setOptionalStyles:setOptionalStyles$1,disabledButtonCSS:\"opacity:0.5;pointer-events:none\"},{stringify:Z}=JSON;let{lex:J}=q,K={};const{twine23:Q,builtinColourNames:ee,buttonClass:ae,toHarloweColour:te,toCSSColour:re,el:oe,fontIcon:ne}=X,se=\"querySelector\",ie=`${se}All`,le=\"addEventListener\",ce=\"removeEventListener\",he=[[\"#f8f9fa\",\"#fff5f5\",\"#fff0f6\",\"#f8f0fc\",\"#f3f0ff\",\"#edf2ff\",\"#e7f5ff\",\"#e3fafc\",\"#e6fcf5\",\"#ebfbee\",\"#f4fce3\",\"#fff9db\",\"#fff4e6\"],[\"#f1f3f5\",\"#ffe3e3\",\"#ffdeeb\",\"#f3d9fa\",\"#e5dbff\",\"#dbe4ff\",\"#d0ebff\",\"#c5f6fa\",\"#c3fae8\",\"#d3f9d8\",\"#e9fac8\",\"#fff3bf\",\"#ffe8cc\"],[\"#e9ecef\",\"#ffc9c9\",\"#fcc2d7\",\"#eebefa\",\"#d0bfff\",\"#bac8ff\",\"#a5d8ff\",\"#99e9f2\",\"#96f2d7\",\"#b2f2bb\",\"#d8f5a2\",\"#ffec99\",\"#ffd8a8\"],[\"#dee2e6\",\"#ffa8a8\",\"#faa2c1\",\"#e599f7\",\"#b197fc\",\"#91a7ff\",\"#74c0fc\",\"#66d9e8\",\"#63e6be\",\"#8ce99a\",\"#c0eb75\",\"#ffe066\",\"#ffc078\"],[\"#ced4da\",\"#ff8787\",\"#f783ac\",\"#da77f2\",\"#9775fa\",\"#748ffc\",\"#4dabf7\",\"#3bc9db\",\"#38d9a9\",\"#69db7c\",\"#a9e34b\",\"#ffd43b\",\"#ffa94d\"],[\"#adb5bd\",\"#ff6b6b\",\"#f06595\",\"#cc5de8\",\"#845ef7\",\"#5c7cfa\",\"#339af0\",\"#22b8cf\",\"#20c997\",\"#51cf66\",\"#94d82d\",\"#fcc419\",\"#ff922b\"],[\"#868e96\",\"#fa5252\",\"#e64980\",\"#be4bdb\",\"#7950f2\",\"#4c6ef5\",\"#228be6\",\"#15aabf\",\"#12b886\",\"#40c057\",\"#82c91e\",\"#fab005\",\"#fd7e14\"],[\"#495057\",\"#f03e3e\",\"#d6336c\",\"#ae3ec9\",\"#7048e8\",\"#4263eb\",\"#1c7ed6\",\"#1098ad\",\"#0ca678\",\"#37b24d\",\"#74b816\",\"#f59f00\",\"#f76707\"],[\"#343a40\",\"#e03131\",\"#c2255c\",\"#9c36b5\",\"#6741d9\",\"#3b5bdb\",\"#1971c2\",\"#0c8599\",\"#099268\",\"#2f9e44\",\"#66a80f\",\"#f08c00\",\"#e8590c\"],[\"#212529\",\"#c92a2a\",\"#a61e4d\",\"#862e9c\",\"#5f3dc4\",\"#364fc7\",\"#1864ab\",\"#0b7285\",\"#087f5b\",\"#2b8a3e\",\"#5c940d\",\"#e67700\",\"#d9480f\"]],dataValueRow$1=(e=((e,a)=>e.expression=a),a=void 0,t=!1)=>({type:\"inline-dropdown-rows\",text:\"Value: \",name:\"variable-datatype\",width:\"16%\",options:[[\"text string\",{type:\"inline-string-textarea\",width:\"55%\",text:\"\",placeholder:\"Text\",modelCallback:e,modelRegistry:a}],[\"number\",{type:\"inline-number-textarea\",width:\"20%\",text:\"\",modelCallback:e,modelRegistry:a}],[\"Boolean value\",{type:\"inline-dropdown\",text:\"\",options:[\"false\",\"true\"],model(a,t){e(a,`${!!t[se](\"select\").value}`)},modelRegistry:a}],[\"colour\",{type:\"inline-colour\",text:\"\",value:\"#ffffff\",model(a,t){const r=t[se](\"[type=color]\").value,o=t[se](\"[type=range]\").value;e(a,te(r,o))},modelRegistry:a}],[\"array\",{type:\"datavalue-rows\",text:\"<div class='harlowe-4-datavalueRowHint'>An <b>array</b> is a sequence of ordered datavalues that can be used without having to create separate variables for each. Use it to store similar values whose order and position matter, or to store an ever-changing quantity of similar values.</div>\",model(a,t){e(a,`(a:${t})`)},renumber(e,a){const t=`${a+=1}`.slice(-1);e.textContent=a+(\"1\"===t?\"st\":\"2\"===t?\"nd\":\"3\"===t?\"rd\":\"th\")+\": \"},modelRegistry:a}],[\"datamap\",{type:\"datavalue-map\",text:\"<div class='harlowe-4-datavalueRowHint'>A <b>datamap</b> is a value that holds any number of other values, each of which is \\\"mapped\\\" to a unique name. Use it to store data values that represent parts of a larger game entity, or rows of a table.</div>\",model(a,t){t.every(((e,a)=>a%2!=0||'\"\"'!==e&&\"''\"!==e))||(a.invalidSubrow=!0),e(a,`(dm:${t})`)},renumber(e){e.textContent=\":\"},modelRegistry:a}],[],[\"randomly chosen value\",{type:\"datavalue-rows\",text:\"<div class='harlowe-4-datavalueRowHint'>One of the following values is randomly chosen <b>each time the macro is run</b>.</div>\",model(a,t){t.length||(a.invalidSubrow=!0),e(a,`(either:${t})`)},renumber(e){e.textContent=\"•\",e.style.marginRight=\"0.5em\"},modelRegistry:a}],[\"random number\",oe(\"<div class='harlowe-4-datavalueRowHint'>A number between these two values is randomly chosen <b>each time the macro is run</b>.</div>\"),{type:\"inline-number-textarea\",width:\"20%\",text:\"From\",model(){},modelRegistry:a},{type:\"inline-number-textarea\",width:\"20%\",text:\"to\",model(a,t){e(a,`(random:${+t.previousElementSibling[se](\"input\").value||0},${+t[se](\"input\").value||0})`)},modelRegistry:a}],...t?[]:[[],[\"itself + value\",{type:\"datavalue-inner\",text:\"<div class='harlowe-4-datavalueRowHint'>The following value is added to the existing value in the variable. NOTE: if the values aren't the same type of data, an error will result.</div>\",model(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`it + ${t}`)},renumber(e){(e||{}).textContent=\"it + \"},modelRegistry:a}],[\"variable + value\",{type:\"inline-dropdown\",text:\" Other variable: \",options:[\"$\",\"_\"],model(e,a){e.innerVariable=a[se](\"select\").value?\"_\":\"$\"}},{type:\"inline-textarea\",width:\"25%\",text:\"\",placeholder:\"Variable name\",model(e,a){const t=a[se](\"input\").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)&&(e.innerVariable+=t)}},{type:\"datavalue-inner\",text:\"<div class='harlowe-4-datavalueRowHint'>The above variable's value and the value below are added together. NOTE: if the values aren't the same type of data, an error will result.</div>\",model(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`${a.innerVariable} + ${t}`)},renumber(e){(e||{}).textContent=\"\"},modelRegistry:a}]],[],[\"coded expression\",{type:\"expression-textarea\",width:\"90%\",text:\"<div>Write a Harlowe code expression that should be computed to produce the desired value.</div>\",placeholder:\"Code\",modelCallback:e,modelRegistry:a}]]});K.Panel=(...e)=>()=>{if(!e.length)return;const a=[],t=[];function output(){return Object.entries(this.changers).map((([e,a])=>`(${e}:${a.join(\",\")})`)).join(\"+\")}function changerNamed(e){return this.changers[e]||=[]}const model=e=>a.reduce(((e,a)=>a(e)||e),{changers:{},wrapStart:\"[\",wrapEnd:\"]\",wrapStringify:!1,innerText:void 0,valid:!1,output,changerNamed,initiator:e});function update({target:e}={}){const a=model(e);t.forEach((e=>e(a)))}const r=oe(`<div class=\"harlowe-4-toolbarPanel${Q?\"\":\" card floating\"}\" style=\"transition:max-height 0.8s;overflow-y:auto\">`),makeColourPicker=e=>{const makeSwatchRow=(e,a,t)=>oe(`<span class=harlowe-4-swatchRow data-index=\"${a}\" ${t?\"\":'style=\"display:none\"'}>${e.map((e=>`<span class=harlowe-4-swatch style=\"background-color:${e}\"></span>`)).join(\"\")}</span>`),a=oe(`<div class=harlowe-4-singleColourPicker><input style=\"width:48px;margin-right:8px\" type=color value=\"${e}\"></div>`),t=oe(`<span class=\"text-select-control\"><select ${Q?\"\":'style=\"max-width: 9em;\"'}><option value=\"\" selected>Harlowe built-ins</option></select></span>`),r=t[se](\"select\");return a.append(makeSwatchRow(Object.keys(ee),\"\",!0)),he.forEach(((e,t)=>{a.append(makeSwatchRow(e,t)),r?.append(oe(`<option value=${t}>OpenColor ${t}</option>`))})),r?.[le](\"change\",(()=>{a[ie](\"[data-index]\").forEach((e=>e.style.display=\"none\")),a[se](`[data-index=\"${r.value}\"]`).style.display=\"inline-block\"})),a.append(t,oe(\"<br>\"),new Text(\"Opacity: \"),oe('<input type=range style=\"width:64px;top:8px;position:relative\" value=1 min=0 max=1 step=0.05>')),a[le](\"click\",(({target:e})=>{if(e instanceof HTMLElement&&e.classList.contains(\"harlowe-4-swatch\")){const t=a[se](\"input\");t&&(t.value=e?.getAttribute(\"style\")?.slice(-7)||\"\",t.dispatchEvent(new Event(\"change\")))}})),a},o=e.reduce((function reducer(e,r){let o,n,s=\"\";const i=\"label\"===e.tagName.toLowerCase();if(Object.getPrototypeOf(r)!==Object.prototype?o=r:(({type:s}=r),n=s.startsWith(\"inline\")),s.endsWith(\"text\")&&(o=oe(`<${n?\"span\":\"div\"}>${r.text}</${n?\"span\":\"div\"}>`)),\"notice\"===s&&(o=oe(`<small style=\"display:block\">${r.text}</small>`)),\"buttons\"===s&&e.append(...r.buttons.map((e=>{if(\"tagName\"in e)return e;const a=oe(`<button title=\"${e.title}\" class=\"${ae()}${e.active?\" active\":\"\"}${e.danger?\" variant-danger\":\"\"}\">${e.html}</button>`);return e.onClick&&a[le](\"click\",e.onClick),e.update&&t.push((t=>e.update(t,a))),a}))),s.endsWith(\"preview\")){const e=r.tagName||\"span\";if(o=oe(`<div class=\"harlowe-4-stylePreview\" style=\"${s.startsWith(\"t8n\")?\"cursor:pointer;height: 2.6rem;\":\"\"}\" ${s.startsWith(\"t8n\")?'alt=\"Click to preview the transition\"':\"\"}><${e}>${r.text||\"\"}</${e}>${s.startsWith(\"t8n\")?`<${e}>${r.text2}</${e}>`:\"\"}</div>`),s.startsWith(\"t8n\")){o[le](\"mouseup\",update),o[le](\"touchend\",update);const e=o[se](\":first-child\");e[le](\"animationend\",(()=>e.style.visibility=\"hidden\"))}}if((s.endsWith(\"checkbox\")||s.endsWith(\"checkboxrow\"))&&(o=oe(`<label${n?\"\":' style=\"display:block\"'} class=\"harlowe-4-checkboxRow\"><input type=\"checkbox\" ${r.persist?\"data-persist\":\"\"}></input>${r.text}</label>`),s.endsWith(\"w\")&&(r.subrow.reduce(reducer,o),r.subrow.forEach((a=>{const{model:t}=a;a.model=(a,r)=>!o[se](\":scope > input:checked\")||i&&!e[se](\":scope > input:checked\")?a:t(a,r)}))),o[le](\"change\",update)),\"checkboxes\"===s&&(o=oe(`<div class=\"harlowe-4-toolbarCheckboxes\" ${!1===r.bottomBorder?' style=\"border:none\"':\"\"}><div${r.bold?' style=\"font-weight:bold\"':\"\"}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=oe(`<label${r.capitalise?' style=\"text-transform:capitalize;\"':\"\"} class=\"${ae()}\"><input type=\"checkbox\" ${r.persist?\"data-persist\":\"\"} ${r.checked?.(a)?\"checked\":\"\"}></input>${e}</label>`);t[le](\"change\",update),o.append(t)}))),\"radios\"===s&&(o=oe(`<div class=\"harlowe-4-toolbarCheckboxes\"><div${r.bold?' style=\"font-weight:bold\"':\"\"}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=oe(`<label${r.capitalise?' style=\"text-transform:capitalize;\"':\"\"} class=\"${ae()}\"><input type=\"radio\" name=\"${r.name}\" value=\"${e}\" ${a?\"\":\"checked\"} ${r.persist?\"data-persist\":\"\"}></input>${e}</label>`);t[le](\"change\",update),o.append(t)}))),s.endsWith(\"textarea\")){let e=\"text\";const a=r.multiline?\"textarea\":\"input\";s.endsWith(\"expression-textarea\")&&(r.update=(e,t)=>{!e.expression&&t[se](a).value?t.setAttribute(\"invalid\",\"This doesn't seem to be valid code.\"):t.removeAttribute(\"invalid\")},r.model=(e,t)=>{const o=(t[se](a).value||\"\").trim();if(o){if(J(o,\"\",\"macro\").children.every((function recur(e){return\"text\"!==e.type&&\"error\"!==e.type&&(\"string\"===e.type||\"hook\"===e.type||e.children.every(recur))})))return void r.modelCallback(e,o);e.valid=!0}}),s.endsWith(\"string-textarea\")&&(r.model||=(e,t)=>{r.modelCallback(e,JSON.stringify(t[se](a).value||\"\"))}),s.endsWith(\"number-textarea\")&&(e=\"number\",r.model||=(e,t)=>{r.modelCallback(e,+t[se](a).value||0)}),o=oe(`<${n?\"span\":\"div\"} class=\"harlowe-4-labeledInput\">${r.text}<${a} ${r.useSelection?\"data-use-selection\":\"\"}${s.includes(\"passage\")?'list=\"harlowe-4-passages\"':\"\"} style=\"width:${r.width};${r.multiline?`max-width:${r.width};`:\"\"}padding:var(--grid-size);margin${n?\":2px 0.5rem 0 0.5rem\":\"-left:1rem\"};${r.multiline&&n?\"display:inline-block;height:40px\":\"\"}\" type=${e} ${r.persist?\"data-persist\":\"\"} placeholder=\"${r.placeholder||\"\"}\"></${a}></${n?\"span\":\"div\"}>`),o[se](a)[le](\"input\",update)}if((s.endsWith(\"number\")||s.endsWith(\"range\"))&&(o=oe(`<${n?\"span\":\"div\"} class=\"harlowe-4-labeledInput\">${r.text}<input style=\"padding:var(--grid-size);${r.width?`width:${r.width}`:\"\"}\" type=${s.endsWith(\"range\")?\"range\":\"number\"} min=${r.min} max=${r.max} value=${r.value}${r.step?` step=${r.step}`:\"\"}></input></${n?\"span\":\"div\"}>`),o[se](\"input\")[le](s.endsWith(\"range\")?\"input\":\"change\",update)),s.endsWith(\"colour\")){o=oe(`<${n?\"span\":\"div\"} class=\"harlowe-4-labeledInput\">${r.text}</${n?\"span\":\"div\"}>`);const e=makeColourPicker(r.value);o.append(e),o[ie](\"input\").forEach((e=>e[le](\"change\",update)))}if(s.endsWith(\"gradient\")){o=oe(`<div style='position:relative'><span class=harlowe-4-gradientBar></span><button class=\"${ae()}\">${ne(\"plus\")} Colour</button></div>`);const e=o[se](\".harlowe-4-gradientBar\"),createColourStop=(a,t,r)=>{const o=oe(`<div ${r?\"selected\":\"\"} data-colour=\"${t}\" data-pos=\"${a}\" class=harlowe-4-colourStop style=\"left:calc(${100*a}% - 8px); top:-8px\"><div class=harlowe-4-colourStopButtons style=\"left:${-(Q?464:384)*a-(Q?0:40)}px\"></div></div>`),n=makeColourPicker(t);n[ie](\"input\").forEach((e=>e[le](\"change\",(()=>{const e=n[se](\"input[type=range]\").value,a=n[se](\"[type=color]\").value;o.setAttribute(\"data-colour\",re(a,e)),+e<1&&o.setAttribute(\"data-harlowe-colour\",te(a,e)),update()}))));const s=oe(`<button class=\"${ae()}\" style='float:right'>${ne(\"times\")} Delete</button>`);s[le](\"click\",(()=>{o.remove(),update()})),n.append(s),o.firstElementChild?.prepend(n),e.append(o),update()};setTimeout((()=>{createColourStop(0,\"#ffffff\"),createColourStop(.5,\"#000000\",!0),createColourStop(1,\"#ffffff\")})),o[se](\"button\")[le](\"click\",(()=>createColourStop(.5,\"#888888\")));const listener=({target:a})=>{if(a.classList.contains(\"harlowe-4-colourStop\")){const t=document.documentElement,{left:r,right:o}=e.getBoundingClientRect(),n=o-r,onMouseMove=e=>{let t=\"pageX\"in e?e.pageX:e.touches[0].pageX;if(void 0===t)return;const o=Math.min(1,Math.max(0,(t-window.scrollX-r)/n));a.style.left=`calc(${100*o}% - 8px)`,a.firstChild.style.left=-(Q?464:384)*o-(Q?0:40)+\"px\",a.setAttribute(\"data-pos\",o),update()},onMouseUp=()=>{t[ce](\"mousemove\",onMouseMove),t[ce](\"mouseup\",onMouseUp),t[ce](\"touchmove\",onMouseMove),t[ce](\"touchend\",onMouseUp)};t[le](\"mousemove\",onMouseMove),t[le](\"mouseup\",onMouseUp),t[le](\"touchmove\",onMouseMove),t[le](\"touchend\",onMouseUp),Array.from(e[ie](\"[selected]\")).forEach((e=>e.removeAttribute(\"selected\"))),a.setAttribute(\"selected\",!0)}};o[le](\"mousedown\",listener),o[le](\"touchstart\",listener),t.push((()=>{e.style.background=`linear-gradient(to right, ${Array.from(e[ie](\".harlowe-4-colourStop\")).sort(((e,a)=>(+e.getAttribute(\"data-pos\")||0)-(+a.getAttribute(\"data-pos\")||0))).map((e=>`${e.getAttribute(\"data-colour\")} ${100*(+e.getAttribute(\"data-pos\")||0)}%`))})`}))}if(s.endsWith(\"dropdown\")){const e=oe(`<${n?\"span\":\"div\"} style=\"white-space:nowrap;${n?\"\":\"width:50%;\"}position:relative;\">${r.text}<span class=\"text-select-control\"><select style=\"${n?\"margin:0.5rem;\":\"margin-left:1rem;\"}font-size:0.9rem;margin-top:4px\" ${r.persist?\"data-persist\":\"\"}></select></span></${n?\"span\":\"div\"}>`);r.options.forEach(((a,t)=>{e[se](\"select\")?.append(oe(`<option value=\"${t?a:\"\"}\"${a?t?\"\":\" selected\":\" disabled\"}>${a||\"───────\"}</select>`))})),e[se](\"select\")?.[le](\"change\",update),o=e}if(\"radiorows\"===s&&(o=oe(\"<div>\"),r.options.forEach(((a,t)=>{const n=oe(`<label class='harlowe-4-radioRow'><input type=\"radio\" name=\"${r.name}\" value=\"${t||\"none\"}\" ${t?\"\":\"checked\"}></input></label>`);o.append(a.reduce(reducer,n)),a.forEach((a=>{const{model:t}=a;t&&(a.model=(a,r)=>!n[se](\":scope > input:checked\")||i&&!e[se](\":scope > input:checked\")?a:t(a,r))})),n[se](\"input\")?.[le](\"change\",update)}))),\"macro-list\"===s){o=oe('<div><div style=\"text-align:center\">Category: </div></div>');const e=oe(\"<span class='text-select-control'><select></span>\");o.firstChild.append(e);const a=e[se](\"select\"),t=oe('<div style=\"margin-top:8px;border-top:1px solid hsla(0,0%,50%,0.5);max-height:40vh;overflow-y:scroll\">');o.append(t),a?.[le](\"change\",(()=>{const e=t[se](`[name=\"${a.value}\"]`);e?.scrollIntoView()})),Object.values(X.ShortDefs.Macro).sort((({name:e,category:a,categoryOrder:t},{name:r,category:o,categoryOrder:n})=>a!==o?(a||\"\").localeCompare(o||\"\"):t!==n?isNaN(+t)?1:isNaN(+n)?-1:Math.sign(t-n):e.localeCompare(r))).forEach(((e,r,o)=>{if(0!==r&&e.category===o[r-1].category||(t.append(oe(`<h3 style=\"text-transform:capitalize\" name=\"${e.category}\">${e.category}</h3>`)),a?.append(oe(`<option value=\"${e.category}\">${e.category}</option>`))),r>0&&e.name===o[r-1].name)return;const n=oe(`<label class='harlowe-4-radioRow'><input type=\"radio\" name=\"macro-list\" value=\"${e.name}\"></input><code><a href=\"/twine/docs.html#${e.anchor}\" target=\"_blank\" rel=\"noopener noreferrer\">(${e.name}: ${e.sig}) → ${e.returnType}</a></code>${e.aka.length?`<div><i>Also known as: ${e.aka.map((e=>`<code>(${e}:)</code>`)).join(\", \")}</i>`:\"\"}</div><div>${e.abstract.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`))}</div></label>`);t.append(n),n[se](\"input\")?.[le](\"change\",update)}))}if(s.endsWith(\"dropdown-rows\")){o=oe(`<${n?\"span\":\"div\"}><span class=\"harlowe-4-dropdownRowLabel\">${r.text}</span><span class=\"text-select-control\"><select style=\"font-size:1rem;margin-top:4px;${r.width?`width:${r.width};text-overflow:ellipsis`:\"\"}\"></select></span><span class=\"harlowe-4-dropdownRows\"></span></${n?\"span\":\"div\"}>`);const a=o[se](\"select\");r.options.forEach((([t,...r],n)=>{if(!t)return void a.append(oe(\"<option disabled>───────</option>\"));a.append(oe(`<option value=\"${t}\" ${n?\"\":\"selected\"}>${t}<option>`));const s=oe(`<span data-value=\"${t}\" ${n?\"hidden\":\"\"}>`);o[se](\".harlowe-4-dropdownRows\").append(r.reduce(reducer,s)),r.forEach((r=>{const{model:o}=r;o&&(r.model=(r,n)=>a.value!==t||i&&!e[se](\":scope > input:checked\")?r:o(r,n))}))})),a[le](\"change\",(()=>{const e=a.value;o[ie](\":scope > .harlowe-4-dropdownRows > span\").forEach((a=>{a[(a.getAttribute(\"data-value\")===e?\"remove\":\"set\")+\"Attribute\"](\"hidden\",\"\")})),update()}))}if(\"textarea-rows\"===s){o=oe(`<div class=\"harlowe-4-textareaRows ${r.nonZeroRows?\"harlowe-4-nonZeroRows\":\"\"}\">`);const makeRow=()=>{if(o.childNodes.length>100)return;const e=oe(`<div class=\"harlowe-4-dataRow\"><input type=text style=\"width:80%;padding:var(--grid-size)\" placeholder=\"${r.placeholder}\"></input><button class=\"${ae()} harlowe-4-rowMinus\">${ne(\"minus\")}</button><button class=\"${ae()} harlowe-4-rowPlus\">${ne(\"plus\")}</button></div>`);e[se](\"input\")?.[le](\"input\",update),e[se](\".harlowe-4-rowPlus\")?.[le](\"click\",(()=>{makeRow(),update()})),e[se](\".harlowe-4-rowMinus\")?.[le](\"click\",(()=>{e.remove(),update()})),o.append(e)};makeRow()}if(\"datavalue-inner\"===s){o=oe(`<div class=\"harlowe-4-dataRow\" style='margin:0.2em 0px'>${r.text}</div>`);const e=[];let a=[];reducer(o,dataValueRow$1(((e,t)=>a.push(t)),e,!0));const t=r.model;r.model=r=>{a=[],e.reduce(((e,a)=>a(e)||e),r),t?.(r,a)},r.renumber(o[se](\":scope > * > .harlowe-4-dropdownRowLabel\"))}if(\"datavalue-rows\"===s||\"datavalue-map\"===s){o=oe(`<div class=\"harlowe-4-datavalueRows\">${r.text||\"\"}<div class=\"harlowe-4-dataEmptyRow\"><i>No data</i></div><button class=\"${ae()} harlowe-4-rowPlus\">${ne(\"plus\")} Value</button></div>`);const e=o[se](\".harlowe-4-rowPlus\"),a=new Set;let t=[];const renumber=()=>{Array.from(o[ie](\":scope > .harlowe-4-dataRow > * > .harlowe-4-dropdownRowLabel\")).forEach(r.renumber)},makeRow=()=>{if(o.childNodes.length>50)return;const r=oe('<div class=\"harlowe-4-dataRow\">'),n=[];o.insertBefore([...s.endsWith(\"map\")?[{type:\"inline-textarea\",text:\"\",placeholder:\"Data name\",width:\"15%\",model(e,a){t.push(Z(a[se](\"input\").value))},modelRegistry:n}]:[],dataValueRow$1(((e,a)=>t.push(a)),n,!0)].reduce(reducer,r),e),n.forEach((e=>a.add(e))),r.append(oe(`<button class=\"${ae()} harlowe-4-rowMinus\">${ne(\"minus\")}</button>`)),r[se](\":scope > .harlowe-4-rowMinus\")?.[le](\"click\",(()=>{r.remove(),n.forEach((e=>a.delete(e))),0===o.childNodes.length&&makeRow(),update(),renumber()}))},n=r.model;r.model=e=>{t=[],[...a].reduce(((e,a)=>a(e)||e),e),n?.(e,t)},e[le](\"click\",(()=>{makeRow(),update(),renumber()}))}if(\"scroll-wrapper\"===s&&(o=oe('<div class=\"harlowe-4-scrollWrapper\"></div>'),r.contents.reduce(reducer,o)),\"confirm\"===s){if(!Q){const a=oe('<div class=\"harlowe-4-scrollWrapper\"></div>');a.append(...e.childNodes),e.append(a)}const a=oe('<div class=\"harlowe-4-confirmButtons\" style=\"padding-bottom:8px;\"></div>'),r=oe(`<button class=\"${ae()}\">${ne(\"times\")} Cancel</button>`),n=oe(`<button class=\"${ae(!0)} create\">${ne(\"check\")} Add</button>`);n.setAttribute(\"style\",X.disabledButtonCSS),t.push((e=>{const a=e.valid?\"removeAttribute\":\"setAttribute\";n[a](\"style\",X.disabledButtonCSS),e.valid&&(\"function\"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),\"function\"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)))})),r[le](\"click\",K.switchPanel),n[le](\"click\",(()=>{const e=model();\"function\"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),\"function\"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)),K.wrapSelection(e.output()+e.wrapStart,e.wrapEnd,\"\",e.innerText,e.wrapStringify),K.switchPanel()})),a.append(r,n),o=a}if(i){const a=r.update;r.update=(t,r)=>{const o=e[se](\":scope > input:checked\");Array.from(e[ie](\"div,br ~ *\")).forEach((e=>e[(o?\"remove\":\"set\")+\"Attribute\"](\"hidden\",\"\"))),Array.from(e[ie](\"input,select\")).slice(1).forEach((e=>e[(o?\"remove\":\"set\")+\"Attribute\"](\"disabled\",\"\"))),a?.(t,r)}}return r.model&&(r.modelRegistry||a).push((e=>r.model(e,o))),r.update&&t.push((e=>r.update(e,o))),o&&e.append(o),e.onreset=update,e}),r);return e.splice(0,e.length),o},K.dataValueRow=dataValueRow$1;const{stringify:de,parse:me}=JSON,{round:pe}=Math;let ue,ge={},ye=X.getPrefs().tooltips;void 0===ye&&(ye=!0);const{Panel:be,dataValueRow:fe}=K,{twine23:we,toHarloweColour:ke,toCSSColour:ve,el:xe,fontIcon:Te,GCD:$e,fourDecimals:Ce}=X,Se=\"querySelector\",Ne=`${Se}All`,Ae=\"addEventListener\",Oe=xe('<div class=\"harloweToolbar\">'),twine2KeymapOverride=e=>{Oe[Se](\".harlowe-4-toolbarPanel\")&&\"Escape\"===e.key&&(switchPanel(),e.stopPropagation())};function wrapSelection(e,a,t,r,o){if(0===(e+a).length)return;const n=void 0!==r?r:ue.doc.getSelection()||t||\"Your Text Here\";ue.doc.replaceSelection(e+(o||String)(n)+a,\"around\")}function switchPanel(e=\"default\"){if(!we&&\"default\"===e)return void Oe[Ne](\".harlowe-4-toolbarPanel\").forEach((e=>e.remove()));Object.entries(ge).forEach((([a,t])=>{if(\"function\"==typeof t){if(a!==e)return;t=ge[a]=t()}t[Ne](\"[type=radio]:not([data-persist])\").forEach((e=>e.checked=e.parentNode?.parentNode?.[Se](\"label:first-of-type\")===e.parentNode)),t[Ne](\"[type=checkbox]:not([data-persist])\").forEach((e=>e.checked=e.hasAttribute(\"checked\"))),t[Ne](\"[type=text]:not([data-persist])\").forEach((e=>e.value=\"\")),t[Ne](\"select:not([data-persist])\").forEach((e=>{e.value=e.firstElementChild?.getAttribute(\"value\")||\"\";const{nextElementSibling:a}=e;a?.className.includes(\"harlowe-4-dropdownRows\")&&Array.from(a.children).forEach((a=>{a[(a.getAttribute(\"data-value\")===e.value?\"remove\":\"set\")+\"Attribute\"](\"hidden\",\"\")}))})),\"onreset\"in t&&\"function\"==typeof t.onreset&&t.onreset()}));let a=ge[e];if(!(a instanceof HTMLElement))return;const{height:t}=getComputedStyle(Oe);Oe[Ne](\".harlowe-4-toolbarPanel\").forEach((e=>e.remove())),we?(a.style.maxHeight=t,Oe[Ne](\"[data-use-selection]\").forEach((e=>e.value=ue.doc.getSelection())),setTimeout((()=>a.style.maxHeight=\"70vh\"),100)):a.classList.add(\"card-button-card\",\"card\",\"floating\"),Oe.append(a),Oe.parentNode?.addEventListener(\"keydown\",twine2KeymapOverride),document.addEventListener(\"keydown\",twine2KeymapOverride)}K.wrapSelection=wrapSelection,K.switchPanel=switchPanel;const _e={default:e=>e?\"appear step-end\":\"appear\",dissolve:()=>\"appear\",shudder:()=>\"shudder-in\",rumble:()=>\"rumble-in\",zoom:()=>\"zoom-in\",\"slide-left\":e=>e?\"slide-right\":\"slide-left\",\"slide-right\":e=>e?\"slide-left\":\"slide-right\",\"slide-up\":e=>e?\"slide-down\":\"slide-up\",\"slide-down\":e=>e?\"slide-up\":\"slide-down\",flicker:()=>\"flicker\",pulse:()=>\"pulse\",instant:e=>\"appear step-\"+(e?\"end\":\"start\"),\"fade-right\":e=>e?\"fade-left\":\"fade-right\",\"fade-left\":e=>e?\"fade-right\":\"fade-left\",\"fade-up\":e=>e?\"fade-down\":\"fade-up\",\"fade-down\":e=>e?\"fade-up\":\"fade-down\",blur:()=>\"blur\"},Pe=[\"default\",\"\",\"instant\",\"dissolve\",\"blur\",\"rumble\",\"shudder\",\"pulse\",\"zoom\",\"flicker\",\"slide-left\",\"slide-right\",\"slide-up\",\"slide-down\",\"fade-left\",\"fade-right\",\"fade-up\",\"fade-down\"],He={type:\"checkbox\",text:\"Affect the entire remainder of the passage or hook\",model(e,a){a[Se](\":checked\")&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},Le=\"A <b>hook</b> is a section of passage prose enclosed in <code>[</code> or <code>]</code>, or preceded with <code>[=</code>.\",Ie={type:\"confirm\"},doneRow=()=>{const e=xe(`<span style=\"${we?\"float:right;\":\"position:absolute;bottom:var(--grid-size);right:var(--grid-size);\"}\"><button class=\"variant-primary primary icon-button\">Done</button></span>`);return e?.firstChild?.[Ae](\"click\",(()=>{switchPanel(),ue.constructor.signal(ue,\"harlowe-4-findDone\")})),e};ge={textstyle:(()=>{const e={bold:\"font-weight:bold\",italic:\"font-style:italic\",underline:\"text-decoration: underline\",\"double-underline\":\"text-decoration: underline;text-decoration-style:double\",\"wavy-underline\":\"text-decoration: underline;text-decoration-style:wavy\",strike:\"text-decoration: line-through\",\"double-strike\":\"text-decoration: line-through;text-decoration-style:double\",\"wavy-strike\":\"text-decoration: line-through;text-decoration-style:wavy\",superscript:\"vertical-align:super;font-size:.83em\",subscript:\"vertical-align:sub;font-size:.83em\",mark:\"background-color: hsla(60, 100%, 50%, 0.6)\",outline:\"color:black; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px  1px 0 white, 1px  1px 0 white\",shadow:\"text-shadow: 0.08em 0.08em 0.08em white\",emboss:\"text-shadow: 0.04em 0.04em 0em white\",condense:\"letter-spacing:-0.08em\",expand:\"letter-spacing:0.1em\",blur:\"text-shadow: 0em 0em 0.08em white; color:transparent\",blurrier:\"text-shadow: 0em 0em 0.2em white; color:transparent\",smear:\"text-shadow: 0em 0em 0.02em white, -0.2em 0em 0.5em white, 0.2em 0em 0.5em white; color:transparent\",mirror:\"display:inline-block;transform:scaleX(-1)\",\"upside-down\":\"display:inline-block;transform:scaleY(-1)\",tall:\"display:inline-block;transform:scaleY(1.5) translateY(-0.25ex)\",flat:\"display:inline-block;transform:scaleY(0.5) translateY(0.25ex)\",blink:\"animation:harlowe-4-fade-in-out 1s steps(1,end) infinite alternate\",\"fade-in-out\":\"animation:harlowe-4-fade-in-out 2s ease-in-out infinite alternate\",rumble:\"display:inline-block;animation:harlowe-4-rumble linear 0.1s 0s infinite\",shudder:\"display:inline-block;animation:harlowe-4-shudder linear 0.1s 0s infinite\",sway:\"display:inline-block;animation:harlowe-4-sway 5s linear 0s infinite\",buoy:\"display:inline-block;animation:harlowe-4-buoy 5s linear 0s infinite\",fidget:\"display:inline-block;animation:harlowe-4-fidget 60s linear 0s infinite\"};function model(e,a){const t=Array.from(a[Ne](\"[type=radio]:checked\")).map((e=>e.value)).filter((e=>\"none\"!==e)).concat(Array.from(a[Ne](\"[type=checkbox]:checked\")).map((e=>e?.parentNode?.textContent||\"\")));e.changerNamed(\"text-style\").push(...t.map((e=>de(e)))),e.valid||=t.length>0}return be({type:\"preview\",text:\"Example text preview\",update(a,t){t.firstChild.setAttribute(\"style\",`position:relative;${a.changers[\"text-style\"].map((a=>e[me(a)])).join(\";\")}`)}},{type:\"small\",text:\"This preview doesn't account for other modifications to this passage's text colour, font, or background, and is meant only for you to examine each of these styles.\"},{type:\"checkboxes\",name:\"Font variants\",capitalise:!0,bold:!0,options:[\"bold\",\"italic\",\"mark\"],model},{type:\"radios\",name:\"Underlines and strikes\",capitalise:!0,bold:!0,options:[\"none\",\"underline\",\"double-underline\",\"wavy-underline\",\"strike\",\"double-strike\",\"wavy-strike\"],model},{type:\"radios\",name:\"Superscript and subscript\",capitalise:!0,bold:!0,options:[\"none\",\"superscript\",\"subscript\"],model},{type:\"radios\",name:\"Outlines\",capitalise:!0,bold:!0,options:[\"none\",\"outline\",\"shadow\",\"emboss\",\"blur\",\"blurrier\",\"smear\"],model},{type:\"radios\",name:\"Letter spacing\",capitalise:!0,bold:!0,options:[\"none\",\"condense\",\"expand\"],model},{type:\"radios\",name:\"Flips and stretches\",capitalise:!0,bold:!0,options:[\"none\",\"mirror\",\"upside-down\",\"tall\",\"flat\"],model},{type:\"radios\",name:\"Animations\",capitalise:!0,bold:!0,options:[\"none\",\"blink\",\"fade-in-out\",\"rumble\",\"shudder\",\"sway\",\"buoy\",\"fidget\"],model},He,Ie)})(),borders:(()=>{function dropdownControls(e,a){return[xe(`<div><b>${e}</b></div>`),{type:\"inline-dropdown\",text:\"Style:\",options:[\"none\",\"\",\"dotted\",\"dashed\",\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\"],model(e,t){const r=t[Se](\"select\").value;e.changerNamed(\"b4r\").push(de(r||\"none\")),(e.borderEnabled||=[])[a]=!!r}},{type:\"inline-number\",text:\"Size:\",value:1,min:.1,max:20,step:.1,model(e,a){e.changerNamed(\"b4r-size\").push(a[Se](\"input\").value)}},{type:\"inline-colour\",text:\"Colour:\",value:\"#ffffff\",update(e,t){t.setAttribute(\"style\",e.borderEnabled[a]?\"\":\"display:none\")},model(e,a){const t=a[Se](\"[type=color]\").value,r=a[Se](\"[type=range]\").value;e.changerNamed(\"b4r-colour\").push(ke(t,r)),e.borderColours=(e.borderColours||[]).concat(ve(t,r))}}]}return be({type:\"preview\",text:\"Example border preview\",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute(\"style\",`border-style:${t.b4r?`${t.b4r.map(me).join(\" \")};`:\"\"}${t[\"b4r-size\"]?`border-width:${t[\"b4r-size\"].reduce(((e,a)=>`${e} ${2*a}px`),\"\")};`:\"\"}${t[\"b4r-colour\"]?`border-color:${e.borderColours.join(\" \")};`:\"\"}`)}},...dropdownControls(\"Top\",0),...dropdownControls(\"Right\",1),...dropdownControls(\"Bottom\",2),...dropdownControls(\"Left\",3),{type:\"radios\",name:\"Affect:\",options:[\"The attached hook\",\"The remainder of the passage or hook.\",\"The entire passage.\"],model(e,a){const t=a[Se](\"input:checked\"),r=Array.from(a[Ne](\"label\")).indexOf(t.parentNode);r>=2&&Object.keys(e.changers).length?(e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},{type:\"confirm\",model(e){e.valid=!0;const a=e.suppressedChangers||e.changers;[[\"b4r\",e=>\"none\"===me(e)],[\"b4r-size\",e=>1==+e],[\"b4r-colour\",e=>\"transparent\"===e]].forEach((([t,r])=>{a[t]=function reduce4ValueProp(e){return 4===e.length&&e[3]===e[1]&&e.pop(),3===e.length&&e[2]===e[0]&&e.pop(),2===e.length&&e[1]===e[0]&&e.pop(),e}(a[t]),a[t].every(r)&&(delete a[t],\"b4r\"===t&&(e.valid=!1))})),e.valid&&e.suppressedChangers&&(e.wrapStart=`(enchant:?passage,${Object.entries(a).map((([e,a])=>`(${e}:${a.join(\",\")})`)).join(\"+\")})`,e.wrapEnd=\"\")}})})(),textcolor:be({type:\"preview\",text:\"Example text preview\",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute(\"style\",`${t[\"text-colour\"]?`color:${e.textColour};`:\"\"}${e.stops?`background:linear-gradient(${e.angle}deg, ${e.stops.map((e=>`${e.getAttribute(\"data-colour\")} ${100*e.getAttribute(\"data-pos\")}%`))})`:t.bg?`background:${e.backgroundColour}`:\"\"}`)}},{type:\"small\",text:\"This preview doesn't account for other modifications to this passage's text colour or background, and is meant only for you to examine the selected colours.\"},xe(\"<div><b>Text colour</b></div>\"),{type:\"radiorows\",name:\"txtcolor\",options:[[{type:\"inline-text\",text:\"Default text colour\"}],[new Text(\"Flat colour\"),{type:\"colour\",text:\"\",value:\"#ffffff\",model(e,a){const t=a[Se](\"[type=color]\").value,r=a[Se](\"[type=range]\").value;e.changerNamed(\"text-colour\").push(ke(t,r)),e.textColour=ve(t,r)}}]]},xe(\"<div><b>Background</b></div>\"),{type:\"radiorows\",name:\"bgcolor\",options:[[{type:\"inline-text\",text:\"Default background\",model(e){e.valid=!0}}],[new Text(\"Flat colour\"),{type:\"colour\",text:\"\",value:\"#000000\",model(e,a){const t=a[Se](\"[type=color]\").value,r=a[Se](\"[type=range]\").value;e.changerNamed(\"bg\").push(ke(t,r)),e.backgroundColour=ve(t,r),e.valid=!0}}],[new Text(\"Linear gradient\"),{type:\"gradient\",model(e,a){const t=Array.from(a[Ne](\".harlowe-4-colourStop\")).sort(((e,a)=>Number(e.getAttribute(\"data-pos\"))-Number(a.getAttribute(\"data-pos\"))));t.length>1&&(e.valid=!0,e.changerNamed(\"bg\").push(`(gradient: $deg, ${t.map((e=>`${Ce(e.getAttribute(\"data-pos\"))},${e.getAttribute(\"data-harlowe-colour\")||e.getAttribute(\"data-colour\")}`))})`),e.stops=t,e.angle=0)}},xe(`<br style=\"height:${we?1:4}rem\">`),{type:\"inline-range\",text:\"Angle (deg):\",value:0,min:0,max:359,step:1,model(e,a){if(e.valid){const t=e.changerNamed(\"bg\");e.angle=+a[Se](\"input\").value,t[0]=t[0].replace(\"$deg\",e.angle)}}}]]},{type:\"radios\",name:\"Affect:\",options:[\"The attached hook\",\"The remainder of the passage or hook.\",\"The entire passage.\",\"The entire page.\"],model(e,a){const t=a[Se](\"input:checked\"),r=Array.from(a[Ne](\"label\")).indexOf(t.parentNode),o=Object.entries(e.changers);r>=2&&o.length?(e.wrapStart=`(enchant:?pa${2===r?\"ssa\":\"\"}ge,${o.map((([e,a])=>`(${e}:${a.join(\",\")})`)).join(\"+\")})`,e.wrapEnd=\"\",e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},Ie),passagelink:(()=>{const passageT8nPreviews=()=>[xe(\"<br>\"),{type:\"inline-dropdown\",text:\"Departing transition: \",options:Pe,model(e,a){const{value:t}=a[Se](\"select\");\"\"!==t&&e.changerNamed(\"t8n-depart\").push(de(t))}},{type:\"inline-dropdown\",text:\"Arriving transition: \",options:Pe,model(e,a){const{value:t}=a[Se](\"select\");\"\"!==t&&e.changerNamed(\"t8n-arrive\").push(de(t))}},xe(\"<br>\"),{type:\"inline-number\",text:\"Transition time (sec): \",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[Se](\"input\").value;.8!=+t&&e.changerNamed(\"t8n-time\").push(`${t}s`)}},{type:\"t8n-preview\",text:\"Departing Text\",text2:\"Arriving Text\",update(e,a){if(e.initiator&&![\"select\",\"div\",\"span\"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${_e[e.changers[\"t8n-depart\"]?me(e.changers[\"t8n-depart\"][0]):\"default\"](!0)}`,r=`harlowe-4-${_e[e.changers[\"t8n-arrive\"]?me(e.changers[\"t8n-arrive\"][0]):\"default\"](!1)}`,o=e.changers[\"t8n-time\"]?e.changers[\"t8n-time\"][0]:\"0.8s\",n=a.firstChild,s=a.lastChild;n.setAttribute(\"style\",`animation:${t} reverse ${o} 1;`),s.setAttribute(\"style\",`animation:${r} ${o} 1;`),n.remove(),s.remove(),setTimeout((()=>a.append(n,s)))}}];return be({type:\"radiorows\",name:\"whichclick\",options:[[{type:\"inline-textarea\",text:\"Create a hyperlink, with this text:\",placeholder:\"Link text (can't be empty)\",useSelection:!0,width:\"50%\",model(e,a){const t=a[Se](\"input\").value;t.length>0&&(e.linkText=t,e.valid=!0)}}],[{type:\"inline-text\",text:\"Allow the entire page to be clicked.\",model(e){e.changerNamed(\"click\").push(\"?page\"),e.clickPage=!0,e.valid=!0}},{type:\"text\",text:\"This will place a faint blue border around the edges of the page, and change the mouse cursor to the hand pointer, until it is clicked.\"}]]},{type:\"text\",text:\"<b>When it is clicked, perform this action:</b>\"},{type:\"radiorows\",name:\"passagelink\",update(e,a){a.lastChild.firstChild[(e.clickPage?\"set\":\"remove\")+\"Attribute\"](\"disabled\",\"\"),e.clickPage&&a.lastChild.firstChild.checked&&a.firstChild.firstChild.click()},options:[[{type:\"inline-passage-textarea\",text:\"Go to this passage:\",width:\"70%\",placeholder:\"Passage name\",model(e,a){const t=a[Se](\"input\").value;t.length||(e.valid=!1),\"click\"in e.changers?(delete e.changers.click,e.wrapStart=`(click-goto:?page,${de(t)})`,e.wrapEnd=\"\"):[\"]]\",\"->\",\"<-\"].some((a=>t.includes(a)||e.linkText&&e.linkText.includes(a)))?(e.wrapStart=`(link-goto:${de(e.linkText)},`,e.wrapEnd=`${de(t)})`):(e.wrapStart=`[[${e.linkText}`,e.wrapEnd=`->${t}]]`),e.innerText=\"\"}},...passageT8nPreviews()],[{type:\"inline-text\",text:\"Undo the current turn, returning to the previous passage.\",model(e){\"click\"in e.changers?(e.wrapStart=`(click-undo:${e.changers.click})`,e.wrapEnd=\"\",delete e.changers.click):(e.changerNamed(\"link-undo\").push(de(e.linkText)),e.wrapStart=\"\",e.wrapEnd=\"\")}},...passageT8nPreviews()],[{type:\"inline-dropdown\",text:\"Reveal \",options:[\"an attached hook.\",\"the remainder of the passage.\"],model(e,a){a[Se](\"select\").value&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},xe(\"<br>\"),{type:\"text\",text:`(${Le})`},{type:\"inline-dropdown\",text:\"Revealed text transition: \",options:Pe,model(e,a){const{value:t}=a[Se](\"select\");\"\"!==t&&e.changerNamed(\"t8n\").push(de(t))}},{type:\"inline-number\",text:\"Transition time (sec): \",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[Se](\"input\").value;.8!=+t&&e.changerNamed(\"t8n-time\").push(`${t}s`)}},{type:\"t8n-preview\",text2:\"Revealed Text\",update(e,a){if(e.initiator&&![\"select\",\"div\",\"span\"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${_e[e.changers.t8n?me(e.changers.t8n[0]):\"default\"](!1)}`,r=e.changers[\"t8n-time\"]?e.changers[\"t8n-time\"][0]:\"0.8s\",o=a.lastChild;o.setAttribute(\"style\",`animation:${t} ${r} 1;`),o.remove(),setTimeout((()=>a.append(o)))}},{type:\"radiorows\",name:\"linkReveal\",update(e,a){a[Ne](\"input\").forEach((a=>a[(e.clickPage?\"set\":\"remove\")+\"Attribute\"](\"disabled\",\"\")))},options:[[{type:\"inline-text\",text:\"Then remove the link's own text.\",model(e){e.clickPage||e.changerNamed(\"link\").push(de(e.linkText))}}],[{type:\"inline-text\",text:\"Then unlink the link's own text.\",model(e){e.clickPage||e.changerNamed(\"link-reveal\").push(de(e.linkText))}}],[{type:\"inline-text\",text:\"Re-run the hook each time the link is clicked.\",model(e){e.clickPage||e.changerNamed(\"link-rerun\").push(de(e.linkText))}}],[{type:\"inline-text\",text:\"Repeat the hook each time the link is clicked.\",model(e){e.clickPage||e.changerNamed(\"link-repeat\").push(de(e.linkText))}}]]}],[{type:\"inline-text\",text:\"Cycle the link's text to the next alternative in a list.\"},xe(\"<br>\"),{type:\"textarea-rows\",nonZeroRows:!0,placeholder:\"Link text (can't be empty)\",model(e,a){const t=[e.linkText].concat(Array.from(a[Ne](\"input\")).map((e=>e.value)));!e.clickPage&&t.every(Boolean)?(e.wrapStart=`(cycling-link:${t.map((e=>JSON.stringify(e)))})`,e.wrapEnd=\"\",e.innerText=\"\"):a.parentNode.firstChild.checked&&(e.valid=!1)}},{type:\"radios\",name:\"Upon reaching the end:\",options:[\"Loop to the start.\",\"Remove the link.\",\"Unlink the link.\"],model(e,a){if(!e.valid)return;const{value:t}=a[Se](\"[type=radio]:checked\");\"U\"===t[0]?e.wrapStart=e.wrapStart.replace(/^\\(cycling/,\"(seq\"):\"R\"===t[0]&&(e.wrapStart=e.wrapStart.replace(/\\)$/,',\"\")'))}}]]},Ie)})(),if:be({type:\"text\",text:\"<b>Only show a section of the passage if this condition is met:</b>\"},{type:\"radiorows\",name:\"if\",options:[[{type:\"inline-dropdown\",text:\"The player visited this passage\",options:[\"exactly\",\"at most\",\"at least\",\"anything but\",\"a multiple of\"],model(e,a){e.changerNamed(\"if\").push(`visits${{\"\":\" is \",\"at most\":\" <= \",\"at least\":\" >= \",\"anything but\":\" is not \",\"a multiple of\":\" % \"}[a[Se](\"select\").value]}`)}},{type:\"inline-number\",text:\"\",value:0,min:0,max:999,model(e,a){const t=e.changerNamed(\"if\");t[0]+=a[Se](\"input\").value,t[0].includes(\" % \")&&(t[0]+=\" is 0\",t[0]=t[0].replace(\" % 2 is 0\",\" is an even\")),e.valid=!0}},new Text(\" times.\")],[{type:\"inline-dropdown\",text:\"The player has now visited this passage an\",options:[\"even\",\"odd\"],model(e,a){e.changerNamed(\"if\").push({\"\":\"visits is an even\",odd:\"visits is an odd\"}[a[Se](\"select\").value]),e.valid=!0}},new Text(\" number of times.\")],[{type:\"inline-number\",text:\"\",value:2,min:1,max:999,model(e,a){e.changerNamed(\"after\").push(`${a[Se](\"input\").value}s`),e.valid=!0}},new Text(\" seconds have passed since this passage was entered.\")],[{type:\"inline-textarea\",width:\"20%\",text:\"The passage \",placeholder:\"Passage name\",model(e,a){const t=a[Se](\"input\").value;t&&(e.changerNamed(\"if\").push(`(history: where its name contains ${de(t)})'s length`),e.valid=!0)}},{type:\"inline-dropdown\",text:\"was visited \",options:[\"exactly\",\"at most\",\"at least\",\"anything but\",\"a multiple of\"],model(e,a){e.changerNamed(\"if\")[0]+={\"\":\" is \",\"at most\":\" <= \",\"at least\":\" >= \",\"anything but\":\" is not \",\"a multiple of\":\" % \"}[a[Se](\"select\").value]}},{type:\"inline-number\",text:\"\",value:1,min:1,max:999,model(e,a){const t=e.changerNamed(\"if\");t[0]+=a[Se](\"input\").value,t[0].includes(\" % \")&&(t[0]+=\" is 0\",t[0]=t[0].replace(\" % 2 is 0\",\" is even\"))}},new Text(\" times.\")],[{type:\"inline-textarea\",width:\"15%\",text:\"Passages tagged \",placeholder:\"Tag name\",model(e,a){const t=a[Se](\"input\").value;t&&(e.changerNamed(\"if\").push(`(history: where (passage:it)'s tags contains ${de(t)})'s length`),e.valid=!0)}},{type:\"inline-dropdown\",text:\"were visited \",options:[\"exactly\",\"at most\",\"at least\",\"anything but\",\"a multiple of\"],model(e,a){const t=a[Se](\"select\").value;e.changerNamed(\"if\")[0]+={\"\":\" is \",\"at most\":\" <= \",\"at least\":\" >= \",\"anything but\":\" is not \",\"a multiple of\":\" % \"}[t]}},{type:\"inline-number\",text:\"\",value:1,min:1,max:999,model(e,a){const t=e.changerNamed(\"if\");t[0]+=a[Se](\"input\").value,t[0].includes(\" % \")&&(t[0]+=\" is 0\",t[0]=t[0].replace(\" % 2 is 0\",\" is even\"))}},new Text(\" times.\")],[{type:\"inline-text\",text:\"There are no more interactable elements in the passage.\",model(e){e.changerNamed(\"more\"),e.valid=!0}},{type:\"text\",text:\"Interactable elements are link, mouseover, or mouseout areas. If you're using links that reveal additional lines of prose and then remove or unlink themselves, this will reveal the attached text when all of those are gone.\"}],[{type:\"inline-dropdown\",text:\"The variable \",options:[\"$\",\"_\"],model(e,a){e.variable=a[Se](\"select\").value?\"_\":\"$\"}},{type:\"inline-textarea\",width:\"25%\",text:\"\",placeholder:\"Variable name\",model(e,a){const t=a[Se](\"input\").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)&&(e.variable+=t)}},{type:\"inline-dropdown\",text:\"\",options:[\"is\",\"is not\",\"is greater than\",\"is less than\",\"contains\",\"is in\"],model(e,a){const t=a[Se](\"select\").value;e.operator={\"is greater than\":\">\",\"is less than\":\"<\",\"\":\"is\"}[t]||t}},new Text(\"a value.\"),xe(\"<br>\"),fe(),{type:\"text\",text:\"\",model(e){void 0!==e.expression&&\"\"!==e.expression&&e.operator&&e.variable&&!e.invalidSubrow&&(e.changerNamed(\"if\").push(`${e.variable} ${e.operator} ${e.expression}`),e.valid=!0)}}]]},{type:\"checkbox\",text:\"Also, only if the previous (if:), (else-if:) or (unless:) hook's condition wasn't fulfilled.\",model(e,a){a[Se](\":checked\")&&(\"if\"in e.changers?(e.changerNamed(\"else-if\").push(...e.changerNamed(\"if\")),delete e.changers.if):e.changerNamed(\"else\"))}},He,Ie),hook:be({type:\"text\",text:`${Le} The main purpose of hooks is that they can be visually or textually altered by special data values called <b>changers</b>. Changers are usually placed in front of hooks to change them.`,model(e){e.wrapStart=\"[\",e.wrapEnd=\"]\",e.valid=!0}},{type:\"textarea\",width:\"25%\",text:\"Hook name (letters, numbers and underscores only):\",placeholder:\"Hook name\",model(e,a){const t=a[Se](\"input\").value;t&&(RegExp(`^${M.validPropertyName}$`).exec(t)?(e.wrapStart=`|${t}>[`,e.hookName=t):e.valid=!1)}},{type:\"text\",text:\"\",update(e,a){const t=(e.hookName||\"\").toLowerCase();t?[\"link\",\"page\",\"passage\",\"sidebar\"].includes(t)?a.innerHTML=`The hook name <b><code>?${t}</code></b> is <b>reserved</b> by Harlowe. It refers to <b>${\"link\"===t?\"all of the links in the passage\":\"page\"===t?\"the entire HTML page\":\"passage\"===t?\"the element that contains the current passage's text\":\"sidebar\"===t?\"the passage's sidebar, containing the undo/redo icons\":\"unknown\"}</b>.`:a.innerHTML=`You can refer to this hook (and every other one with this name) using the code <b><code>?${t}</code></b>.`:a.innerHTML=\"Hook names are optional, but giving a hook a nametag allows it to be remotely altered using macros like <code>(click:)</code>, <code>(replace:)</code>, or <code>(enchant:)</code>. You can use these macros elsewhere in the passage, keeping your prose uncluttered.\"}},Ie),align:be({type:\"preview\",text:\"You can apply left, center and right alignment to your passage text, as well as adjust the margins and width.\",update(e,a){a.setAttribute(\"style\",\"width:100%;height:6em;overflow-y:hidden;\");let t=`width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`;\"center\"!==e.align&&(t+=`text-align:${e.align};`),a.firstChild.setAttribute(\"style\",`display:block;${t}`)}},{type:\"inline-range\",text:\"Placement: \",value:0,min:0,max:10,step:1,model(e,a){e.placement=a[Se](\"input\").value/10}},{type:\"inline-range\",text:\"Width: \",value:5,min:1,max:10,step:1,model(e,a){e.width=a[Se](\"input\").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:\"radios\",name:\"Alignment\",capitalise:!0,options:[\"left\",\"center\",\"justify\",\"right\"],model(e,a){e.align=a[Se](\"input:checked\").value}},{type:\"checkbox\",text:\"Affect the entire remainder of the passage\",model(e,a){const t=!!a[Se](\":checked\");if(e.width===(\"center\"===e.align?.5:1)&&(!e.left||!e.right)==(\"center\"!==e.align&&\"justify\"!==e.align)){const a=pe(10*e.left),r=pe(10*e.right),o=$e(a,r),n=\"left\"===e.align?\"<==\":\"right\"===e.align?\"==>\":\"=\".repeat(a/o)+(a?\">\":\"\")+(r?\"<\":\"\")+\"=\".repeat(r/o);t?(e.wrapStart=`${n}\\n`,e.wrapEnd=\"\"):e.changerNamed(\"align\").push(de(n))}else{const a=pe(100*e.left),r=pe(100*e.width),o=pe(100*e.right),n=$e(r,$e(a,o));e.changerNamed(\"align\").push(de(\"left\"===e.align?\"<==\":\"right\"===e.align?\"==>\":\"justify\"===e.align?\"<==>\":\"=><=\")),e.changerNamed(\"box\").push(de(\"=\".repeat(a/n)+\"X\".repeat(r/n)+\"=\".repeat(o/n))),t&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}e.valid=!0}},Ie),rotate:be({type:\"preview\",text:\"Rotated text preview\",update(e,a){a.setAttribute(\"style\",\"height:6em;\");const t=a[Se](\"span\"),{changers:r}=e,o=r[\"text-rotate-x\"],n=r[\"text-rotate-y\"],s=r[\"text-rotate-z\"];let i=\"margin-top:2em;transform:\";(o||n)&&(i+=\"perspective(50vw) \"),o&&(i+=`rotateX(${o}deg) `),n&&(i+=`rotateY(${n}deg) `),s&&(i+=`rotateZ(${s}deg)`),t.setAttribute(\"style\",i)}},{type:\"range\",text:\"Rotation (X axis):\",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[Se](\"input\");+t&&(e.changerNamed(\"text-rotate-x\").push(t),e.valid=!0)}},{type:\"range\",text:\"Rotation (Y axis):\",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[Se](\"input\");+t&&(e.changerNamed(\"text-rotate-y\").push(t),e.valid=!0)}},{type:\"range\",text:\"Rotation (Z axis):\",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[Se](\"input\");+t&&(e.changerNamed(\"text-rotate-z\").push(t),e.valid=!0)}},He,Ie),columns:be({type:\"preview\",text:\"Use columns to lay out two or more spans of prose alongside each other. Each column has its own margins and can occupy a different amount of horizontal space.\",update(e,a){a.setAttribute(\"style\",\"width:90%;display:flex;justify-content:space-between;height:5em;overflow-y:hidden;\");const t=e.columns||[],r=Array.from(a[Ne](\"span\"));for(let e=0;e<Math.max(t.length,r.length);e+=1)e>=t.length?r[e].remove():e>=r.length&&a.append(xe(`<span>${r[0].textContent}</span>`));const o=t.reduce(((e,a)=>e+a.width),0)(Array.from(a[Ne](\"span\"))).forEach(((e,a)=>e.setAttribute(\"style\",`position:relative; font-size:50%; width:${t[a].width/o*100}%;margin-left:${t[a].left}em;margin-right:${t[a].right}em`)))}},{type:\"inline-dropdown\",text:\"Columns:\",options:[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\"],model(e,a){e.columns=[...Array(+a[Se](\"select\").value||1)].map((()=>({left:1,width:1,right:1}))),e.wrapStart=\"\",e.innerText=\"\",e.wrapEnd=e.columns.length>1?\"\\n|==|\":\"\",e.valid=!0},update(e,a){Array.from(a.parentNode[Ne](\".harlowe-4-labeledInput\")).forEach((e=>e.removeAttribute(\"style\"))),Array.from(a.parentNode[Ne](`p:nth-of-type(${e.columns.length}) ~ .harlowe-4-labeledInput`)).forEach((e=>e.setAttribute(\"style\",\"display:none\")))}},xe(\"<br>\"),...[0,1,2,3,4,5].reduce(((e,a)=>e.concat({type:\"inline-number\",text:`Column ${a+1} left margin:`,value:1,min:0,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].left=+t[Se](\"input\").value)}},{type:\"inline-number\",text:\"Width:\",value:1,min:1,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].width=+t[Se](\"input\").value)}},{type:\"inline-number\",text:\"Right margin:\",value:1,min:0,max:9,step:1,model(e,t){const r=e.columns[a];r&&(r.right=+t[Se](\"input\").value,e.wrapStart+=`\\n${\"=\".repeat(r.left)}${\"|\".repeat(r.width)}${\"=\".repeat(r.right)}\\nColumn ${a+1}`)}},xe(\"<p>\"))),[]),Ie),collapse:be({type:\"inline-dropdown\",text:\"Collapse the whitespace within \",options:[\"a section of the passage.\",\"the remainder of the passage.\"],model(e,a){a[Se](\"select\").value?(e.wrapStart=\"{=\\n\",e.wrapEnd=\"\"):(e.wrapStart=\"{\",e.wrapEnd=\"}\"),e.valid=!0}},{type:\"text\",text:\"The <b>collapsing markup</b> hides line breaks and reduces sequences of consecutive spaces to just a single space.\"},{type:\"text\",text:\"If you wish to include whitespace that's exempt from this, you may include <b>HTML &lt;br&gt; tags</b>, or use the verbatim (Vb) markup.\"},Ie),basicValue:be({type:\"text\",text:\"Use <b>variables</b> to store <b>data values</b>, either across your story or within a passage.<br>That data can then be used in the passage, or in other macro calls, by using the variable's name in place of that value.\"},{type:\"textarea\",width:\"25%\",text:\"Variable name (letters, numbers and underscores only):\",placeholder:\"Variable name\",model(e,a){const t=a[Se](\"input\").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)&&(e.variableName=t)}},fe(),{type:\"checkbox\",text:\"Temp variable (the variable only exists in this passage and hook).\",model(e,a){e.sigil=a[Se](\"input\").checked?\"_\":\"$\",e.variableName&&e.expression&&!e.invalidSubrow?(e.wrapStart=`(set: ${e.sigil}${e.variableName} to ${e.expression})`,e.wrapEnd=e.innerText=\"\",e.valid=!0):e.valid=!1}},{type:\"text\",text:\"\",update(e,a){const t=e.valid?`${e.sigil}${e.variableName}`:\"\";a.innerHTML=e.valid?`<p>You can refer to this variable using the code <b><code>${t}</code></b>.</p><p>Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are storage containers for other values.<br>You can access a specific value stored in them using that value's <b>data name</b> (or a string or number value in brackets) by writing <b><code>${t}'s</code></b> <i>name</i>, or <i>name</i> <b><code>of ${t}</code></b>.</p><p>(If you want to display that stored value in the passage, you'll need to give it to a macro, such as <code>(print: ${t}'s </code> <i>name</i><code>)</code>.)</p>`:\"\"}},Ie),input:be({type:\"radiorows\",name:\"inputelement\",options:[[new Text(\"Create a text input box.\"),xe(\"<br>\"),{type:\"preview\",tagName:\"textarea\",text:\"You can type sample text into this preview box.\",update(e,a){a.setAttribute(\"style\",\"width:100%;height:6em;\"),a.firstChild.setAttribute(\"style\",`display:block;resize:none;font-family:Georgia,serif;border-style:solid;border-color:#fff;color:#fff;width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`),a.firstChild.setAttribute(\"rows\",e.rows||3)},model(e){e.wrapStart=e=>{const a=pe(100*e.left),t=pe(100*e.width),r=pe(100*e.right),o=$e(t,$e(a,r));return`(${\"forcedText\"in e?\"force-\":\"\"}input-box:${e.variable?`2bind ${e.variable},`:\"\"}${de(\"=\".repeat(a/o)+\"X\".repeat(t/o)+\"=\".repeat(r/o))}${3!==e.rows?`,${e.rows}`:\"\"}${\"forcedText\"in e?`,${de(e.forcedText)}`:e.initialText?`,${de(e.initialText)}`:\"\"})`},e.wrapEnd=e.innerText=\"\",e.valid=!0}},{type:\"inline-range\",text:\"Placement: \",value:5,min:0,max:10,step:1,width:\"25%\",model(e,a){e.placement=a[Se](\"input\").value/10}},{type:\"inline-range\",text:\"Width: \",value:5,min:1,max:10,step:1,width:\"25%\",model(e,a){e.width=a[Se](\"input\").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:\"inline-number\",text:\"Rows:\",value:3,min:1,max:9,step:1,model(e,a){e.rows=+a[Se](\"input\").value}},{type:\"radiorows\",name:\"inputboxtype\",options:[[{type:\"inline-textarea\",width:\"50%\",text:\"The box initially contains this text:\",placeholder:\"Initial text\",model(e,a){e.initialText=a[Se](\"input\").value||\"\"}}],[{type:\"inline-textarea\",width:\"50%\",text:\"Force the player to type this text:\",placeholder:\"Text to display\",model(e,a){e.forcedText=a[Se](\"input\").value||\"\"}},xe(\"<div>Instead of being a normal input box, this will instead slowly write the above text into the box as the player presses keys.</div>\")]]}],[new Text(\"Create a dropdown menu.\"),xe(\"<br>\"),{type:\"inline-text\",text:\"Dropdown options (leave blank to make a separator):\"},{type:\"textarea-rows\",nonZeroRows:!0,placeholder:\"Option text (leave blank to make a separator)\",model(e,a){const t=Array.from(a[Ne](\"input\")).map((e=>e.value));t.some(Boolean)&&(e.wrapStart=e=>`(dropdown: ${e.variable?`2bind ${e.variable},`:\"\"}${t.map((e=>de(e)))})`,e.wrapEnd=e.innerText=\"\",e.valid=!0)}}],[new Text(\"Create a checkbox.\"),xe(\"<br>\"),{type:\"inline-textarea\",width:\"50%\",text:\"Checkbox label:\",placeholder:\"Label text\",model(e,a){const t=a[Se](\"input\").value||\"\";t&&(e.wrapStart=e=>`(checkbox: ${e.variable?`2bind ${e.variable},`:\"\"}${de(t)})`,e.wrapEnd=e.innerText=\"\",e.valid=!0),e.needsVariable=!0}}],[new Text(\"Show a dialog box.\"),xe(\"<br>\"),xe(\"<div>This dialog box will appear as soon as the macro is displayed. This is best used inside a hook that's only shown if a condition is met.</div>\"),{type:\"textarea\",width:\"80%\",text:\"Text:\",placeholder:\"Your text here\",model(e,a){const t=a[Se](\"input\").value||\"\";e.wrapStart=e=>`(dialog: ${e.variable?`bind ${e.variable},`:\"\"}${de(t)}, ${e.links.map((e=>de(e)))})`,e.wrapEnd=e.innerText=\"\"}},{type:\"inline-text\",text:\"Link options:\"},{type:\"textarea-rows\",nonZeroRows:!0,placeholder:\"Link text (can't be blank)\",model(e,a){const t=Array.from(a[Ne](\"input\")).map((e=>e.value));t.every(Boolean)&&(e.links=t,e.valid=!0)}}]]},{type:\"checkboxrow\",text:\"\",update(e,a){const t=a[Se](\"input\");e.needsVariable?(t.setAttribute(\"disabled\",!0),t.checked=!0):t.removeAttribute(\"disabled\",!0)},model(e,a){e.needsVariable&&!a[Se](\"input:checked\")&&(e.valid=!1)},subrow:[{type:\"inline-dropdown\",text:\"Bind this input element to the variable\",options:[\"$\",\"_\"],model(e,a){e.variable=a[Se](\"select\").value?\"_\":\"$\"}},{type:\"inline-textarea\",width:\"25%\",text:\"\",placeholder:\"Variable name\",model(e,a){const t=a[Se](\"input\").value;t&&RegExp(`^${M.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)?e.variable+=t:e.valid=!1}}]},Ie),prefs:be({type:\"text\",text:'<b style=\"font-size:1rem;height:var(--control-height);display:block;padding:var(--grid-size)\">Harlowe editor toolbar preferences</b>'},{type:\"checkboxes\",name:\"Show text completion tooltips when you type:\",capitalise:!0,bold:!1,options:[\"macro names\",\"keywords\"],checked:e=>!1!==X.getPrefs()[e?\"completionsForKeywords\":\"completionsForMacros\"],update(e,a){const[t,r]=a[Ne](\"[type=checkbox]\");t.checked=!1!==X.getPrefs().completionsForMacros,r.checked=!1!==X.getPrefs().completionsForKeywords},model(e,a){const[t,r]=a[Ne](\"[type=checkbox]\");X.setPref(\"completionsForMacros\",t.checked),X.setPref(\"completionsForKeywords\",r.checked)}},{type:\"checkboxes\",name:\"Other preferences:\",capitalise:!1,bold:!1,bottomBorder:!1,options:[\"Macro code uses the Code Editor Font instead of the Passage Editor Font\"],checked:e=>!1!==X.getPrefs()[e?\"\":\"codeUsesCodeFont\"],update(e,a){const[t]=a[Ne](\"[type=checkbox]\");t.checked=!1!==X.getPrefs().codeUsesCodeFont},model(e,a){const[t]=a[Ne](\"[type=checkbox]\");X.setPref(\"codeUsesCodeFont\",t.checked)}},doneRow()),macro:be({type:\"text\",text:\"<b>Macros</b> are code used for programming and styling your story. The vast majority of Harlowe's features are available through macros.<br>All of the built-in Harlowe macros are listed here. For more details, click their signatures to open the documentation.\"},{type:\"macro-list\",model(e,a){const t=a[Se](\"input:checked\");t&&(e.wrapStart=`(${t.value}:`,e.wrapEnd=\")\",e.innerText=\"Your Code Here\",e.valid=!0)}},Ie),find:(()=>{let updateButton=(e,a)=>a.setAttribute(\"style\",!e.query||e.matches<=0?X.disabledButtonCSS:\"\");return be({type:\"scroll-wrapper\",contents:[xe('<div><span style=\"width:50%;display:inline-block;margin-left:0.5rem\">Find in This Passage</span><span style=\"display:inline-block;\">Replace With</span></div>'),{type:\"inline-textarea\",multiline:!0,width:\"calc(50% - 1rem)\",text:\"\",placeholder:\"\",persist:!0,model(e,a){e.query=a[Se](\"textarea\").value}},{type:\"inline-textarea\",multiline:!0,width:\"calc(50% - 1rem)\",text:\"\",placeholder:\"\",persist:!0,model(e,a){e.replaceQuery=a[Se](\"textarea\").value}},xe(\"<br>\"),{type:\"buttons\",buttons:[{title:\"Previous Result\",html:'<b style=\"font-size:150%\">↑</b>',onClick:()=>ue.constructor.signal(ue,\"harlowe-4-findNext\",-1),update:updateButton},{title:\"Next Result\",html:'<b style=\"font-size:150%\">↓</b>',onClick:()=>ue.constructor.signal(ue,\"harlowe-4-findNext\",1),update:updateButton}]},{type:\"inline-dropdown\",text:\"\",options:[\"Everywhere\",\"Only in prose\",\"Only in code\",\"Only in selection\"],persist:!0,model(e,a){e.onlyIn=a[Se](\"select\").value}},{type:\"inline-checkbox\",text:\"Match Case&nbsp;\",persist:!0,model(e,a){e.matchCase=a&&a[Se](\"input\").checked,ue.constructor.signal(ue,\"harlowe-4-find\",e)}},{type:\"inline-checkbox\",text:\"Use Regular Expressions\",persist:!0,model(e,a){e.useRegExp=a&&a[Se](\"input\").checked,ue.constructor.signal(ue,\"harlowe-4-find\",e)}},xe(\"<br>\"),{type:\"text\",text:\"\",update(e,a){a.innerHTML=e.useRegExp?'You can use <code>$1</code>, <code>$2</code>, <code>$3</code>, etc. in the \"Replace With\" text to access capturing groups.':\"\"}},{type:\"buttons\",buttons:[{title:\"Replace\",html:\"Replace\",onClick:({target:e})=>ue.constructor.signal(ue,\"harlowe-4-replace\",e.parentNode.childNodes[2].lastChild.value,!1),update:updateButton},{title:\"Replace All\",html:\"Replace All\",danger:!0,onClick:({target:e})=>ue.constructor.signal(ue,\"harlowe-4-replace\",e.parentNode.childNodes[2].lastChild.value,!0),update:updateButton}]},{type:\"text\",text:\"\",update:function update(e,a){e.query&&e.matches>0?(a.textContent=`${e.matchIndex+1} of ${e.matches} result${1!==e.matches?\"s\":\"\"}`,a.setAttribute(\"style\",\"display:inline-block; margin-left:calc(var(--grid-size) * 2);\")):(a.textContent=\"\",a.setAttribute(\"style\",\"display:none\")),e.updateResultsDisplay||=()=>update(e,a)}}]},doneRow())})(),default:we?be({type:\"buttons\",buttons:[{title:\"Bold\",html:\"<div style='font-family:serif;font-weight:bold'>B</div>\",onClick:()=>wrapSelection(\"''\",\"''\",\"Bold Text\")},{title:\"Italic\",html:\"<div style='font-family:serif;font-style:italic'>I</div>\",onClick:()=>wrapSelection(\"//\",\"//\",\"Italic Text\")},{title:\"Strikethrough\",html:\"<div style='font-family:serif;text-decoration:line-through'>S</div>\",onClick:()=>wrapSelection(\"~~\",\"~~\",\"Strikethrough Text\")},{title:\"Superscript\",html:\"<div style='font-family:serif'>X<sup>2</sup></div>\",onClick:()=>wrapSelection(\"^^\",\"^^\",\"Superscript Text\")},{title:\"Text and background colour\",html:\"<div class='harlowe-4-bgColourButton'>\",onClick:()=>switchPanel(\"textcolor\")},{title:\"Borders\",html:Te(\"border-style\"),onClick:()=>switchPanel(\"borders\")},{title:\"Rotated text\",html:'<div style=\"transform:rotate(-30deg);font-family:serif;font-weight:bold\">R</div>',onClick:()=>switchPanel(\"rotate\")},{title:\"Special text style\",html:\"Styles…\",onClick:()=>switchPanel(\"textstyle\")},xe('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Heading\",html:\"<div style='font-family:serif;font-weight:bold'>H</div>\",onClick:()=>wrapSelection(\"\\n#\",\"\",\"Heading Text\")},{title:\"Bulleted list item\",html:Te(\"list-ul\"),onClick:()=>wrapSelection(\"\\n* \",\"\")},{title:\"Numbered list item\",html:Te(\"list-ol\"),onClick:()=>wrapSelection(\"\\n0. \",\"\")},{title:\"Horizontal rule\",html:\"<b>—</b>\",onClick:()=>wrapSelection(\"\\n---\\n\",\"\")},{title:\"Alignment\",html:Te(\"align-right\"),onClick:()=>switchPanel(\"align\")},{title:\"Columns\",html:Te(\"columns\"),onClick:()=>switchPanel(\"columns\")},xe('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Collapse whitespace (in-game)\",html:\"<b>{}</b>\",onClick:()=>switchPanel(\"collapse\")},{title:\"Verbatim (ignore all markup)\",html:\"Vb\",onClick(){const e=(ue.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection(\"`\".repeat(e+1),\"`\".repeat(e+1),\"Verbatim Text\")}},{title:\"Comments\",html:\"<b>&lt;!--</b>\",onClick:()=>wrapSelection(\"\\x3c!--\",\"--\\x3e\",\"HTML Comments (Not Visible In-Game)\")},xe('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Link element\",html:\"Link…\",onClick:()=>switchPanel(\"passagelink\")},{title:\"Only show a portion of text if a condition is met\",html:\"If…\",onClick:()=>switchPanel(\"if\")},{title:\"Input element\",html:\"Input…\",onClick:()=>switchPanel(\"input\")},{title:\"Hook (named section of the passage)\",html:\"Hook…\",onClick:()=>switchPanel(\"hook\")},{title:\"Set a variable with a data value\",html:\"Var…\",onClick:()=>switchPanel(\"basicValue\")},{title:\"Peruse a list of all built-in macros\",html:\"Macro…\",onClick:()=>switchPanel(\"macro\")},xe('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Proofreading view (dim all code except strings)\",html:Te(\"eye\"),onClick:({target:e})=>{ue.display.wrapper.classList.toggle(\"harlowe-4-hideCode\"),\"svg\"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle(\"active\")}},{title:\"Coding tooltips (show a tooltip when the cursor rests on code structures)\",html:Te(\"comment\"),active:!0,onClick:({target:e})=>{ue.display.wrapper.classList.toggle(\"harlowe-4-hideHelpTooltip\"),\"svg\"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle(\"active\")}},xe('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Find and replace\",html:Te(\"search\"),onClick:()=>{switchPanel(\"find\");const e=ue.doc.getSelection(),a=document[Se](\".harlowe-4-toolbarPanel textarea\");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event(\"input\"))))}},{title:\"Open the Harlowe documentation\",html:\"<div style='font-weight:bold'>?</div>\",onClick:()=>window.open(\"http://www.cnbbx.com/twine/\",\"Harlowe Documentation\",\"noopener,noreferrer\")},(()=>{const e=xe(`<button style=\"position:absolute;right:0em;margin-top:-2em\">${Te(\"chevron-up\")}</button>`);return e[Ae](\"click\",(()=>{Oe.classList.toggle(\"harlowe-4-minimised\");const a=e.firstElementChild?.classList;a?.toggle(\"fa-chevron-down\"),a?.toggle(\"fa-chevron-up\")})),e})()]}):be()},switchPanel();const Me=\"data:image/svg+xml,\",svgURI=e=>`${Me}${window.escape(`<svg viewBox='0 0 14 14' width='80' height='80' xmlns='http://www.w3.org/2000/svg'>${e}</svg>`)}`,t24Icon=(e,a,t,r)=>svgURI(`<text y='${a}' x='${e}' fill='currentColor' style='/*harlowe-4*/${t}'>${r}</text>`),fontIconURI=e=>`${Me}${window.escape(Te(e))}`,Ee=navigator.userAgent.includes(\"Macintosh\")?\"Cmd-\":\"Ctrl-\",Fe={},Re={name:\"harlowe-4-keymap\",[`${Ee}G`](){\"parentNode\"in ge.find&&ge.find.parentNode&&ue.constructor.signal(ue,\"harlowe-4-findNext\",1)},[`Shift-${Ee}G`](){\"parentNode\"in ge.find&&ge.find.parentNode&&ue.constructor.signal(ue,\"harlowe-4-findNext\",-1)},[`${Ee}H`](){if(\"parentNode\"in ge.find&&ge.find.parentNode){const e=ge.find[Ne](\"textarea\")[1];ue.constructor.signal(ue,\"harlowe-4-replace\",e.value,!1)}else switchPanel(\"find\")}};let ze,Be;const We=navigator.userAgent.includes(\"Macintosh\")?\"⌘\":\"Ctrl+\",De=we?[]:[{type:\"menu\",label:\"Styles\",iconOnly:!0,icon:svgURI(\"<text y='11' x='-3' fill='currentColor' style='/*harlowe-4*/font-weight:bold;font-size:80%'>B</text><text y='8' x='4' fill='currentColor' style='/*harlowe-4*/font-style:italic;font-size:80%'>I</text><text y='13' x='7' fill='currentColor' style='/*harlowe-4*/text-decoration:line-through;font-size:80%'>S</text>\").replace(\"%2780%27\",\"%27108%27\"),items:[{type:\"button\",key:`${Ee}B`,command(){wrapSelection(\"''\",\"''\",\"Bold Text\")},label:`Bold [${We}B]`},{type:\"button\",key:`${Ee}I`,command(){wrapSelection(\"//\",\"//\",\"Italic Text\")},label:`Italic [${We}I]`},{type:\"button\",key:`${Ee}-`,command(){wrapSelection(\"~~\",\"~~\",\"Strikethrough Text\")},label:`Strikethrough [${We}-]`},{type:\"button\",key:`${Ee}.`,command(){wrapSelection(\"^^\",\"^^\",\"Superscript Text\")},label:`Superscript [${We}.]`},{type:\"separator\"},{type:\"button\",command(){switchPanel(\"textstyle\")},label:\"More Styles…\"}]},{type:\"button\",command(){switchPanel(\"textcolor\")},label:\"Colours\",iconOnly:!0,icon:svgURI('<defs><linearGradient id=\"X\"><stop offset=\"0%\" stop-color=\"hsla(0,100%,50%,0.5)\"/><stop offset=\"16%\" stop-color=\"hsla(30,100%,50%,0.5)\"/><stop offset=\"33%\" stop-color=\"hsla(60,100%,50%,0.5)\"/><stop offset=\"50%\" stop-color=\"hsla(120,100%,50%,0.5)\"/><stop offset=\"66%\" stop-color=\"hsla(180,100%,50%,0.5)\"/><stop offset=\"83%\" stop-color=\"hsla(240,100%,50%,0.5)\"/><stop offset=\"100%\" stop-color=\"hsla(320,100%,50%,0.5)\"/></linearGradient></defs><circle cx=\"8\" cy=\"8\" r=\"6\" fill=\"url(\\'#X\\')\"/>')},{type:\"button\",command(){switchPanel(\"borders\")},label:\"Borders\",iconOnly:!0,icon:fontIconURI(\"border-style\")},{type:\"button\",command(){switchPanel(\"rotate\")},label:\"Rotated text\",iconOnly:!0,icon:t24Icon(-3,14,\"transform:rotate(-30deg);font-family:serif;\",\"R\")},{type:\"menu\",icon:fontIconURI(\"list-ul\"),label:\"List and line items\",iconOnly:!0,items:[{type:\"button\",command(){wrapSelection(\"\\n* \",\"\")},label:\"Bulleted List Item\"},{type:\"button\",command(){wrapSelection(\"\\n0. \",\"\")},label:\"Numbered List Item\"},{type:\"separator\"},{type:\"button\",command(){wrapSelection(\"\\n#\",\"\",\"Heading Text\")},label:\"Heading\"},{type:\"button\",command(){wrapSelection(\"\\n---\\n\",\"\")},label:\"Horizontal Rule\"}]},{type:\"menu\",icon:fontIconURI(\"align-center\"),label:\"Alignment and columns\",iconOnly:!0,items:[{type:\"button\",command(){switchPanel(\"align\")},label:\"Alignment\"},{type:\"button\",command(){switchPanel(\"columns\")},label:\"Columns\"}]},{type:\"button\",command(){switchPanel(\"collapse\")},label:\"Collapse Whitespace (In-Game)\",iconOnly:!0,icon:t24Icon(0,10,\"font-weight:bold;font-size:12px\",\"{ }\")},{type:\"button\",command(){const e=(ue.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection(\"`\".repeat(e+1),\"`\".repeat(e+1),\"Verbatim Text\")},label:\"Verbatim (Ignore All Markup Inside)\",iconOnly:!0,icon:t24Icon(1,12,\"font-size:11px\",\"Vb\")},{type:\"button\",command(){wrapSelection(\"\\x3c!--\",\"--\\x3e\",\"Comment Text\")},label:\"HTML Comments (Not Run In-Game)\",iconOnly:!0,icon:t24Icon(-1,10,\"font-weight:bold\",\"&#10216;!-\")},{type:\"menu\",label:\"(Macro:)\",items:[{type:\"button\",command(){switchPanel(\"passagelink\")},label:\"Link…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"if\")},label:\"If…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"input\")},label:\"Input…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"hook\")},label:\"Hook…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"basicValue\")},label:\"Value…\",icon:\"\"},{type:\"separator\"},{type:\"button\",command(){switchPanel(\"macro\")},label:\"List All Macros…\",icon:\"\"}]},ze={type:\"button\",command(){ue.display.wrapper.classList.toggle(\"harlowe-4-hideCode\"),ue.constructor.signal(ue,\"cursorActivity\")},label:\"Proofreading View (dim all code except strings)\",iconOnly:!0,icon:fontIconURI(\"eye\")},Be={type:\"button\",command(){const{wrapper:e}=ue.display;e.classList.toggle(\"harlowe-4-hideHelpTooltip\"),e.classList.toggle(\"harlowe-4-showHelpTooltip\"),ye=e.classList.contains(\"harlowe-4-showHelpTooltip\"),X.setPref(\"tooltips\",ye),ue.constructor.signal(ue,\"cursorActivity\")},label:\"Coding Tooltips (when the cursor rests on code structures)\",iconOnly:!0,icon:fontIconURI(\"comment\")},{type:\"button\",key:`${Ee}F`,command(){switchPanel(\"find\");const e=ue.doc.getSelection(),a=ge.find[Se](\".harlowe-4-toolbarPanel textarea\");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event(\"input\"))))},label:`Find and Replace [${We}F]`,iconOnly:!0,icon:fontIconURI(\"search\")},{type:\"button\",command(){window.open(\"http://www.cnbbx.com/twine/\",\"Harlowe Documentation\",\"noopener,noreferrer\")},label:\"Show Manual (opens a new tab)\",iconOnly:!0,icon:t24Icon(3,14,\"font-weight:bold;font-size:19px;\",\"?\")},{type:\"button\",command(){switchPanel(\"prefs\")},label:\"Editor Preferences\",iconOnly:!0,icon:fontIconURI(\"gear\")}].map((function recur(e,a){if(\"button\"===e.type){const{command:t}=e;Fe[a]=e=>{ue=e,t()},e.key&&(Re[e.key]=t),e.command=`${a}`}return\"menu\"===e.type&&(e.items=e.items.map(((e,t)=>recur(e,`${a}.${t}`)))),e}));function Toolbar(e,{foregroundColor:a}){const t=document[Ne](\".story-format-toolbar\"),r=t[t.length-1]||document[Se](\".editor .passageTags\");return r&&r.nextElementSibling!==Oe&&r[we?\"after\":\"before\"](Oe),ue=e,we||(ue.addKeyMap(Re),ue.display.wrapper.className.match(/harlowe-4-....HelpTooltip/)||ue.display.wrapper.classList.toggle(`harlowe-4-${ye?\"show\":\"hide\"}HelpTooltip`)),De.forEach((e=>{let t=a;(e===ze&&ue.display.wrapper.classList.contains(\"harlowe-4-hideCode\")||e===Be&&!ue.display.wrapper.classList.contains(\"harlowe-4-hideHelpTooltip\"))&&(t=\"#0a60c2\"),e.icon&&=e.icon.replace(/fill%3D%27[^']+?%27/g,`fill%3D%27${window.escape(t)}%27`)})),De}let{ShortDefs:qe,twine23:je,insensitiveName:Ve,getPrefs:Ye}=X;const{hasOwn:Ue}=Object,docsURL=(e,a)=>`<a href=\"/twine/docs.html#${e}\" target=\"_blank\" rel=\"noopener noreferrer\">${a}</a>`,Ge=\"This markup gives the enclosed text \",producesBooleanTrueIf=e=>`The <b>\"${e}\" operator</b> produces the boolean value \\`true\\` if `,Xe=\" Otherwise, it produces `false`.\",Ze=\"If they contain strings, numbers, commands or changers, you can place them directly in your prose to display the value, run the command, or apply the changer.\",lambdaClause=e=>`The keyword <b>\"${e}\"</b> makes the code on the right into a <b>\"${e}\" lambda clause</b>. `,specialHookName=(e,a)=>`<br><br>Additionally, because it uses the special name \"\\`${e}\\`\", it also refers to <b>${a}</b>, and can be used to apply changers to ${a}.`,Je=\"Only matches \",Ke={num:`${Je}numbers.`,str:`${Je}strings.`,bool:`${Je}booleans.`,array:`${Je}arrays.`,dm:`${Je}datamaps.`,ds:`${Je}datasets.`,command:`${Je}commands.`,changer:`${Je}changers.`,color:`${Je}colours.`,gradient:`${Je}gradients.`,lambda:`${Je}lambdas.`,macro:`${Je}custom macros.`,datatype:`${Je}other datatypes.`,codehook:`${Je}code hooks.`,even:`${Je}even numbers.`,odd:`${Je}odd numbers.`,int:`${Je}whole numbers (numbers with no fractional component, and which are positive or negative).`,empty:`${Je}these empty structures: <code>\"\"</code> (the empty string), <code>(a:)</code>, <code>(dm:)</code> and <code>(ds:)</code>.`,whitespace:`${Je}a single character of whitespace (spaces, newlines, and other kinds of space).`,lowercase:`${Je}a single lowercase character. Lowercase characters are characters that change when put through <code>(uppercase:)</code>.`,uppercase:`${Je}a single uppercase character. Uppercase characters are characters that change when put through <code>(lowercase:)</code>.`,anycase:\"This matches any character which is case-sensitive - that is, where its <code>(lowercase:)</code> form doesn't match its <code>(uppercase:)</code> form.\",alnum:`${Je}a single alphanumeric character (letters and numbers).`,digit:`${Je}a string consisting of exactly one of the characters '0', '1', '2', '3', '4', '5', '6', '7', '8', and '9'.`,newline:`${Je}a line break character (also known as a \"newline\" character).`,const:\"Matches nothing; Use this only with <code>(set:)</code> to make constants.\",any:\"Matches anything; Use this with <code>(macro:)</code> to make variables that accept any storable type, or with <code>(set:)</code> inside data structure patterns.\"};Object.assign(Ke,{number:Ke.num,string:Ke.str,boolean:Ke.bool,datamap:Ke.dm,dataset:Ke.ds,colour:Ke.color,integer:Ke.int,alphanumeric:Ke.alnum,linebreak:Ke.newline});const Qe={hr:\"This is a <b>horizontal rule</b>. It extends across the entire passage width (or the column width, if it's in a column).\",bulleted:\"The `*` at the start of this line makes this a <b>bulleted list item</b>.\",numbered:\"The `0.` at the start of this line makes this a <b>numbered list item</b>.\",heading:({depth:e})=>`This is a <b>level ${e} ${1===e?\"(largest) \":\"\"}heading</b> mark.`,align:({align:e})=>`This is an <b>aligner</b> mark. The text after this is ${\"justify\"===e?\"justified (spaced out to touch both edges)\":`aligned to the ${e}`}. Write \\`<==\\` for left alignment, \\`==>\\` for right alignment, \\`=><=\\` for centering, and \\`<==>\\` for justified alignment.`,column:({text:e,width:a,marginRight:t,marginLeft:r})=>e.trim().startsWith(\"|\")&&e.trim().endsWith(\"|\")?\"This mark ends all of the preceding columns. The text after this is not in a column.\":`The text after this mark is in a <b>column</b> with width multiplier ${a}x, a left margin of ${r}em, and a right margin of ${t}em. Write more consecutive \\`|\\` marks to increase the width, and place \\`=\\` to the left and right to increase the margin on that side.`,em:`${Ge}<b>emphasis style</b>. This is visually the same as italic style by default.`,strong:`${Ge}<b>strong emphasis style</b>. This is visually the same as bold style by default.`,bold:`${Ge}<b>bold style</b>.`,italic:`${Ge}<b>italic style</b>.`,strike:`${Ge}<b>strikethrough style</b>.`,sup:`${Ge}<b>superscript style</b>.`,comment:\"This is a <b>HTML comment</b>. Everything inside it will be ignored by Harlowe.\",scriptStyleTag:()=>Qe.tag,tag:\"This is a <b>HTML tag</b>. Harlowe supports raw HTML in passage code.\",hook:({type:e,name:a,tagPosition:t})=>`${\"hook\"===e?\"These square brackets are a <b>hook</b>, enclosing this section of passage code.\":\"\"} Changer values can be attached to the left of hooks.${a?`<br>This hook has a <b>nametag</b> on the ${\"prepended\"===t?\"left\":\"right\"}. This allows the hook to be referred to in macro calls using the hook name <code>?${a}</code>.`:\"\"}`,unclosedHook:e=>`This marks all of the remaining code in the passage as being inside a <b>hook</b>.${Qe.hook(e)}`,verbatim:\"This is <b>verbatim markup</b>. Place text between matching pairs and amounts of <code>`</code> marks, and Harlowe will ignore the markup within, instead displaying it as-is.\",unclosedCollapsed:e=>Qe.collapsed(e),collapsed:({type:e})=>`This is <b>${\"unclosedCollapsed\"===e?\"unclosed \":\"\"}collapsed whitespace</b> markup. All sequences of consecutive whitespace within ${\"unclosedCollapsed\"===e?\"the remainder of the passage \":\"the <code>{</code> and <code>}</code> marks\"} will be replaced with a single space. You can use this to space out your code and keep your passage readable.<br>To include a line break within this markup that will be preserved, use a HTML <code>&lt;br&gt;</code> tag.`,escapedLine:\"This is an <b>escaped line break</b> mark. This removes the line break before or after it from the displayed passage.\",twineLink:({passage:e})=>`This is a <b>link to the passage \"${e}\"</b>. Links, like hooks and commands, can have changer values attached to the left.`,br:\"\",url:\"\",variable:`This is a <b>story-wide variable</b>. After this has been set to a data value, it can be used anywhere else in the story. Use these to store data values related to your story's game state, or changers that are commonly used. ${Ze}`,tempVariable:`This is a <b>temp variable</b>. It can only be used in the same passage and hook (plus any nested hooks therein) in which it's first set to a data value. Use these to store values temporarily, or that won't be needed elsewhere. ${Ze}`,macroName:(e,[,a])=>Qe.macro(a),grouping:\"Use these <b>grouping brackets</b> to ensure operations are performed in a certain order. Code in brackets will be computed before the code adjacent to it.\",property:({type:e,name:a})=>(a?`This retrieves the data stored at <b>the \\`${a}\\` ${a.match(/^\\d+(?:th|nd|st|rd)(?:last)?(?:to\\d+(?:nth|nd|st|rd)(?:last)?)?$/g)?\"position\"+(a.includes(\"to\")?\"s\":\"\"):\"name\"}</b> of the container value on the ${e.startsWith(\"belonging\")?\"right\":\"left\"}.<br><br>`:\"\")+\"Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are also storage containers for other values. You can access a specific value stored in them using that value's <b>data name</b> (or a string, number, or array value in brackets) by writing <i>value</i> `'s` <i>name</i>, or <i>name</i> `of` <i>value</i>.\",possessiveOperator:e=>Qe.property(e),itsProperty:e=>Qe.property(e),itsOperator:e=>Qe.identifier(e),belongingItProperty:e=>Qe.property(e),belongingItOperator:e=>Qe.property(e),belongingProperty:e=>Qe.property(e),belongingOperator:e=>Qe.property(e),escapedStringChar:\"\",string:'This is <b>string data</b>. Strings are sequences of text data enclosed in matching \" or \\' marks. Use a `\\\\` inside a string to \"escape\" the next character. Escaped \" or \\' marks don\\'t count as the end of the string.<br><br>If a string matches a passage name, it will be <span class=\"cm-harlowe-4-passageString\">underlined</span>. If it matches a tag name, it will be <span class=\"cm-harlowe-4-tagString\">dotted</span>.',hookName:({name:e})=>`This <b>hook name</b> refers to all hooks named \"\\`${e=e.toLowerCase()}\\`\" in this passage.${\"page\"===e?specialHookName(\"page\",\"the entire HTML page\"):\"passage\"===e?specialHookName(\"passage\",\"the entire passage\"):\"link\"===e?specialHookName(\"link\",\"every link in the passage\"):\"sidebar\"===e?specialHookName(\"sidebar\",\"the sidebar\"):\"\"}`,cssTime:({value:e})=>`This is <b>number data</b> in CSS time format. Harlowe automatically converts this to a number of milliseconds, so this is identical to ${e}.`,datatype:({text:e})=>(e=e.toLowerCase(),`This is the name of a <b>datatype</b>. Use these names to check what kind of data a data value is, using the \\`matches\\` or \\`is a\\` operators.<br>You can also use them in a \\`(set:)\\` or \\`(put:)\\` to restrict that variable's data for error-checking purposes. (See ${docsURL(\"type_datatype\",\"the documentation\")} for details.)${Ue(Ke,e)?`<code class='harlowe-4-tooltipMacroSignature cm-harlowe-4-datatype'>${e}</code>${Ke[e]}`:\"\"}`),colour:({text:e})=>\"This is a \"+(e.startsWith(\"#\")?\"<b>HTML colour value</b>. Harlowe can use this as colour data.\":\"built-in Harlowe <b>colour value</b>. The built-in colours are `red`, `orange`, `yellow`, `lime`, `green`, `cyan` (alias `aqua`), `blue`, `navy`, `purple`, `fuchsia` (alias `magenta`), `white`, `gray` (alias `grey`), `black`, and `transparent`.\"),number:\"This is <b>number data</b>. Harlowe supports whole numbers (like `2`), negative numbers (like `-2`), and numbers with a decimal fraction component (like `2.2`).\",inequality:({operator:e,negate:a})=>{const t=`${\">\"===(e=a?{\">\":\"<=\",\"<\":\">=\",\">=\":\"<\",\"<=\":\">\"}[e]:e)[0]?\"greater \":\"less \"}than${e.endsWith(\"=\")?\" or equal to\":\"\"}`;return`${producesBooleanTrueIf(t)} the number value on the left is ${t} the number value on the right.${Xe}`},identifier:({text:e})=>(e=Ve(e)).startsWith(\"it\")?\"The keyword <b>it</b> is a shorthand for the leftmost part of an operation. You can write `(if: $candles < 2 and it > 5)` instead of `(if: $candles < 2 and $candles > 5)` or `(set: $candles to it + 3)` instead of `(set: $candles to $candles + 3)`. When accessing a data value from it, you can write it as <b>its</b>, such as in `its length > 0`.\":\"time\"===e?\"The keyword <b>time</b> equals the number of milliseconds passed since the passage was displayed.\":e.startsWith(\"exit\")?'The keyword <b>exits</b> or <b>exit</b> equals the number of currently available \"exits\" in a passage - the number of link, mouseover, and mouseout elements that are still active on the page, which could lead to new content and progress.':e.startsWith(\"visit\")?\"The keyword <b>visits</b> or <b>visit</b> equals the number of times the current passage has been visited this game, including the current visit. In `(storylet:)` macros, when Harlowe decides whether this passage is available to `(open-storylets:)`, this will often be 0, but when actually visiting the passage, it will be at least 1.\":\"pos\"===e?'The keyword <b>pos</b> should ONLY be used within a \"where\" or \"via\" lambda clause. It refers to the position of the current data value that this lambda is processing.':\"\",whitespace:\"<b>Whitespace</b> within macro calls is simply used to separate syntax elements. You can use as much or as little as you like to make your code more readable.\",error:(e,[{message:a,explanation:t}])=>a+(t?`<br>${t}`:\"\"),boolean:\"The keywords <b>true</b> or <b>false</b> are the two <b>boolean values</b>. They are produced by comparison operators (`<`, `>`, `is`, etc.) and other macros.\",is:`The <b>\"is\" operator</b> produces the boolean value \\`true\\` if the values on each sides of it are exactly the same.${Xe}`,to:'Use the <b>\"to\" operator</b> only inside a `(set:)` macro call. Place it to the left of the data, and right of the variable to set the data to.',into:'Use the <b>\"into\" operator</b> only inside a `(put:)`, `(move:)` or `(unpack:)` macro call. Place it to the right of the data, and left of the destination to put the data.',where:`${lambdaClause(\"where\")}This lambda will search for input values <i>where</i> the right side, once computed, produces \\`true\\`.`,when:`${lambdaClause(\"when\")}This lambda will cause the macro (if it accepts \"when\" lambdas) to only do something <i>when</i> the right side, once computed, produces \\`true\\`.`,via:`${lambdaClause(\"via\")}This lambda is used to convert input values into new values <i>via</i> computing the expression to the right.`,making:`${lambdaClause(\"making\")}This is used only by the \\`(folded:)\\` macro. The lambda <i>makes</i> the temp variable on the right, which becomes the final value of the \\`(folded:)\\` call.`,each:`${lambdaClause(\"each\")}This causes the macro (if it accepts lambdas) to, for <i>each</i> input value, place that value in the temp variable on the right, before running the other lambda clauses adjacent to this one (if any).`,and:`${producesBooleanTrueIf(\"and\")}the values on each side of it are both \\`true\\`.${Xe}`,or:`${producesBooleanTrueIf(\"or\")}the values on each side of it are both \\`false\\`.${Xe}`,not:'The <b>\"not\" operator</b> inverts the boolean value to its right, turning `true` to `false` and vice-versa.',isNot:`${producesBooleanTrueIf(\"is not\")}the values on each sides of it are NOT exactly the same.${Xe}`,contains:`${producesBooleanTrueIf(\"contains\")}the array, string, or dataset on the left contains the data on the right, or if the datamap on the left has the data name on the right.${Xe}`,doesNotContain:`${producesBooleanTrueIf(\"does not contain\")}the array, string, or dataset on the left does NOT contain the data on the right, or if the datamap on the left does NOT have the data name on the right.${Xe}`,isIn:`${producesBooleanTrueIf(\"is in\")}the data on the left is in the array, string, datamap or dataset on the right.${Xe}`,isA:`${producesBooleanTrueIf(\"is a\")}the data on the left matches the datatype on the right.${Xe}`,isNotA:`${producesBooleanTrueIf(\"is not a\")}the data on the left does NOT match the datatype on the right.${Xe}`,isNotIn:`${producesBooleanTrueIf(\"is not in\")}the data on the left is NOT in the array, string, datamap or dataset on the right.${Xe}`,matches:`${producesBooleanTrueIf(\"matches\")}one side describes the other - that is, if one side is a datatype that describes the other, or both sides are arrays, datamaps, or datasets, with data in positions that matches those in the other, or if both sides are equal.${Xe}`,doesNotMatch:`${producesBooleanTrueIf(\"does not match\")}one side does NOT describe the other.${Xe}`,bind:'The <b>bind</b> or <b>2bind</b> keyword specifies that the variable to the right should be \"bound\" to an interactable element. This is used only by certain command macros, like `(dialog:)` or `(cycling-link:)`.',comma:\"Use <b>commas</b> to separate the values that you give to macro calls.\",spread:\"This is a <b>spreader</b>. These spread out the values in the array, string or dataset to the right of it, as if each value was individually placed in the call and separated with commas.<br><br>Alternatively, if a datatype is to the right of it, that datatype becomes a <b>spread datatype</b> that matches zero or more of itself.\",typeSignature:\"The <b>-type</b> suffix is used to restrict the variable on the right to only holding data that matches the data pattern on the left. Variables restricted in this way are called <b>typed variables</b>.\",addition:\"Use the <b>addition operator</b> to add two numbers together, as well as join two strings or two arrays, and combine two datamaps, two datasets, two changers, or two colours. This operator can also combine two hook names, creating a hook name that applies to both sets of hooks.\",subtraction:\"Use the <b>subtraction operator</b> to subtract two numbers, as well as create a copy of the array or dataset on the left that doesn't contain values of the array or dataset on the right.\",multiplication:\"Use the <b>multiplication operator</b> to multiply two numbers.\",division:({text:e})=>(\"/\"===e?\"Use the <b>division operator</b> to divide\":\"Use the <b>modulo operator</b> to get the remainder (modulo) from dividing\")+\" two numbers. Dividing a number by 0 produces an error.\",macro:({name:e})=>{if(void 0===e)return\"This macro call is incomplete or erroneously written. Macro calls should consist of `(`, the name (which is case-insensitive and dash-insensitive), `:`, zero or more expressions separated by commas, then `)`, in that order.\";if(\"_\"===e[0]||\"$\"===e[0])return`This is a <b>call to a custom macro stored in the ${e} variable</b>. Custom macros are created with the \\`(macro:)\\` macro, and must be stored in variables in order to be used.`;const a=qe.Macro[Ve(e)];if(!a)return\"This is a call to a nonexistent or misspelled macro. This will cause an error.\";const t=a.returnType.toLowerCase();return`This is a <b>call to the \\`(${a.name}:)\\` macro</b>. ${\"metadata\"===t?\"Metadata macros like this should be placed at the very top of the passage, before all other macros.\":\"instant\"===t||\"command\"===t?'It produces a <span class=\"cm-harlowe-4-macroName-command\">command</span>, so it should appear in passage code without being connected to a hook.':\"changer\"===t?'It produces a <span class=\"cm-harlowe-4-macroName-changer\">changer</span>, which can be placed to the left of a hook or a command (passage links are commands), or combined with other changers.':\"any\"===t||\"string\"===t?\"\":`Since it produces a <span class=\"cm-harlowe-4-macroName-${t}\">${t}</span>, it should be nested inside another macro call that can use ${t} (or any) data, or modified with an operator like \\`is\\` or \\`is in\\`.${\"array\"===t||\"dataset\"===t?\" You may also use it in a macro call which can accept any number of values, and spread its contents out using the spreader `...` syntax.\":\"\"}`}${\"command\"===t||\"changer\"===t?\" You may also put it in a variable to reuse it multiple times, like other kinds of data.\":\"\"}<code class='harlowe-4-tooltipMacroSignature'>${docsURL(a.anchor,`(${a.name}: ${a.sig}) -> ${a.returnType}`)}</code>${a.aka.length?`<div><i>Also known as: ${a.aka.map((e=>`<code>(${e}:)</code>`)).join(\", \")}</i>`:\"\"}</div><div>${a.abstract}</div>`},text:({text:e},a)=>{if(e.trim()){if(a.reduce(((e,a)=>void 0===e?\"macro\"===a.type||\"hook\"!==a.type&&e:e),void 0))return\"This doesn't seem to be valid code.<br>Note that inside macro calls, only other macro calls, data, operators and whitespace are permitted.\"}}},ea=document.createElement(\"div\");ea.className=\"harlowe-4-tooltip\";let aa=0,ta=0,ra=4,oa=0,na=0,sa=Object;function tooltipAppear(){aa<1?(ea.style.display=\"\",ta=10):(aa-=1,requestAnimationFrame(tooltipAppear))}const ia={Up(){updateTooltipMenuCursor(Math.max(0,oa-1))},Down(){updateTooltipMenuCursor(Math.min(na-1,oa+1))},PageUp(){updateTooltipMenuCursor(0)},PageDown(){updateTooltipMenuCursor(na-1)},Home(){updateTooltipMenuCursor(0)},End(){updateTooltipMenuCursor(na-1)},Enter(){sa(oa)},Tab(){sa(oa)}};function tooltipClear(e){e.removeKeyMap(ia),oa=0,sa=Object,ea.setAttribute(\"style\",\"display:none\")}const docCursorPlus=(e,a)=>e.posFromIndex(e.indexFromPos(e.getCursor())+a);function positionTooltip(e,a,t=!1){ea.removeAttribute(\"style\");const{width:r}=ea.getBoundingClientRect(),o=e.display.wrapper,{width:n}=o.getBoundingClientRect(),s=e.charCoords(a,\"local\"),i=je?30:0,l=Math.min(n-r,Math.max((0|s.left)+i-(t?r/2:0),i));ea.setAttribute(\"style\",`left:${l}px; top:${(0|s.top)+(t?30:24)-o.querySelector(\".CodeMirror-scroll\").scrollTop}px;`),t&&ea.lastElementChild?.setAttribute(\"style\",`left:${s.right-l+(je?(s.right-s.left)/2+6:-12)}px; top:-24px`),o.addEventListener(\"keydown\",(a=>{\"display:none\"!==ea.getAttribute(\"style\")&&\"Escape\"===a.key&&(tooltipClear(e),a.stopPropagation())}))}function makeHelpTooltip(e,a,t){if(t.display.wrapper.classList.contains(\"harlowe-4-hideHelpTooltip\")||t.doc.somethingSelected())return!1;const[r]=e;let o=Qe[r.type];return\"function\"==typeof o&&(o=o(r,e)),!!o&&(o=o.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`)),ea.innerHTML=o+(ra>0?(ra--,`<br><br><i>Use the ${(document.querySelector('[aria-label^=\"Coding tooltips\"],[title^=\"Coding tooltips\"]')||{}).innerHTML||\"tooltip\"} toolbar button to toggle these popups!</i>`):\"\")+\"<div class=harlowe-4-tooltipTail>\",ea.className=\"harlowe-4-tooltip harlowe-4-helpTooltip\",positionTooltip(t,a,!0),ea.style.display=\"none\",aa=50,!0)}const la=Object.values(qe?.Macro||{}).reduce(((e,{name:a,returnType:t,aka:r})=>e.find((e=>e.name===a))?e:e.concat({name:a,returnType:t}).concat(r.map((e=>({name:e,returnType:t}))))),[]);const ca=[...\"exit,exits,it,pos,time,turn,turns,visit,visits\".split(\",\").map((e=>({name:e,type:\"identifier\"}))),...\"where,when,each,via,making\".split(\",\").map((e=>({name:e,type:\"lambda\",label:\"lambda keyword\"}))),...\"number,num,string,str,boolean,bool,array,datamap,dm,dataset,ds,command,changer,color,colour,gradient,lambda,macro,datatype,codehook\".split(\",\").map((e=>({name:e,type:\"datatype\"}))),...\"even,odd,integer,int,empty,whitespace,lowercase,uppercase,anycase,alphanumeric,alnum,digit,linebreak,newline,const,any\".split(\",\").map((e=>({name:e,type:\"datatype\",label:\"specific datatype\"}))),...\"red,orange,yellow,lime,green,cyan,aqua,blue,navy,purple,fuchsia,magenta,white,gray,grey,black,transparent\".split(\",\").map((e=>({name:e,type:\"colour\"}))),...\"is,is not,contains,does not contain,is in,is not in,is a,is not a,matches,does not match,and,or,not\".split(\",\").map((e=>({name:e,type:\"boolean\",label:\"boolean operator\"}))),...\"to,into,bind,2bind,-type\".split(\",\").map((e=>({name:e,type:\"operator\"}))),{name:\"true\",type:\"boolean\"},{name:\"false\",type:\"boolean\"}];function updateTooltipMenuCursor(e){oa=e,ea.querySelector(\".harlowe-4-tooltipItemSelected\")?.classList.remove(\"harlowe-4-tooltipItemSelected\");const a=ea.querySelectorAll(\".harlowe-4-tooltipItem\")[e];a&&(a.classList.add(\"harlowe-4-tooltipItemSelected\"),a.scrollIntoView({block:\"center\"}))}function makeCompletion(e,a,t){const r=e[e.length-1],{doc:o}=t,n=r.text.slice(0,o.indexFromPos(o.getCursor())),s=function macroCompletion(e,a,t){if(!1===Ye().completionsForMacros)return;if(t.some((e=>\"string\"===e.type)))return;let[,r]=/\\(([\\w_-]+)$/.exec(a)||[];if(!r)return;const o=Ve(r),n=la.filter((({name:e})=>Ve(e).startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(sa=a=>{e.replaceRange(`(${n[a].name}:)`,docCursorPlus(e,-(r.length+1)),e.getCursor()),e.setCursor(docCursorPlus(e,-1))},oa=0,na=n.length,n.map(((e,a)=>`<div class='cm-harlowe-4-macro cm-harlowe-4-root harlowe-4-tooltipItem${a?\"\":\" harlowe-4-tooltipItemSelected\"}'>(<span class=\"cm-harlowe-4-macroName-${e.returnType.toLowerCase()}\">${e.name}</span>:)</div>`)).join(\"\")):void 0}(o,n,e)||function keywordCompletion(e,a,t){if(!1===Ye().completionsForKeywords)return;if(!t.reduce(((e,a)=>void 0===e?\"macro\"===a.type||\"hook\"!==a.type&&\"string\"!==a.type&&e:e),void 0))return;let[,r]=/[^$\\w?]([-2]?[a-zA-Z ]+)$/.exec(a)||[];if(!r||\"-\"===r||\"\"===r[r.length-1].trim())return;const o=r.trimLeft().toLowerCase(),n=ca.filter((({name:e})=>e.startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(sa=a=>{e.replaceRange(n[a].name,docCursorPlus(e,-r.length),e.getCursor())},oa=0,na=n.length,n.map(((e,a)=>`<div style='display:flex;justify-content:space-between' class=\"harlowe-4-tooltipItem${a?\"\":\" harlowe-4-tooltipItemSelected\"}\"><span class='cm-harlowe-4-${e.type} cm-harlowe-4-root'>${e.name}</span><i style=\"display:inline-block;margin-left:2em;\">${e.label||e.type}</i></div>`)).join(\"\")):void 0}(o,n,e);if(s)return ea.innerHTML=s,ea.className=\"harlowe-4-tooltip harlowe-4-completion\",positionTooltip(t,a,!1),aa=0,t.addKeyMap(ia),oa=0,!0}function Tooltips(e,a){const{tree:t,lastAction:r}=a,{cm:o}=e;tooltipClear(o);const n=o.display.wrapper;ea.parentNode!==n&&(n.append(ea),n.addEventListener(\"mousemove\",(()=>{\"none\"===ea.style.display||n.querySelector(\".harlowe-4-tooltip:hover\")?aa>0&&(aa+=1):(ta-=1,ta<=0&&tooltipClear(o))})));const s=e.getCursor(),i=t.pathAt(Math.min(t.text.length-1,e.indexFromPos(s)));if(!i.length)return void(aa=0);const l=aa>0;(\"change\"===r?makeCompletion:makeHelpTooltip)(i,s,o)&&(l||tooltipAppear())}let ha=q.lex,{ShortDefs:da,insensitiveName:ma,getPrefs:pa,setOptionalStyles:ua}=X;const ga=Object.entries(da.Macro).reduce(((e,[a,t])=>([a,...t.aka].forEach((a=>e[a]=t)),e)),{}),mode=()=>{let e,a,t;const r=new WeakMap,docData=e=>(r.has(e)||refreshTree(e),r.get(e));function lexTreePostProcess(e,r,o){\"variable\"!==r.type&&\"tempVariable\"!==r.type&&\"hook\"!==r.type&&\"hookName\"!==r.type||e.referenceTokens[r.type].push(r),\"string\"===r.type&&(r.childAt=void 0,r.children=[]);let n={},s=\"\";for(let e=-1;e<o.length;e+=1){const{type:i,text:l}=-1===e?r:o[e];\"verbatim\"!==i&&\"comment\"!==i||(s=\"\");let c=`harlowe-4-${i}`;switch(n[c]=(n[c]||0)+1,n[c]>1&&(c+=`-${n[c]}`),i){case\"string\":{const e=l.slice(1,-1);a.has(e)?c+=\" harlowe-4-passageString\":t.has(e)&&(c+=\" harlowe-4-tagString\");break}case\"text\":if(l.trim()){o.slice(e+1).reduce(((e,a)=>void 0===e?\"macro\"===a.type||\"hook\"!==a.type&&e:e),void 0)&&(c+=\" harlowe-4-error\")}break;case\"macroName\":{const e=l[0];if(\"_\"===e||\"$\"===e){c+=` harlowe-4-customMacro harlowe-4-${\"_\"===e?\"tempV\":\"v\"}ariable`;break}const a=ma(l.slice(0,-1));Object.hasOwn(ga,a)?c+=`-${ga[a].returnType.toLowerCase()}`:c+=\" harlowe-4-error\";break}}s+=`${c} `}e.cssClasses[r.start]=s,r.children?.length&&(e.cssClasses[r.children[r.children.length-1].end]=s);for(let a=0;a<r.children.length;a+=1)lexTreePostProcess(e,r.children[a],[r].concat(o))}function refreshTree(e){let a;r.has(e)?a=r.get(e):(a={tooltipsEnabled:!0,lastAction:\"\"},r.set(e,a)),a.tree=ha(e.getValue()),a.referenceTokens={variable:[],tempVariable:[],hook:[],hookName:[]},a.cssClasses=Object.create(null),a.cursorMarks?.forEach((e=>e.clear())),a.cursorMarks=[];for(let e=0;e<a.tree.children.length;e+=1)lexTreePostProcess(a,a.tree.children[e],[a.tree])}let o,n,s=[],i=-1;const l={token(e){const{line:a}=e.lineOracle,t=e.pos;for(let r=0;r<s.length;r+=1){const{start:n,end:i}=s[r];if(!(n.line>a||i.line<a)&&(n.line<=a&&i.line>=a)){if((n.line<a||n.ch<=t)&&(i.line>a||i.ch>t))return i.line>a?e.skipToEnd():e.pos=i.ch,o===r?\"harlowe-4-findResultCurrent\":\"harlowe-4-findResult\";if(n.line===a&&n.ch>t)return void(e.pos=n.ch)}}e.skipToEnd()}};function harlowe3Find(a){if(e.removeOverlay(l),s=[],o=-1,a.matches=void 0,!a.query)return void(n=void 0);n=a;const{doc:t}=e,r=i>-1?i:Math.max(0,t.indexFromPos(t.getCursor())-1);try{a.regExp=new RegExp(a.useRegExp?a.query:a.query.replace(/[-[\\]/{}()*+?.\\\\^$|]/gm,\"\\\\$&\"),a.matchCase?\"g\":\"gi\")}catch(e){return void(n=void 0)}const c=t.getValue(),h=docData(t).tree,{onlyIn:d}=a;let m;e:for(;m=a.regExp.exec(c);){const a=m[0].length;if(!a)break;const{index:n}=m,l=m.slice(1);if(\"Only in prose\"===d||\"Only in code\"===d){let e=h.pathAt(n),t=e[0];for(let r=n;r<n+a;r+=1){let a;for(r>t.end&&(e=h.pathAt(r),t=e[0]),a=0;a<e.length;a+=1){const{type:t}=e[a];if(\"text\"===t||\"string\"===t){if(\"Only in code\"===d)continue e;break}}if(a===e.length&&\"Only in prose\"===d)continue e}}else if(\"Only in selection\"===d){const e=t.listSelections();let r=!1;for(let o=0;o<e.length&&!r;o+=1){const s=t.indexFromPos(e[o].anchor),i=t.indexFromPos(e[o].head);n>=Math.min(s,i)&&n+a<Math.max(s,i)&&(r=!0)}if(!r)continue e}const c=t.posFromIndex(n),p=t.posFromIndex(n+a);s.push({start:c,end:p,groups:l.length?l:null}),-1===o&&(n>r&&(o=s.length-1),i||e.scrollIntoView(c,e.display.wrapper.offsetHeight/2))}-1===o&&(o=0),e.addOverlay(l),a.matches=s.length,a.matchIndex=o,a.updateResultsDisplay?.(),i=-1}function harlowe3FindNext(a){o=(o+a)%s.length,o<0&&(o+=s.length),s[o]&&e.scrollIntoView(s[o].start,e.display.wrapper.offsetHeight/2),e.removeOverlay(l),e.addOverlay(l),n.matchIndex=o,n.updateResultsDisplay?.()}function harlowe3Replace(a,t){const{doc:r}=e,l=s[o];if(!t&&l)l.groups?.length&&(a=a.replace(/\\$(\\d+)/g,((e,a)=>l.groups[+a-1]||`$${a}`))),i=r.indexFromPos(l.start)+a.length-1,r.replaceRange(a,l.start,l.end);else if(s.length){const e=s[0].start,t=s[s.length-1].end;r.replaceRange(r.getValue().slice(r.indexFromPos(e),r.indexFromPos(t)).replace(n.regExp,a),e,t)}}const on=(e,a,t)=>(!e._handlers||!(e._handlers[a]||[]).some((e=>e.name===t.name)))&&e.on(a,t);let init=r=>{e||(e=r.cm,window===this&&(e.setOption(\"lineNumbers\",!0),e.setOption(\"lineNumberFormatter\",(()=>\"•\")))),X.twine23&&Toolbar?.(e,{foregroundColor:\"#888\"}),(()=>{let e;a=new Set,t=new Set;try{e=localStorage.getItem(\"twine-stories\").split(\",\")}catch(e){return}let r,o=0;for(let a of e)try{a=JSON.parse(localStorage.getItem(`twine-stories-${a}`));const e=Date.parse(a.lastUpdate);e>o&&document.title.includes(a.name)&&(r=a,o=e)}catch(e){continue}if(r)try{for(let e of localStorage.getItem(\"twine-passages\")?.split(\",\")||[]){let o=JSON.parse(localStorage.getItem(`twine-passages-${e}`));if(o.story===r.id){a.add(o.name);for(let e of o.tags)t.add(e)}}}catch(e){return}})(),ua(pa()),refreshTree(r),on(r,\"beforeChange\",(function harlowe3beforeChange(e,a){if(!r.cm.display.wrapper.parentNode)return;!function forceFullChange(e,a){if(!e.update)return;const t=e.from.line;let r=a.split(\"\\n\").slice(0,e.from.line+1);return r[t]=r[t].slice(0,e.from.ch)+e.text[0],r=r.concat(e.text.slice(1)),e.update({line:0,ch:0},e.to,r),r.join(\"\\n\")}(a,r.getValue())})),on(r,\"change\",(function harlowe3Change(){r.cm.display.wrapper.parentNode&&(docData(r).lastAction=\"changing\",refreshTree(r),n&&s[o]&&(-1===i&&(i=r.indexFromPos(s[o].start)-1),harlowe3Find(n)))})),on(r,\"cursorActivity\",(function harlowe3CursorActivity(){!function cursorMarking(e){const a=docData(e);let{tree:t,cursorMarks:r,referenceTokens:o}=a;r.length&&(r.forEach((e=>e.clear())),r=a.cursorMarks=[]);const n=t.tokenAt(e.indexFromPos(e.getCursor()));n&&(r.push(e.markText(e.posFromIndex(n.start),e.posFromIndex(n.end),{className:\"cm-harlowe-4-cursor\"})),(\"variable\"===n.type||\"tempVariable\"===n.type||\"hookName\"===n.type||\"hook\"===n.type)&&o[\"hook\"===n.type?\"hookName\":n.type].forEach((a=>{a!==n&&a.name===n.name&&r.push(e.markText(e.posFromIndex(a.start),e.posFromIndex(a.end),{className:\"cm-harlowe-4-variableOccurrence\"}))})),\"hookName\"!==n.type&&\"hook\"!==n.type||o.hook.forEach((a=>{if(a!==n&&a.name&&a.name===n.name){const t=\"appended\"===a.tagPosition?a.end-a.name.length-1:a.start+1;r.push(e.markText(e.posFromIndex(t),e.posFromIndex(t+a.name.length),{className:\"cm-harlowe-4-hookOccurrence\"}))}})))}(r);const e=docData(r);e.lastAction=\"changing\"===e.lastAction?\"change\":\"cursorActivity\",Tooltips?.(r,e)})),on(e,\"renderLine\",(function harlowe3RenderLine(e,a,t){Array.from(t.querySelectorAll(\".cm-harlowe-4-colour\")).forEach((e=>{const{colour:a}=ha(e.textContent,\"\",\"macro\").tokenAt(0);e.setAttribute(\"style\",`background:linear-gradient(to bottom,transparent,transparent 80%,${a} 80.1%,${a})`)}))})),on(e,\"scroll\",(function harlowe3Scroll(){const e=document.querySelector(\".harlowe-4-tooltip\");e?.remove()})),on(e,\"harlowe-4-find\",harlowe3Find),on(e,\"harlowe-4-findNext\",harlowe3FindNext),on(e,\"harlowe-4-replace\",harlowe3Replace),on(e,\"harlowe-4-findDone\",(function harlowe3FindDone(){e.removeOverlay(l)})),init=null};return{startState:()=>({pos:0,disconnected:null,styleBeforeNewline:\"\"}),blankLine(e){e.pos++},token(e,a){const{doc:t}=e.lineOracle;if(null===a.disconnected?a.disconnected=!t.cm.display.wrapper.parentNode:a.disconnected)return a.pos++,e.next(),null;init?.(t);const{cssClasses:r}=docData(t),o=r[a.pos]||a.styleBeforeNewline||null;do{a.pos++,e.next()}while(!(r[a.pos]!==o&&a.pos in r||e.eol()));return e.eol()?(a.styleBeforeNewline=o,a.pos++):a.styleBeforeNewline=\"\",o}}};\"CodeMirror\"in window?window.CodeMirror.defineMode(\"harlowe-4\",mode):this.editorExtensions={twine:{2:{codeMirror:{mode,toolbar:Toolbar,commands:Fe}}}};let ya=document.querySelector(\"style#cm-harlowe-4\");ya||(ya=document.createElement(\"style\"),ya.setAttribute(\"id\",\"cm-harlowe-4\"),document.head.appendChild(ya)),ya.innerHTML=\".cm-harlowe-4-cursor:not([class^='cm-harlowe-4-verbatim']):not([class^='cm-harlowe-4-text cm-harlowe-4-root']) { border-bottom: 2px solid darkgray; }.cm-harlowe-4-findResult { background-color: hsla(280,100%,70%,0.4) !important; } .cm-harlowe-4-findResultCurrent { background-color: hsla(320,100%,70%,0.6) !important; }.cm-harlowe-4-root .cm-tab { text-decoration: line-through dotted #888; border-right: dotted 1px #888; }.CodeMirror {padding: 0 !important}.CodeMirror-linenumber {color: hsla(0,0%,80%,1.0);}.CodeMirror-gutters {left: 0px !important;}.cm-harlowe-4-root{box-sizing:border-box;}.cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.theme-dark .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.theme-dark .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.theme-dark .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.theme-dark .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.theme-dark .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.theme-dark .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.theme-dark .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}.theme-dark .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[class^='cm-harlowe-4-hook '], [class^='cm-harlowe-4-hook-']{font-weight:bold;}.cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.theme-dark .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}[data-app-theme=dark] .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}.theme-dark .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[data-app-theme=dark] .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[class^='cm-harlowe-4-macroName']{font-style:italic;}.cm-harlowe-4-macroName-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-macroName-array{color:hsla(0,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}.cm-harlowe-4-macroName-dataset{color:hsla(30,100%,40%,1.0)}.theme-dark .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}.cm-harlowe-4-macroName-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-macroName-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-macroName-datamap{color:hsla(60,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}.cm-harlowe-4-macroName-changer{color:hsla(90,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}.cm-harlowe-4-macroName-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-macroName-colour, .cm-harlowe-4-macroName-gradient{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-colour, .theme-dark .cm-harlowe-4-macroName-gradient{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-colour, [data-app-theme=dark] .cm-harlowe-4-macroName-gradient{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-macroName-command, .cm-harlowe-4-macroName-instant, .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-macroName-command, .theme-dark .cm-harlowe-4-macroName-instant, .theme-dark .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-command, [data-app-theme=dark] .cm-harlowe-4-macroName-instant, [data-app-theme=dark] .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-macroName-custommacro, .cm-harlowe-4-macroName-macro, .cm-harlowe-4-macroName-any{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-custommacro, .theme-dark .cm-harlowe-4-macroName-macro, .theme-dark .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-custommacro, [data-app-theme=dark] .cm-harlowe-4-macroName-macro, [data-app-theme=dark] .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,80%,30%,1.0)}.theme-dark [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-comma, .cm-harlowe-4-spread{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-comma, .theme-dark .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-comma, [data-app-theme=dark] .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-addition{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-subtraction, .cm-harlowe-4-multiplication, .cm-harlowe-4-division{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-subtraction, .theme-dark .cm-harlowe-4-multiplication, .theme-dark .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-subtraction, [data-app-theme=dark] .cm-harlowe-4-multiplication, [data-app-theme=dark] .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-is, .cm-harlowe-4-and, .cm-harlowe-4-or, .cm-harlowe-4-not, .cm-harlowe-4-isNot, .cm-harlowe-4-contains, .cm-harlowe-4-doesNotContain, .cm-harlowe-4-isIn, .cm-harlowe-4-isA, .cm-harlowe-4-isNotA, .cm-harlowe-4-isNotIn, .cm-harlowe-4-matches, .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-is, .theme-dark .cm-harlowe-4-and, .theme-dark .cm-harlowe-4-or, .theme-dark .cm-harlowe-4-not, .theme-dark .cm-harlowe-4-isNot, .theme-dark .cm-harlowe-4-contains, .theme-dark .cm-harlowe-4-doesNotContain, .theme-dark .cm-harlowe-4-isIn, .theme-dark .cm-harlowe-4-isA, .theme-dark .cm-harlowe-4-isNotA, .theme-dark .cm-harlowe-4-isNotIn, .theme-dark .cm-harlowe-4-matches, .theme-dark .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-is, [data-app-theme=dark] .cm-harlowe-4-and, [data-app-theme=dark] .cm-harlowe-4-or, [data-app-theme=dark] .cm-harlowe-4-not, [data-app-theme=dark] .cm-harlowe-4-isNot, [data-app-theme=dark] .cm-harlowe-4-contains, [data-app-theme=dark] .cm-harlowe-4-doesNotContain, [data-app-theme=dark] .cm-harlowe-4-isIn, [data-app-theme=dark] .cm-harlowe-4-isA, [data-app-theme=dark] .cm-harlowe-4-isNotA, [data-app-theme=dark] .cm-harlowe-4-isNotIn, [data-app-theme=dark] .cm-harlowe-4-matches, [data-app-theme=dark] .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-bold, .cm-harlowe-4-strong{font-weight:bold;}.cm-harlowe-4-italic, .cm-harlowe-4-em{font-style:italic;}.cm-harlowe-4-sup{vertical-align: super;font-size:0.8em;}.cm-harlowe-4-strike{text-decoration: line-through;}.cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)}.theme-dark .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)}[data-app-theme=dark] .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)}[class^='cm-harlowe-4-bold'], [class^='cm-harlowe-4-strong'], [class^='cm-harlowe-4-italic'], [class^='cm-harlowe-4-em'], [class^='cm-harlowe-4-sup'], [class^='cm-harlowe-4-verbatim'], [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,0%,0.5)}.theme-dark [class^='cm-harlowe-4-bold'], .theme-dark [class^='cm-harlowe-4-strong'], .theme-dark [class^='cm-harlowe-4-italic'], .theme-dark [class^='cm-harlowe-4-em'], .theme-dark [class^='cm-harlowe-4-sup'], .theme-dark [class^='cm-harlowe-4-verbatim'], .theme-dark [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[data-app-theme=dark] [class^='cm-harlowe-4-bold'], [data-app-theme=dark] [class^='cm-harlowe-4-strong'], [data-app-theme=dark] [class^='cm-harlowe-4-italic'], [data-app-theme=dark] [class^='cm-harlowe-4-em'], [data-app-theme=dark] [class^='cm-harlowe-4-sup'], [data-app-theme=dark] [class^='cm-harlowe-4-verbatim'], [data-app-theme=dark] [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.theme-dark .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}[data-app-theme=dark] .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-tag, .cm-harlowe-4-scriptStyleTag, .cm-harlowe-4-comment{color: hsla(240,34%,25%,1.0);}.theme-dark .cm-harlowe-4-tag, .theme-dark .cm-harlowe-4-scriptStyleTag, .theme-dark .cm-harlowe-4-comment{color: hsla(240,51%,75%,1.0);}[data-app-theme=dark] .cm-harlowe-4-tag, [data-app-theme=dark] .cm-harlowe-4-scriptStyleTag, [data-app-theme=dark] .cm-harlowe-4-comment{color: hsla(240,51%,75%,1.0);}.cm-harlowe-4-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-variable{color:hsla(200,100%,30%,1.0)}.theme-dark .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}.cm-harlowe-4-tempVariable{color:hsla(200,70%,20%,1.0)}.theme-dark .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}.cm-harlowe-4-hookName{color:hsla(160,100%,30%,1.0)}.theme-dark .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}.cm-harlowe-4-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-colour{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-cssTime{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-passageString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px;}.theme-dark .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}[data-app-theme=dark] .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}.cm-harlowe-4-tagString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px dotted;}.theme-dark .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}[data-app-theme=dark] .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}.cm-harlowe-4-variableOccurrence, .cm-harlowe-4-hookOccurrence{background: hsla(159,50%,75%,1.0) !important;}.theme-dark .cm-harlowe-4-variableOccurrence, .theme-dark .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[data-app-theme=dark] .cm-harlowe-4-variableOccurrence, [data-app-theme=dark] .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[class^='cm-harlowe-4-where'], [class^='cm-harlowe-4-via'], [class^='cm-harlowe-4-with'], [class^='cm-harlowe-4-making'], [class^='cm-harlowe-4-each'], [class^='cm-harlowe-4-when']{color:hsla(120,100%,40%,1.0); font-style:italic;}.theme-dark [class^='cm-harlowe-4-where'], .theme-dark [class^='cm-harlowe-4-via'], .theme-dark [class^='cm-harlowe-4-with'], .theme-dark [class^='cm-harlowe-4-making'], .theme-dark [class^='cm-harlowe-4-each'], .theme-dark [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}[data-app-theme=dark] [class^='cm-harlowe-4-where'], [data-app-theme=dark] [class^='cm-harlowe-4-via'], [data-app-theme=dark] [class^='cm-harlowe-4-with'], [data-app-theme=dark] [class^='cm-harlowe-4-making'], [data-app-theme=dark] [class^='cm-harlowe-4-each'], [data-app-theme=dark] [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}.cm-harlowe-4-heading{font-weight:bold;}.cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);}.theme-dark .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}[data-app-theme=dark] .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}.cm-harlowe-4-align{color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);}.theme-dark .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}.cm-harlowe-4-column{color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);}.theme-dark .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}.cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,30%,1.0);}.theme-dark .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}.cm-harlowe-4-identifier, .cm-harlowe-4-property, .cm-harlowe-4-belongingProperty, .cm-harlowe-4-itsProperty, .cm-harlowe-4-belongingItProperty, .cm-harlowe-4-belongingItOperator, .cm-harlowe-4-possessiveOperator, .cm-harlowe-4-belongingOperator{color:hsla(200,80%,40%,1.0)}.theme-dark .cm-harlowe-4-identifier, .theme-dark .cm-harlowe-4-property, .theme-dark .cm-harlowe-4-belongingProperty, .theme-dark .cm-harlowe-4-itsProperty, .theme-dark .cm-harlowe-4-belongingItProperty, .theme-dark .cm-harlowe-4-belongingItOperator, .theme-dark .cm-harlowe-4-possessiveOperator, .theme-dark .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-identifier, [data-app-theme=dark] .cm-harlowe-4-property, [data-app-theme=dark] .cm-harlowe-4-belongingProperty, [data-app-theme=dark] .cm-harlowe-4-itsProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItOperator, [data-app-theme=dark] .cm-harlowe-4-possessiveOperator, [data-app-theme=dark] .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}@keyframes harlowe-4-appear{0%{opacity:0}to{opacity:1}}@keyframes harlowe-4-fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes harlowe-4-rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes harlowe-4-shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes harlowe-4-buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes harlowe-4-sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes harlowe-4-pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes harlowe-4-zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes harlowe-4-shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes harlowe-4-rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes harlowe-4-fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes harlowe-4-slide-right{0%{transform:translateX(-100vw)}}@keyframes harlowe-4-slide-left{0%{transform:translateX(100vw)}}@keyframes harlowe-4-slide-up{0%{transform:translateY(100vh)}}@keyframes harlowe-4-slide-down{0%{transform:translateY(-100vh)}}@keyframes harlowe-4-fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes harlowe-4-fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes harlowe-4-fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes harlowe-4-fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes harlowe-4-flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes harlowe-4-blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}\\n.harlowe-4-toolbarPanel{transition:max-height .8s;overflow-y:auto;margin-bottom:4px}.harlowe-4-minimised .harlowe-4-toolbarPanel>:not(:last-child){display:none}.harlowe-4-toolbarPanel code:not(:empty){font-size:1rem;border:1px dotted hsl(0, 0%, 50%)}.harlowe-4-toolbarPanel [type=radio][disabled]~*{opacity:.5}.harlowe-4-stylePreview{text-align:center;user-select:none;background:black;color:white;font-family:\\\"Georgia\\\",serif;padding:8px;font-size:1.5rem;margin:8px auto;width:60%;position:sticky;top:0;z-index:1}.harlowe-4-stylePreview textarea{background:black;color:white}.harlowe-4-stylePreview>span{display:inline-block}.harlowe-4-stylePreview>span:first-child{position:absolute}.harlowe-4-stylePreview>span:last-child{position:relative}.harlowe-4-toolbarPanel>button{border-radius:.8rem;margin:0px 2px;padding:0px 4px;height:36px;font-size:1.2rem;min-width:28px}.harlowe-4-toolbarPanel>button:not(:active):not(.active):not(:last-child){border:1px solid hsla(0, 0%, 50%, 0.5);border-top:none;border-left:none}.harlowe-4-toolbarCheckboxes{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);position:relative;padding-bottom:8px;margin-bottom:8px}.harlowe-4-toolbarPanel label:not(.harlowe-4-radioRow){white-space:nowrap}.harlowe-4-toolbarCheckboxes>label{min-width:20%;display:inline-block}.harlowe-4-swatch{width:24px;height:24px;display:inline-block;cursor:pointer;border-bottom:1px solid hsla(0, 0%, 50%, 0.5);border-right:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-labeledInput{position:relative;padding-bottom:8px}.harlowe-4-labeledInput>input[type=text]{display:inline-block;font-size:1rem}.harlowe-4-labeledInput>input[type=range]{vertical-align:middle}.harlowe-4-labeledInput>input[type=number]{box-shadow:0 1px 0 hsla(0, 0%, 50%, 0.5);background:transparent;color:inherit;border:none;font-family:\\\"Source Code Pro\\\",monospace;font-family:var(--font-monospaced);width:4rem;margin:0 .5rem;display:inline-block;font-size:1rem}.harlowe-4-radioRow{margin:8px 0px;display:block}.harlowe-4-radioRow .harlowe-4-radioRow{margin-left:2rem}.harlowe-4-toolbarPanel>*>.harlowe-4-radioRow{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);padding-bottom:8px}.harlowe-4-confirmButtons>span{display:inline-block;align-items:center}.harlowe-4-resultCode{max-width:50%;overflow-x:auto;white-space:pre;display:inline-block;padding:1px 0px}.harlowe-4-resultCode *{white-space:nowrap}.harlowe-4-toolbarBullet{padding:0px 2px;color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarBullet::before{content:\\\"•\\\"}.harlowe-4-bgColourButton{display:inline-block;border-radius:8px;width:16px;height:16px;margin-bottom:-2px;background:linear-gradient(to right, hsla(0, 100%, 50%, 0.5), hsla(30, 100%, 50%, 0.5), hsla(60, 100%, 50%, 0.5), hsla(120, 100%, 50%, 0.5), hsla(180, 100%, 50%, 0.5), hsla(240, 100%, 50%, 0.5), hsla(300, 100%, 50%, 0.5), hsla(320, 100%, 50%, 0.5))}.harlowe-4-gradientBar{display:inline-block;position:relative;width:75%;height:32px;margin:12px 8px 96px 40px;border:1px solid hsla(0, 0%, 50%, 0.5);border-radius:5px}.harlowe-4-gradientBar+button{position:absolute;top:8px;right:8px}.harlowe-4-colourStop{position:absolute;height:48px;width:16px;background:hsla(0, 0%, 50%, 0.5);border-radius:5px;cursor:grab}.harlowe-4-colourStop:active{cursor:grabbing}.harlowe-4-colourStopButtons{display:none;position:relative;top:64px;width:540px;background:hsla(0, 0%, 50%, 0.5);padding:8px;cursor:auto}.harlowe-4-colourStop[selected]{border-bottom-right-radius:0px;border-bottom-left-radius:0px;height:64px}.harlowe-4-colourStop[selected]>.harlowe-4-colourStopButtons{display:block}.harlowe-4-singleColourPicker{display:inline-block}.harlowe-4-singleColourPicker select{position:relative;top:-4px;font-size:1rem;margin-left:8px}.harlowe-4-directionPicker{width:48px;height:48px;border-radius:24px;border:1px solid hsla(0, 0%, 50%, 0.5);display:inline-block}.harlowe-4-hideCode .cm-harlowe-4-root:not(.cm-harlowe-4-text):not(.cm-harlowe-4-string):not(.cm-harlowe-4-verbatim){opacity:.25}.harlowe-4-hideHelpTooltip .harlowe-4-helpTooltip{display:none}.harlowe-4-tooltip{font-family:var(--font-system);max-width:20vw;position:absolute;border:1px solid hsla(0, 0%, 50%, 0.5);padding:8px;display:block;z-index:8}[data-version^=\\\"2.3\\\"] .harlowe-4-tooltip{font-family:\\\"Source Sans Pro\\\",sans-serif}.theme-light .harlowe-4-tooltip,[data-app-theme=light] .harlowe-4-tooltip{background:white}.theme-dark .harlowe-4-tooltip,[data-app-theme=dark] .harlowe-4-tooltip{background:black}.harlowe-4-tooltipMacroSignature{display:block;padding-top:.5em;margin-top:.5em;border-top:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail{position:absolute;height:0;width:0;border:12px solid transparent;border-bottom-color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail::after{content:\\\"\\\";position:absolute;height:0;width:0;left:-12px;top:-10px;border:12px solid transparent}.harlowe-4-completion{max-height:12em;overflow-y:scroll}.harlowe-4-tooltipItemSelected{background-color:#888;background-color:var(--light-gray-translucent)}.theme-light .harlowe-4-tooltipTail::after,[data-app-theme=light] .harlowe-4-tooltipTail::after{border-bottom-color:white}.theme-dark .harlowe-4-tooltipTail::after,[data-app-theme=dark] .harlowe-4-tooltipTail::after{border-bottom-color:black}.harlowe-4-dataEmptyRow:not(:last-child){display:none}.harlowe-4-dataRow .harlowe-4-dropdownRowLabel{font-family:\\\"Source Code Pro\\\",monospace;font-family:var(--font-monospaced)}.harlowe-4-textareaRows{margin-bottom:.5em}.harlowe-4-nonZeroRows>:first-child>.harlowe-4-rowMinus{display:none}.harlowe-4-datavalueRows{margin-left:6px;padding-left:6px;border-left:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarPanel [invalid]::after{display:block;position:absolute;content:attr(invalid);background-color:hsla(17, 100%, 50%, 0.5);right:0px;bottom:8px}.harlowe-4-datavalueRows .harlowe-4-datavalueRows .harlowe-4-datavalueRowHint{display:none}.story-format-toolbar .icon>img:only-child{margin-right:0px}.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{display:flex;justify-content:end}.passage-edit-dialog.collapsed .harlowe-4-toolbarPanel{display:none}.harlowe-4-scrollWrapper{overflow:hidden auto;max-height:60vh}.harlowe-4-toolbarPanel a[href]{color:var(--dark-blue);font-weight:bold}.harlowe-4-toolbarPanel.card{position:absolute;width:576px;height:auto;top:0px;padding:8px}.story-format-toolbar+.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{justify-content:start;flex-flow:row-reverse}.harlowe-4-toolbarPanel textarea,.harlowe-4-toolbarPanel [type=text]{background:var(--white-translucent);border-radius:var(--corner-round);border:1px solid var(--faint-gray);color:var(--dark-gray)}html:not([data-version^=\\\"2.3\\\"]) .harlowe-4-toolbarPanel [type=checkbox]{background:transparent;border:2px solid var(--dark-gray);width:16px;height:16px;appearance:none;position:relative;border-radius:2px;margin:0px 6px;vertical-align:middle}html:not([data-version^=\\\"2.3\\\"]) .harlowe-4-toolbarPanel [type=checkbox]:checked::before{content:\\\"✔\\\";position:absolute;right:-2px;top:-4px;margin-right:3px}select>option{background-color:var(--light-gray);color:var(--dark-gray) !important}.harlowe-4-radioRow{padding-left:0px;padding-right:0px;user-select:none;position:relative}.harlowe-4-radioRow>:first-child,.harlowe-4-radioRow>:nth-child(2){cursor:pointer}.harlowe-4-radioRow>div{padding:var(--grid-size)}.harlowe-4-toolbarPanel select{padding:var(--grid-size)}.harloweToolbar+.story-format-toolbar button{padding:calc(var(--grid-size) - 1px)}#root>.dialogs>:not(.passag-edit-stack){z-index:-1}\\n\";\n"});